{{< include macros.qmd >}}

As usual, by independence, we have:

:::{#lem-score-logistic}

$$
\ba
\brown{\llik'(\vb)}
   &\eqdef \deriv{\vb} \llik(\vb)
\\ &=      \deriv{\vb} \sumin \llik_i(\vb)
\\ &=      \sumin \deriv{\vb} \llik_i(\vb)
\\ &=      \sumin \magenta{\llik'_i(\vb)}
\ea
$$
:::

---

We can apply the [vector chain rule](math-prereqs.qmd#thm-chain-vec) here:

:::{#lem-logistic-score-comp}

$$
\ba
\magenta{\llik_i'(\vb)}
   &= \deriv{\vb} \llik_i(\vb)
\\ &= \deriv{\vb}\paren{y_i \eta_i + \logf{1-\pi_i}}
\\ &= \deriv{\vb}y_i\eta_i + \deriv{\vb}\logf{1-\pi_i}
\\ &= \red{\derivf{\eta_i}{\vb}}y_i - \purple{\derivf{\pi_i}{\vb}}\frac{1}{1-\pi_i}
\ea
$$

:::

---

:::{#lem-d_eta_d_vb}

$$
\ba
\red{\derivf{\eta_i}{\vb}} &= \deriv{\vb}(\vx_i \cdot \vb)
\\
&= \red{\vx_i}
\ea
$${#eq-d_eta_d_vb}

:::

---

To derive $\purple{\derivf{\pi_i}{\vb}}$,
we can apply the [vector chain rule](math-prereqs.qmd#thm-chain-vec) again:

:::{#lem-d_pi_d_beta}

$$
\purple{\derivf{\pi}{\vb}} =
 \red{\derivf{\eta}{\vb}}\green{\derivf{\omega}{\eta}} \blue{\derivf{\pi}{\omega}} 
$$

:::

---

We found
$\red{\derivf{\eta}{\vb}} = \red{\vx}$ already in @lem-d_eta_d_vb.

The other two are also quick:

:::{#lem-d_pi-d_omega}

By @cor-deriv-invodds-pi-scale:

$$
\ba
\blue{\derivf{\pi}{\omega}} &= \deriv{\omega} \oddst^{-1}(\odds)
\\
&= \blue{(1-\pi)^2}
\ea
$${#eq-dpi-domega}

:::

:::{#lem-d_omega-d_eta}

$$
\ba
\green{\derivf{\omega}{\eta}} &=  \deriv{\eta} \exp{\eta}
\\
&= \exp{\eta}
\\
&= \omega
\\
&= \green{\frac{\pi}{1-\pi}}
\ea
$${#eq-d_omega-d_eta}

:::

---

Let's first combine 
$\green{\derivf{\omega}{\eta}} \blue{\derivf{\pi}{\omega}} = \orange{\derivf{\pi}{\eta}}$ to get two more results:

:::{#thm-d_pi-d_eta}

$$
\ba
\orange{\derivf{\pi}{\eta}} &= \green{\derivf{\omega}{\eta}} \blue{\derivf{\pi}{\omega}}
\\
&= \green{\frac{\pi}{1-\pi}}  \blue{(1-\pi)^2}
\\
&= \orange{\pi (1-\pi)}
\ea
$$
:::

:::{#cor-d_pi-d_eta-var}
$$\derivf{\pi}{\eta} = \Varf{Y|X=x}$$
:::


---

Combining @lem-d_pi_d_beta, @lem-d_eta_d_vb, and @thm-d_pi-d_eta:

:::{#thm-d_pi_d_beta}

$$
\ba
\purple{\derivf{\pi}{\vb}} &=
 \red{\derivf{\eta}{\vb}}\green{\derivf{\omega}{\eta}} \blue{\derivf{\pi}{\omega}} 
\\
&=
 \red{\derivf{\eta}{\vb}}\orange{\derivf{\pi}{\eta}}
\\
&= \paren{\red{\vx}} \paren{\orange{\pi (1-\pi)}}
\\
&= \purple{\vx \pi (1-\pi)}
\ea
$$

:::

---

Now we can combine 
@lem-logistic-score-comp,
@lem-d_pi_d_beta,
and
@thm-d_pi_d_beta:

:::{#thm-logistic-score-comp}
$$
\ba
\magenta{\llik_i'(\vb)}
&= \red{\derivf{\eta_i}{\vb}}y_i - \purple{\derivf{\pi_i}{\vb}}\frac{1}{1-\pi_i}
\\
&= \red{\vx_i}y_i - \purple{\vx_i \pi_i (1-\pi_i)}\frac{1}{1-\pi_i}
\\
&= \vx_i y_i - \vx_i \pi_i
\\ &= \vx_i (y_i - \pi_i)
\\ &= \vx_i (y_i - \mu_i)
\\ &= \vx_i (y_i - \Expp[Y_i|\vX_i=\vx_i])
\\ &= \vx_i \ \err(y_i|\vX_i=\vx_i)
\\ &= \magenta{\vx_i \err_i}
\ea
$$

:::

::: notes

This last expression is essentially the same as we found in [linear regression](Linear-models-overview.qmd#eq-scorefun-linreg).
:::

---

Finally, 
combining @lem-score-logistic and @thm-logistic-score-comp, 
we have:

:::{#thm-logistic-score-fn}

$$
\ba
\brown{\llik'(\vb)} &= \sumin \magenta{\llik_i'(\vb)}\\
&= \brown{\sumin \vx_i\eps_i}
\ea
$${#eq-logit-score}

:::

---

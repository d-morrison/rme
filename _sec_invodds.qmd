{{< include macros.qmd >}}

:::{#def-inv-odds}

##### inverse odds function
The **inverse odds function**,

$$\invoddsf{\odds} \eqdef \frac{\odds}{1 + \odds}$$
converts odds into their corresponding probabilities (@fig-inv-odds).
:::

---

The inverse-odds function takes an odds as input and produces a probability as output.
Its domain of inputs is $[0,\infty)$ and its range of outputs is $[0,1]$.

I haven't seen anyone give the inverse-odds function a concise name; maybe $\text{prob}()$ or $\text{probs}()$ or $\text{risk}()$?

---

:::{#lem-invodds-pi}

If $\pi$ is the probability of an event
and $\omega$ is the corresponding odds of that events,
then:

$$\pi = \invoddsf{\odds} = \frac{\odds}{1+\odds}$$

This formula is derived as follows: Recall that odds are defined as
$\odds = \frac{\Pr(A)}{\Pr(\neg A)}$, where $\Pr(\neg A) = 1 - \Pr(A)$.
Solving for $\Pr(A)$ in terms of $\odds$, we get:

$$\Pr(A) = \frac{\odds}{1 + \odds}.$$
:::

---


```{r}
#| label: fig-inv-odds
#| fig-cap: The inverse odds function, $\invoddsf{\odds}$
odds_inv <- function(omega) (1 + omega^-1)^-1
library(ggplot2)
ggplot() +
  geom_function(fun = odds_inv, aes(col = "inverse-odds")) +
  xlab("Odds") +
  ylab("Probability") +
  xlim(0, 5) +
  ylim(0, 1) +
  geom_abline(aes(intercept = 0, slope = 1, col = "x=y"))
```

---

:::{#exr-odds-probs}

What probability corresponds to an odds of $\odds = 1$, and what is the numerical difference between these two values?

:::

---

::::{.solution}
$$
\pi(1) = \frac{1}{1+1}
=\frac{1}{2}
= .5
$$
$$
1 - \pi(1) = 1 - .5 = .5
$$

::::

---

:::{#lem-invodds-simplified}

##### Simplified expression for inverse odds function

::: notes
An equivalent expression for the inverse odds function is
:::

$$
\pi(\odds) = (1+\odds^{-1})^{-1}
$$ {#eq-inv-odds-reduced}

:::

---

:::{#exr-inv-odds2}
Prove that @eq-inv-odds-reduced is equivalent to @def-inv-odds.
:::

---

:::{#sol-inv-odds2}

Analogous to @sol-odds2.

:::

---


:::{#lem-one-minus-odds-inv}
#### One minus inverse-odds


$$1 - \oddsinvf{\odds} = \frac{1}{1+\odds}$$
:::

---

::: {.proof}

$$
\ba
1 - \oddsinvf{\odds} &= 1 - \frac{\odds}{1 + \odds}
\\ &= \frac{\red{1+\odds}}{1 + \odds} - \frac{\blue{\odds}}{1 + \odds}
\\ &= \frac{\red{(1+\odds)} - \blue{\odds}}{1 + \odds}
\\ &= \frac{1 + \odds - \odds}{1 + \odds}
\\ &= \frac{1}{1 + \odds}
\ea
$$
:::

---

:::{#lem-inverse-odds-nonevent}

If $\odds$ is the odds of event $A$,
then the probability that $A$ does not occur is:

$$\Pr(\neg A) = \frac{1}{1+\odds}$$
:::

---

::: proof

:::: notes
Use @cor-p-neg0 and @lem-one-minus-odds-inv:
::::

$$
\ba
\Pr(\neg A)
&= 1 - \Pr(A)
\\ &= 1 - \oddsinvf{\odds}
\\ &= \frac{1}{1 + \odds}
\ea
$$
:::

---

:::{#cor-inverse-odds-nonevent}

If $\prob$ is the probability of event $A$ 
and $\odds$ is the corresponding odds of event $A$,
then:

$$1-\pi = \frac{1}{1+\odds}$$
:::

---

::: proof

Combine @lem-inverse-odds-nonevent and @cor-p-neg.

:::

---

:::{#lem-deriv-invodds}

##### Derivative of inverse odds function
$$\doddsinvf{\odds} = \frac{1}{\sqf{1+\odds}}$$
:::

---

::: proof

:::: notes
Use the quotient rule:
::::

$$
\ba
{\oddsinv}'(\odds)
&= \deriv{\odds} \oddsinvf{\odds}
\\ &= \deriv{\odds} \frac{\odds}{1+\odds}
\\ &= \frac{\deriv{\odds}\odds}{1+\odds} - \frac{\odds}{\sqf{1+\odds}} \cd \deriv{\odds}(1+\odds)
\\ &= \frac{1}{1+\odds} - \frac{\odds}{\sqf{1+\odds}} \cd 1
\\ &= \frac{1}{1+\odds} - \frac{\odds}{\sqf{1+\odds}}
\\ &= \frac{1+\odds}{\sqf{1+\odds}} - \frac{\odds}{\sqf{1+\odds}}
\\ &= \frac{1+\odds - \odds}{\sqf{1+\odds}}
\\ &= \frac{1}{\sqf{1+\odds}}
\ea
$$

:::

---


:::{#cor-deriv-invodds}

$$\doddsinvf{\odds} = \sqf{1 - \oddsinvf{\odds}}$$
:::

---

:::{#cor-deriv-invodds-pi-scale}

$$\doddsinvf{\odds} = (1-\pi)^2$$

:::

---

::: proof

Combining @cor-inverse-odds-nonevent and @lem-deriv-invodds:

$$
\ba
\doddsinvf{\odds} &= \sqf{\frac{1}{1+\omega}}
\\
&= (1-\pi)^2
\ea
$$
:::

---

:::{#cor-d_prob-d_odds}

$$\derivf{\prob}{\odds} = (1-\prob)^2$${#eq-d_prob-d_odds}

:::

---

::: proof

By @cor-deriv-invodds-pi-scale:

$$
\ba
\derivf{\pi}{\omega} &= \deriv{\omega} \oddst^{-1}(\odds)
\\
&= (1-\pi)^2
\ea
$$

Alternatively, by @cor-d_odds-d_prob:

$$
\ba
\derivf{\prob}{\odds} 
&= \invf{\derivf{\odds}{\prob}}
\\
&= \invf{\frac{1}{\sqf{1-\prob}}}
\\
&= \sqf{1-\prob}
\ea
$$

:::



---

### Odds ratios

::: notes

Now that we have defined odds, we can introduce another way of comparing event probabilities: odds ratios.

:::

:::{#def-OR}
##### Odds ratio
The **odds ratio** for two odds $\odds_1$, $\odds_2$ is their ratio:

$$\theta(\odds_1, \odds_2) = \frac{\odds_1}{\odds_2}$$

:::

---

:::{#exm-OR}
#### Calculating odds ratios
In @exm-oc-mi, the odds ratio for OC users versus OC-non-users is:

$$
\begin{aligned}
\theta(\odds(OC), \odds(\neg OC))
&= \frac{\odds(OC)}{\odds(\neg OC)}\\
&= \frac{`r pi_OC`}{`r pi_nOC`}\\
&= `r pi_OC / pi_nOC`\\
\end{aligned}
$$
:::

---

#### A shortcut for calculating odds ratio estimates {.smaller}

::: notes
The general form of a two-by-two table is shown in @tbl-2x2-generic.


|               | Event | Non-Event | Total
|-------------- | ------ | ---------- | -----
|Exposed        | a      | b | a+b
|Non-exposed    | c      | d | c+d
|Total         | a+c   | b+d | a+b+c+d

: A generic 2x2 table {#tbl-2x2-generic}

:::

::: notes
From this table, we have:
:::

* $\hat\pi(Event|Exposed) = a/(a+b)$

* $\hat\pi(\neg Event|Exposed) = b/(a+b)$

* $\hat\odds(Event|Exposed) = \frac{\frac{a}{a+b}}{\frac{b}{a+b}}=\frac{a}{b}$

* $\hat\odds(Event|\neg Exposed) = \frac{c}{d}$
(see @exr-odds-generic)

* $\theta(Exposed,\neg Exposed) = \frac{\frac{a}{b}}{\frac{c}{d}} = \frac{ad}{bc}$

---

:::{#exr-odds-generic}
Given @tbl-2x2-generic, show that $\hat\odds(Event|\neg Exposed) = \frac{c}{d}$.
:::

---

#### Properties of odds ratios {#sec-OR-props}

{{< include _sec_ORs_reversible.qmd >}}

#### Odds Ratios vs Probability (Risk) Ratios {#sec-OR-RR}

::: notes
When the outcome is rare (i.e., its probability is small) for both groups being compared in an odds ratio, the odds of the outcome will be similar to the probability of the outcome, and thus the risk ratio will be similar to the odds ratio.
:::

##### Case 1: rare events

For rare events, odds ratios and probability (a.k.a. risk, a.k.a.
prevalence) ratios will be close:

$$\pi_1 = .01$$
$$\pi_2 = .02$$

```{r "rare events or-rr"}
#| code-fold: show
pi1 <- .01
pi2 <- .02
pi2 / pi1
odds(pi2) / odds(pi1)
```

---

:::{#exm-or-rr-OC-MI}
In @exm-oc-mi, the outcome is rare for both OC and non-OC participants, so the odds for both groups are similar to the corresponding probabilities, and the odds ratio is similar the risk ratio.
:::

---

##### Case 2: frequent events

$$\pi_1 = .4$$

$$\pi_2 = .5$$

For more frequently-occurring outcomes, this won't be the case:

```{r}
#| code-fold: show
pi1 <- .4
pi2 <- .5
pi2 / pi1
odds(pi2) / odds(pi1)
```

---


#### Odds Ratios in Case-Control Studies

::: notes
@tbl-oc-mi simulates a follow-up study in which two populations were followed and the number of MI’s was observed.
The risks are $P(MI|OC)$ and $P(MI|\neg OC)$ and we can estimate these risks from the data.

But suppose we had a case-control study in which we had 100 women with MI and selected a comparison group of 100 women without MI (matched as groups on age, etc.).
Then MI is not random, and we cannot compute P(MI|OC) and we cannot compute the risk ratio.
However, the odds ratio however can be computed.

The disease odds ratio is the odds for the disease in the exposed group divided by the odds for the disease in the unexposed group, and we cannot validly compute and use these separate parts.

We can still validly compute and use the exposure odds ratio,
which is the odds for exposure in the disease group divided by the odds for exposure in the non-diseased group
(because exposure can be treated as random):

:::

$$
\hth(OC|MI) =
\frac{\hat{\odds}(OC|MI)}{\hat{\odds}(OC|\neg MI)}
$$

::: notes
And these two odds ratios, $\hth(MI|OC)$ and $\hth(OC|MI)$,
are mathematically equivalent, as we saw in @sec-OR-props:
:::

$$\hth(MI|OC) = \hth(OC|MI)$$

---

:::{#exr-or-rev}

Calculate the odds ratio of MI with respect to OC use,
assuming that @tbl-oc-mi comes from a case-control study.
Confirm that the result is the same as in @exm-OR.

:::

---

::::{.solution}

:::{#tbl-oc-mi2}

```{r}
tbl_oc_mi |> pander::pander()
```

Simulated data from study of oral contraceptive use and heart attack risk

:::

* $\odds(OC|MI) = P(OC|MI)/(1 – P(OC|MI) = \frac{13}{7} = `r 13/7`$

* $\odds(OC|\neg MI) = P(OC|\neg MI)/(1 – P(OC|\neg MI) = \frac{4987}{9993} = `r 4987/9993`$

* $\theta(OC,MI) = \frac{\odds(OC|MI)}{\odds(OC|\neg MI)} = \frac{13/7}{4987/9993} = `r (13/7)/(4987/9993)`$

::: notes
This is the same estimate we calculated in @exm-OR.
:::

::::

---

#### Odds Ratios in Cross-Sectional Studies

* If a cross-sectional study is a probability sample of a population (which it rarely is) then we can estimate risks.

* If it is a sample, but not an unbiased probability sample, then we need to treat it in the same way as a case-control study.

* We can validly estimate odds ratios in either case.

* But we can usually not validly estimate risks and risk ratios.

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>2&nbsp; Linear (Gaussian) Models – Regression Models for Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./logistic-regression.html" rel="next">
<link href="./glms.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-b53751a350365c71b6c909e95f209ed1.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a34d670291f06f286357e447776a572a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c1bc4f463887108f52ae36d18b6ee8b3.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-W625DGE908"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-W625DGE908', { 'anonymize_ip': true});
</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false,
  "enableExperimentalNewNoteButton": true
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><link href="site_libs/table1-1.0/table1_defaults.css" rel="stylesheet">
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="custom.scss">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./Linear-models-overview.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression Models for Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/d-morrison/rme" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Regression-Models-for-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Intro-to-GLMs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Linear-models-overview.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Models for Count Outcomes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-multilevel-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to multi-level models for correlated data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./time-to-event-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time to Event Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./proportional-hazards-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Proportional Hazards Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametric-survival-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Parametric survival models</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendices-are-prereqs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Overview of Appendices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./math-prereqs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Mathematics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-MLEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Introduction to Maximum Likelihood Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Introduction to Bayesian inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./common-mistakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Common Mistakes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Notation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Statistical computing in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CONTRIBUTING.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Contributing to <code>rme</code></span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#configuring-r" id="toc-configuring-r" class="nav-link active" data-scroll-target="#configuring-r">Configuring R</a></li>
  <li>
<a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview"><span class="header-section-number">2.1</span> Overview</a>
  <ul class="collapse">
<li><a href="#why-this-course-includes-linear-regression" id="toc-why-this-course-includes-linear-regression" class="nav-link" data-scroll-target="#why-this-course-includes-linear-regression"><span class="header-section-number">2.1.1</span> Why this course includes linear regression</a></li>
  <li><a href="#chapter-overview" id="toc-chapter-overview" class="nav-link" data-scroll-target="#chapter-overview"><span class="header-section-number">2.1.2</span> Chapter overview</a></li>
  </ul>
</li>
  <li>
<a href="#sec-understand-LMs" id="toc-sec-understand-LMs" class="nav-link" data-scroll-target="#sec-understand-LMs"><span class="header-section-number">2.2</span> Understanding Gaussian Linear Regression Models</a>
  <ul class="collapse">
<li><a href="#motivating-example-birthweights-and-gestational-age" id="toc-motivating-example-birthweights-and-gestational-age" class="nav-link" data-scroll-target="#motivating-example-birthweights-and-gestational-age"><span class="header-section-number">2.2.1</span> Motivating example: birthweights and gestational age</a></li>
  <li><a href="#parallel-lines-regression" id="toc-parallel-lines-regression" class="nav-link" data-scroll-target="#parallel-lines-regression"><span class="header-section-number">2.2.2</span> Parallel lines regression</a></li>
  <li><a href="#interactions" id="toc-interactions" class="nav-link" data-scroll-target="#interactions"><span class="header-section-number">2.2.3</span> Interactions</a></li>
  <li><a href="#stratified-regression" id="toc-stratified-regression" class="nav-link" data-scroll-target="#stratified-regression"><span class="header-section-number">2.2.4</span> Stratified regression</a></li>
  <li><a href="#curved-line-regression" id="toc-curved-line-regression" class="nav-link" data-scroll-target="#curved-line-regression"><span class="header-section-number">2.2.5</span> Curved-line regression</a></li>
  </ul>
</li>
  <li>
<a href="#sec-est-LMs" id="toc-sec-est-LMs" class="nav-link" data-scroll-target="#sec-est-LMs"><span class="header-section-number">2.3</span> Estimating Linear Models via Maximum Likelihood</a>
  <ul class="collapse">
<li><a href="#likelihood-log-likelihood-and-score-functions-for-linear-regression" id="toc-likelihood-log-likelihood-and-score-functions-for-linear-regression" class="nav-link" data-scroll-target="#likelihood-log-likelihood-and-score-functions-for-linear-regression"><span class="header-section-number">2.3.1</span> Likelihood, log-likelihood, and score functions for linear regression</a></li>
  <li><a href="#deriving-the-linear-regression-score-function" id="toc-deriving-the-linear-regression-score-function" class="nav-link" data-scroll-target="#deriving-the-linear-regression-score-function"><span class="header-section-number">2.3.2</span> Deriving the linear regression score function</a></li>
  <li><a href="#residual-standard-deviation" id="toc-residual-standard-deviation" class="nav-link" data-scroll-target="#residual-standard-deviation"><span class="header-section-number">2.3.3</span> Residual Standard Deviation</a></li>
  </ul>
</li>
  <li>
<a href="#sec-infer-LMs" id="toc-sec-infer-LMs" class="nav-link" data-scroll-target="#sec-infer-LMs"><span class="header-section-number">2.4</span> Inference about Gaussian Linear Regression Models</a>
  <ul class="collapse">
<li><a href="#motivating-example-birthweight-data" id="toc-motivating-example-birthweight-data" class="nav-link" data-scroll-target="#motivating-example-birthweight-data"><span class="header-section-number">2.4.1</span> Motivating example: <code>birthweight</code> data</a></li>
  <li><a href="#wald-tests-and-cis" id="toc-wald-tests-and-cis" class="nav-link" data-scroll-target="#wald-tests-and-cis"><span class="header-section-number">2.4.2</span> Wald tests and CIs</a></li>
  <li><a href="#p-values" id="toc-p-values" class="nav-link" data-scroll-target="#p-values"><span class="header-section-number">2.4.3</span> P-values</a></li>
  <li><a href="#confidence-intervals" id="toc-confidence-intervals" class="nav-link" data-scroll-target="#confidence-intervals"><span class="header-section-number">2.4.4</span> Confidence intervals</a></li>
  <li><a href="#gaussian-approximations" id="toc-gaussian-approximations" class="nav-link" data-scroll-target="#gaussian-approximations"><span class="header-section-number">2.4.5</span> Gaussian approximations</a></li>
  <li><a href="#p-values-1" id="toc-p-values-1" class="nav-link" data-scroll-target="#p-values-1"><span class="header-section-number">2.4.6</span> P-values</a></li>
  <li><a href="#confidence-intervals-1" id="toc-confidence-intervals-1" class="nav-link" data-scroll-target="#confidence-intervals-1"><span class="header-section-number">2.4.7</span> Confidence intervals</a></li>
  <li><a href="#likelihood-ratio-statistics" id="toc-likelihood-ratio-statistics" class="nav-link" data-scroll-target="#likelihood-ratio-statistics"><span class="header-section-number">2.4.8</span> Likelihood ratio statistics</a></li>
  </ul>
</li>
  <li>
<a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit"><span class="header-section-number">2.5</span> Goodness of fit</a>
  <ul class="collapse">
<li><a href="#aic-and-bic" id="toc-aic-and-bic" class="nav-link" data-scroll-target="#aic-and-bic"><span class="header-section-number">2.5.1</span> AIC and BIC</a></li>
  <li><a href="#residual-deviance" id="toc-residual-deviance" class="nav-link" data-scroll-target="#residual-deviance"><span class="header-section-number">2.5.2</span> (Residual) Deviance</a></li>
  <li><a href="#null-deviance" id="toc-null-deviance" class="nav-link" data-scroll-target="#null-deviance"><span class="header-section-number">2.5.3</span> Null Deviance</a></li>
  </ul>
</li>
  <li>
<a href="#rescaling" id="toc-rescaling" class="nav-link" data-scroll-target="#rescaling"><span class="header-section-number">2.6</span> Rescaling</a>
  <ul class="collapse">
<li><a href="#rescale-age" id="toc-rescale-age" class="nav-link" data-scroll-target="#rescale-age"><span class="header-section-number">2.6.1</span> Rescale age</a></li>
  </ul>
</li>
  <li>
<a href="#prediction" id="toc-prediction" class="nav-link" data-scroll-target="#prediction"><span class="header-section-number">2.7</span> Prediction</a>
  <ul class="collapse">
<li><a href="#prediction-for-linear-models" id="toc-prediction-for-linear-models" class="nav-link" data-scroll-target="#prediction-for-linear-models"><span class="header-section-number">2.7.1</span> Prediction for linear models</a></li>
  <li><a href="#example-prediction-for-the-birthweight-data" id="toc-example-prediction-for-the-birthweight-data" class="nav-link" data-scroll-target="#example-prediction-for-the-birthweight-data"><span class="header-section-number">2.7.2</span> Example: prediction for the <code>birthweight</code> data</a></li>
  <li><a href="#quantifying-uncertainty-in-predictions" id="toc-quantifying-uncertainty-in-predictions" class="nav-link" data-scroll-target="#quantifying-uncertainty-in-predictions"><span class="header-section-number">2.7.3</span> Quantifying uncertainty in predictions</a></li>
  </ul>
</li>
  <li>
<a href="#sec-diagnose-LMs" id="toc-sec-diagnose-LMs" class="nav-link" data-scroll-target="#sec-diagnose-LMs"><span class="header-section-number">2.8</span> Diagnostics</a>
  <ul class="collapse">
<li><a href="#assumptions-in-linear-regression-models" id="toc-assumptions-in-linear-regression-models" class="nav-link" data-scroll-target="#assumptions-in-linear-regression-models"><span class="header-section-number">2.8.1</span> Assumptions in linear regression models</a></li>
  <li><a href="#direct-visualization" id="toc-direct-visualization" class="nav-link" data-scroll-target="#direct-visualization"><span class="header-section-number">2.8.2</span> Direct visualization</a></li>
  <li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals"><span class="header-section-number">2.8.3</span> Residuals</a></li>
  <li><a href="#marginal-distributions-of-residuals" id="toc-marginal-distributions-of-residuals" class="nav-link" data-scroll-target="#marginal-distributions-of-residuals"><span class="header-section-number">2.8.4</span> Marginal distributions of residuals</a></li>
  <li><a href="#qq-plot-of-standardized-residuals" id="toc-qq-plot-of-standardized-residuals" class="nav-link" data-scroll-target="#qq-plot-of-standardized-residuals"><span class="header-section-number">2.8.5</span> QQ plot of standardized residuals</a></li>
  <li><a href="#conditional-distributions-of-residuals" id="toc-conditional-distributions-of-residuals" class="nav-link" data-scroll-target="#conditional-distributions-of-residuals"><span class="header-section-number">2.8.6</span> Conditional distributions of residuals</a></li>
  <li><a href="#diagnostics-constructed-by-hand" id="toc-diagnostics-constructed-by-hand" class="nav-link" data-scroll-target="#diagnostics-constructed-by-hand"><span class="header-section-number">2.8.7</span> Diagnostics constructed by hand</a></li>
  </ul>
</li>
  <li>
<a href="#model-selection-1" id="toc-model-selection-1" class="nav-link" data-scroll-target="#model-selection-1"><span class="header-section-number">2.9</span> Model selection</a>
  <ul class="collapse">
<li><a href="#mean-squared-error" id="toc-mean-squared-error" class="nav-link" data-scroll-target="#mean-squared-error"><span class="header-section-number">2.9.1</span> Mean squared error</a></li>
  </ul>
</li>
  <li>
<a href="#categorical-covariates-with-more-than-two-levels" id="toc-categorical-covariates-with-more-than-two-levels" class="nav-link" data-scroll-target="#categorical-covariates-with-more-than-two-levels"><span class="header-section-number">2.10</span> Categorical covariates with more than two levels</a>
  <ul class="collapse">
<li><a href="#example-birthweight" id="toc-example-birthweight" class="nav-link" data-scroll-target="#example-birthweight"><span class="header-section-number">2.10.1</span> Example: <code>birthweight</code></a></li>
  <li><a href="#section" id="toc-section" class="nav-link" data-scroll-target="#section"><span class="header-section-number">2.10.2</span> </a></li>
  <li><a href="#lets-see-how-that-model-looks" id="toc-lets-see-how-that-model-looks" class="nav-link" data-scroll-target="#lets-see-how-that-model-looks"><span class="header-section-number">2.10.3</span> Let’s see how that model looks:</a></li>
  <li><a href="#lets-see-what-r-does-with-categorical-variables-by-default" id="toc-lets-see-what-r-does-with-categorical-variables-by-default" class="nav-link" data-scroll-target="#lets-see-what-r-does-with-categorical-variables-by-default"><span class="header-section-number">2.10.4</span> Let’s see what R does with categorical variables by default:</a></li>
  <li><a href="#re-parametrize-with-no-intercept" id="toc-re-parametrize-with-no-intercept" class="nav-link" data-scroll-target="#re-parametrize-with-no-intercept"><span class="header-section-number">2.10.5</span> Re-parametrize with no intercept</a></li>
  <li><a href="#lets-see-what-these-new-models-look-like" id="toc-lets-see-what-these-new-models-look-like" class="nav-link" data-scroll-target="#lets-see-what-these-new-models-look-like"><span class="header-section-number">2.10.6</span> Let’s see what these new models look like:</a></li>
  <li><a href="#lets-see-how-r-did-that" id="toc-lets-see-how-r-did-that" class="nav-link" data-scroll-target="#lets-see-how-r-did-that"><span class="header-section-number">2.10.7</span> Let’s see how R did that:</a></li>
  </ul>
</li>
  <li><a href="#ordinal-covariates" id="toc-ordinal-covariates" class="nav-link" data-scroll-target="#ordinal-covariates"><span class="header-section-number">2.11</span> Ordinal covariates</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/d-morrison/rme/edit/main/Linear-models-overview.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./Linear-models-overview.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Last modified: 2025-04-03: 3:48:46 (AM)</p>
    </div>
  </div>
  
    
  </div>
  


</header><hr>
<!-- ::: {.content-hidden when-format="revealjs"} --><hr>
<section id="configuring-r" class="level3 unnumbered"><h3 class="unnumbered anchored" data-anchor-id="configuring-r">Configuring R</h3>
<p>Functions from these packages will be used throughout this document:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/">conflicted</a></span><span class="op">)</span> <span class="co"># check for conflicting function definitions</span></span>
<span><span class="co"># library(printr) # inserts help-file output into markdown output</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/rmarkdown">rmarkdown</a></span><span class="op">)</span> <span class="co"># Convert R Markdown documents into a variety of formats.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rapporter.github.io/pander/">pander</a></span><span class="op">)</span> <span class="co"># format tables for markdown</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonocarroll/ggeasy">ggeasy</a></span><span class="op">)</span> <span class="co"># help with graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span> <span class="co"># help with graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># manipulate data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span> <span class="co"># `tibble`s extend `data.frame`s</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span> <span class="co"># `%&gt;%` and other additional piping tools</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span> <span class="co"># import Stata files</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span> <span class="co"># format R output for markdown</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span> <span class="co"># Tools to help to create tidy data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://plotly-r.com">plotly</a></span><span class="op">)</span> <span class="co"># interactive graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dobson</span><span class="op">)</span> <span class="co"># datasets from Dobson and Barnett 2018</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/">parameters</a></span><span class="op">)</span> <span class="co"># format model output tables for markdown</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span> <span class="co"># import Stata files</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stefanom.io/latex2exp/">latex2exp</a></span><span class="op">)</span> <span class="co"># use LaTeX in R code (for figures and tables)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org">fs</a></span><span class="op">)</span> <span class="co"># filesystem path manipulations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span> <span class="co"># survival analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/survminer/index.html">survminer</a></span><span class="op">)</span> <span class="co"># survival analysis graphics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">KMsurv</span><span class="op">)</span> <span class="co"># datasets from Klein and Moeschberger</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/">parameters</a></span><span class="op">)</span> <span class="co"># format model output tables for</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/webshot2/">webshot2</a></span><span class="op">)</span> <span class="co"># convert interactive content to static for pdf</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://forcats.tidyverse.org/">forcats</a></span><span class="op">)</span> <span class="co"># functions for categorical variables ("factors")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span> <span class="co"># functions for dealing with strings</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span> <span class="co"># functions for dealing with dates and times</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are some R settings I use in this document:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># delete any data that's already loaded into R</span></span>
<span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflicts_prefer.html">conflicts_prefer</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">)</span></span>
<span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="co"># ggplot2::labs(col = "") +</span></span>
<span>    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>      text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, family <span class="op">=</span> <span class="st">"serif"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">'digits'</span> <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/panderOptions.html">panderOptions</a></span><span class="op">(</span><span class="st">"big.mark"</span>, <span class="st">","</span><span class="op">)</span></span>
<span><span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/panderOptions.html">panderOptions</a></span><span class="op">(</span><span class="st">"table.emphasize.rownames"</span>, <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">pander</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pander/man/panderOptions.html">panderOptions</a></span><span class="op">(</span><span class="st">"table.split.table"</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflicts_prefer.html">conflicts_prefer</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">)</span> <span class="co"># use the `filter()` function from dplyr() by default</span></span>
<span><span class="va">legend_text_size</span> <span class="op">=</span> <span class="fl">9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ::: -->
<style>
.quarto-figure-center > figure {
text-align: center;
}
</style>
<hr>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This content is adapted from:</p>
<ul>
<li>
<span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>, Chapters 2-6</li>
<li>
<span class="citation" data-cites="dunn2018generalized">Dunn and Smyth (<a href="references.html#ref-dunn2018generalized" role="doc-biblioref">2018</a>)</span>, Chapters 2-3</li>
<li>
<span class="citation" data-cites="vittinghoff2e">Vittinghoff et al. (<a href="references.html#ref-vittinghoff2e" role="doc-biblioref">2012</a>)</span>, Chapter 4</li>
</ul>
<p>There are numerous textbooks specifically for linear regression, including:</p>
<ul>
<li>
<span class="citation" data-cites="kutner2005applied">Kutner et al. (<a href="references.html#ref-kutner2005applied" role="doc-biblioref">2005</a>)</span>: used for UCLA Biostatistics MS level linear models class</li>
<li>
<span class="citation" data-cites="chatterjee2015regression">Chatterjee and Hadi (<a href="references.html#ref-chatterjee2015regression" role="doc-biblioref">2015</a>)</span>: used for Stanford MS-level linear models class</li>
<li>
<span class="citation" data-cites="seber2012linear">Seber and Lee (<a href="references.html#ref-seber2012linear" role="doc-biblioref">2012</a>)</span>: used for UCLA Biostatistics PhD level linear models class and UC Davis STA 108.</li>
<li>
<span class="citation" data-cites="kleinbaum2014applied">Kleinbaum et al. (<a href="references.html#ref-kleinbaum2014applied" role="doc-biblioref">2014</a>)</span>: same first author as <span class="citation" data-cites="kleinbaum2010logistic">Kleinbaum and Klein (<a href="references.html#ref-kleinbaum2010logistic" role="doc-biblioref">2010</a>)</span> and <span class="citation" data-cites="kleinbaum2012survival">Kleinbaum and Klein (<a href="references.html#ref-kleinbaum2012survival" role="doc-biblioref">2012</a>)</span>
</li>
<li><span class="citation" data-cites="weisberg2005applied">Weisberg (<a href="references.html#ref-weisberg2005applied" role="doc-biblioref">2005</a>)</span></li>
<li>
<em>Linear Models with R</em> <span class="citation" data-cites="Faraway2025-io">(<a href="references.html#ref-Faraway2025-io" role="doc-biblioref">Faraway 2025</a>)</span>
</li>
</ul>
</div>
</div>
</section><section id="overview" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="overview">
<span class="header-section-number">2.1</span> Overview</h2>
<section id="why-this-course-includes-linear-regression" class="level3 smaller" data-number="2.1.1"><h3 class="smaller anchored" data-number="2.1.1" data-anchor-id="why-this-course-includes-linear-regression">
<span class="header-section-number">2.1.1</span> Why this course includes linear regression</h3>
<div class="fragment fade-in-then-semi-out">
<ul>
<li>This course is about <em>generalized linear models</em> (for non-Gaussian outcomes)</li>
</ul>
</div>
<div class="fragment fade-in-then-semi-out">
<ul>
<li>UC Davis STA 108 (“Applied Statistical Methods: Regression Analysis”) is a prerequisite for this course, so everyone here should have some understanding of linear regression already.</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>We will review linear regression to:
<ul>
<li>make sure everyone is caught up</li>
<li>to provide an epidemiological perspective on model interpretation.</li>
</ul>
</li>
</ul>
</div>
</section><section id="chapter-overview" class="level3" data-number="2.1.2"><h3 data-number="2.1.2" class="anchored" data-anchor-id="chapter-overview">
<span class="header-section-number">2.1.2</span> Chapter overview</h3>
<ul>
<li><p><a href="#sec-understand-LMs" class="quarto-xref"><span>Section 2.2</span></a>: how to interpret linear regression models</p></li>
<li><p><a href="#sec-est-LMs" class="quarto-xref"><span>Section 2.3</span></a>: how to estimate linear regression models</p></li>
<li><p><a href="#sec-infer-LMs" class="quarto-xref"><span>Section 2.4</span></a>: how to quantify uncertainty about our estimates</p></li>
<li><p><a href="#sec-diagnose-LMs" class="quarto-xref"><span>Section 2.8</span></a>: how to tell if your model is insufficiently complex</p></li>
</ul></section></section><section id="sec-understand-LMs" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="sec-understand-LMs">
<span class="header-section-number">2.2</span> Understanding Gaussian Linear Regression Models</h2>
<section id="motivating-example-birthweights-and-gestational-age" class="level3 smaller" data-number="2.2.1"><h3 class="smaller anchored" data-number="2.2.1" data-anchor-id="motivating-example-birthweights-and-gestational-age">
<span class="header-section-number">2.2.1</span> Motivating example: birthweights and gestational age</h3>
<p>Suppose we want to learn about the distributions of birthweights (<em>outcome</em> <span class="math inline">\(Y\)</span>) for (human) babies born at different gestational ages (<em>covariate</em> <span class="math inline">\(A\)</span>) and with different chromosomal sexes (<em>covariate</em> <span class="math inline">\(S\)</span>) (<span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> Example 2.2.2).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Data as table</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Reshape data for graphing</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Data as graph</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dobson</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"birthweight"</span>, package <span class="op">=</span> <span class="st">"dobson"</span><span class="op">)</span></span>
<span><span class="va">birthweight</span> <span class="op">|&gt;</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-birthweight-data1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-birthweight-data1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: <code>birthweight</code> data (<span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> Example 2.2.2)
</figcaption><div aria-describedby="tbl-birthweight-data1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 17%">
<col style="width: 32%">
<col style="width: 19%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">boys gestational age</th>
<th style="text-align: right;">boys weight</th>
<th style="text-align: right;">girls gestational age</th>
<th style="text-align: right;">girls weight</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: right;">2968</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3317</td>
</tr>
<tr class="even">
<td style="text-align: right;">38</td>
<td style="text-align: right;">2795</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2729</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: right;">3163</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2935</td>
</tr>
<tr class="even">
<td style="text-align: right;">35</td>
<td style="text-align: right;">2925</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2754</td>
</tr>
<tr class="odd">
<td style="text-align: right;">36</td>
<td style="text-align: right;">2625</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">3210</td>
</tr>
<tr class="even">
<td style="text-align: right;">37</td>
<td style="text-align: right;">2847</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2817</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: right;">3292</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3126</td>
</tr>
<tr class="even">
<td style="text-align: right;">40</td>
<td style="text-align: right;">3473</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">2539</td>
</tr>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: right;">2628</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2412</td>
</tr>
<tr class="even">
<td style="text-align: right;">38</td>
<td style="text-align: right;">3176</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2991</td>
</tr>
<tr class="odd">
<td style="text-align: right;">40</td>
<td style="text-align: right;">3421</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2875</td>
</tr>
<tr class="even">
<td style="text-align: right;">38</td>
<td style="text-align: right;">2975</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3231</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">birthweight</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"sex"</span>, <span class="st">".value"</span><span class="op">)</span>,</span>
<span>    names_sep <span class="op">=</span> <span class="st">"s "</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>age <span class="op">=</span> <span class="va">`gestational age`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    sex <span class="op">=</span> <span class="va">sex</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html">case_match</a></span><span class="op">(</span></span>
<span>        <span class="st">"boy"</span> <span class="op">~</span> <span class="st">"male"</span>,</span>
<span>        <span class="st">"girl"</span> <span class="op">~</span> <span class="st">"female"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span>levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bw</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-birthweight-data2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-birthweight-data2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: <code>birthweight</code> data reshaped
</figcaption><div aria-describedby="tbl-birthweight-data2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["sex"],"name":[1],"type":["fct"],"align":["left"]},{"label":["age"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"male","2":"40","3":"2968"},{"1":"female","2":"40","3":"3317"},{"1":"male","2":"38","3":"2795"},{"1":"female","2":"36","3":"2729"},{"1":"male","2":"40","3":"3163"},{"1":"female","2":"40","3":"2935"},{"1":"male","2":"35","3":"2925"},{"1":"female","2":"38","3":"2754"},{"1":"male","2":"36","3":"2625"},{"1":"female","2":"42","3":"3210"},{"1":"male","2":"37","3":"2847"},{"1":"female","2":"39","3":"2817"},{"1":"male","2":"41","3":"3292"},{"1":"female","2":"40","3":"3126"},{"1":"male","2":"40","3":"3473"},{"1":"female","2":"37","3":"2539"},{"1":"male","2":"37","3":"2628"},{"1":"female","2":"36","3":"2412"},{"1":"male","2":"38","3":"3176"},{"1":"female","2":"38","3":"2991"},{"1":"male","2":"40","3":"3421"},{"1":"female","2":"39","3":"2875"},{"1":"male","2":"38","3":"2975"},{"1":"female","2":"40","3":"3231"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</figure>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">plot1</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">age</span>, </span>
<span>    y <span class="op">=</span> <span class="va">weight</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    shape <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    col <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Gestational age (weeks)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Birthweight (grams)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># expand_limits(y = 0, x = 0) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-plot-birthweight1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plot-birthweight1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: <code>birthweight</code> data (<span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> Example 2.2.2)
</figcaption><div aria-describedby="fig-plot-birthweight1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plot-birthweight1-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
<section id="data-notation" class="level4"><h4 class="anchored" data-anchor-id="data-notation">Data notation</h4>
<p>Let’s define some notation to represent this data.</p>
<ul>
<li><p><span class="math inline">\(Y\)</span>: birthweight (measured in grams)</p></li>
<li><p><span class="math inline">\(S\)</span>: chromosomal sex: “male” (XY) or “female” (XX)</p></li>
<li><p><span class="math inline">\(M\)</span>: indicator variable for <span class="math inline">\(S\)</span> = “male”<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p></li>
<li><p><span class="math inline">\(M = 0\)</span> if female (XX)</p></li>
<li><p><span class="math inline">\(M = 1\)</span> if male (XY)</p></li>
<li><p><span class="math inline">\(F\)</span>: indicator variable for <span class="math inline">\(S\)</span> = “female”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p></li>
<li><p><span class="math inline">\(F = 1\)</span> if female (XX)</p></li>
<li><p><span class="math inline">\(F = 0\)</span> if male (XY)</p></li>
<li><p><span class="math inline">\(A\)</span>: estimated gestational age at birth (measured in weeks).</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Female is the <strong>reference level</strong> for the categorical variable <span class="math inline">\(S\)</span> (chromosomal sex) and corresponding indicator variable <span class="math inline">\(M\)</span> . The choice of a reference level is arbitrary and does not limit what we can do with the resulting model; it only makes it more computationally convenient to make inferences about comparisons involving that reference group.</p>
</div>
</div>
</section></section><section id="parallel-lines-regression" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="parallel-lines-regression">
<span class="header-section-number">2.2.2</span> Parallel lines regression</h3>
<p>We don’t have enough data to model the distribution of birth weight separately for each combination of gestational age and sex, so let’s instead consider a (relatively) simple model for how that distribution varies with gestational age and sex:</p>
<p><span class="math display">\[p(Y=y|A=a,S=s) \ \sim_{\text{iid}}\ N(\mu(a,s), \sigma^2)\]</span></p>
<p><span id="eq-lm-parallel"><span class="math display">\[
\begin{aligned}
\mu(a,s)
&amp;\stackrel{\text{def}}{=}\mathbb{E}\left[Y|A=a, S=s\right] \\
&amp;= \beta_0 + \beta_A a+ \beta_M m
\end{aligned}
\tag{2.1}\]</span></span></p>
<div class="notes">
<p><a href="#tbl-lm-parallel" class="quarto-xref">Table&nbsp;<span>2.3</span></a> shows the parameter estimates from R. <a href="#fig-parallel-fit1" class="quarto-xref">Figure&nbsp;<span>2.2</span></a> shows the estimated model, superimposed on the data.</p>
</div><div class="column" style="width:40%;">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/">parameters</a></span><span class="op">)</span></span>
<span><span class="va">bw_lm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>, </span>
<span>  data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">parameters</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># show_sigma = TRUE,</span></span>
<span>    select <span class="op">=</span> <span class="st">"{estimate}"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-lm-parallel" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lm-parallel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.3: Estimate of <a href="#eq-lm-parallel" class="quarto-xref">Model&nbsp;<span>2.1</span></a> for <code>birthweight</code> data
</figcaption><div aria-describedby="tbl-lm-parallel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-1773.32</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female)</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">163.04</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: center;">120.89</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:50%;">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>`E[Y|X=x]` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">=</span> </span>
<span>  <span class="va">plot1</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html">%+%</a></span> <span class="va">bw</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">`E[Y|X=x]`</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-parallel-fit1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-parallel-fit1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Parallel-slopes model of birthweight
</figcaption><div aria-describedby="fig-parallel-fit1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-parallel-fit1-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
<hr>
<section id="model-assumptions-and-predictions" class="level4"><h4 class="anchored" data-anchor-id="model-assumptions-and-predictions">Model assumptions and predictions</h4>
<div class="notes">
<p>To learn what this model is assuming, let’s plug in a few values.</p>
</div>
<div id="exr-pred-fem-parallel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.1</strong></span> According to this model, what’s the mean birthweight for a female born at 36 weeks?</p>
<div id="tbl-coef-model1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coef-model1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.4: Estimated coefficients for <a href="#eq-lm-parallel" class="quarto-xref">model&nbsp;<span>2.1</span></a>
</figcaption><div aria-describedby="tbl-coef-model1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)     sexmale         age </span></span>
<span><span class="co">#&gt;     -1773.3       163.0       120.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</figure>
</div>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>&nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_female</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)     sexmale         age </span></span>
<span><span class="co">#&gt;     -1773.3       163.0       120.9</span></span>
<span><span class="co"># print(pred_female)</span></span>
<span><span class="co">### built-in prediction: </span></span>
<span><span class="co"># predict(bw_lm1, newdata = tibble(sex = "female", age = 36))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
E[Y|A = 0, A = 36]
&amp;= \beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36 \\
&amp;=  2578.8739
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="exr-pred-male-parallel" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.2</strong></span> What’s the mean birthweight for a male born at 36 weeks?</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)     sexmale         age </span></span>
<span><span class="co">#&gt;     -1773.3       163.0       120.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>&nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_male</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)     sexmale         age </span></span>
<span><span class="co">#&gt;     -1773.3       163.0       120.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
E[Y|M = 1, A = 36]
&amp;= \beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36 \\
&amp;=  2741.9132
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="exr-diff-sex-parallel-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.3</strong></span> What’s the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)     sexmale         age </span></span>
<span><span class="co">#&gt;     -1773.3       163.0       120.9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\begin{aligned}
&amp; E[Y|M = 1, A = 36] - E[Y|M = 0, A = 36]\\
&amp;=
2741.9132 - 2578.8739\\
&amp;=
163.0393
\end{aligned}
\]</span></p>
<p>Shortcut:</p>
<p><span class="math display">\[
\begin{aligned}
&amp; E[Y|M = 1, A = 36] - E[Y|M = 0, A = 36]\\
&amp;= (\beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36) -
(\beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36) \\
&amp;= \beta_M \\
&amp;=  163.0393
\end{aligned}
\]</span></p>
</div>
<div class="notes">
<p>Note that age doesn’t show up in this difference: in other words, according to this model, the difference between females and males with the same gestational age is the same for every age.</p>
<p>That’s an assumption of the model; it’s built-in to the parametric structure, even before we plug in the estimated values of those parameters.</p>
<p>That’s why the lines are parallel.</p>
</div>
</section></section><section id="interactions" class="level3 smaller" data-number="2.2.3"><h3 class="smaller anchored" data-number="2.2.3" data-anchor-id="interactions">
<span class="header-section-number">2.2.3</span> Interactions</h3>
<div class="notes">
<p>What if we don’t like that parallel lines assumption?</p>
<p>Then we need to allow an “interaction” between age <span class="math inline">\(A\)</span> and sex <span class="math inline">\(S\)</span>:</p>
</div>
<p><span id="eq-BW-lm-interact"><span class="math display">\[
E[Y|A=a, S=s] = \beta_0 + \beta_A a+ \beta_M m + \beta_{AM} (a \cdot m)
\tag{2.2}\]</span></span></p>
<div class="notes">
<p>Now, the slope of mean birthweight <span class="math inline">\(E[Y|A,S]\)</span> with respect to gestational age <span class="math inline">\(A\)</span> depends on the value of sex <span class="math inline">\(S\)</span>.</p>
</div>
<div class="column smaller" style="width:40%;">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># show_sigma = TRUE,</span></span>
<span>    select <span class="op">=</span> <span class="st">"{estimate}"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-bw-model-coefs-interact" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bw-model-coefs-interact-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.5: Birthweight model with interaction term
</figcaption><div aria-describedby="tbl-bw-model-coefs-interact-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female)</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div><div class="column" style="width:5%;">

</div><div class="column" style="width:55%;">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1_interact</span> <span class="op">=</span> </span>
<span>  <span class="va">plot1</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html">%+%</a></span> <span class="va">bw</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predlm2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot1_interact</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-bw-interaction" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-bw-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Birthweight model with interaction term
</figcaption><div aria-describedby="fig-bw-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-bw-interaction-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
<div class="notes">
<p>Now we can see that the lines aren’t parallel.</p>
</div>
<hr>
<p>Here’s another way we could rewrite this model (by collecting terms involving <span class="math inline">\(S\)</span>):</p>
<p><span class="math display">\[
E[Y|A, M] = \beta_0 + \beta_M M+ (\beta_A + \beta_{AM} M) A
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to understand a coefficient in a model with interactions, collect terms for the corresponding variable, and you will see what other variables are interacting with the variable you are interested in.</p>
</div>
</div>
<div class="notes">
<p>In this case, the coefficient <span class="math inline">\(S\)</span> is interacting with <span class="math inline">\(A\)</span>. So the slope of <span class="math inline">\(Y\)</span> with respect to <span class="math inline">\(A\)</span> depends on the value of <span class="math inline">\(M\)</span>.</p>
<p>According to this model, there is no such thing as “<em>the</em> slope of birthweight with respect to age”. There are two slopes, one for each sex.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> We can only talk about “the slope of birthweight with respect to age among males” and “the slope of birthweight with respect to age among females”.</p>
<p>Then: that coefficient is the difference in means per unit change in its corresponding coefficient, when the other collected variables are set to 0.</p>
</div>
<hr>
<div class="notes">
<p>To learn what this model is assuming, let’s plug in a few values.</p>
</div>
<div id="exr-pred-fem-interact" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.4</strong></span> According to this model, what’s the mean birthweight for a female born at 36 weeks?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>&nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_female</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
E[Y|A = 0, X_2 = 36] =
\beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36 + \beta_{AM} \cdot (0 * 36)
=  2552.7333
\]</span></p>
</div>
<hr>
<div id="exr-pred-interact-male_36" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.5</strong></span> What’s the mean birthweight for a male born at 36 weeks?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>&nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pred_male</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale"</span><span class="op">]</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span><span class="op">*</span><span class="fl">36</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale:age"</span><span class="op">]</span> <span class="op">*</span> <span class="fl">36</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
E[Y|A = 0, X_2 = 36]
&amp;= \beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36 + \beta_{AM} \cdot 1 \cdot 36\\
&amp;= 2762.7069
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="exr-diff-gender-interact" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.6</strong></span> What’s the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\begin{aligned}
&amp; E[Y|M = 1, A = 36] - E[Y|M = 0, A = 36]\\
&amp;= (\beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36 + \beta_{AM} \cdot 1 \cdot 36)\\
&amp;\ \ \ \ \  -(\beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36 + \beta_{AM} \cdot 0 \cdot 36) \\
&amp;= \beta_{S} + \beta_{AM}\cdot 36\\
&amp;=  209.9736
\end{aligned}
\]</span></p>
</div>
<div class="notes">
<p>Note that age now does show up in the difference: in other words, according to this model, the difference in mean birthweights between females and males with the same gestational age can vary by gestational age.</p>
<p>That’s how the lines in the graph ended up non-parallel.</p>
</div>
</section><section id="stratified-regression" class="level3 smaller" data-number="2.2.4"><h3 class="smaller anchored" data-number="2.2.4" data-anchor-id="stratified-regression">
<span class="header-section-number">2.2.4</span> Stratified regression</h3>
<div class="notes">
<p>We could re-write the interaction model as a stratified model, with a slope and intercept for each sex:</p>
</div>
<p><span id="eq-model-strat"><span class="math display">\[
\mathbb{E}\left[Y|A=a, S=s\right] =
\beta_M m + \beta_{AM} (a \cdot m) +
\beta_F f + \beta_{AF} (a \cdot f)
\tag{2.3}\]</span></span></p>
<p>Compare this stratified model with our interaction model, <a href="#eq-BW-lm-interact" class="quarto-xref">Equation&nbsp;<span>2.2</span></a>:</p>
<p><span class="math display">\[
\mathbb{E}\left[Y|A=a, S=s\right] =
\beta_0 + \beta_A a + \beta_M m + \beta_{AM} (a \cdot m)
\]</span></p>
<div class="notes">
<p>In the stratified model, the intercept term <span class="math inline">\(\beta_0\)</span> has been relabeled as <span class="math inline">\(\beta_F\)</span>.</p>
</div><div class="column" style="width:45%;">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    <span class="co"># show_sigma = TRUE,</span></span>
<span>    select <span class="op">=</span> <span class="st">"{estimate}"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-bw-model-coefs-interact2" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bw-model-coefs-interact2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.6: Birthweight model with interaction term
</figcaption><div aria-describedby="tbl-bw-model-coefs-interact2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female)</td>
<td style="text-align: center;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm_strat</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>    data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bw_lm_strat</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    <span class="co"># show_sigma = TRUE,</span></span>
<span>    select <span class="op">=</span> <span class="st">"{estimate}"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-bw-model-coefs-strat" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bw-model-coefs-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.7: Birthweight model - stratified betas
</figcaption><div aria-describedby="tbl-bw-model-coefs-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sex (female)</td>
<td style="text-align: center;">-2141.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">-1268.67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (female) × age</td>
<td style="text-align: center;">130.40</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">111.98</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div>
</section><section id="curved-line-regression" class="level3" data-number="2.2.5"><h3 data-number="2.2.5" class="anchored" data-anchor-id="curved-line-regression">
<span class="header-section-number">2.2.5</span> Curved-line regression</h3>
<div class="notes">
<p>If we transform some of our covariates (<span class="math inline">\(X\)</span>s) and plot the resulting model on the original covariate scale, we end up with curved regression lines:</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggpenguins</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span> , y <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Bill length (mm)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Body mass (g)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ggpenguins2</span> <span class="op">=</span> <span class="va">ggpenguins</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    geom <span class="op">=</span> <span class="st">"smooth"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Bill length (mm)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Body mass (g)"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ggpenguins2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-penguins-log-x" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-penguins-log-x-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: <code>palmerpenguins</code> model with <code>bill_length</code> entering on log scale
</figcaption><div aria-describedby="fig-penguins-log-x-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-penguins-log-x-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section></section><section id="sec-est-LMs" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="sec-est-LMs">
<span class="header-section-number">2.3</span> Estimating Linear Models via Maximum Likelihood</h2>
<section id="likelihood-log-likelihood-and-score-functions-for-linear-regression" class="level3 smaller" data-number="2.3.1"><h3 class="smaller anchored" data-number="2.3.1" data-anchor-id="likelihood-log-likelihood-and-score-functions-for-linear-regression">
<span class="header-section-number">2.3.1</span> Likelihood, log-likelihood, and score functions for linear regression</h3>
<div class="notes">
<p>In EPI 203 and <a href="intro-MLEs.html" class="quarto-xref"><span>Appendix F</span></a>, we learned how to fit outcome-only models of the form <span class="math inline">\(p(X=x|\theta)\)</span> to iid data <span class="math inline">\(\tilde{x}= (x_1,…,x_n)\)</span> using maximum likelihood estimation.</p>
<p>Now, we apply the same procedure to linear regression models:</p>
</div>
<p><span id="eq-linreg-lik"><span class="math display">\[
\mathcal L(\tilde{y}|\mathbf{x},\beta, \sigma^2) =
\prod_{i=1}^n (2\pi\sigma^2)^{-1/2}
\text{exp}\left\{-\frac{1}{2\sigma^2}(y_i - \tilde{x_i}'\beta)^2\right\}
\tag{2.4}\]</span></span></p>
<p><span id="eq-linreg-loglik"><span class="math display">\[
\ell(\tilde{y}|\mathbf{x},\beta, \sigma^2)
= -\frac{n}{2}\text{log}\left\{\sigma^2\right\} -
\frac{1}{2\sigma^2}\sum_{i=1}^n (y_i - \tilde{x_i}' \beta)^2
\tag{2.5}\]</span></span></p>
<p><span id="eq-linreg-score"><span class="math display">\[
\ell'_{\beta}(\tilde{y}|\mathbf{x},\beta, \sigma^2)
= -
\frac{1}{2\sigma^2}\frac{\partial}{\partial \beta}
\left(\sum_{i=1}^n (y_i - \tilde{x_i}^{\top} \beta)^2\right)
\tag{2.6}\]</span></span></p>
<hr>
<div class="notes">
<p>Let’s switch to matrix-vector notation:</p>
</div>
<p><span class="math display">\[
\sum_{i=1}^n (y_i - \tilde{x}_i^{\top} \tilde{\beta})^2
= (\tilde{y}- \mathbf{X}\tilde{\beta})'(\tilde{y}- \mathbf{X}\tilde{\beta})
\]</span></p>
<hr>
<p>So</p>
<p><span class="math display">\[
\begin{aligned}
(\tilde{y}- \mathbf{X}\tilde{\beta})'(\tilde{y}- \mathbf{X}\tilde{\beta})
&amp;= (\tilde{y}' - \tilde{\beta}'X')(\tilde{y}- \mathbf{X}\tilde{\beta})
\\ &amp;= y'y - \tilde{\beta}'X'y - y'\mathbf{X}\tilde{\beta}+\tilde{\beta}'\mathbf{X}'\mathbf{X}\beta
\\ &amp;= y'y - 2y'\mathbf{X}\beta +\beta'\mathbf{X}'\mathbf{X}\beta
\end{aligned}
\]</span></p>
</section><section id="deriving-the-linear-regression-score-function" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="deriving-the-linear-regression-score-function">
<span class="header-section-number">2.3.2</span> Deriving the linear regression score function</h3>
<div class="notes">
<p>We will use some results from <a href="./math-prereqs.html#sec-vector-calculus">vector calculus</a>:</p>
</div>
<p><span id="eq-scorefun-linreg"><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial \beta}\left(\sum_{i=1}^n (y_i - x_i' \beta)^2\right)
   &amp;= \frac{\partial}{\partial \beta}(\tilde{y}- X\beta)'(\tilde{y}- X\beta)
\\ &amp;= \frac{\partial}{\partial \beta} (y'y - 2y'X\beta +\beta'X'X\beta)
\\ &amp;= (- 2X'y +2X'X\beta)
\\ &amp;= - 2X'(y - X\beta)
\\ &amp;= - 2X'(y - \mathbb{E}[y])
\\ &amp;= - 2X' \varepsilon(y)
\end{aligned}
\tag{2.7}\]</span></span></p>
<hr>
<p>So if <span class="math inline">\(\ell(\beta,\sigma^2) =0\)</span>, then</p>
<p><span class="math display">\[
\begin{aligned}
0 &amp;= (- 2X'y +2X'X\beta)\\
2X'y &amp;= 2X'X\beta\\
X'y &amp;= X'X\beta\\
(X'X)^{-1}X'y &amp;= \beta
\end{aligned}
\]</span></p>
<hr>
<p>The second derivative matrix <span class="math inline">\(\ell_{\beta, \beta'} ''(\beta, \sigma^2;\mathbf X,\tilde{y})\)</span> is negative definite at <span class="math inline">\(\beta = (X'X)^{-1}X'y\)</span>, so <span class="math inline">\(\hat \beta_{ML} = (X'X)^{-1}X'y\)</span> is the MLE for <span class="math inline">\(\beta\)</span>.</p>
<hr>
<p>Similarly (not shown):</p>
<p><span class="math display">\[
\hat\sigma^2_{ML} = \frac{1}{n} (Y-X\hat\beta)'(Y-X\hat\beta)
\]</span></p>
<p>And</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal I_{\beta} &amp;= E[-\ell_{\beta, \beta'} ''(Y|X,\beta, \sigma^2)]\\
&amp;= \frac{1}{\sigma^2}X'X
\end{aligned}
\]</span></p>
<hr>
<p>So:</p>
<p><span class="math display">\[
Var(\hat \beta) \approx (\mathcal I_{\beta})^{-1} = \sigma^2 (X'X)^{-1}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\hat\beta \dot \sim N(\beta, \mathcal I_{\beta}^{-1})
\]</span></p>
<div class="notes">
<p>These are all results you have hopefully seen before.</p>
</div>
<hr>
<p>In the Gaussian linear regression case, we also have exact results:</p>
<p><span class="math display">\[
\frac{\hat\beta_j}{\hat{\text{se}}\left(\hat\beta_j\right)} \ \sim \ t_{n-p}
\]</span></p>
<hr>
<p>In our model 2 above, <span class="math inline">\(\hat{\mathcal{I}}(\beta)\)</span> is:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;             (Intercept)  sexmale      age sexmale:age</span></span>
<span><span class="co">#&gt; (Intercept)     1353968 -1353968 -34871.0     34871.0</span></span>
<span><span class="co">#&gt; sexmale        -1353968  2596387  34871.0    -67211.0</span></span>
<span><span class="co">#&gt; age              -34871    34871    899.9      -899.9</span></span>
<span><span class="co">#&gt; sexmale:age       34871   -67211   -899.9      1743.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If we take the square roots of the diagonals, we get the standard errors listed in the model output:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)     sexmale         age sexmale:age </span></span>
<span><span class="co">#&gt;     1163.60     1611.33       30.00       41.76</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-mod-intx" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mod-intx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.8: Estimated model for <code>birthweight</code> data with interaction term
</figcaption><div aria-describedby="tbl-mod-intx-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
<td style="text-align: center;">1611.33</td>
<td style="text-align: center;">(-2488.18, 4234.17)</td>
<td style="text-align: center;">0.54</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>So we can do confidence intervals, hypothesis tests, and p-values exactly as in the one-variable case we looked at previously.</p>
</section><section id="residual-standard-deviation" class="level3" data-number="2.3.3"><h3 data-number="2.3.3" class="anchored">
<span class="header-section-number">2.3.3</span> Residual Standard Deviation</h3>
<div class="notes">
<p><span class="math inline">\(\hat \sigma\)</span> represents an <em>estimate</em> of the <em>Residual Standard Deviation</em> parameter, <span class="math inline">\(\sigma\)</span>. We can extract <span class="math inline">\(\hat \sigma\)</span> from the fitted model, using the <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> function:</p>
</div>
<div class="cell">
<details open="" class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 180.6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<section id="sigma-is-not-residual-standard-error" class="level4"><h4 class="anchored">
<span class="math inline">\(\sigma\)</span> is NOT “Residual standard error”</h4>
<div class="notes">
<p>In the <code><a href="https://rdrr.io/r/stats/summary.lm.html">summary.lm()</a></code> output, this estimate is labeled as <code>"Residual standard error"</code>:</p>
</div>
<div class="cell">
<details open="" class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = weight ~ sex + age + sex:age, data = bw)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></span>
<span><span class="co">#&gt; -246.7 -138.1  -39.1  176.6  274.3 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -2141.7     1163.6   -1.84  0.08057 .  </span></span>
<span><span class="co">#&gt; sexmale        873.0     1611.3    0.54  0.59395    </span></span>
<span><span class="co">#&gt; age            130.4       30.0    4.35  0.00031 ***</span></span>
<span><span class="co">#&gt; sexmale:age    -18.4       41.8   -0.44  0.66389    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 181 on 20 degrees of freedom</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.643,  Adjusted R-squared:  0.59 </span></span>
<span><span class="co">#&gt; F-statistic:   12 on 3 and 20 DF,  p-value: 0.000101</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="notes">
<p>However, this is a misnomer:</p>
</div>
<div class="cell" data-printr.help.sections="[&quot;description&quot;,&quot;note&quot;]">
<details open="" class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/printr/">printr</a></span><span class="op">)</span> <span class="co"># captures ? documentation</span></span>
<span><span class="op">?</span><span class="fu">stats</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="r-help-page">
<div class="container"><main><table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true"><tbody><tr class="odd">
<td>sigma</td>
<td style="text-align: right;">R Documentation</td>
</tr></tbody></table>
<h2 class="anchored" data-anchor-id="sigma-is-not-residual-standard-error">Extract Residual Standard Deviation 'Sigma'</h2>

<h3 class="anchored">Description</h3>

<p>Extract the estimated standard deviation of the errors, the
“residual standard deviation” (misnamed also
“residual standard error”, e.g., in
<code><a href="https://rdrr.io/r/stats/summary.lm.html">summary.lm()</a></code>'s output, from a fitted model).
</p>
<p>Many classical statistical models have a <em>scale parameter</em>,
typically the standard deviation of a zero-mean normal (or Gaussian)
random variable which is denoted as <code class="reqn">\sigma</code>.
<code>sigma(.)</code> extracts the <em>estimated</em> parameter from a fitted
model, i.e., <code class="reqn">\hat\sigma</code>.
</p>


<h3 class="anchored">Note</h3>

<p>The misnomer “Residual standard <b>error</b>” has been part of
too many <span class="rlang"><b>R</b></span> (and S) outputs to be easily changed there.
</p>

</main></div>
</div>
</div>
</div>
</section></section></section><section id="sec-infer-LMs" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="sec-infer-LMs">
<span class="header-section-number">2.4</span> Inference about Gaussian Linear Regression Models</h2>
<section id="motivating-example-birthweight-data" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="motivating-example-birthweight-data">
<span class="header-section-number">2.4.1</span> Motivating example: <code>birthweight</code> data</h3>
<p>Research question: is there really an interaction between sex and age?</p>
<p><span class="math inline">\(H_0: \beta_{AM} = 0\)</span></p>
<p><span class="math inline">\(H_A: \beta_{AM} \neq 0\)</span></p>
<p><span class="math inline">\(P(|\hat\beta_{AM}| &gt; |-18.4172| \mid H_0)\)</span> = ?</p>
</section><section id="wald-tests-and-cis" class="level3 smaller" data-number="2.4.2"><h3 class="smaller anchored" data-number="2.4.2" data-anchor-id="wald-tests-and-cis">
<span class="header-section-number">2.4.2</span> Wald tests and CIs</h3>
<p>R can give you Wald tests for single coefficients and corresponding CIs:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female)</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
<td style="text-align: center;">1611.33</td>
<td style="text-align: center;">(-2488.18, 4234.17)</td>
<td style="text-align: center;">0.54</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="even">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>To understand what’s happening, let’s replicate these results by hand for the interaction term.</p>
</section><section id="p-values" class="level3 smaller" data-number="2.4.3"><h3 class="smaller anchored" data-number="2.4.3" data-anchor-id="p-values">
<span class="header-section-number">2.4.3</span> P-values</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span>keep <span class="op">=</span> <span class="st">"sexmale:age"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 26%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">beta_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale:age"</span>, <span class="st">"Estimate"</span><span class="op">]</span></span>
<span><span class="va">se_hat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="st">"sexmale:age"</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span><span class="va">dfresid</span> <span class="op">=</span> <span class="va">bw_lm2</span><span class="op">$</span><span class="va">df.residual</span></span>
<span><span class="va">t_stat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">beta_hat</span><span class="op">)</span><span class="op">/</span><span class="va">se_hat</span></span>
<span><span class="va">pval_t</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">pt</a></span><span class="op">(</span><span class="op">-</span><span class="va">t_stat</span>, df <span class="op">=</span> <span class="va">dfresid</span>, lower.tail <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">pt</a></span><span class="op">(</span><span class="va">t_stat</span>, df <span class="op">=</span> <span class="va">dfresid</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
&amp;P\left(
| \hat \beta_{AM}  | &gt;
| -18.4172| \middle| H_0
\right)
\\
&amp;= \Pr \left(
\left| \frac{\hat\beta_{AM}}{\hat{SE}(\hat\beta_{AM})} \right| &gt;
\left| \frac{-18.4172}{41.7558} \right| \middle| H_0
\right)\\
&amp;= \Pr \left(
\left| T_{20} \right|  &gt;  0.4411 | H_0
\right)\\
&amp;= 0.6639
\end{aligned}
\]</span></p>
<div class="notes">
<p>This matches the result in the table above.</p>
</div>
</section><section id="confidence-intervals" class="level3" data-number="2.4.4"><h3 data-number="2.4.4" class="anchored" data-anchor-id="confidence-intervals">
<span class="header-section-number">2.4.4</span> Confidence intervals</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span>keep <span class="op">=</span> <span class="st">"sexmale:age"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 26%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">q_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">qt</a></span><span class="op">(</span></span>
<span>  p <span class="op">=</span> <span class="fl">0.975</span>, </span>
<span>  df <span class="op">=</span> <span class="va">dfresid</span>, </span>
<span>  lower.tail <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">q_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html">qt</a></span><span class="op">(</span></span>
<span>  p <span class="op">=</span> <span class="fl">0.025</span>, </span>
<span>  df <span class="op">=</span> <span class="va">dfresid</span>, </span>
<span>  lower.tail <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">confint_radius_t</span> <span class="op">=</span> </span>
<span>  <span class="va">se_hat</span> <span class="op">*</span> <span class="va">q_t</span></span>
<span></span>
<span><span class="va">confint_t</span> <span class="op">=</span> <span class="va">beta_hat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">confint_radius_t</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">confint_t</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]   68.68 -105.52</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="notes">
<p>This also matches.</p>
</div>
</section><section id="gaussian-approximations" class="level3" data-number="2.4.5"><h3 data-number="2.4.5" class="anchored" data-anchor-id="gaussian-approximations">
<span class="header-section-number">2.4.5</span> Gaussian approximations</h3>
<p>Here are the asymptotic (Gaussian approximation) equivalents:</p>
</section><section id="p-values-1" class="level3 smaller" data-number="2.4.6"><h3 class="smaller anchored" data-number="2.4.6" data-anchor-id="p-values-1">
<span class="header-section-number">2.4.6</span> P-values</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span>keep <span class="op">=</span> <span class="st">"sexmale:age"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 26%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">pval_z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">t_stat</span><span class="op">)</span>, lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">pval_z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6592</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="confidence-intervals-1" class="level3 smaller" data-number="2.4.7"><h3 class="smaller anchored" data-number="2.4.7" data-anchor-id="confidence-intervals-1">
<span class="header-section-number">2.4.7</span> Confidence intervals</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span>keep <span class="op">=</span> <span class="st">"sexmale:age"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span></span>
<span>    include_reference <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 18%">
<col style="width: 10%">
<col style="width: 26%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr></tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">confint_radius_z</span> <span class="op">=</span> <span class="va">se_hat</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span>, lower <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">confint_z</span> <span class="op">=</span> </span>
<span>  <span class="va">beta_hat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">confint_radius_z</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">confint_z</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -100.26   63.42</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="likelihood-ratio-statistics" class="level3" data-number="2.4.8"><h3 data-number="2.4.8" class="anchored" data-anchor-id="likelihood-ratio-statistics">
<span class="header-section-number">2.4.8</span> Likelihood ratio statistics</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -156.6 (df=5)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -156.7 (df=4)</span></span>
<span></span>
<span><span class="va">lLR</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">delta_df</span> <span class="op">=</span> <span class="op">(</span><span class="va">bw_lm1</span><span class="op">$</span><span class="va">df.residual</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">x_max</span> <span class="op">=</span> <span class="fl">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">d_lLR</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">df</span> <span class="op">=</span> <span class="va">delta_df</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">dchisq</a></span><span class="op">(</span><span class="va">x</span>, df <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chisq_plot</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">geom_function</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="va">d_lLR</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_function.html">stat_function</a></span><span class="op">(</span> fun <span class="op">=</span> <span class="va">d_lLR</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lLR</span>, <span class="va">x_max</span><span class="op">)</span>, geom <span class="op">=</span> <span class="st">"area"</span>, fill <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lLR</span>, xend <span class="op">=</span> <span class="va">lLR</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fu">d_lLR</span><span class="op">(</span><span class="va">lLR</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0.0001</span>,<span class="va">x_max</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"p(X=x)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"log(likelihood ratio) statistic [x]"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">chisq_plot</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-chisq-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chisq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Chi-square distribution
</figcaption><div aria-describedby="fig-chisq-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-chisq-plot-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<p>Now we can get the p-value:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span></span>
<span>  q <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">lLR</span>, </span>
<span>  df <span class="op">=</span> <span class="va">delta_df</span>, </span>
<span>  lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6298</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<p>In practice you don’t have to do this by hand; there are functions to do it for you:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># built in</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">bw_lm2</span>, <span class="va">bw_lm1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">#Df</th>
<th style="text-align: right;">LogLik</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Chisq</th>
<th style="text-align: right;">Pr(&gt;Chisq)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-156.6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">-156.7</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">0.2323</td>
<td style="text-align: right;">0.6298</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section><section id="goodness-of-fit" class="level2" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="goodness-of-fit">
<span class="header-section-number">2.5</span> Goodness of fit</h2>
<section id="aic-and-bic" class="level3" data-number="2.5.1"><h3 data-number="2.5.1" class="anchored" data-anchor-id="aic-and-bic">
<span class="header-section-number">2.5.1</span> AIC and BIC</h3>
<div class="notes">
<p>When we use likelihood ratio tests, we are comparing how well different models fit the data.</p>
<p>Likelihood ratio tests require “nested” models: one must be a special case of the other.</p>
<p>If we have non-nested models, we can instead use the Akaike Information Criterion (AIC) or Bayesian Information Criterion (BIC):</p>
</div>
<ul>
<li><p>AIC = <span class="math inline">\(-2 * \ell(\hat\theta) + 2 * p\)</span></p></li>
<li><p>BIC = <span class="math inline">\(-2 * \ell(\hat\theta) + p * \text{log}(n)\)</span></p></li>
</ul>
<p>where <span class="math inline">\(\ell\)</span> is the log-likelihood of the data evaluated using the parameter estimates <span class="math inline">\(\hat\theta\)</span>, <span class="math inline">\(p\)</span> is the number of estimated parameters in the model (including <span class="math inline">\(\hat\sigma^2\)</span>), and <span class="math inline">\(n\)</span> is the number of observations.</p>
<p>You can calculate these criteria using the <code><a href="https://rdrr.io/r/stats/logLik.html">logLik()</a></code> function, or use the built-in R functions:</p>
<section id="aic-in-r" class="level4"><h4 class="anchored" data-anchor-id="aic-in-r">AIC in R</h4>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fl">2</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="co"># sigma counts as a parameter here</span></span>
<span><span class="co">#&gt; [1] 323.2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 323.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="bic-in-r" class="level4"><h4 class="anchored" data-anchor-id="bic-in-r">BIC in R</h4>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/nobs.html">nobs</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 329</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 329</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Large values of AIC and BIC are worse than small values. There are no hypothesis tests or p-values associated with these criteria.</p>
</section></section><section id="residual-deviance" class="level3" data-number="2.5.2"><h3 data-number="2.5.2" class="anchored" data-anchor-id="residual-deviance">
<span class="header-section-number">2.5.2</span> (Residual) Deviance</h3>
<p>Let <span class="math inline">\(q\)</span> be the number of distinct covariate combinations in a data set.</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw.X.unique</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html">count</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_unique.bw</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">bw.X.unique</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For example, in the <code>birthweight</code> data, there are <span class="math inline">\(q = 12\)</span> unique patterns (<a href="#tbl-bw-x-combos" class="quarto-xref">Table&nbsp;<span>2.9</span></a>).</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw.X.unique</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-bw-x-combos" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bw-x-combos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.9: Unique covariate combinations in the <code>birthweight</code> data, with replicate counts
</figcaption><div aria-describedby="tbl-bw-x-combos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">sex</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<hr>
<div id="def-replicates" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.1 (Replicates)</strong></span> If a given covariate pattern has more than one observation in a dataset, those observations are called <strong>replicates</strong>.</p>
</div>
<hr>
<div id="exm-replicate-bw" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.1 (Replicates in the <code>birthweight</code> data)</strong></span> In the <code>birthweight</code> dataset, there are 2 replicates of the combination “female, age 36” (<a href="#tbl-bw-x-combos" class="quarto-xref">Table&nbsp;<span>2.9</span></a>).</p>
</div>
<hr>
<div id="exr-replicate-bw" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.7 (Replicates in the <code>birthweight</code> data)</strong></span> Which covariate pattern(s) in the <code>birthweight</code> data has the most replicates?</p>
</div>
<hr>
<div id="sol-replicate-bw" class="proof solution">
<p><span class="proof-title"><em>Solution 2.1</em> (Replicates in the <code>birthweight</code> data). </span>Two covariate patterns are tied for most replicates: males at age 40 weeks and females at age 40 weeks. 40 weeks is the usual length for human pregnancy (<span class="citation" data-cites="polin2011fetal">Polin, Fox, and Abman (<a href="references.html#ref-polin2011fetal" role="doc-biblioref">2011</a>)</span>), so this result makes sense.</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw.X.unique</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">sex</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
<section id="saturated-models" class="level4 smaller"><h4 class="smaller anchored" data-anchor-id="saturated-models">Saturated models</h4>
<p>The most complicated model we could fit would have one parameter (a mean) for each covariate pattern, plus a variance parameter:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_max</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span> <span class="op">-</span> <span class="fl">1</span>, </span>
<span>    data <span class="op">=</span> <span class="va">_</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm_max</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-bw-model-sat" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-bw-model-sat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.10: Saturated model for the <code>birthweight</code> data
</figcaption><div aria-describedby="tbl-bw-model-sat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 27%">
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 25%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(12)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sex (male) × age35</td>
<td style="text-align: center;">2925.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2515.55, 3334.45)</td>
<td style="text-align: center;">15.56</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age36</td>
<td style="text-align: center;">2570.50</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2280.98, 2860.02)</td>
<td style="text-align: center;">19.34</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age36</td>
<td style="text-align: center;">2625.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2215.55, 3034.45)</td>
<td style="text-align: center;">13.97</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age37</td>
<td style="text-align: center;">2539.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2129.55, 2948.45)</td>
<td style="text-align: center;">13.51</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age37</td>
<td style="text-align: center;">2737.50</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2447.98, 3027.02)</td>
<td style="text-align: center;">20.60</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age38</td>
<td style="text-align: center;">2872.50</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2582.98, 3162.02)</td>
<td style="text-align: center;">21.62</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age38</td>
<td style="text-align: center;">2982.00</td>
<td style="text-align: center;">108.50</td>
<td style="text-align: center;">(2745.60, 3218.40)</td>
<td style="text-align: center;">27.48</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age39</td>
<td style="text-align: center;">2846.00</td>
<td style="text-align: center;">132.88</td>
<td style="text-align: center;">(2556.48, 3135.52)</td>
<td style="text-align: center;">21.42</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (female) × age40</td>
<td style="text-align: center;">3152.25</td>
<td style="text-align: center;">93.96</td>
<td style="text-align: center;">(2947.52, 3356.98)</td>
<td style="text-align: center;">33.55</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age40</td>
<td style="text-align: center;">3256.25</td>
<td style="text-align: center;">93.96</td>
<td style="text-align: center;">(3051.52, 3460.98)</td>
<td style="text-align: center;">34.66</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sex (male) × age41</td>
<td style="text-align: center;">3292.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2882.55, 3701.45)</td>
<td style="text-align: center;">17.52</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (female) × age42</td>
<td style="text-align: center;">3210.00</td>
<td style="text-align: center;">187.92</td>
<td style="text-align: center;">(2800.55, 3619.45)</td>
<td style="text-align: center;">17.08</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>We call this model the <strong>full</strong>, <strong>maximal</strong>, or <strong>saturated</strong> model for this dataset.</p>
<p>We can calculate the log-likelihood of this model as usual:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">lm_max</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -151.4 (df=13)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can compare this model to our other models using chi-square tests, as usual:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">lm_max</span>, <span class="va">bw_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">#Df</th>
<th style="text-align: right;">LogLik</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Chisq</th>
<th style="text-align: right;">Pr(&gt;Chisq)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">-151.4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-156.6</td>
<td style="text-align: right;">-8</td>
<td style="text-align: right;">10.36</td>
<td style="text-align: right;">0.241</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The likelihood ratio statistic for this test is <span class="math display">\[\lambda = 2 * (\ell_{\text{full}} - \ell) = 10.3554\]</span> where:</p>
<ul>
<li>
<span class="math inline">\(\ell_{\text{max}}\)</span> is the log-likelihood of the full model: -151.4016</li>
<li>
<span class="math inline">\(\ell\)</span> is the log-likelihood of our comparison model (two slopes, two intercepts): -156.5793</li>
</ul>
<p>This statistic is called the <strong>deviance</strong> or <strong>residual deviance</strong> for our two-slopes and two-intercepts model; it tells us how much the likelihood of that model deviates from the likelihood of the maximal model.</p>
<p>The corresponding p-value tells us whether there we have enough evidence to detect that our two-slopes, two-intercepts model is a worse fit for the data than the maximal model; in other words, it tells us if there’s evidence that we missed any important patterns. (Remember, a nonsignificant p-value could mean that we didn’t miss anything and a more complicated model is unnecessary, or it could mean we just don’t have enough data to tell the difference between these models.)</p>
</section></section><section id="null-deviance" class="level3" data-number="2.5.3"><h3 data-number="2.5.3" class="anchored" data-anchor-id="null-deviance">
<span class="header-section-number">2.5.3</span> Null Deviance</h3>
<p>Similarly, the <em>least</em> complicated model we could fit would have only one mean parameter, an intercept:</p>
<p><span class="math display">\[\text E[Y|X=x] = \beta_0\]</span> We can fit this model in R like so:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm0</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm0</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 19%">
<col style="width: 10%">
<col style="width: 29%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(23)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">2967.67</td>
<td style="text-align: center;">57.58</td>
<td style="text-align: center;">(2848.56, 3086.77)</td>
<td style="text-align: center;">51.54</td>
<td style="text-align: center;">&lt; .001</td>
</tr></tbody>
</table>
</div>
</div>
<p>This model also has a likelihood:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'log Lik.' -169 (df=2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And we can compare it to more complicated models using a likelihood ratio test:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">bw_lm2</span>, <span class="va">lm0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">#Df</th>
<th style="text-align: right;">LogLik</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Chisq</th>
<th style="text-align: right;">Pr(&gt;Chisq)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">-156.6</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-169.0</td>
<td style="text-align: right;">-3</td>
<td style="text-align: right;">24.75</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The likelihood ratio statistic for the test comparing the null model to the maximal model is <span class="math display">\[\lambda = 2 * (\ell_{\text{full}} - \ell_{0}) = 35.1067\]</span> where:</p>
<ul>
<li>
<span class="math inline">\(\ell_{\text{0}}\)</span> is the log-likelihood of the null model: -168.955</li>
<li>
<span class="math inline">\(\ell_{\text{full}}\)</span> is the log-likelihood of the maximal model: -151.4016</li>
</ul>
<p>In R, this test is:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html">lrtest</a></span><span class="op">(</span><span class="va">lm_max</span>, <span class="va">lm0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">#Df</th>
<th style="text-align: right;">LogLik</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Chisq</th>
<th style="text-align: right;">Pr(&gt;Chisq)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">13</td>
<td style="text-align: right;">-151.4</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">-169.0</td>
<td style="text-align: right;">-11</td>
<td style="text-align: right;">35.11</td>
<td style="text-align: right;">2e-04</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This log-likelihood ratio statistic is called the <strong>null deviance</strong>. It tells us whether we have enough data to detect a difference between the null and full models.</p>
</section></section><section id="rescaling" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="rescaling">
<span class="header-section-number">2.6</span> Rescaling</h2>
<section id="rescale-age" class="level3 smaller" data-number="2.6.1"><h3 class="smaller anchored" data-number="2.6.1" data-anchor-id="rescale-age">
<span class="header-section-number">2.6.1</span> Rescale age</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    `age - mean` <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span>,</span>
<span>    `age - 36wks` <span class="op">=</span> <span class="va">age</span> <span class="op">-</span> <span class="fl">36</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">lm1c</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">`age - 36wks`</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lm2c</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">`age - 36wks`</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">`age - 36wks`</span>, data <span class="op">=</span> <span class="va">bw</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">lm2c</span>, ci_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 16%">
<col style="width: 9%">
<col style="width: 24%">
<col style="width: 8%">
<col style="width: 9%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">2552.73</td>
<td style="text-align: center;">97.59</td>
<td style="text-align: center;">(2349.16, 2756.30)</td>
<td style="text-align: center;">26.16</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">209.97</td>
<td style="text-align: center;">129.75</td>
<td style="text-align: center;">(-60.68, 480.63)</td>
<td style="text-align: center;">1.62</td>
<td style="text-align: center;">0.121</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age - 36wks</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age - 36wks</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Compare with what we got without rescaling:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="va">bw_lm2</span>, ci_method <span class="op">=</span> <span class="st">"wald"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 22%">
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 28%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(20)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2141.67</td>
<td style="text-align: center;">1163.60</td>
<td style="text-align: center;">(-4568.90, 285.56)</td>
<td style="text-align: center;">-1.84</td>
<td style="text-align: center;">0.081</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male)</td>
<td style="text-align: center;">872.99</td>
<td style="text-align: center;">1611.33</td>
<td style="text-align: center;">(-2488.18, 4234.17)</td>
<td style="text-align: center;">0.54</td>
<td style="text-align: center;">0.594</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: center;">130.40</td>
<td style="text-align: center;">30.00</td>
<td style="text-align: center;">(67.82, 192.98)</td>
<td style="text-align: center;">4.35</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">sex (male) × age</td>
<td style="text-align: center;">-18.42</td>
<td style="text-align: center;">41.76</td>
<td style="text-align: center;">(-105.52, 68.68)</td>
<td style="text-align: center;">-0.44</td>
<td style="text-align: center;">0.664</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section><section id="prediction" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="prediction">
<span class="header-section-number">2.7</span> Prediction</h2>
<section id="prediction-for-linear-models" class="level3" data-number="2.7.1"><h3 data-number="2.7.1" class="anchored" data-anchor-id="prediction-for-linear-models">
<span class="header-section-number">2.7.1</span> Prediction for linear models</h3>
<div id="def-predicted-value" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.2 (Predicted value)</strong></span> In a regression model <span class="math inline">\(\text{p}(y|x)\)</span>, the <strong>predicted value</strong> of <span class="math inline">\(y\)</span> given <span class="math inline">\(x\)</span> is the estimated mean of <span class="math inline">\(Y\)</span> given <span class="math inline">\(X\)</span>:</p>
<p><span class="math display">\[\hat y \stackrel{\text{def}}{=}\hat{\text{E}}\left[Y|X=x\right]\]</span></p>
</div>
<hr>
<p>For linear models, the predicted value can be straightforwardly calculated by multiplying each predictor value <span class="math inline">\(x_j\)</span> by its corresponding coefficient <span class="math inline">\(\beta_j\)</span> and adding up the results:</p>
<p><span class="math display">\[
\begin{aligned}
\hat Y &amp;= \hat E[Y|X=x] \\
&amp;= x'\hat\beta \\
&amp;= \hat\beta_0\cdot 1 + \hat\beta_1 x_1 + ... + \hat\beta_p x_p
\end{aligned}
\]</span></p>
<hr></section><section id="example-prediction-for-the-birthweight-data" class="level3" data-number="2.7.2"><h3 data-number="2.7.2" class="anchored" data-anchor-id="example-prediction-for-the-birthweight-data">
<span class="header-section-number">2.7.2</span> Example: prediction for the <code>birthweight</code> data</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">X</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">X</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3225</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>R has built-in functions for prediction:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">40</span>, sex <span class="op">=</span> <span class="st">"male"</span><span class="op">)</span></span>
<span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt;    1 </span></span>
<span><span class="co">#&gt; 3225</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If you don’t provide <code>newdata</code>, R will use the covariate values from the original dataset:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt;    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 </span></span>
<span><span class="co">#&gt; 3225 3062 2984 2579 3225 3062 2621 2821 2742 3304 2863 2942 3346 3062 3225 2700 </span></span>
<span><span class="co">#&gt;   17   18   19   20   21   22   23   24 </span></span>
<span><span class="co">#&gt; 2863 2579 2984 2821 3225 2942 2984 3062</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>These special predictions are called the <em>fitted values</em> of the dataset:</p>
<div id="def-fitted-value" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.3</strong></span> For a given dataset <span class="math inline">\((\tilde{Y}, \mathbf{X})\)</span> and corresponding fitted model <span class="math inline">\(\text{p}_{\hat \beta}(\tilde{y}|\mathbf{x})\)</span>, the <strong>fitted value</strong> of <span class="math inline">\(y_i\)</span> is the predicted value of <span class="math inline">\(y\)</span> when <span class="math inline">\(\tilde{X}=\tilde{x}_i\)</span> using the estimate parameters <span class="math inline">\(\hat \beta\)</span>.</p>
</div>
<p>R has an extra function to get these values:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm1</span><span class="op">)</span></span>
<span><span class="co">#&gt;    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 </span></span>
<span><span class="co">#&gt; 3225 3062 2984 2579 3225 3062 2621 2821 2742 3304 2863 2942 3346 3062 3225 2700 </span></span>
<span><span class="co">#&gt;   17   18   19   20   21   22   23   24 </span></span>
<span><span class="co">#&gt; 2863 2579 2984 2821 3225 2942 2984 3062</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="quantifying-uncertainty-in-predictions" class="level3" data-number="2.7.3"><h3 data-number="2.7.3" class="anchored" data-anchor-id="quantifying-uncertainty-in-predictions">
<span class="header-section-number">2.7.3</span> Quantifying uncertainty in predictions</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span></span>
<span>    newdata <span class="op">=</span> <span class="va">x</span>,</span>
<span>    se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $fit</span></span>
<span><span class="co">#&gt;    1 </span></span>
<span><span class="co">#&gt; 3225 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $se.fit</span></span>
<span><span class="co">#&gt; [1] 61.46</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $df</span></span>
<span><span class="co">#&gt; [1] 21</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $residual.scale</span></span>
<span><span class="co">#&gt; [1] 177.1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The output of <code>predict.lm(se.fit = TRUE)</code> is a <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>; you can extract the elements with <code>$</code> or <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">magrittr::use_series()</a></code>:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb58"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></span>
<span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span></span>
<span>    newdata <span class="op">=</span> <span class="va">x</span>,</span>
<span>    se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">use_series</a></span><span class="op">(</span><span class="va">se.fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 61.46</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can get <strong>confidence intervals</strong> for <span class="math inline">\(\mathbb{E}\left[Y|X=x\right]\)</span>:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span></span>
<span>  newdata <span class="op">=</span> <span class="va">x</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">fit</th>
<th style="text-align: right;">lwr</th>
<th style="text-align: right;">upr</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">3225</td>
<td style="text-align: right;">3098</td>
<td style="text-align: right;">3353</td>
</tr></tbody>
</table>
</div>
</div>
<p>You can also get <strong>prediction intervals</strong> for the value of an individual outcome <span class="math inline">\(Y\)</span>:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb60"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw_lm1</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">x</span>, interval <span class="op">=</span> <span class="st">"predict"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">fit</th>
<th style="text-align: right;">lwr</th>
<th style="text-align: right;">upr</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">3225</td>
<td style="text-align: right;">2836</td>
<td style="text-align: right;">3615</td>
</tr></tbody>
</table>
</div>
</div>
<p>The warning from the last command is: “predictions on current data refer to <em>future</em> responses” (since you already know what happened to the current data, and thus don’t need to predict it).</p>
<p>See <code><a href="https://rdrr.io/r/stats/predict.lm.html">?predict.lm</a></code> for more.</p>
</section></section><section id="sec-diagnose-LMs" class="level2" data-number="2.8"><h2 data-number="2.8" class="anchored" data-anchor-id="sec-diagnose-LMs">
<span class="header-section-number">2.8</span> Diagnostics</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section is adapted from <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018, secs. 6.2–6.3</a>)</span> and <span class="citation" data-cites="dunn2018generalized">Dunn and Smyth (<a href="references.html#ref-dunn2018generalized" role="doc-biblioref">2018</a>)</span> <a href="https://link.springer.com/chapter/10.1007/978-1-4419-0118-7_3">Chapter 3</a>.</p>
</div>
</div>
<section id="assumptions-in-linear-regression-models" class="level3 smaller scrollable" data-number="2.8.1"><h3 class="smaller scrollable anchored" data-number="2.8.1" data-anchor-id="assumptions-in-linear-regression-models">
<span class="header-section-number">2.8.1</span> Assumptions in linear regression models</h3>
<p><span class="math display">\[Y|\tilde{X}\ \sim_{⫫}\ N(\tilde{X}'\beta,\sigma^2)\]</span></p>
<ol type="1">
<li><p>Normality: The distribution conditional on a given <span class="math inline">\(X\)</span> value is normal</p></li>
<li><p>Correct Functional Form: The conditional means have the structure</p></li>
</ol>
<p><span class="math display">\[E[Y|\tilde{X} = \tilde{x}] = \tilde{x}'\beta\]</span> 3. Homoskedasticity: The variance <span class="math inline">\(\sigma^2\)</span> is constant (with respect to <span class="math inline">\(\tilde{x}\)</span>)</p>
<ol start="4" type="1">
<li>Independence: The observations are statistically independent</li>
</ol></section><section id="direct-visualization" class="level3" data-number="2.8.2"><h3 data-number="2.8.2" class="anchored" data-anchor-id="direct-visualization">
<span class="header-section-number">2.8.2</span> Direct visualization</h3>
<div class="notes">
<p>The most direct way to examine the fit of a model is to compare it to the raw observed data.</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">sex</span>, <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1_interact</span> <span class="op">=</span> </span>
<span>  <span class="va">plot1</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html">%+%</a></span> <span class="va">bw</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predlm2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot1_interact</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-bw-interaction2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-bw-interaction2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: Birthweight model with interaction term
</figcaption><div aria-describedby="fig-bw-interaction2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-bw-interaction2-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>It’s not easy to assess these assumptions from this model. If there are multiple continuous covariates, it becomes even harder to visualize the raw data.</p>
</div>
</section><section id="residuals" class="level3" data-number="2.8.3"><h3 data-number="2.8.3" class="anchored" data-anchor-id="residuals">
<span class="header-section-number">2.8.3</span> Residuals</h3>
<div class="notes">
<p>Maybe we can transform the data and model in some way to make it easier to inspect.</p>
</div>
<div id="def-resid-noise" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.4 (Residual noise)</strong></span> The <strong>residual noise</strong> in a probabilistic model <span class="math inline">\(p(Y)\)</span> is the difference between an observed value <span class="math inline">\(y\)</span> and its distributional mean:</p>
<p><span id="eq-def-resid"><span class="math display">\[\varepsilon(y) \stackrel{\text{def}}{=}y - \mathbb{E}\left[Y\right] \tag{2.8}\]</span></span></p>
</div>
<div class="notes">
<p>We use the same notation for residual noise that we used for <a href="./estimation.html#def-error">errors</a>. <span class="math inline">\(\mathbb{E}\left[Y\right]\)</span> can be viewed as an estimate of <span class="math inline">\(Y\)</span>, before <span class="math inline">\(y\)</span> is observed. Conversely, each observation <span class="math inline">\(y\)</span> can be viewed as an estimate of <span class="math inline">\(\mathbb{E}\left[Y\right]\)</span> (albeit an imprecise one, individually, since <span class="math inline">\(n=1\)</span>).</p>
</div>
<p>We can rearrange <a href="#eq-def-resid" class="quarto-xref">Equation&nbsp;<span>2.8</span></a> to view <span class="math inline">\(y\)</span> as the sum of its mean plus the residual noise:</p>
<p><span class="math display">\[y = \mathbb{E}\left[Y\right] + \varepsilon{y}\]</span></p>
<hr>
<div id="thm-gaussian-resid-noise" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2.1 (Residuals in Gaussian models)</strong></span> If <span class="math inline">\(Y\)</span> has a Gaussian distribution, then <span class="math inline">\(\varepsilon(Y)\)</span> also has a Gaussian distribution, and vice versa.</p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Left to the reader.</p>
</div>
<hr>
<div id="def-resid-fitted" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.5 (Residual errors of a fitted model value)</strong></span> The <strong>residual of a fitted value <span class="math inline">\(\hat y\)</span></strong> (shorthand: “residual”) is its <a href="./estimation.html#def-error">error</a>: <span class="math display">\[
\begin{aligned}
e(\hat y) &amp;\stackrel{\text{def}}{=}\varepsilon\left(\hat y\right)
\\&amp;= y - \hat y
\end{aligned}
\]</span></p>
</div>
<p><span class="math inline">\(e(\hat y)\)</span> can be seen as the maximum likelihood estimate of the residual noise:</p>
<p><span class="math display">\[
\begin{aligned}
e(\hat y) &amp;= y - \hat y
\\ &amp;= \hat\varepsilon_{ML}
\end{aligned}
\]</span></p>
<hr>
<section id="general-characteristics-of-residuals" class="level4"><h4 class="anchored" data-anchor-id="general-characteristics-of-residuals">General characteristics of residuals</h4>
<div id="thm-resid-unbiased" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2.2</strong></span> For <a href="./estimation.html#sec-unbiased-estimators">unbiased</a> estimators <span class="math inline">\(\hat\theta\)</span>:</p>
<p><span id="eq-mean-resid-unbiased"><span class="math display">\[\mathbb{E}\left[e(y)\right] = 0 \tag{2.9}\]</span></span> <span id="eq-var-resid-unbiased"><span class="math display">\[\text{Var}\left(e(y)\right) \approx \sigma^2 \tag{2.10}\]</span></span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>&nbsp;</p>
<p><a href="#eq-mean-resid-unbiased" class="quarto-xref">Equation&nbsp;<span>2.9</span></a>:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}\left[e(y)\right] &amp;= \mathbb{E}\left[y - \hat y\right]
\\ &amp;= \mathbb{E}\left[y\right] - \mathbb{E}\left[\hat y\right]
\\ &amp;= \mathbb{E}\left[y\right] - \mathbb{E}\left[y\right]
\\ &amp;= 0
\end{aligned}
\]</span></p>
<p><a href="#eq-var-resid-unbiased" class="quarto-xref">Equation&nbsp;<span>2.10</span></a>:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Var}\left(e(y)\right) &amp;= \text{Var}\left(y - \hat y\right)
\\ &amp;= \text{Var}\left(y\right) + \text{Var}\left(\hat y\right) - 2 \text{Cov}\left(y, \hat y\right)
\\ &amp;{\dot{\approx}} \text{Var}\left(y\right) + 0 - 2 \cdot 0
\\ &amp;= \text{Var}\left(y\right)
\\ &amp;= \sigma^2
\end{aligned}
\]</span></p>
</div>
<hr></section><section id="characteristics-of-residuals-in-gaussian-models" class="level4"><h4 class="anchored" data-anchor-id="characteristics-of-residuals-in-gaussian-models">Characteristics of residuals in Gaussian models</h4>
<p>With enough data and a correct model, the residuals will be approximately Guassian distributed, with variance <span class="math inline">\(\sigma^2\)</span>, which we can estimate using <span class="math inline">\(\hat\sigma^2\)</span>: that is:</p>
<p><span class="math display">\[
e_i \ \sim_{\text{iid}}\ N(0, \hat\sigma^2)
\]</span></p>
<hr>
<div id="exm-resid-bw" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.2 (residuals in <code>birthweight</code> data)</strong></span> R provides a function for residuals:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb62"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt;       1       2       3       4       5       6       7       8       9      10 </span></span>
<span><span class="co">#&gt;  176.27 -140.73 -144.13  -59.53  177.47 -126.93  -68.93  242.67 -139.33   51.67 </span></span>
<span><span class="co">#&gt;      11      12      13      14      15      16      17      18      19      20 </span></span>
<span><span class="co">#&gt;  156.67 -125.13  274.28 -137.71  -27.69 -246.69 -191.67  189.33  -11.67 -242.64 </span></span>
<span><span class="co">#&gt;      21      22      23      24 </span></span>
<span><span class="co">#&gt;  -47.64  262.36  210.36  -30.62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div id="exr-calc-resids" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 2.8</strong></span> Check R’s output by computing the residuals directly.</p>
</div>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>&nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span><span class="op">$</span><span class="va">weight</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt;       1       2       3       4       5       6       7       8       9      10 </span></span>
<span><span class="co">#&gt;  176.27 -140.73 -144.13  -59.53  177.47 -126.93  -68.93  242.67 -139.33   51.67 </span></span>
<span><span class="co">#&gt;      11      12      13      14      15      16      17      18      19      20 </span></span>
<span><span class="co">#&gt;  156.67 -125.13  274.28 -137.71  -27.69 -246.69 -191.67  189.33  -11.67 -242.64 </span></span>
<span><span class="co">#&gt;      21      22      23      24 </span></span>
<span><span class="co">#&gt;  -47.64  262.36  210.36  -30.62</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This matches R’s output!</p>
</div>
<hr></section><section id="graph-the-residuals" class="level4"><h4 class="anchored" data-anchor-id="graph-the-residuals">Graph the residuals</h4>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb64"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>resids_intxn <span class="op">=</span> </span>
<span>           <span class="va">weight</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_bw_resid</span> <span class="op">=</span></span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">age</span>, </span>
<span>    y <span class="op">=</span> <span class="va">resids_intxn</span>,</span>
<span>    linetype <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    shape <span class="op">=</span> <span class="va">sex</span>,</span>
<span>    col <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Gestational age (weeks)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"residuals (grams)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># expand_limits(y = 0, x = 0) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.7</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">plot_bw_resid</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-resids-intxn" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-resids-intxn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.7: Residuals of interaction model for <code>birthweight</code> data
</figcaption><div aria-describedby="fig-resids-intxn-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-resids-intxn-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<div id="def-stred" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2.6 (Standardized residuals)</strong></span> <span class="math display">\[r_i = \frac{e_i}{\widehat{SD}(e_i)}\]</span></p>
</div>
<p>Hence, with enough data and a correct model, the standardized residuals will be approximately standard Gaussian; that is,</p>
<p><span class="math display">\[
r_i \ \sim_{\text{iid}}\ N(0,1)
\]</span></p>
</section></section><section id="marginal-distributions-of-residuals" class="level3" data-number="2.8.4"><h3 data-number="2.8.4" class="anchored" data-anchor-id="marginal-distributions-of-residuals">
<span class="header-section-number">2.8.4</span> Marginal distributions of residuals</h3>
<p>To look for problems with our model, we can check whether the residuals <span class="math inline">\(e_i\)</span> and standardized residuals <span class="math inline">\(r_i\)</span> look like they have the distributions that they are supposed to have, according to the model.</p>
<hr>
<section id="standardized-residuals-in-r" class="level4"><h4 class="anchored" data-anchor-id="standardized-residuals-in-r">Standardized residuals in R</h4>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        1        2        3        4        5        6        7        8 </span></span>
<span><span class="co">#&gt;  1.15982 -0.92601 -0.87479 -0.34723  1.03507 -0.73473 -0.39901  1.43752 </span></span>
<span><span class="co">#&gt;        9       10       11       12       13       14       15       16 </span></span>
<span><span class="co">#&gt; -0.82539  0.30606  0.92807 -0.87616  1.91428 -0.86559 -0.16430 -1.46376 </span></span>
<span><span class="co">#&gt;       17       18       19       20       21       22       23       24 </span></span>
<span><span class="co">#&gt; -1.11016  1.09658 -0.06761 -1.46159 -0.28696  1.58040  1.26717 -0.19805</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        1        2        3        4        5        6        7        8 </span></span>
<span><span class="co">#&gt;  0.97593 -0.77920 -0.79802 -0.32962  0.98258 -0.70279 -0.38166  1.34357 </span></span>
<span><span class="co">#&gt;        9       10       11       12       13       14       15       16 </span></span>
<span><span class="co">#&gt; -0.77144  0.28606  0.86741 -0.69282  1.51858 -0.76244 -0.15331 -1.36584 </span></span>
<span><span class="co">#&gt;       17       18       19       20       21       22       23       24 </span></span>
<span><span class="co">#&gt; -1.06123  1.04825 -0.06463 -1.34341 -0.26376  1.45262  1.16471 -0.16954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="notes">
<p>These are not quite the same, because R is doing something more complicated and precise to get the standard errors. Let’s not worry about those details for now; the difference is pretty small in this case:</p>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb66"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">rstandard_compare_plot</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>, </span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"resid(bw_lm2)/sigma(bw_lm2)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"rstandard(bw_lm2)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      intercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      slope <span class="op">=</span> <span class="fl">1</span>, </span>
<span>      col <span class="op">=</span> <span class="st">"x=y"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour<span class="op">=</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">rstandard_compare_plot</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Let’s add these residuals to the <code>tibble</code> of our dataset:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    fitted_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    </span>
<span>    resid_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">resid</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    <span class="co"># resid_lm2 = weight - fitted_lm2,</span></span>
<span>    </span>
<span>    std_resid_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    <span class="co"># std_resid_lm2 = resid_lm2 / sigma(bw_lm2)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span></span>
<span>    <span class="va">sex</span>,</span>
<span>    <span class="va">age</span>,</span>
<span>    <span class="va">weight</span>,</span>
<span>    <span class="va">fitted_lm2</span>,</span>
<span>    <span class="va">resid_lm2</span>,</span>
<span>    <span class="va">std_resid_lm2</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">sex</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">weight</th>
<th style="text-align: right;">fitted_lm2</th>
<th style="text-align: right;">resid_lm2</th>
<th style="text-align: right;">std_resid_lm2</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2729</td>
<td style="text-align: right;">2553</td>
<td style="text-align: right;">176.27</td>
<td style="text-align: right;">1.1598</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2412</td>
<td style="text-align: right;">2553</td>
<td style="text-align: right;">-140.73</td>
<td style="text-align: right;">-0.9260</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">2539</td>
<td style="text-align: right;">2683</td>
<td style="text-align: right;">-144.13</td>
<td style="text-align: right;">-0.8748</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2754</td>
<td style="text-align: right;">2814</td>
<td style="text-align: right;">-59.53</td>
<td style="text-align: right;">-0.3472</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2991</td>
<td style="text-align: right;">2814</td>
<td style="text-align: right;">177.47</td>
<td style="text-align: right;">1.0351</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2817</td>
<td style="text-align: right;">2944</td>
<td style="text-align: right;">-126.93</td>
<td style="text-align: right;">-0.7347</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">39</td>
<td style="text-align: right;">2875</td>
<td style="text-align: right;">2944</td>
<td style="text-align: right;">-68.93</td>
<td style="text-align: right;">-0.3990</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3317</td>
<td style="text-align: right;">3074</td>
<td style="text-align: right;">242.67</td>
<td style="text-align: right;">1.4375</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2935</td>
<td style="text-align: right;">3074</td>
<td style="text-align: right;">-139.33</td>
<td style="text-align: right;">-0.8254</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3126</td>
<td style="text-align: right;">3074</td>
<td style="text-align: right;">51.67</td>
<td style="text-align: right;">0.3061</td>
</tr>
<tr class="odd">
<td style="text-align: left;">female</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3231</td>
<td style="text-align: right;">3074</td>
<td style="text-align: right;">156.67</td>
<td style="text-align: right;">0.9281</td>
</tr>
<tr class="even">
<td style="text-align: left;">female</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">3210</td>
<td style="text-align: right;">3335</td>
<td style="text-align: right;">-125.13</td>
<td style="text-align: right;">-0.8762</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">2925</td>
<td style="text-align: right;">2651</td>
<td style="text-align: right;">274.28</td>
<td style="text-align: right;">1.9143</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">2625</td>
<td style="text-align: right;">2763</td>
<td style="text-align: right;">-137.71</td>
<td style="text-align: right;">-0.8656</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">2847</td>
<td style="text-align: right;">2875</td>
<td style="text-align: right;">-27.69</td>
<td style="text-align: right;">-0.1643</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">2628</td>
<td style="text-align: right;">2875</td>
<td style="text-align: right;">-246.69</td>
<td style="text-align: right;">-1.4638</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2795</td>
<td style="text-align: right;">2987</td>
<td style="text-align: right;">-191.67</td>
<td style="text-align: right;">-1.1102</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">3176</td>
<td style="text-align: right;">2987</td>
<td style="text-align: right;">189.33</td>
<td style="text-align: right;">1.0966</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">2975</td>
<td style="text-align: right;">2987</td>
<td style="text-align: right;">-11.67</td>
<td style="text-align: right;">-0.0676</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">2968</td>
<td style="text-align: right;">3211</td>
<td style="text-align: right;">-242.64</td>
<td style="text-align: right;">-1.4616</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3163</td>
<td style="text-align: right;">3211</td>
<td style="text-align: right;">-47.64</td>
<td style="text-align: right;">-0.2870</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3473</td>
<td style="text-align: right;">3211</td>
<td style="text-align: right;">262.36</td>
<td style="text-align: right;">1.5804</td>
</tr>
<tr class="odd">
<td style="text-align: left;">male</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">3421</td>
<td style="text-align: right;">3211</td>
<td style="text-align: right;">210.36</td>
<td style="text-align: right;">1.2672</td>
</tr>
<tr class="even">
<td style="text-align: left;">male</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">3292</td>
<td style="text-align: right;">3323</td>
<td style="text-align: right;">-30.62</td>
<td style="text-align: right;">-0.1981</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<div class="notes">
<p>Now let’s build histograms:</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb68"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">resid_marginal_hist</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resid_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">resid_marginal_hist</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-marg-dist-resid" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-marg-dist-resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.8: Marginal distribution of (nonstandardized) residuals
</figcaption><div aria-describedby="fig-marg-dist-resid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-marg-dist-resid-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>Hard to tell with this small amount of data, but I’m a bit concerned that the histogram doesn’t show a bell-curve shape.</p>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">std_resid_marginal_hist</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">std_resid_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">std_resid_marginal_hist</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-marg-stresd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-marg-stresd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.9: Marginal distribution of standardized residuals
</figcaption><div aria-describedby="fig-marg-stresd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-marg-stresd-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>This looks similar, although the scale of the x-axis got narrower, because we divided by <span class="math inline">\(\hat\sigma\)</span> (roughly speaking).</p>
<p>Still hard to tell if the distribution is Gaussian.</p>
</div>
<hr></section></section><section id="qq-plot-of-standardized-residuals" class="level3" data-number="2.8.5"><h3 data-number="2.8.5" class="anchored" data-anchor-id="qq-plot-of-standardized-residuals">
<span class="header-section-number">2.8.5</span> QQ plot of standardized residuals</h3>
<div class="notes">
<p>Another way to assess normality is the QQ plot of the standardized residuals versus normal quantiles:</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span> </span>
<span><span class="co"># needed to make ggplot2::autoplot() work for `lm` objects</span></span>
<span></span>
<span><span class="va">qqplot_lm2_auto</span> <span class="op">=</span> </span>
<span>  <span class="va">bw_lm2</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span></span>
<span>    which <span class="op">=</span> <span class="fl">2</span>, <span class="co"># options are 1:6; can do multiple at once</span></span>
<span>    ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">qqplot_lm2_auto</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>If the Gaussian model were correct, these points should follow the dotted line.</p>
<p>Fig 2.4 panel (c) in <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> is a little different; they didn’t specify how they produced it, but other statistical analysis systems do things differently from R.</p>
<p>See also <span class="citation" data-cites="dunn2018generalized">Dunn and Smyth (<a href="references.html#ref-dunn2018generalized" role="doc-biblioref">2018</a>)</span> <a href="https://link.springer.com/chapter/10.1007/978-1-4419-0118-7_3#Sec14:~:text=3.5.4%20Q%E2%80%93Q%20Plots%20and%20Normality">§3.5.4</a>.</p>
</div>
<hr>
<section id="qq-plot---how-its-built" class="level4"><h4 class="anchored" data-anchor-id="qq-plot---how-its-built">QQ plot - how it’s built</h4>
<div class="notes">
<p>Let’s construct it by hand:</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    p <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="va">std_resid_lm2</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="co"># "Blom's method"</span></span>
<span>    expected_quantiles_lm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">qqplot_lm2</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">expected_quantiles_lm2</span>, </span>
<span>      y <span class="op">=</span> <span class="va">std_resid_lm2</span>, </span>
<span>      col <span class="op">=</span> <span class="va">sex</span>, </span>
<span>      shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">'none'</span><span class="op">)</span> <span class="op">+</span> <span class="co"># removing the plot legend</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Normal Q-Q"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Theoretical Quantiles"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Standardized residuals"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find the expected line:</span></span>
<span></span>
<span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">.75</span><span class="op">)</span>                  <span class="co"># reference probabilities</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html">rstandard</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>, <span class="va">ps</span><span class="op">)</span>  <span class="co"># empirical quantiles</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="va">ps</span><span class="op">)</span>                     <span class="co"># theoretical quantiles</span></span>
<span></span>
<span><span class="va">qq_slope</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span></span>
<span><span class="va">qq_intcpt</span> <span class="op">=</span> <span class="va">a</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">qq_slope</span></span>
<span></span>
<span><span class="va">qqplot_lm2</span> <span class="op">=</span> </span>
<span>  <span class="va">qqplot_lm2</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="va">qq_slope</span>, intercept <span class="op">=</span> <span class="va">qq_intcpt</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">qqplot_lm2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr></section></section><section id="conditional-distributions-of-residuals" class="level3" data-number="2.8.6"><h3 data-number="2.8.6" class="anchored" data-anchor-id="conditional-distributions-of-residuals">
<span class="header-section-number">2.8.6</span> Conditional distributions of residuals</h3>
<p>If our Gaussian linear regression model is correct, the residuals <span class="math inline">\(e_i\)</span> and standardized residuals <span class="math inline">\(r_i\)</span> should have:</p>
<ul>
<li>an approximately Gaussian distribution, with:</li>
<li>a mean of 0</li>
<li>a constant variance</li>
</ul>
<p>This should be true <strong>for every</strong> value of <span class="math inline">\(x\)</span>.</p>
<hr>
<p>If we didn’t correctly guess the functional form of the linear component of the mean, <span class="math display">\[\text{E}[Y|X=x] = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p\]</span></p>
<p>Then the the residuals might have nonzero mean.</p>
<p>Regardless of whether we guessed the mean function correctly, ther the variance of the residuals might differ between values of <span class="math inline">\(x\)</span>.</p>
<hr>
<section id="residuals-versus-fitted-values" class="level4"><h4 class="anchored" data-anchor-id="residuals-versus-fitted-values">Residuals versus fitted values</h4>
<div class="notes">
<p>To look for these issues, we can plot the residuals <span class="math inline">\(e_i\)</span> against the fitted values <span class="math inline">\(\hat y_i\)</span> (<a href="#fig-bw_lm2-resid-vs-fitted" class="quarto-xref">Figure&nbsp;<span>2.10</span></a>).</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb72"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">bw_lm2</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-bw_lm2-resid-vs-fitted" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-bw_lm2-resid-vs-fitted-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.10: <code>birthweight</code> model (<a href="#eq-BW-lm-interact" class="quarto-xref">Equation&nbsp;<span>2.2</span></a>): residuals versus fitted values
</figcaption><div aria-describedby="fig-bw_lm2-resid-vs-fitted-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-bw_lm2-resid-vs-fitted-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>If the model is correct, the blue line should stay flat and close to 0, and the cloud of dots should have the same vertical spread regardless of the fitted value.</p>
<p>If not, we probably need to change the functional form of linear component of the mean, <span class="math display">\[\text{E}[Y|X=x] = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p\]</span></p>
</div>
<hr></section><section id="example-plos-medicine-title-length-data" class="level4"><h4 class="anchored" data-anchor-id="example-plos-medicine-title-length-data">Example: PLOS Medicine title length data</h4>
<p>(Adapted from <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>, §6.7.1)</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">PLOS</span>, package <span class="op">=</span> <span class="st">"dobson"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">fig1</span> <span class="op">=</span> </span>
<span>  <span class="va">PLOS</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">authors</span>,</span>
<span>        y <span class="op">=</span> <span class="va">nchar</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>col<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-plos" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.11: Number of authors versus title length in <em>PLOS Medicine</em> articles
</figcaption><div aria-describedby="fig-plos-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<section id="linear-fit" class="level5"><h5 class="anchored" data-anchor-id="linear-fit">Linear fit</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb74"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_PLOS_linear</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">nchar</span> <span class="op">~</span> <span class="va">authors</span>, </span>
<span>  data <span class="op">=</span> <span class="va">PLOS</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fig2</span> <span class="op">=</span> <span class="va">fig1</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>, </span>
<span>              fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"lm(y ~ x)"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fig2</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lm_PLOS_linear</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-plos-lm" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.12: Number of authors versus title length in <em>PLOS Medicine</em>, with linear model fit
</figcaption><div aria-describedby="fig-plos-lm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Data and fit
</figcaption><div aria-describedby="fig-plos-lm-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-1.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Residuals vs fitted
</figcaption><div aria-describedby="fig-plos-lm-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-2.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<hr></section><section id="quadratic-fit" class="level5 smaller"><h5 class="smaller anchored" data-anchor-id="quadratic-fit">Quadratic fit</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb76"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_PLOS_quad</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">nchar</span> <span class="op">~</span> <span class="va">authors</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">authors</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="va">PLOS</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fig3</span> <span class="op">=</span> </span>
<span>  <span class="va">fig2</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"lm(y ~ x + I(x^2))"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">fig3</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lm_PLOS_quad</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-plos-lm-quad" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-lm-quad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.13: Number of authors versus title length in <em>PLOS Medicine</em>, with quadratic model fit
</figcaption><div aria-describedby="fig-plos-lm-quad-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm-quad" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-quad-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-quad-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Data and fit
</figcaption><div aria-describedby="fig-plos-lm-quad-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-quad-1.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm-quad" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm-quad" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-quad-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-quad-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Residuals vs fitted
</figcaption><div aria-describedby="fig-plos-lm-quad-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-quad-2.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm-quad" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<hr></section><section id="linear-versus-quadratic-fits" class="level5"><h5 class="anchored" data-anchor-id="linear-versus-quadratic-fits">Linear versus quadratic fits</h5>
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb78"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lm_PLOS_linear</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lm_PLOS_quad</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-plos-lm-resid2" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-lm-resid2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.14: Residuals versus fitted plot for linear and quadratic fits to <code>PLOS</code> data
</figcaption><div aria-describedby="fig-plos-lm-resid2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm-resid2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-resid2-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-resid2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Linear
</figcaption><div aria-describedby="fig-plos-lm-resid2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-resid2-1.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm-resid2" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm-resid2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-resid2-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-resid2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Quadratic
</figcaption><div aria-describedby="fig-plos-lm-resid2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-resid2-2.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm-resid2" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<hr></section><section id="cubic-fit" class="level5"><h5 class="anchored" data-anchor-id="cubic-fit">Cubic fit</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_PLOS_cub</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">nchar</span> <span class="op">~</span> <span class="va">authors</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">authors</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">authors</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="va">PLOS</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb80"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fig4</span> <span class="op">=</span> </span>
<span>  <span class="va">fig3</span> <span class="op">+</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"lm(y ~ x + I(x^2) + I(x ^ 3))"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">fig4</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lm_PLOS_cub</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-plos-lm-cubic" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-lm-cubic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.15: Number of authors versus title length in <em>PLOS Medicine</em>, with cubic model fit
</figcaption><div aria-describedby="fig-plos-lm-cubic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm-cubic" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-cubic-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-cubic-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Data and fit
</figcaption><div aria-describedby="fig-plos-lm-cubic-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-cubic-1.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm-cubic" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-lm-cubic" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-lm-cubic-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-lm-cubic-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Residuals vs fitted
</figcaption><div aria-describedby="fig-plos-lm-cubic-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-lm-cubic-2.png" class="img-fluid figure-img" data-ref-parent="fig-plos-lm-cubic" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<hr></section><section id="logarithmic-fit" class="level5"><h5 class="anchored" data-anchor-id="logarithmic-fit">Logarithmic fit</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lm_PLOS_log</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">nchar</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">authors</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">PLOS</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb82"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fig5</span> <span class="op">=</span> <span class="va">fig4</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span></span>
<span>    method <span class="op">=</span> <span class="st">"lm"</span>,</span>
<span>    fullrange <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"lm(y ~ log(x))"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">fig5</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">lm_PLOS_log</span>, which <span class="op">=</span> <span class="fl">1</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-plos-log" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.16: logarithmic fit
</figcaption><div aria-describedby="fig-plos-log-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-log" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-log-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-log-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Data and fit
</figcaption><div aria-describedby="fig-plos-log-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-log-1.png" class="img-fluid figure-img" data-ref-parent="fig-plos-log" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-plos-log" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-plos-log-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure"><figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-plos-log-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Residuals vs fitted
</figcaption><div aria-describedby="fig-plos-log-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-log-2.png" class="img-fluid figure-img" data-ref-parent="fig-plos-log" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<hr></section><section id="model-selection" class="level5 smaller"><h5 class="smaller anchored" data-anchor-id="model-selection">Model selection</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">lm_PLOS_linear</span>, <span class="va">lm_PLOS_quad</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-plos-lin-quad-anova" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-plos-lin-quad-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.11: linear vs quadratic
</figcaption><div aria-describedby="tbl-plos-lin-quad-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">876</td>
<td style="text-align: right;">947502</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">875</td>
<td style="text-align: right;">880950</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">66552</td>
<td style="text-align: right;">66.1</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb84"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">lm_PLOS_quad</span>, <span class="va">lm_PLOS_cub</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-plos-quad-cub-anova" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-plos-quad-cub-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.12: quadratic vs cubic
</figcaption><div aria-describedby="tbl-plos-quad-cub-anova-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">875</td>
<td style="text-align: right;">880950</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">874</td>
<td style="text-align: right;">865933</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">15018</td>
<td style="text-align: right;">15.16</td>
<td style="text-align: right;">1e-04</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<hr></section><section id="aicbic" class="level5 smaller"><h5 class="smaller anchored" data-anchor-id="aicbic">AIC/BIC</h5>
<div class="cell">
<details open="" class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">lm_PLOS_quad</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8568</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">lm_PLOS_cub</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8555</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb86"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">lm_PLOS_cub</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8555</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">lm_PLOS_log</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8544</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">lm_PLOS_cub</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8578</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span><span class="op">(</span><span class="va">lm_PLOS_log</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 8558</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="extrapolation-is-dangerous" class="level5"><h5 class="anchored" data-anchor-id="extrapolation-is-dangerous">Extrapolation is dangerous</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fig_all</span> <span class="op">=</span> <span class="va">fig5</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span><span class="op">)</span></span>
<span><span class="va">fig_all</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-plos-multifit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-plos-multifit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.17: Number of authors versus title length in <em>PLOS Medicine</em>
</figcaption><div aria-describedby="fig-plos-multifit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-plos-multifit-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr></section></section><section id="scale-location-plot" class="level4"><h4 class="anchored" data-anchor-id="scale-location-plot">Scale-location plot</h4>
<div class="notes">
<p>We can also plot the square roots of the absolute values of the standardized residuals against the fitted values (<a href="#fig-bw-scale-loc" class="quarto-xref">Figure&nbsp;<span>2.18</span></a>).</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb89"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">bw_lm2</span>, which <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-bw-scale-loc" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-bw-scale-loc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.18: Scale-location plot of <code>birthweight</code> data
</figcaption><div aria-describedby="fig-bw-scale-loc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-bw-scale-loc-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>Here, the blue line doesn’t need to be near 0, but it should be flat. If not, the residual variance <span class="math inline">\(\sigma^2\)</span> might not be constant, and we might need to transform our outcome <span class="math inline">\(Y\)</span> (or use a model that allows non-constant variance).</p>
</div>
<hr></section><section id="residuals-versus-leverage" class="level4"><h4 class="anchored" data-anchor-id="residuals-versus-leverage">Residuals versus leverage</h4>
<div class="notes">
<p>We can also plot our standardized residuals against “leverage”, which roughly speaking is a measure of how unusual each <span class="math inline">\(x_i\)</span> value is. Very unusual <span class="math inline">\(x_i\)</span> values can have extreme effects on the model fit, so we might want to remove those observations as outliers, particularly if they have large residuals.</p>
</div>
<div class="cell" data-labels="fig-bw_lm2_resid-vs-leverage">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">bw_lm2</span>, which <span class="op">=</span> <span class="fl">5</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><figcaption><code>birthweight</code> model with interactions (<a href="#eq-BW-lm-interact" class="quarto-xref">Equation&nbsp;<span>2.2</span></a>): residuals versus leverage</figcaption><p><img src="Linear-models-overview_files/figure-html/-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>The blue line should be relatively flat and close to 0 here.</p>
</div>
<hr></section></section><section id="diagnostics-constructed-by-hand" class="level3" data-number="2.8.7"><h3 data-number="2.8.7" class="anchored" data-anchor-id="diagnostics-constructed-by-hand">
<span class="header-section-number">2.8.7</span> Diagnostics constructed by hand</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb91"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw</span> <span class="op">=</span> </span>
<span>  <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    residlm2 <span class="op">=</span> <span class="va">weight</span> <span class="op">-</span> <span class="va">predlm2</span>,</span>
<span>    std_resid <span class="op">=</span> <span class="va">residlm2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">bw_lm2</span><span class="op">)</span>,</span>
<span>    <span class="co"># std_resid_builtin = rstandard(bw_lm2), # uses leverage</span></span>
<span>    sqrt_abs_std_resid <span class="op">=</span> <span class="va">std_resid</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="residuals-vs-fitted" class="level5"><h5 class="anchored" data-anchor-id="residuals-vs-fitted">Residuals vs fitted</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">resid_vs_fit</span> <span class="op">=</span> <span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predlm2</span>, y <span class="op">=</span> <span class="va">residlm2</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb93"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">resid_vs_fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="standardized-residuals-vs-fitted" class="level5"><h5 class="anchored" data-anchor-id="standardized-residuals-vs-fitted">Standardized residuals vs fitted</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predlm2</span>, y <span class="op">=</span> <span class="va">std_resid</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="standardized-residuals-vs-gestational-age" class="level5"><h5 class="anchored" data-anchor-id="standardized-residuals-vs-gestational-age">Standardized residuals vs gestational age</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">std_resid</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="sqrtabsrstandard-vs-fitted" class="level5"><h5 class="anchored" data-anchor-id="sqrtabsrstandard-vs-fitted">
<code>sqrt(abs(rstandard()))</code> vs fitted</h5>
<p>Compare with <code>autoplot(bw_lm2, 3)</code></p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span></span>
<span><span class="va">bw</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">predlm2</span>, y <span class="op">=</span> <span class="va">sqrt_abs_std_resid</span>, col <span class="op">=</span> <span class="va">sex</span>, shape <span class="op">=</span> <span class="va">sex</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section></section><section id="model-selection-1" class="level2" data-number="2.9"><h2 data-number="2.9" class="anchored" data-anchor-id="model-selection-1">
<span class="header-section-number">2.9</span> Model selection</h2>
<p>(adapted from <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> §6.3.3; for more information on prediction, see <span class="citation" data-cites="james2013introduction">James et al. (<a href="references.html#ref-james2013introduction" role="doc-biblioref">2013</a>)</span> and <span class="citation" data-cites="rms2e">Harrell (<a href="references.html#ref-rms2e" role="doc-biblioref">2015</a>)</span>).</p>
<div class="notes">
<p>If we have a lot of covariates in our dataset, we might want to choose a small subset to use in our model.</p>
<p>There are a few possible metrics to consider for choosing a “best” model.</p>
</div>
<section id="mean-squared-error" class="level3" data-number="2.9.1"><h3 data-number="2.9.1" class="anchored" data-anchor-id="mean-squared-error">
<span class="header-section-number">2.9.1</span> Mean squared error</h3>
<p>We might want to minimize the <strong>mean squared error</strong>, <span class="math inline">\(\text E[(y-\hat y)^2]\)</span>, for new observations that weren’t in our data set when we fit the model.</p>
<p>Unfortunately, <span class="math display">\[\frac{1}{n}\sum_{i=1}^n (y_i-\hat y_i)^2\]</span> gives a biased estimate of <span class="math inline">\(\text E[(y-\hat y)^2]\)</span> for new data. If we want an unbiased estimate, we will have to be clever.</p>
<hr>
<section id="cross-validation" class="level4"><h4 class="anchored" data-anchor-id="cross-validation">Cross-validation</h4>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"carbohydrate"</span>, package <span class="op">=</span> <span class="st">"dobson"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cvTools</span><span class="op">)</span></span>
<span><span class="va">full_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">carbohydrate</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">carbohydrate</span><span class="op">)</span></span>
<span><span class="va">cv_full</span> <span class="op">=</span> </span>
<span>  <span class="va">full_model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/cvTools/man/cvFit.html">cvFit</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">carbohydrate</span>, K <span class="op">=</span> <span class="fl">5</span>, R <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    y <span class="op">=</span> <span class="va">carbohydrate</span><span class="op">$</span><span class="va">carbohydrate</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reduced_model</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">full_model</span>, </span>
<span>                       formula <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">age</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_reduced</span> <span class="op">=</span> </span>
<span>  <span class="va">reduced_model</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/pkg/cvTools/man/cvFit.html">cvFit</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">carbohydrate</span>, K <span class="op">=</span> <span class="fl">5</span>, R <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    y <span class="op">=</span> <span class="va">carbohydrate</span><span class="op">$</span><span class="va">carbohydrate</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">results_reduced</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="st">"wgt+protein"</span>,</span>
<span>      errs <span class="op">=</span> <span class="va">cv_reduced</span><span class="op">$</span><span class="va">reps</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">results_full</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"wgt+age+protein"</span>,</span>
<span>           errs <span class="op">=</span> <span class="va">cv_full</span><span class="op">$</span><span class="va">reps</span><span class="op">[</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_results</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">results_reduced</span>, <span class="va">results_full</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cv_results</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">model</span>, x <span class="op">=</span> <span class="va">errs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<section id="comparing-metrics" class="level5"><h5 class="anchored" data-anchor-id="comparing-metrics">comparing metrics</h5>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb99"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="va">compare_results</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="va">model</span>, <span class="op">~</span> <span class="va">cvRMSE</span>, <span class="op">~</span> <span class="va">r.squared</span>, <span class="op">~</span><span class="va">adj.r.squared</span>, <span class="op">~</span> <span class="va">trainRMSE</span>, <span class="op">~</span><span class="va">loglik</span>,</span>
<span>  <span class="st">"full"</span>, <span class="va">cv_full</span><span class="op">$</span><span class="va">cv</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">full_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>,  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">full_model</span><span class="op">)</span><span class="op">$</span><span class="va">adj.r.squared</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">full_model</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">full_model</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="st">"reduced"</span>, <span class="va">cv_reduced</span><span class="op">$</span><span class="va">cv</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reduced_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reduced_model</span><span class="op">)</span><span class="op">$</span><span class="va">adj.r.squared</span>, <span class="fu"><a href="https://rdrr.io/r/stats/sigma.html">sigma</a></span><span class="op">(</span><span class="va">reduced_model</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/logLik.html">logLik</a></span><span class="op">(</span><span class="va">reduced_model</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">compare_results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">cvRMSE</th>
<th style="text-align: right;">r.squared</th>
<th style="text-align: right;">adj.r.squared</th>
<th style="text-align: right;">trainRMSE</th>
<th style="text-align: right;">loglik</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">full</td>
<td style="text-align: right;">6.947</td>
<td style="text-align: right;">0.4805</td>
<td style="text-align: right;">0.3831</td>
<td style="text-align: right;">5.956</td>
<td style="text-align: right;">-61.84</td>
</tr>
<tr class="even">
<td style="text-align: left;">reduced</td>
<td style="text-align: right;">6.524</td>
<td style="text-align: right;">0.4454</td>
<td style="text-align: right;">0.3802</td>
<td style="text-align: right;">5.971</td>
<td style="text-align: right;">-62.49</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">full_model</span>, <span class="va">reduced_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Res.Df</th>
<th style="text-align: right;">RSS</th>
<th style="text-align: right;">Df</th>
<th style="text-align: right;">Sum of Sq</th>
<th style="text-align: right;">F</th>
<th style="text-align: right;">Pr(&gt;F)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: right;">567.7</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">17</td>
<td style="text-align: right;">606.0</td>
<td style="text-align: right;">-1</td>
<td style="text-align: right;">-38.36</td>
<td style="text-align: right;">1.081</td>
<td style="text-align: right;">0.3139</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr></section></section><section id="stepwise-regression" class="level4"><h4 class="anchored" data-anchor-id="stepwise-regression">stepwise regression</h4>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb101"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://olsrr.rsquaredacademy.com/">olsrr</a></span><span class="op">)</span></span>
<span><span class="fu">olsrr</span><span class="fu">:::</span><span class="fu"><a href="https://olsrr.rsquaredacademy.com/reference/ols_step_both_aic.html">ols_step_both_aic</a></span><span class="op">(</span><span class="va">full_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                              Stepwise Summary                              </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Step    Variable         AIC        SBC       SBIC       R2       Adj. R2 </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;  0      Base Model     140.773    142.764    83.068    0.00000    0.00000 </span></span>
<span><span class="co">#&gt;  1      protein (+)    137.950    140.937    80.438    0.21427    0.17061 </span></span>
<span><span class="co">#&gt;  2      weight (+)     132.981    136.964    77.191    0.44544    0.38020 </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final Model Output </span></span>
<span><span class="co">#&gt; ------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                          Model Summary                          </span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------</span></span>
<span><span class="co">#&gt; R                       0.667       RMSE                 5.505 </span></span>
<span><span class="co">#&gt; R-Squared               0.445       MSE                 30.301 </span></span>
<span><span class="co">#&gt; Adj. R-Squared          0.380       Coef. Var           15.879 </span></span>
<span><span class="co">#&gt; Pred R-Squared          0.236       AIC                132.981 </span></span>
<span><span class="co">#&gt; MAE                     4.593       SBC                136.964 </span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------</span></span>
<span><span class="co">#&gt;  RMSE: Root Mean Square Error </span></span>
<span><span class="co">#&gt;  MSE: Mean Square Error </span></span>
<span><span class="co">#&gt;  MAE: Mean Absolute Error </span></span>
<span><span class="co">#&gt;  AIC: Akaike Information Criteria </span></span>
<span><span class="co">#&gt;  SBC: Schwarz Bayesian Criteria </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                ANOVA                                </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;                 Sum of                                             </span></span>
<span><span class="co">#&gt;                Squares        DF    Mean Square      F        Sig. </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; Regression     486.778         2        243.389    6.827    0.0067 </span></span>
<span><span class="co">#&gt; Residual       606.022        17         35.648                    </span></span>
<span><span class="co">#&gt; Total         1092.800        19                                   </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                   Parameter Estimates                                    </span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;       model      Beta    Std. Error    Std. Beta      t        Sig      lower     upper </span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept)    33.130        12.572                  2.635    0.017     6.607    59.654 </span></span>
<span><span class="co">#&gt;     protein     1.824         0.623        0.534     2.927    0.009     0.509     3.139 </span></span>
<span><span class="co">#&gt;      weight    -0.222         0.083       -0.486    -2.662    0.016    -0.397    -0.046 </span></span>
<span><span class="co">#&gt; ----------------------------------------------------------------------------------------</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr></section><section id="lasso" class="level4"><h4 class="anchored" data-anchor-id="lasso">Lasso</h4>
<p><span class="math display">\[\arg min_{\theta} \ell(\theta) + \lambda \sum_{j=1}^p|\beta_j|\]</span></p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu">glmnet</a></span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">carbohydrate</span><span class="op">$</span><span class="va">carbohydrate</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="va">carbohydrate</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">weight</span>, <span class="va">protein</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/glmnet.html">glmnet</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb103"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">fit</span>, xvar <span class="op">=</span> <span class="st">'lambda'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-carbs-lasso" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-carbs-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.19: Lasso selection
</figcaption><div aria-describedby="fig-carbs-lasso-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-carbs-lasso-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cvfit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/glmnet/man/cv.glmnet.html">cv.glmnet</a></span><span class="op">(</span><span class="va">x</span>,<span class="va">y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cvfit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="Linear-models-overview_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb105"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">cvfit</span>, s <span class="op">=</span> <span class="st">"lambda.1se"</span><span class="op">)</span></span>
<span><span class="co">#&gt; 4 x 1 sparse Matrix of class "dgCMatrix"</span></span>
<span><span class="co">#&gt;                  s1</span></span>
<span><span class="co">#&gt; (Intercept) 34.2044</span></span>
<span><span class="co">#&gt; age          .     </span></span>
<span><span class="co">#&gt; weight      -0.0926</span></span>
<span><span class="co">#&gt; protein      0.8582</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section></section><section id="categorical-covariates-with-more-than-two-levels" class="level2" data-number="2.10"><h2 data-number="2.10" class="anchored" data-anchor-id="categorical-covariates-with-more-than-two-levels">
<span class="header-section-number">2.10</span> Categorical covariates with more than two levels</h2>
<section id="example-birthweight" class="level3" data-number="2.10.1"><h3 data-number="2.10.1" class="anchored" data-anchor-id="example-birthweight">
<span class="header-section-number">2.10.1</span> Example: <code>birthweight</code>
</h3>
<p>In the birthweight example, the variable <code>sex</code> had only two observed values:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">bw</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] female male  </span></span>
<span><span class="co">#&gt; Levels: female male</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>If there are more than two observed values, we can’t just use a single variable with 0s and 1s.</p>
</section><section id="section" class="level3" data-number="2.10.2"><h3 data-number="2.10.2" class="anchored" data-anchor-id="section">
<span class="header-section-number">2.10.2</span> </h3>
<div class="notes">
<p>For example, <a href="#tbl-iris-data" class="quarto-xref">Table&nbsp;<span>2.13</span></a> shows the <a href="https://www.meganstodel.com/posts/no-to-iris/">(in)famous</a> <code>iris</code> data (<span class="citation" data-cites="anderson1935irises">Anderson (<a href="references.html#ref-anderson1935irises" role="doc-biblioref">1935</a>)</span>), and <a href="#tbl-iris-summary" class="quarto-xref">Table&nbsp;<span>2.14</span></a> provides summary statistics. The data include three species: “setosa”, “versicolor”, and “virginica”.</p>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb107"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-iris-data" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-iris-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.13: The <code>iris</code> data
</figcaption><div aria-describedby="tbl-iris-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Sepal.Length</th>
<th style="text-align: right;">Sepal.Width</th>
<th style="text-align: right;">Petal.Length</th>
<th style="text-align: right;">Petal.Width</th>
<th style="text-align: left;">Species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5.1</td>
<td style="text-align: right;">3.5</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.9</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.7</td>
<td style="text-align: right;">3.2</td>
<td style="text-align: right;">1.3</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">3.1</td>
<td style="text-align: right;">1.5</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">3.6</td>
<td style="text-align: right;">1.4</td>
<td style="text-align: right;">0.2</td>
<td style="text-align: left;">setosa</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.4</td>
<td style="text-align: right;">3.9</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">0.4</td>
<td style="text-align: left;">setosa</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/benjaminrich/table1">table1</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/table1/man/table1.html">table1</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">|</span> <span class="va">Species</span>,</span>
<span>  data <span class="op">=</span> <span class="va">iris</span>,</span>
<span>  overall <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-iris-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-iris-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.14: Summary statistics for the <code>iris</code> data
</figcaption><div aria-describedby="tbl-iris-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="Rtable1">
<table class="Rtable1 do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead><tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">setosa<br><span class="stratn">(N=50)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">versicolor<br><span class="stratn">(N=50)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">virginica<br><span class="stratn">(N=50)</span></span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">Sepal.Length</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.01 (0.352)</td>
<td>5.94 (0.516)</td>
<td>6.59 (0.636)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.00 [4.30, 5.80]</td>
<td class="lastrow">5.90 [4.90, 7.00]</td>
<td class="lastrow">6.50 [4.90, 7.90]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Sepal.Width</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>3.43 (0.379)</td>
<td>2.77 (0.314)</td>
<td>2.97 (0.322)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.40 [2.30, 4.40]</td>
<td class="lastrow">2.80 [2.00, 3.40]</td>
<td class="lastrow">3.00 [2.20, 3.80]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Petal.Length</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>1.46 (0.174)</td>
<td>4.26 (0.470)</td>
<td>5.55 (0.552)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.50 [1.00, 1.90]</td>
<td class="lastrow">4.35 [3.00, 5.10]</td>
<td class="lastrow">5.55 [4.50, 6.90]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Petal.Width</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.246 (0.105)</td>
<td>1.33 (0.198)</td>
<td>2.03 (0.275)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">0.200 [0.100, 0.600]</td>
<td class="lastrow">1.30 [1.00, 1.80]</td>
<td class="lastrow">2.00 [1.40, 2.50]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
</div>
<hr>
<p>If we want to model <code>Sepal.Length</code> by species, we could create a variable <span class="math inline">\(X\)</span> that represents “setosa” as <span class="math inline">\(X=1\)</span>, “virginica” as <span class="math inline">\(X=2\)</span>, and “versicolor” as <span class="math inline">\(X=3\)</span>.</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb109"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="co"># this step is not always necessary, but ensures you're starting  </span></span>
<span><span class="co"># from the original version of a dataset stored in a loaded package</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op">=</span> </span>
<span>  <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">Species</span> <span class="op">==</span> <span class="st">"setosa"</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>      <span class="va">Species</span> <span class="op">==</span> <span class="st">"virginica"</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">Species</span> <span class="op">==</span> <span class="st">"versicolor"</span> <span class="op">~</span> <span class="fl">3</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span><span class="op">(</span><span class="va">Species</span>, <span class="va">X</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-numeric-coding" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-numeric-coding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.15: <code>iris</code> data with numeric coding of species
</figcaption><div aria-describedby="tbl-numeric-coding-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Species</th>
<th style="text-align: right;">X</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">setosa</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">versicolor</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">virginica</td>
<td style="text-align: right;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>Then we could fit a model like:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_lm1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">X</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris_lm1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-iris-numeric-species" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-iris-numeric-species-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.16: Model of <code>iris</code> data with numeric coding of <code>Species</code>
</figcaption><div aria-describedby="tbl-iris-numeric-species-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(148)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">4.91</td>
<td style="text-align: center;">0.16</td>
<td style="text-align: center;">(4.60, 5.23)</td>
<td style="text-align: center;">30.83</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">X</td>
<td style="text-align: center;">0.46</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(0.32, 0.61)</td>
<td style="text-align: center;">6.30</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section id="lets-see-how-that-model-looks" class="level3" data-number="2.10.3"><h3 data-number="2.10.3" class="anchored" data-anchor-id="lets-see-how-that-model-looks">
<span class="header-section-number">2.10.3</span> Let’s see how that model looks:</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb111"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_plot1</span> <span class="op">=</span> <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">X</span>, </span>
<span>      y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">iris_plot1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-iris-numeric-species-model" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-iris-numeric-species-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.20: Model of <code>iris</code> data with numeric coding of <code>Species</code>
</figcaption><div aria-describedby="fig-iris-numeric-species-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-iris-numeric-species-model-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>We have forced the model to use a straight line for the three estimated means. Maybe not a good idea?</p>
</section><section id="lets-see-what-r-does-with-categorical-variables-by-default" class="level3" data-number="2.10.4"><h3 data-number="2.10.4" class="anchored" data-anchor-id="lets-see-what-r-does-with-categorical-variables-by-default">
<span class="header-section-number">2.10.4</span> Let’s see what R does with categorical variables by default:</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_lm2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris_lm2</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-iris-model-factor1" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-iris-model-factor1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.17: Model of <code>iris</code> data with <code>Species</code> as a categorical variable
</figcaption><div aria-describedby="tbl-iris-model-factor1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 20%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(147)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">5.01</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(4.86, 5.15)</td>
<td style="text-align: center;">68.76</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Species (versicolor)</td>
<td style="text-align: center;">0.93</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">(0.73, 1.13)</td>
<td style="text-align: center;">9.03</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Species (virginica)</td>
<td style="text-align: center;">1.58</td>
<td style="text-align: center;">0.10</td>
<td style="text-align: center;">(1.38, 1.79)</td>
<td style="text-align: center;">15.37</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section><section id="re-parametrize-with-no-intercept" class="level3" data-number="2.10.5"><h3 data-number="2.10.5" class="anchored" data-anchor-id="re-parametrize-with-no-intercept">
<span class="header-section-number">2.10.5</span> Re-parametrize with no intercept</h3>
<p>If you don’t want the default and offset option, you can use “-1” like we’ve seen previously:</p>
<div id="tbl-iris-no-intcpt" class="cell anchored">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb113"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris.lm2b</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Species</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">iris.lm2b</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/parameters/reference/model_parameters.html">parameters</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://easystats.github.io/insight/reference/display.html">print_md</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 20%">
<col style="width: 11%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Coefficient</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">t(147)</th>
<th style="text-align: center;">p</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Species (setosa)</td>
<td style="text-align: center;">5.01</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(4.86, 5.15)</td>
<td style="text-align: center;">68.76</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">Species (versicolor)</td>
<td style="text-align: center;">5.94</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(5.79, 6.08)</td>
<td style="text-align: center;">81.54</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Species (virginica)</td>
<td style="text-align: center;">6.59</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(6.44, 6.73)</td>
<td style="text-align: center;">90.49</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="lets-see-what-these-new-models-look-like" class="level3" data-number="2.10.6"><h3 data-number="2.10.6" class="anchored" data-anchor-id="lets-see-what-these-new-models-look-like">
<span class="header-section-number">2.10.6</span> Let’s see what these new models look like:</h3>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">iris_plot2</span> <span class="op">=</span> </span>
<span>  <span class="va">iris</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    predlm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">iris_lm2</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Sepal.Length</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">predlm2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>    intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">iris_lm1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">iris_plot2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-iris-no-intcpt" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-iris-no-intcpt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.21
</figcaption><div aria-describedby="fig-iris-no-intcpt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Linear-models-overview_files/figure-html/fig-iris-no-intcpt-1.png" id="fig-iris-no-intcpt" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section><section id="lets-see-how-r-did-that" class="level3" data-number="2.10.7"><h3 data-number="2.10.7" class="anchored" data-anchor-id="lets-see-how-r-did-that">
<span class="header-section-number">2.10.7</span> Let’s see how R did that:</h3>
<div id="tbl-iris-model-matrix-factor" class="cell anchored">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb115"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">iris_lm2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sepal.Length ~ Species</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">iris_lm2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">(Intercept)</th>
<th style="text-align: right;">Speciesversicolor</th>
<th style="text-align: right;">Speciesvirginica</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This format is called a “corner point parametrization” (e.g., in <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>) or “treatment coding” (e.g., in <span class="citation" data-cites="dunn2018generalized">Dunn and Smyth (<a href="references.html#ref-dunn2018generalized" role="doc-biblioref">2018</a>)</span>).</p>
<p>The default contrasts are controlled by <code>options("contrasts")</code>:</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"contrasts"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $contrasts</span></span>
<span><span class="co">#&gt;         unordered           ordered </span></span>
<span><span class="co">#&gt; "contr.treatment"      "contr.poly"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>See <code><a href="https://rdrr.io/r/base/options.html">?options</a></code> for more details.</p>
<hr>
<div id="tbl-iris-group-point-parameterization" class="cell anchored">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb117"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">iris.lm2b</span><span class="op">)</span></span>
<span><span class="co">#&gt; Sepal.Length ~ Species - 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">iris.lm2b</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead><tr class="header">
<th style="text-align: right;">Speciessetosa</th>
<th style="text-align: right;">Speciesversicolor</th>
<th style="text-align: right;">Speciesvirginica</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This format is called a “group point parametrization” (e.g., in <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>).</p>
<p>There are more options; see <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> §6.4.1 and the <a href="https://CRAN.R-project.org/package=codingMatrices"><code>codingMatrices</code> package</a> <a href="https://cran.r-project.org/web/packages/codingMatrices/vignettes/codingMatrices.pdf">vignette</a> (<span class="citation" data-cites="venablescodingMatrices">Venables (<a href="references.html#ref-venablescodingMatrices" role="doc-biblioref">2023</a>)</span>).</p>
</section></section><section id="ordinal-covariates" class="level2" data-number="2.11"><h2 data-number="2.11" class="anchored" data-anchor-id="ordinal-covariates">
<span class="header-section-number">2.11</span> Ordinal covariates</h2>
<p>(c.f. <span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span> §2.4.4)</p>
<hr>
<div class="notes">
<p>We can create ordinal variables in R using the <code><a href="https://rdrr.io/r/base/factor.html">ordered()</a></code> function<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
</div>
<div id="exm-ordinal-variable" class="theorem example">
<p><span class="theorem-title"><strong>Example 2.3</strong></span> &nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">url</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://regression.ucsf.edu/sites/g/files/tkssra6706/"</span>,</span>
<span>  <span class="st">"f/wysiwyg/home/data/hersdata.dta"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://haven.tidyverse.org">haven</a></span><span class="op">)</span></span>
<span><span class="va">hers</span> <span class="op">=</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/read_dta.html">read_dta</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb119"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">hers</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="tbl-HERS" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-HERS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.18: HERS dataset
</figcaption><div aria-describedby="tbl-HERS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 1%">
<col style="width: 2%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">HT</th>
<th style="text-align: right;">age</th>
<th style="text-align: right;">raceth</th>
<th style="text-align: right;">nonwhite</th>
<th style="text-align: right;">smoking</th>
<th style="text-align: right;">drinkany</th>
<th style="text-align: right;">exercise</th>
<th style="text-align: right;">physact</th>
<th style="text-align: right;">globrat</th>
<th style="text-align: right;">poorfair</th>
<th style="text-align: right;">medcond</th>
<th style="text-align: right;">htnmeds</th>
<th style="text-align: right;">statins</th>
<th style="text-align: right;">diabetes</th>
<th style="text-align: right;">dmpills</th>
<th style="text-align: right;">insulin</th>
<th style="text-align: right;">weight</th>
<th style="text-align: right;">BMI</th>
<th style="text-align: right;">waist</th>
<th style="text-align: right;">WHR</th>
<th style="text-align: right;">glucose</th>
<th style="text-align: right;">weight1</th>
<th style="text-align: right;">BMI1</th>
<th style="text-align: right;">waist1</th>
<th style="text-align: right;">WHR1</th>
<th style="text-align: right;">glucose1</th>
<th style="text-align: right;">tchol</th>
<th style="text-align: right;">LDL</th>
<th style="text-align: right;">HDL</th>
<th style="text-align: right;">TG</th>
<th style="text-align: right;">tchol1</th>
<th style="text-align: right;">LDL1</th>
<th style="text-align: right;">HDL1</th>
<th style="text-align: right;">TG1</th>
<th style="text-align: right;">SBP</th>
<th style="text-align: right;">DBP</th>
<th style="text-align: right;">age10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">73.8</td>
<td style="text-align: right;">23.69</td>
<td style="text-align: right;">96.0</td>
<td style="text-align: right;">0.932</td>
<td style="text-align: right;">84</td>
<td style="text-align: right;">73.6</td>
<td style="text-align: right;">23.63</td>
<td style="text-align: right;">93.0</td>
<td style="text-align: right;">0.912</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">189</td>
<td style="text-align: right;">122.4</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">201</td>
<td style="text-align: right;">137.6</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">138</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">7.0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">62</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">70.9</td>
<td style="text-align: right;">28.62</td>
<td style="text-align: right;">93.0</td>
<td style="text-align: right;">0.964</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">73.4</td>
<td style="text-align: right;">28.89</td>
<td style="text-align: right;">95.0</td>
<td style="text-align: right;">0.964</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">307</td>
<td style="text-align: right;">241.6</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">216</td>
<td style="text-align: right;">150.6</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">87</td>
<td style="text-align: right;">118</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">6.2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">102.0</td>
<td style="text-align: right;">42.51</td>
<td style="text-align: right;">110.2</td>
<td style="text-align: right;">0.782</td>
<td style="text-align: right;">114</td>
<td style="text-align: right;">96.1</td>
<td style="text-align: right;">40.73</td>
<td style="text-align: right;">103.0</td>
<td style="text-align: right;">0.774</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">166.2</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">154</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">156.0</td>
<td style="text-align: right;">66</td>
<td style="text-align: right;">160</td>
<td style="text-align: right;">134</td>
<td style="text-align: right;">78</td>
<td style="text-align: right;">6.9</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">64</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">64.4</td>
<td style="text-align: right;">24.39</td>
<td style="text-align: right;">87.0</td>
<td style="text-align: right;">0.877</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">58.6</td>
<td style="text-align: right;">22.52</td>
<td style="text-align: right;">77.0</td>
<td style="text-align: right;">0.802</td>
<td style="text-align: right;">93</td>
<td style="text-align: right;">204</td>
<td style="text-align: right;">116.2</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">159</td>
<td style="text-align: right;">207</td>
<td style="text-align: right;">122.6</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">152</td>
<td style="text-align: right;">72</td>
<td style="text-align: right;">6.4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">65</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">57.9</td>
<td style="text-align: right;">21.90</td>
<td style="text-align: right;">77.0</td>
<td style="text-align: right;">0.794</td>
<td style="text-align: right;">101</td>
<td style="text-align: right;">58.9</td>
<td style="text-align: right;">22.28</td>
<td style="text-align: right;">76.5</td>
<td style="text-align: right;">0.757</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">214</td>
<td style="text-align: right;">150.6</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">107</td>
<td style="text-align: right;">235</td>
<td style="text-align: right;">172.2</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">139</td>
<td style="text-align: right;">175</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">6.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60.9</td>
<td style="text-align: right;">29.05</td>
<td style="text-align: right;">96.0</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">116</td>
<td style="text-align: right;">57.7</td>
<td style="text-align: right;">27.52</td>
<td style="text-align: right;">86.0</td>
<td style="text-align: right;">0.910</td>
<td style="text-align: right;">115</td>
<td style="text-align: right;">212</td>
<td style="text-align: right;">137.8</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">111</td>
<td style="text-align: right;">202</td>
<td style="text-align: right;">126.6</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">112</td>
<td style="text-align: right;">174</td>
<td style="text-align: right;">98</td>
<td style="text-align: right;">6.8</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</div>
<hr>
<div class="cell">
<details class="code-fold"><summary>Show R code</summary><div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span></span>
<span><span class="co"># C(contr = codingMatrices::contr.diff)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-anderson1935irises" class="csl-entry" role="listitem">
Anderson, Edgar. 1935. <span>“The Irises of the Gaspe Peninsula.”</span> <em>Bulletin of American Iris Society</em> 59: 2–5.
</div>
<div id="ref-chatterjee2015regression" class="csl-entry" role="listitem">
Chatterjee, Samprit, and Ali S Hadi. 2015. <em>Regression Analysis by Example</em>. John Wiley &amp; Sons. <a href="https://www.wiley.com/en-us/Regression+Analysis+by+Example%2C+4th+Edition-p-9780470055458">https://www.wiley.com/en-us/Regression+Analysis+by+Example%2C+4th+Edition-p-9780470055458</a>.
</div>
<div id="ref-dobson4e" class="csl-entry" role="listitem">
Dobson, Annette J, and Adrian G Barnett. 2018. <em>An Introduction to Generalized Linear Models</em>. 4th ed. CRC press. <a href="https://doi.org/10.1201/9781315182780">https://doi.org/10.1201/9781315182780</a>.
</div>
<div id="ref-dunn2018generalized" class="csl-entry" role="listitem">
Dunn, Peter K, and Gordon K Smyth. 2018. <em>Generalized Linear Models with Examples in <span>R</span></em>. Vol. 53. Springer. <a href="https://link.springer.com/book/10.1007/978-1-4419-0118-7">https://link.springer.com/book/10.1007/978-1-4419-0118-7</a>.
</div>
<div id="ref-Faraway2025-io" class="csl-entry" role="listitem">
Faraway, Julian J. 2025. <em>Linear Models with <span>R</span></em>. <a href="https://www.routledge.com/Linear-Models-with-R/Faraway/p/book/9781032583983">https://www.routledge.com/Linear-Models-with-R/Faraway/p/book/9781032583983</a>.
</div>
<div id="ref-rms2e" class="csl-entry" role="listitem">
Harrell, Frank E. 2015. <em>Regression Modeling Strategies: With Applications to Linear Models, Logistic Regression, and Survival Analysis</em>. 2nd ed. Springer. <a href="https://doi.org/10.1007/978-3-319-19425-7">https://doi.org/10.1007/978-3-319-19425-7</a>.
</div>
<div id="ref-james2013introduction" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, Robert Tibshirani, et al. 2013. <em>An Introduction to Statistical Learning</em>. Vol. 112. Springer. <a href="https://www.statlearning.com/">https://www.statlearning.com/</a>.
</div>
<div id="ref-kleinbaum2010logistic" class="csl-entry" role="listitem">
Kleinbaum, David G, and Mitchel Klein. 2010. <em>Logistic Regression: A Self-Learning Text</em>. 3rd ed. Springer. <a href="https://link.springer.com/book/10.1007/978-1-4419-1742-3">https://link.springer.com/book/10.1007/978-1-4419-1742-3</a>.
</div>
<div id="ref-kleinbaum2012survival" class="csl-entry" role="listitem">
———. 2012. <em>Survival Analysis: A Self-Learning Text</em>. 3rd ed. Springer. <a href="https://link.springer.com/book/10.1007/978-1-4419-6646-9">https://link.springer.com/book/10.1007/978-1-4419-6646-9</a>.
</div>
<div id="ref-kleinbaum2014applied" class="csl-entry" role="listitem">
Kleinbaum, David G, Lawrence L Kupper, Azhar Nizam, K Muller, and ES Rosenberg. 2014. <em>Applied Regression Analysis and Other Multivariable Methods</em>. 5th ed. Cengage Learning. <a href="https://www.cengage.com/c/applied-regression-analysis-and-other-multivariable-methods-5e-kleinbaum/9781285051086/">https://www.cengage.com/c/applied-regression-analysis-and-other-multivariable-methods-5e-kleinbaum/9781285051086/</a>.
</div>
<div id="ref-kutner2005applied" class="csl-entry" role="listitem">
Kutner, Michael H, Christopher J Nachtsheim, John Neter, and William Li. 2005. <em>Applied Linear Statistical Models</em>. McGraw-Hill.
</div>
<div id="ref-polin2011fetal" class="csl-entry" role="listitem">
Polin, Richard A, William W Fox, and Steven H Abman. 2011. <em>Fetal and Neonatal Physiology</em>. 4th ed. Elsevier health sciences.
</div>
<div id="ref-seber2012linear" class="csl-entry" role="listitem">
Seber, George AF, and Alan J Lee. 2012. <em>Linear Regression Analysis</em>. 2nd ed. John Wiley &amp; Sons. <a href="https://www.wiley.com/en-us/Linear+Regression+Analysis%2C+2nd+Edition-p-9781118274422">https://www.wiley.com/en-us/Linear+Regression+Analysis%2C+2nd+Edition-p-9781118274422</a>.
</div>
<div id="ref-venablescodingMatrices" class="csl-entry" role="listitem">
Venables, Bill. 2023. <em>codingMatrices: Alternative Factor Coding Matrices for Linear Model Formulae</em> (version 0.4.0). <a href="https://CRAN.R-project.org/package=codingMatrices">https://CRAN.R-project.org/package=codingMatrices</a>.
</div>
<div id="ref-vittinghoff2e" class="csl-entry" role="listitem">
Vittinghoff, Eric, David V Glidden, Stephen C Shiboski, and Charles E McCulloch. 2012. <em>Regression Methods in Biostatistics: Linear, Logistic, Survival, and Repeated Measures Models</em>. 2nd ed. Springer. <a href="https://doi.org/10.1007/978-1-4614-1353-0">https://doi.org/10.1007/978-1-4614-1353-0</a>.
</div>
<div id="ref-weisberg2005applied" class="csl-entry" role="listitem">
Weisberg, Sanford. 2005. <em>Applied Linear Regression</em>. Vol. 528. John Wiley &amp; Sons.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p><span class="math inline">\(M\)</span> is implicitly a deterministic function of <span class="math inline">\(S\)</span><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><span class="math inline">\(F\)</span> is implicitly a deterministic function of <span class="math inline">\(S\)</span><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>using the definite article “the” would mean there is only one slope.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>or equivalently, <code>factor(ordered = TRUE)</code><a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./glms.html" class="pagination-link" aria-label="Generalized Linear Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Generalized Linear Models</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./logistic-regression.html" class="pagination-link" aria-label="Models for Binary Outcomes">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb121" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="an">df-print:</span><span class="co"> paged</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Linear (Gaussian) Models</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>{{&lt; include shared-config.qmd &gt;}}</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>:::{.callout-note}</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>This content is adapted from:</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@dobson4e, Chapters 2-6</span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@dunn2018generalized, Chapters 2-3</span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@vittinghoff2e, Chapter 4</span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a>There are numerous textbooks specifically for linear regression, including:</span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@kutner2005applied: used for UCLA Biostatistics MS level linear models class</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@chatterjee2015regression: used for Stanford MS-level linear models class</span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@seber2012linear: used for UCLA Biostatistics PhD level linear models class and UC Davis STA 108.</span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@kleinbaum2014applied: same first author as @kleinbaum2010logistic and @kleinbaum2012survival</span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@weisberg2005applied</span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>*Linear Models with R* <span class="co">[</span><span class="ot">@Faraway2025-io</span><span class="co">]</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why this course includes linear regression {.smaller}</span></span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a>:::{.fragment .fade-in-then-semi-out}</span>
<span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>This course is about *generalized linear models* (for non-Gaussian outcomes)</span>
<span id="cb121-37"><a href="#cb121-37" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-38"><a href="#cb121-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-39"><a href="#cb121-39" aria-hidden="true" tabindex="-1"></a>:::{.fragment .fade-in-then-semi-out}</span>
<span id="cb121-40"><a href="#cb121-40" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>UC Davis STA 108 ("Applied Statistical Methods: Regression Analysis") is a prerequisite for this course, so everyone here should have some understanding of linear regression already.</span>
<span id="cb121-41"><a href="#cb121-41" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-42"><a href="#cb121-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-43"><a href="#cb121-43" aria-hidden="true" tabindex="-1"></a>:::{.fragment .fade-in}</span>
<span id="cb121-44"><a href="#cb121-44" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>We will review linear regression to:</span>
<span id="cb121-45"><a href="#cb121-45" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>make sure everyone is caught up</span>
<span id="cb121-46"><a href="#cb121-46" aria-hidden="true" tabindex="-1"></a><span class="ss">    - </span>to provide an epidemiological perspective on model interpretation.</span>
<span id="cb121-47"><a href="#cb121-47" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-48"><a href="#cb121-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-49"><a href="#cb121-49" aria-hidden="true" tabindex="-1"></a><span class="fu">### Chapter overview</span></span>
<span id="cb121-50"><a href="#cb121-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-51"><a href="#cb121-51" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>@sec-understand-LMs: how to interpret linear regression models</span>
<span id="cb121-52"><a href="#cb121-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-53"><a href="#cb121-53" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>@sec-est-LMs: how to estimate linear regression models</span>
<span id="cb121-54"><a href="#cb121-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-55"><a href="#cb121-55" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>@sec-infer-LMs: how to quantify uncertainty about our estimates</span>
<span id="cb121-56"><a href="#cb121-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-57"><a href="#cb121-57" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>@sec-diagnose-LMs: how to tell if your model is insufficiently complex</span>
<span id="cb121-58"><a href="#cb121-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-59"><a href="#cb121-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-60"><a href="#cb121-60" aria-hidden="true" tabindex="-1"></a><span class="fu">## Understanding Gaussian Linear Regression Models {#sec-understand-LMs}</span></span>
<span id="cb121-61"><a href="#cb121-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-62"><a href="#cb121-62" aria-hidden="true" tabindex="-1"></a><span class="fu">### Motivating example: birthweights and gestational age {.smaller}</span></span>
<span id="cb121-63"><a href="#cb121-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-64"><a href="#cb121-64" aria-hidden="true" tabindex="-1"></a>Suppose we want to learn about the distributions of birthweights (*outcome* $Y$) for (human) babies born at different gestational ages (*covariate* $A$) and with different chromosomal sexes (*covariate* $S$) (@dobson4e Example 2.2.2).</span>
<span id="cb121-65"><a href="#cb121-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-66"><a href="#cb121-66" aria-hidden="true" tabindex="-1"></a>::::: {.panel-tabset}</span>
<span id="cb121-67"><a href="#cb121-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-68"><a href="#cb121-68" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data as table</span></span>
<span id="cb121-69"><a href="#cb121-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-72"><a href="#cb121-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-73"><a href="#cb121-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-birthweight-data1</span></span>
<span id="cb121-74"><a href="#cb121-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "`birthweight` data (@dobson4e Example 2.2.2)"</span></span>
<span id="cb121-75"><a href="#cb121-75" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dobson)</span>
<span id="cb121-76"><a href="#cb121-76" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"birthweight"</span>, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb121-77"><a href="#cb121-77" aria-hidden="true" tabindex="-1"></a>birthweight <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span>
<span id="cb121-78"><a href="#cb121-78" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-79"><a href="#cb121-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-80"><a href="#cb121-80" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Reshape data for graphing</span></span>
<span id="cb121-81"><a href="#cb121-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-84"><a href="#cb121-84" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-85"><a href="#cb121-85" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-birthweight-data2</span></span>
<span id="cb121-86"><a href="#cb121-86" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "`birthweight` data reshaped"</span></span>
<span id="cb121-87"><a href="#cb121-87" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb121-88"><a href="#cb121-88" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-89"><a href="#cb121-89" aria-hidden="true" tabindex="-1"></a>  birthweight <span class="sc">|&gt;</span> </span>
<span id="cb121-90"><a href="#cb121-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb121-91"><a href="#cb121-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb121-92"><a href="#cb121-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"sex"</span>, <span class="st">".value"</span>),</span>
<span id="cb121-93"><a href="#cb121-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"s "</span></span>
<span id="cb121-94"><a href="#cb121-94" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb121-95"><a href="#cb121-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">age =</span> <span class="st">`</span><span class="at">gestational age</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb121-96"><a href="#cb121-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-97"><a href="#cb121-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">sex =</span> sex <span class="sc">|&gt;</span> </span>
<span id="cb121-98"><a href="#cb121-98" aria-hidden="true" tabindex="-1"></a>      <span class="fu">case_match</span>(</span>
<span id="cb121-99"><a href="#cb121-99" aria-hidden="true" tabindex="-1"></a>        <span class="st">"boy"</span> <span class="sc">~</span> <span class="st">"male"</span>,</span>
<span id="cb121-100"><a href="#cb121-100" aria-hidden="true" tabindex="-1"></a>        <span class="st">"girl"</span> <span class="sc">~</span> <span class="st">"female"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb121-101"><a href="#cb121-101" aria-hidden="true" tabindex="-1"></a>      <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)))</span>
<span id="cb121-102"><a href="#cb121-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-103"><a href="#cb121-103" aria-hidden="true" tabindex="-1"></a>bw</span>
<span id="cb121-104"><a href="#cb121-104" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-105"><a href="#cb121-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-106"><a href="#cb121-106" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data as graph</span></span>
<span id="cb121-107"><a href="#cb121-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-110"><a href="#cb121-110" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-111"><a href="#cb121-111" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plot-birthweight1</span></span>
<span id="cb121-112"><a href="#cb121-112" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`birthweight` data (@dobson4e Example 2.2.2)"</span></span>
<span id="cb121-113"><a href="#cb121-113" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb121-114"><a href="#cb121-114" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7</span></span>
<span id="cb121-115"><a href="#cb121-115" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb121-116"><a href="#cb121-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb121-117"><a href="#cb121-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> age, </span>
<span id="cb121-118"><a href="#cb121-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> weight,</span>
<span id="cb121-119"><a href="#cb121-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> sex,</span>
<span id="cb121-120"><a href="#cb121-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> sex,</span>
<span id="cb121-121"><a href="#cb121-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> sex))  <span class="sc">+</span></span>
<span id="cb121-122"><a href="#cb121-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb121-123"><a href="#cb121-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Gestational age (weeks)"</span>) <span class="sc">+</span></span>
<span id="cb121-124"><a href="#cb121-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Birthweight (grams)"</span>) <span class="sc">+</span></span>
<span id="cb121-125"><a href="#cb121-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb121-126"><a href="#cb121-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand_limits(y = 0, x = 0) +</span></span>
<span id="cb121-127"><a href="#cb121-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">7</span>)</span>
<span id="cb121-128"><a href="#cb121-128" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1 <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> sex))</span>
<span id="cb121-129"><a href="#cb121-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-130"><a href="#cb121-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-131"><a href="#cb121-131" aria-hidden="true" tabindex="-1"></a>:::::</span>
<span id="cb121-132"><a href="#cb121-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-133"><a href="#cb121-133" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-134"><a href="#cb121-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-135"><a href="#cb121-135" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Data notation</span></span>
<span id="cb121-136"><a href="#cb121-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-137"><a href="#cb121-137" aria-hidden="true" tabindex="-1"></a>Let's define some notation to represent this data.</span>
<span id="cb121-138"><a href="#cb121-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-139"><a href="#cb121-139" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Y$: birthweight (measured in grams)</span>
<span id="cb121-140"><a href="#cb121-140" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$S$: chromosomal sex: "male" (XY) or "female" (XX)</span>
<span id="cb121-141"><a href="#cb121-141" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$M$: indicator variable for $S$ = "male"^<span class="co">[</span><span class="ot">$M$ is implicitly a deterministic function of $S$</span><span class="co">]</span></span>
<span id="cb121-142"><a href="#cb121-142" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$M = 0$ if female (XX)</span>
<span id="cb121-143"><a href="#cb121-143" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$M = 1$ if male (XY)</span>
<span id="cb121-144"><a href="#cb121-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$F$: indicator variable for $S$ = "female"^<span class="co">[</span><span class="ot">$F$ is implicitly a deterministic function of $S$</span><span class="co">]</span></span>
<span id="cb121-145"><a href="#cb121-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$F = 1$ if female (XX)</span>
<span id="cb121-146"><a href="#cb121-146" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$F = 0$ if male (XY)</span>
<span id="cb121-147"><a href="#cb121-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-148"><a href="#cb121-148" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$A$: estimated gestational age at birth (measured in weeks).</span>
<span id="cb121-149"><a href="#cb121-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-150"><a href="#cb121-150" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb121-151"><a href="#cb121-151" aria-hidden="true" tabindex="-1"></a>Female is the **reference level** for the categorical variable $S$ </span>
<span id="cb121-152"><a href="#cb121-152" aria-hidden="true" tabindex="-1"></a>(chromosomal sex) and corresponding indicator variable $M$ . </span>
<span id="cb121-153"><a href="#cb121-153" aria-hidden="true" tabindex="-1"></a>The choice of a reference level is arbitrary and does not limit what </span>
<span id="cb121-154"><a href="#cb121-154" aria-hidden="true" tabindex="-1"></a>we can do with the resulting model; </span>
<span id="cb121-155"><a href="#cb121-155" aria-hidden="true" tabindex="-1"></a>it only makes it more computationally convenient to make inferences </span>
<span id="cb121-156"><a href="#cb121-156" aria-hidden="true" tabindex="-1"></a>about comparisons involving that reference group.</span>
<span id="cb121-157"><a href="#cb121-157" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-158"><a href="#cb121-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-159"><a href="#cb121-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### Parallel lines regression</span></span>
<span id="cb121-160"><a href="#cb121-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-161"><a href="#cb121-161" aria-hidden="true" tabindex="-1"></a>We don't have enough data to model the distribution of birth weight </span>
<span id="cb121-162"><a href="#cb121-162" aria-hidden="true" tabindex="-1"></a>separately for each combination of gestational age and sex, </span>
<span id="cb121-163"><a href="#cb121-163" aria-hidden="true" tabindex="-1"></a>so let's instead consider a (relatively) simple model for how that </span>
<span id="cb121-164"><a href="#cb121-164" aria-hidden="true" tabindex="-1"></a>distribution varies with gestational age and sex:</span>
<span id="cb121-165"><a href="#cb121-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-166"><a href="#cb121-166" aria-hidden="true" tabindex="-1"></a>$$p(Y=y|A=a,S=s) \siid N(\mu(a,s), \sigma^2)$$</span>
<span id="cb121-167"><a href="#cb121-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-168"><a href="#cb121-168" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-169"><a href="#cb121-169" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-170"><a href="#cb121-170" aria-hidden="true" tabindex="-1"></a>\mu(a,s)</span>
<span id="cb121-171"><a href="#cb121-171" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \Exp{Y|A=a, S=s} <span class="sc">\\</span></span>
<span id="cb121-172"><a href="#cb121-172" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_0 + \beta_A a+ \beta_M m</span>
<span id="cb121-173"><a href="#cb121-173" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-174"><a href="#cb121-174" aria-hidden="true" tabindex="-1"></a>$$ {#eq-lm-parallel}</span>
<span id="cb121-175"><a href="#cb121-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-176"><a href="#cb121-176" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-177"><a href="#cb121-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-178"><a href="#cb121-178" aria-hidden="true" tabindex="-1"></a>@tbl-lm-parallel shows the parameter estimates from R.</span>
<span id="cb121-179"><a href="#cb121-179" aria-hidden="true" tabindex="-1"></a>@fig-parallel-fit1 shows the estimated model, superimposed on the data.</span>
<span id="cb121-180"><a href="#cb121-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-181"><a href="#cb121-181" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-182"><a href="#cb121-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-183"><a href="#cb121-183" aria-hidden="true" tabindex="-1"></a>::: {.column width=40%}</span>
<span id="cb121-184"><a href="#cb121-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-187"><a href="#cb121-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-188"><a href="#cb121-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-lm-parallel</span></span>
<span id="cb121-189"><a href="#cb121-189" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimate of [Model @eq-lm-parallel] for `birthweight` data"</span></span>
<span id="cb121-190"><a href="#cb121-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-191"><a href="#cb121-191" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters)</span>
<span id="cb121-192"><a href="#cb121-192" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="ot">=</span> <span class="fu">lm</span>(</span>
<span id="cb121-193"><a href="#cb121-193" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> weight <span class="sc">~</span> sex <span class="sc">+</span> age, </span>
<span id="cb121-194"><a href="#cb121-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> bw)</span>
<span id="cb121-195"><a href="#cb121-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-196"><a href="#cb121-196" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> </span>
<span id="cb121-197"><a href="#cb121-197" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-198"><a href="#cb121-198" aria-hidden="true" tabindex="-1"></a>  parameters<span class="sc">::</span><span class="fu">print_md</span>(</span>
<span id="cb121-199"><a href="#cb121-199" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>,</span>
<span id="cb121-200"><a href="#cb121-200" aria-hidden="true" tabindex="-1"></a>    <span class="co"># show_sigma = TRUE,</span></span>
<span id="cb121-201"><a href="#cb121-201" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="st">"{estimate}"</span>)</span>
<span id="cb121-202"><a href="#cb121-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-203"><a href="#cb121-203" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-204"><a href="#cb121-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-205"><a href="#cb121-205" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-206"><a href="#cb121-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-207"><a href="#cb121-207" aria-hidden="true" tabindex="-1"></a>:::{.column width=10%}</span>
<span id="cb121-208"><a href="#cb121-208" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-209"><a href="#cb121-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-210"><a href="#cb121-210" aria-hidden="true" tabindex="-1"></a>:::{.column width=50%}</span>
<span id="cb121-211"><a href="#cb121-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-214"><a href="#cb121-214" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-215"><a href="#cb121-215" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-parallel-fit1</span></span>
<span id="cb121-216"><a href="#cb121-216" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Parallel-slopes model of birthweight"</span></span>
<span id="cb121-217"><a href="#cb121-217" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-218"><a href="#cb121-218" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-219"><a href="#cb121-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">E[Y|X=x]</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">fitted</span>(bw_lm1)) <span class="sc">|&gt;</span> </span>
<span id="cb121-220"><a href="#cb121-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex, age)</span>
<span id="cb121-221"><a href="#cb121-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-222"><a href="#cb121-222" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">=</span> </span>
<span id="cb121-223"><a href="#cb121-223" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">%+%</span> bw <span class="sc">+</span></span>
<span id="cb121-224"><a href="#cb121-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">E[Y|X=x]</span><span class="st">`</span>))</span>
<span id="cb121-225"><a href="#cb121-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-226"><a href="#cb121-226" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot2)</span>
<span id="cb121-227"><a href="#cb121-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-228"><a href="#cb121-228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-229"><a href="#cb121-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-230"><a href="#cb121-230" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-231"><a href="#cb121-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-232"><a href="#cb121-232" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-233"><a href="#cb121-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-234"><a href="#cb121-234" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Model assumptions and predictions</span></span>
<span id="cb121-235"><a href="#cb121-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-236"><a href="#cb121-236" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-237"><a href="#cb121-237" aria-hidden="true" tabindex="-1"></a>To learn what this model is assuming, let's plug in a few values.</span>
<span id="cb121-238"><a href="#cb121-238" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-239"><a href="#cb121-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-240"><a href="#cb121-240" aria-hidden="true" tabindex="-1"></a>::: {#exr-pred-fem-parallel}</span>
<span id="cb121-241"><a href="#cb121-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-242"><a href="#cb121-242" aria-hidden="true" tabindex="-1"></a>According to this model, what's the mean birthweight for a female born at 36 weeks?</span>
<span id="cb121-243"><a href="#cb121-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-246"><a href="#cb121-246" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-247"><a href="#cb121-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimated coefficients for [model @eq-lm-parallel]"</span></span>
<span id="cb121-248"><a href="#cb121-248" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-coef-model1</span></span>
<span id="cb121-249"><a href="#cb121-249" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(bw_lm1)</span>
<span id="cb121-250"><a href="#cb121-250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-251"><a href="#cb121-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-252"><a href="#cb121-252" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-253"><a href="#cb121-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-254"><a href="#cb121-254" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-255"><a href="#cb121-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-256"><a href="#cb121-256" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb121-257"><a href="#cb121-257" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb121-260"><a href="#cb121-260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-261"><a href="#cb121-261" aria-hidden="true" tabindex="-1"></a>pred_female <span class="ot">=</span> <span class="fu">coef</span>(bw_lm1)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> <span class="fu">coef</span>(bw_lm1)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span></span>
<span id="cb121-262"><a href="#cb121-262" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(bw_lm1)</span>
<span id="cb121-263"><a href="#cb121-263" aria-hidden="true" tabindex="-1"></a><span class="co"># print(pred_female)</span></span>
<span id="cb121-264"><a href="#cb121-264" aria-hidden="true" tabindex="-1"></a><span class="do">### built-in prediction: </span></span>
<span id="cb121-265"><a href="#cb121-265" aria-hidden="true" tabindex="-1"></a><span class="co"># predict(bw_lm1, newdata = tibble(sex = "female", age = 36))</span></span>
<span id="cb121-266"><a href="#cb121-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-267"><a href="#cb121-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-268"><a href="#cb121-268" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-269"><a href="#cb121-269" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-270"><a href="#cb121-270" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|A = 0, A = 36</span><span class="co">]</span> </span>
<span id="cb121-271"><a href="#cb121-271" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36 <span class="sc">\\</span></span>
<span id="cb121-272"><a href="#cb121-272" aria-hidden="true" tabindex="-1"></a>&amp;=  <span class="in">`r pred_female`</span></span>
<span id="cb121-273"><a href="#cb121-273" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-274"><a href="#cb121-274" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-275"><a href="#cb121-275" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-276"><a href="#cb121-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-277"><a href="#cb121-277" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-278"><a href="#cb121-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-279"><a href="#cb121-279" aria-hidden="true" tabindex="-1"></a>:::{#exr-pred-male-parallel}</span>
<span id="cb121-280"><a href="#cb121-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-281"><a href="#cb121-281" aria-hidden="true" tabindex="-1"></a>What's the mean birthweight for a male born at 36 weeks?</span>
<span id="cb121-282"><a href="#cb121-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-285"><a href="#cb121-285" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-286"><a href="#cb121-286" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(bw_lm1)</span>
<span id="cb121-287"><a href="#cb121-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-288"><a href="#cb121-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-289"><a href="#cb121-289" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-290"><a href="#cb121-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-291"><a href="#cb121-291" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-292"><a href="#cb121-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-293"><a href="#cb121-293" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb121-294"><a href="#cb121-294" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb121-295"><a href="#cb121-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-298"><a href="#cb121-298" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-299"><a href="#cb121-299" aria-hidden="true" tabindex="-1"></a>pred_male <span class="ot">=</span> </span>
<span id="cb121-300"><a href="#cb121-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm1)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> </span>
<span id="cb121-301"><a href="#cb121-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm1)[<span class="st">"sexmale"</span>] <span class="sc">+</span> </span>
<span id="cb121-302"><a href="#cb121-302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm1)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span></span>
<span id="cb121-303"><a href="#cb121-303" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(bw_lm1)</span>
<span id="cb121-304"><a href="#cb121-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-305"><a href="#cb121-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-306"><a href="#cb121-306" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-307"><a href="#cb121-307" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-308"><a href="#cb121-308" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|M = 1, A = 36</span><span class="co">]</span> </span>
<span id="cb121-309"><a href="#cb121-309" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36 <span class="sc">\\</span></span>
<span id="cb121-310"><a href="#cb121-310" aria-hidden="true" tabindex="-1"></a>&amp;=  <span class="in">`r pred_male`</span></span>
<span id="cb121-311"><a href="#cb121-311" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-312"><a href="#cb121-312" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-313"><a href="#cb121-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-314"><a href="#cb121-314" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-315"><a href="#cb121-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-316"><a href="#cb121-316" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-317"><a href="#cb121-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-318"><a href="#cb121-318" aria-hidden="true" tabindex="-1"></a>:::{#exr-diff-sex-parallel-1}</span>
<span id="cb121-319"><a href="#cb121-319" aria-hidden="true" tabindex="-1"></a>What's the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</span>
<span id="cb121-320"><a href="#cb121-320" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-321"><a href="#cb121-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-324"><a href="#cb121-324" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-325"><a href="#cb121-325" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(bw_lm1)</span>
<span id="cb121-326"><a href="#cb121-326" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-327"><a href="#cb121-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-328"><a href="#cb121-328" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-329"><a href="#cb121-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-330"><a href="#cb121-330" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb121-331"><a href="#cb121-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-332"><a href="#cb121-332" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-333"><a href="#cb121-333" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-334"><a href="#cb121-334" aria-hidden="true" tabindex="-1"></a>&amp; E<span class="co">[</span><span class="ot">Y|M = 1, A = 36</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y|M = 0, A = 36</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb121-335"><a href="#cb121-335" aria-hidden="true" tabindex="-1"></a>&amp;= </span>
<span id="cb121-336"><a href="#cb121-336" aria-hidden="true" tabindex="-1"></a><span class="in">`r pred_male`</span> - <span class="in">`r pred_female`</span><span class="sc">\\</span></span>
<span id="cb121-337"><a href="#cb121-337" aria-hidden="true" tabindex="-1"></a>&amp;=</span>
<span id="cb121-338"><a href="#cb121-338" aria-hidden="true" tabindex="-1"></a><span class="in">`r pred_male - pred_female`</span></span>
<span id="cb121-339"><a href="#cb121-339" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-340"><a href="#cb121-340" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-341"><a href="#cb121-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-342"><a href="#cb121-342" aria-hidden="true" tabindex="-1"></a>Shortcut:</span>
<span id="cb121-343"><a href="#cb121-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-344"><a href="#cb121-344" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-345"><a href="#cb121-345" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-346"><a href="#cb121-346" aria-hidden="true" tabindex="-1"></a>&amp; E<span class="co">[</span><span class="ot">Y|M = 1, A = 36</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y|M = 0, A = 36</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb121-347"><a href="#cb121-347" aria-hidden="true" tabindex="-1"></a>&amp;= (\beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36) - </span>
<span id="cb121-348"><a href="#cb121-348" aria-hidden="true" tabindex="-1"></a>(\beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36) <span class="sc">\\</span></span>
<span id="cb121-349"><a href="#cb121-349" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_M <span class="sc">\\</span> </span>
<span id="cb121-350"><a href="#cb121-350" aria-hidden="true" tabindex="-1"></a>&amp;=  <span class="in">`r coef(bw_lm1)["sexmale"]`</span></span>
<span id="cb121-351"><a href="#cb121-351" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-352"><a href="#cb121-352" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-353"><a href="#cb121-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-354"><a href="#cb121-354" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-355"><a href="#cb121-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-356"><a href="#cb121-356" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-357"><a href="#cb121-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-358"><a href="#cb121-358" aria-hidden="true" tabindex="-1"></a>Note that age doesn't show up in this difference: in other words, according to this model, the difference between females and males with the same gestational age is the same for every age.</span>
<span id="cb121-359"><a href="#cb121-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-360"><a href="#cb121-360" aria-hidden="true" tabindex="-1"></a>That's an assumption of the model; it's built-in to the parametric structure, even before we plug in the estimated values of those parameters.</span>
<span id="cb121-361"><a href="#cb121-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-362"><a href="#cb121-362" aria-hidden="true" tabindex="-1"></a>That's why the lines are parallel.</span>
<span id="cb121-363"><a href="#cb121-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-364"><a href="#cb121-364" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-365"><a href="#cb121-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-366"><a href="#cb121-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interactions {.smaller}</span></span>
<span id="cb121-367"><a href="#cb121-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-368"><a href="#cb121-368" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-369"><a href="#cb121-369" aria-hidden="true" tabindex="-1"></a>What if we don't like that parallel lines assumption?</span>
<span id="cb121-370"><a href="#cb121-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-371"><a href="#cb121-371" aria-hidden="true" tabindex="-1"></a>Then we need to allow an "interaction" between  age $A$ and sex $S$:</span>
<span id="cb121-372"><a href="#cb121-372" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-373"><a href="#cb121-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-374"><a href="#cb121-374" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-375"><a href="#cb121-375" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|A=a, S=s</span><span class="co">]</span> = \beta_0 + \beta_A a+ \beta_M m + \beta_{AM} (a \cdot m)</span>
<span id="cb121-376"><a href="#cb121-376" aria-hidden="true" tabindex="-1"></a>$$ {#eq-BW-lm-interact}</span>
<span id="cb121-377"><a href="#cb121-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-378"><a href="#cb121-378" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-379"><a href="#cb121-379" aria-hidden="true" tabindex="-1"></a>Now, the slope of mean birthweight $E<span class="co">[</span><span class="ot">Y|A,S</span><span class="co">]</span>$ with respect to gestational age $A$ depends on the value of sex $S$.</span>
<span id="cb121-380"><a href="#cb121-380" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-381"><a href="#cb121-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-382"><a href="#cb121-382" aria-hidden="true" tabindex="-1"></a>::: {.column width=40% .smaller}</span>
<span id="cb121-383"><a href="#cb121-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-386"><a href="#cb121-386" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-387"><a href="#cb121-387" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-bw-model-coefs-interact</span></span>
<span id="cb121-388"><a href="#cb121-388" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Birthweight model with interaction term"</span></span>
<span id="cb121-389"><a href="#cb121-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-390"><a href="#cb121-390" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> sex<span class="sc">:</span>age, <span class="at">data =</span> bw)</span>
<span id="cb121-391"><a href="#cb121-391" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-392"><a href="#cb121-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-393"><a href="#cb121-393" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-394"><a href="#cb121-394" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>,</span>
<span id="cb121-395"><a href="#cb121-395" aria-hidden="true" tabindex="-1"></a>    <span class="co"># show_sigma = TRUE,</span></span>
<span id="cb121-396"><a href="#cb121-396" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="st">"{estimate}"</span>)</span>
<span id="cb121-397"><a href="#cb121-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-398"><a href="#cb121-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-399"><a href="#cb121-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-400"><a href="#cb121-400" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-401"><a href="#cb121-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-402"><a href="#cb121-402" aria-hidden="true" tabindex="-1"></a>:::{.column width=5%}</span>
<span id="cb121-403"><a href="#cb121-403" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-404"><a href="#cb121-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-405"><a href="#cb121-405" aria-hidden="true" tabindex="-1"></a>:::{.column width=55%}</span>
<span id="cb121-406"><a href="#cb121-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-409"><a href="#cb121-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-410"><a href="#cb121-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-bw-interaction</span></span>
<span id="cb121-411"><a href="#cb121-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Birthweight model with interaction term"</span></span>
<span id="cb121-412"><a href="#cb121-412" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-413"><a href="#cb121-413" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-414"><a href="#cb121-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-415"><a href="#cb121-415" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(bw_lm2)</span>
<span id="cb121-416"><a href="#cb121-416" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb121-417"><a href="#cb121-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex, age)</span>
<span id="cb121-418"><a href="#cb121-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-419"><a href="#cb121-419" aria-hidden="true" tabindex="-1"></a>plot1_interact <span class="ot">=</span> </span>
<span id="cb121-420"><a href="#cb121-420" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">%+%</span> bw <span class="sc">+</span></span>
<span id="cb121-421"><a href="#cb121-421" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predlm2))</span>
<span id="cb121-422"><a href="#cb121-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-423"><a href="#cb121-423" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1_interact)</span>
<span id="cb121-424"><a href="#cb121-424" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-425"><a href="#cb121-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-426"><a href="#cb121-426" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-427"><a href="#cb121-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-428"><a href="#cb121-428" aria-hidden="true" tabindex="-1"></a>::: {.notes}</span>
<span id="cb121-429"><a href="#cb121-429" aria-hidden="true" tabindex="-1"></a>Now we can see that the lines aren't parallel.</span>
<span id="cb121-430"><a href="#cb121-430" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-431"><a href="#cb121-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-432"><a href="#cb121-432" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-433"><a href="#cb121-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-434"><a href="#cb121-434" aria-hidden="true" tabindex="-1"></a>Here's another way we could rewrite this model (by collecting terms involving $S$):</span>
<span id="cb121-435"><a href="#cb121-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-436"><a href="#cb121-436" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-437"><a href="#cb121-437" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|A, M</span><span class="co">]</span> = \beta_0 + \beta_M M+ (\beta_A + \beta_{AM} M) A</span>
<span id="cb121-438"><a href="#cb121-438" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-439"><a href="#cb121-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-440"><a href="#cb121-440" aria-hidden="true" tabindex="-1"></a>::: callout-note</span>
<span id="cb121-441"><a href="#cb121-441" aria-hidden="true" tabindex="-1"></a>If you want to understand a coefficient in a model with interactions, collect terms for the corresponding variable, and you will see what other variables are interacting with the variable you are interested in.</span>
<span id="cb121-442"><a href="#cb121-442" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-443"><a href="#cb121-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-444"><a href="#cb121-444" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-445"><a href="#cb121-445" aria-hidden="true" tabindex="-1"></a>In this case, the coefficient $S$ is interacting with $A$. So the slope of $Y$ with respect to $A$ depends on the value of $M$.</span>
<span id="cb121-446"><a href="#cb121-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-447"><a href="#cb121-447" aria-hidden="true" tabindex="-1"></a>According to this model, there is no such thing as "*the* slope of birthweight with respect to age". There are two slopes, one for each sex.^<span class="co">[</span><span class="ot">using the definite article "the" would mean there is only one slope.</span><span class="co">]</span> We can only talk about "the slope of birthweight with respect to age among males" and "the slope of birthweight with respect to age among females".</span>
<span id="cb121-448"><a href="#cb121-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-449"><a href="#cb121-449" aria-hidden="true" tabindex="-1"></a>Then: that coefficient is the difference in means per unit change in its corresponding coefficient, when the other collected variables are set to 0.</span>
<span id="cb121-450"><a href="#cb121-450" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-451"><a href="#cb121-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-452"><a href="#cb121-452" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-453"><a href="#cb121-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-454"><a href="#cb121-454" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-455"><a href="#cb121-455" aria-hidden="true" tabindex="-1"></a>To learn what this model is assuming, let's plug in a few values.</span>
<span id="cb121-456"><a href="#cb121-456" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-457"><a href="#cb121-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-458"><a href="#cb121-458" aria-hidden="true" tabindex="-1"></a>:::{#exr-pred-fem-interact}</span>
<span id="cb121-459"><a href="#cb121-459" aria-hidden="true" tabindex="-1"></a>According to this model, what's the mean birthweight for a female born at 36 weeks?</span>
<span id="cb121-460"><a href="#cb121-460" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-461"><a href="#cb121-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-462"><a href="#cb121-462" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-463"><a href="#cb121-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-464"><a href="#cb121-464" aria-hidden="true" tabindex="-1"></a>::: {.solution}</span>
<span id="cb121-465"><a href="#cb121-465" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb121-466"><a href="#cb121-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-469"><a href="#cb121-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-470"><a href="#cb121-470" aria-hidden="true" tabindex="-1"></a>pred_female <span class="ot">=</span> <span class="fu">coef</span>(bw_lm2)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> <span class="fu">coef</span>(bw_lm2)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span></span>
<span id="cb121-471"><a href="#cb121-471" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-472"><a href="#cb121-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-473"><a href="#cb121-473" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-474"><a href="#cb121-474" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|A = 0, X_2 = 36</span><span class="co">]</span> = </span>
<span id="cb121-475"><a href="#cb121-475" aria-hidden="true" tabindex="-1"></a>\beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36 + \beta_{AM} \cdot (0 * 36) </span>
<span id="cb121-476"><a href="#cb121-476" aria-hidden="true" tabindex="-1"></a>=  <span class="in">`r pred_female`</span></span>
<span id="cb121-477"><a href="#cb121-477" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb121-478"><a href="#cb121-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-479"><a href="#cb121-479" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-480"><a href="#cb121-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-481"><a href="#cb121-481" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-482"><a href="#cb121-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-483"><a href="#cb121-483" aria-hidden="true" tabindex="-1"></a>:::{#exr-pred-interact-male_36}</span>
<span id="cb121-484"><a href="#cb121-484" aria-hidden="true" tabindex="-1"></a>What's the mean birthweight for a male born at 36 weeks?</span>
<span id="cb121-485"><a href="#cb121-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-486"><a href="#cb121-486" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-487"><a href="#cb121-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-488"><a href="#cb121-488" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-489"><a href="#cb121-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-490"><a href="#cb121-490" aria-hidden="true" tabindex="-1"></a>::: solution</span>
<span id="cb121-491"><a href="#cb121-491" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb121-492"><a href="#cb121-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-495"><a href="#cb121-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-496"><a href="#cb121-496" aria-hidden="true" tabindex="-1"></a>pred_male <span class="ot">=</span> </span>
<span id="cb121-497"><a href="#cb121-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"(Intercept)"</span>] <span class="sc">+</span> </span>
<span id="cb121-498"><a href="#cb121-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"sexmale"</span>] <span class="sc">+</span> </span>
<span id="cb121-499"><a href="#cb121-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"age"</span>]<span class="sc">*</span><span class="dv">36</span> <span class="sc">+</span> </span>
<span id="cb121-500"><a href="#cb121-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(bw_lm2)[<span class="st">"sexmale:age"</span>] <span class="sc">*</span> <span class="dv">36</span></span>
<span id="cb121-501"><a href="#cb121-501" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-502"><a href="#cb121-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-503"><a href="#cb121-503" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-504"><a href="#cb121-504" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-505"><a href="#cb121-505" aria-hidden="true" tabindex="-1"></a>E<span class="co">[</span><span class="ot">Y|A = 0, X_2 = 36</span><span class="co">]</span></span>
<span id="cb121-506"><a href="#cb121-506" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36 + \beta_{AM} \cdot 1 \cdot 36<span class="sc">\\</span></span>
<span id="cb121-507"><a href="#cb121-507" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r pred_male`</span></span>
<span id="cb121-508"><a href="#cb121-508" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-509"><a href="#cb121-509" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-510"><a href="#cb121-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-511"><a href="#cb121-511" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-512"><a href="#cb121-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-513"><a href="#cb121-513" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-514"><a href="#cb121-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-515"><a href="#cb121-515" aria-hidden="true" tabindex="-1"></a>:::{#exr-diff-gender-interact}</span>
<span id="cb121-516"><a href="#cb121-516" aria-hidden="true" tabindex="-1"></a>What's the difference in mean birthweights between males born at 36 weeks and females born at 36 weeks?</span>
<span id="cb121-517"><a href="#cb121-517" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-518"><a href="#cb121-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-519"><a href="#cb121-519" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-520"><a href="#cb121-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-521"><a href="#cb121-521" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb121-522"><a href="#cb121-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-523"><a href="#cb121-523" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-524"><a href="#cb121-524" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-525"><a href="#cb121-525" aria-hidden="true" tabindex="-1"></a>&amp; E<span class="co">[</span><span class="ot">Y|M = 1, A = 36</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y|M = 0, A = 36</span><span class="co">]</span><span class="sc">\\</span> </span>
<span id="cb121-526"><a href="#cb121-526" aria-hidden="true" tabindex="-1"></a>&amp;= (\beta_0 + \beta_M \cdot 1+ \beta_A \cdot 36 + \beta_{AM} \cdot 1 \cdot 36)<span class="sc">\\</span> </span>
<span id="cb121-527"><a href="#cb121-527" aria-hidden="true" tabindex="-1"></a>&amp;\ \ \ \ \  -(\beta_0 + \beta_M \cdot 0+ \beta_A \cdot 36 + \beta_{AM} \cdot 0 \cdot 36) <span class="sc">\\</span></span>
<span id="cb121-528"><a href="#cb121-528" aria-hidden="true" tabindex="-1"></a>&amp;= \beta_{S} + \beta_{AM}\cdot 36<span class="sc">\\</span></span>
<span id="cb121-529"><a href="#cb121-529" aria-hidden="true" tabindex="-1"></a>&amp;=  <span class="in">`r pred_male - pred_female`</span></span>
<span id="cb121-530"><a href="#cb121-530" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-531"><a href="#cb121-531" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-532"><a href="#cb121-532" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-533"><a href="#cb121-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-534"><a href="#cb121-534" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-535"><a href="#cb121-535" aria-hidden="true" tabindex="-1"></a>Note that age now does show up in the difference: in other words, according to this model, the difference in mean birthweights between females and males with the same gestational age can vary by gestational age.</span>
<span id="cb121-536"><a href="#cb121-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-537"><a href="#cb121-537" aria-hidden="true" tabindex="-1"></a>That's how the lines in the graph ended up non-parallel.</span>
<span id="cb121-538"><a href="#cb121-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-539"><a href="#cb121-539" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-540"><a href="#cb121-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-541"><a href="#cb121-541" aria-hidden="true" tabindex="-1"></a><span class="fu">### Stratified regression {.smaller}</span></span>
<span id="cb121-542"><a href="#cb121-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-543"><a href="#cb121-543" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-544"><a href="#cb121-544" aria-hidden="true" tabindex="-1"></a>We could re-write the interaction model as a stratified model, with a slope and intercept for each sex:</span>
<span id="cb121-545"><a href="#cb121-545" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-546"><a href="#cb121-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-547"><a href="#cb121-547" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-548"><a href="#cb121-548" aria-hidden="true" tabindex="-1"></a>\E{Y|A=a, S=s} = </span>
<span id="cb121-549"><a href="#cb121-549" aria-hidden="true" tabindex="-1"></a>\beta_M m + \beta_{AM} (a \cdot m) + </span>
<span id="cb121-550"><a href="#cb121-550" aria-hidden="true" tabindex="-1"></a>\beta_F f + \beta_{AF} (a \cdot f)</span>
<span id="cb121-551"><a href="#cb121-551" aria-hidden="true" tabindex="-1"></a>$$ {#eq-model-strat}</span>
<span id="cb121-552"><a href="#cb121-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-553"><a href="#cb121-553" aria-hidden="true" tabindex="-1"></a>Compare this stratified model with our interaction model, @eq-BW-lm-interact:</span>
<span id="cb121-554"><a href="#cb121-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-555"><a href="#cb121-555" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-556"><a href="#cb121-556" aria-hidden="true" tabindex="-1"></a>\E{Y|A=a, S=s} = </span>
<span id="cb121-557"><a href="#cb121-557" aria-hidden="true" tabindex="-1"></a>\beta_0 + \beta_A a + \beta_M m + \beta_{AM} (a \cdot m)</span>
<span id="cb121-558"><a href="#cb121-558" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-559"><a href="#cb121-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-560"><a href="#cb121-560" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-561"><a href="#cb121-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-562"><a href="#cb121-562" aria-hidden="true" tabindex="-1"></a>In the stratified model, the intercept term $\beta_0$ has been relabeled as $\beta_F$.</span>
<span id="cb121-563"><a href="#cb121-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-564"><a href="#cb121-564" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-565"><a href="#cb121-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-566"><a href="#cb121-566" aria-hidden="true" tabindex="-1"></a>::: {.column width=45%}</span>
<span id="cb121-569"><a href="#cb121-569" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-570"><a href="#cb121-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-bw-model-coefs-interact2</span></span>
<span id="cb121-571"><a href="#cb121-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Birthweight model with interaction term"</span></span>
<span id="cb121-572"><a href="#cb121-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-573"><a href="#cb121-573" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> age <span class="sc">+</span> sex<span class="sc">:</span>age, <span class="at">data =</span> bw)</span>
<span id="cb121-574"><a href="#cb121-574" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-575"><a href="#cb121-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-576"><a href="#cb121-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-577"><a href="#cb121-577" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>,</span>
<span id="cb121-578"><a href="#cb121-578" aria-hidden="true" tabindex="-1"></a>    <span class="co"># show_sigma = TRUE,</span></span>
<span id="cb121-579"><a href="#cb121-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="st">"{estimate}"</span>)</span>
<span id="cb121-580"><a href="#cb121-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-581"><a href="#cb121-581" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-582"><a href="#cb121-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-583"><a href="#cb121-583" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-584"><a href="#cb121-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-585"><a href="#cb121-585" aria-hidden="true" tabindex="-1"></a>:::{.column width=10%}</span>
<span id="cb121-586"><a href="#cb121-586" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-587"><a href="#cb121-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-588"><a href="#cb121-588" aria-hidden="true" tabindex="-1"></a>:::{.column width=45%}</span>
<span id="cb121-589"><a href="#cb121-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-592"><a href="#cb121-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-593"><a href="#cb121-593" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-bw-model-coefs-strat</span></span>
<span id="cb121-594"><a href="#cb121-594" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Birthweight model - stratified betas"</span></span>
<span id="cb121-595"><a href="#cb121-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-596"><a href="#cb121-596" aria-hidden="true" tabindex="-1"></a>bw_lm_strat <span class="ot">=</span> </span>
<span id="cb121-597"><a href="#cb121-597" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-598"><a href="#cb121-598" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb121-599"><a href="#cb121-599" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> weight <span class="sc">~</span> sex <span class="sc">+</span> sex<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb121-600"><a href="#cb121-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb121-601"><a href="#cb121-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-602"><a href="#cb121-602" aria-hidden="true" tabindex="-1"></a>bw_lm_strat <span class="sc">|&gt;</span> </span>
<span id="cb121-603"><a href="#cb121-603" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-604"><a href="#cb121-604" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-605"><a href="#cb121-605" aria-hidden="true" tabindex="-1"></a>    <span class="co"># show_sigma = TRUE,</span></span>
<span id="cb121-606"><a href="#cb121-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">select =</span> <span class="st">"{estimate}"</span>)</span>
<span id="cb121-607"><a href="#cb121-607" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-608"><a href="#cb121-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-609"><a href="#cb121-609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-610"><a href="#cb121-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-611"><a href="#cb121-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Curved-line regression</span></span>
<span id="cb121-612"><a href="#cb121-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-613"><a href="#cb121-613" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-614"><a href="#cb121-614" aria-hidden="true" tabindex="-1"></a>If we transform some of our covariates ($X$s) and plot the resulting model on the original covariate scale, we end up with curved regression lines:</span>
<span id="cb121-615"><a href="#cb121-615" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-616"><a href="#cb121-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-619"><a href="#cb121-619" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-620"><a href="#cb121-620" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-penguins-log-x</span></span>
<span id="cb121-621"><a href="#cb121-621" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`palmerpenguins` model with `bill_length` entering on log scale"</span></span>
<span id="cb121-622"><a href="#cb121-622" aria-hidden="true" tabindex="-1"></a>bw_lm3 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex<span class="sc">:</span><span class="fu">log</span>(age) <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> bw)</span>
<span id="cb121-623"><a href="#cb121-623" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb121-624"><a href="#cb121-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-625"><a href="#cb121-625" aria-hidden="true" tabindex="-1"></a>ggpenguins <span class="ot">&lt;-</span> </span>
<span id="cb121-626"><a href="#cb121-626" aria-hidden="true" tabindex="-1"></a>  palmerpenguins<span class="sc">::</span>penguins <span class="sc">|&gt;</span> </span>
<span id="cb121-627"><a href="#cb121-627" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Adelie"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb121-628"><a href="#cb121-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-629"><a href="#cb121-629" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> bill_length_mm , <span class="at">y =</span> body_mass_g)) <span class="sc">+</span></span>
<span id="cb121-630"><a href="#cb121-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb121-631"><a href="#cb121-631" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bill length (mm)"</span>) <span class="sc">+</span> </span>
<span id="cb121-632"><a href="#cb121-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Body mass (g)"</span>)</span>
<span id="cb121-633"><a href="#cb121-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-634"><a href="#cb121-634" aria-hidden="true" tabindex="-1"></a>ggpenguins2 <span class="ot">=</span> ggpenguins <span class="sc">+</span></span>
<span id="cb121-635"><a href="#cb121-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(</span>
<span id="cb121-636"><a href="#cb121-636" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb121-637"><a href="#cb121-637" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">log</span>(x),</span>
<span id="cb121-638"><a href="#cb121-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"smooth"</span>) <span class="sc">+</span></span>
<span id="cb121-639"><a href="#cb121-639" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Bill length (mm)"</span>) <span class="sc">+</span> </span>
<span id="cb121-640"><a href="#cb121-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Body mass (g)"</span>)</span>
<span id="cb121-641"><a href="#cb121-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-642"><a href="#cb121-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-643"><a href="#cb121-643" aria-hidden="true" tabindex="-1"></a>ggpenguins2 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb121-644"><a href="#cb121-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-645"><a href="#cb121-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-646"><a href="#cb121-646" aria-hidden="true" tabindex="-1"></a><span class="fu">## Estimating Linear Models via Maximum Likelihood {#sec-est-LMs}</span></span>
<span id="cb121-647"><a href="#cb121-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-648"><a href="#cb121-648" aria-hidden="true" tabindex="-1"></a><span class="fu">### Likelihood, log-likelihood, and score functions for linear regression {.smaller}</span></span>
<span id="cb121-649"><a href="#cb121-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-650"><a href="#cb121-650" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-651"><a href="#cb121-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-652"><a href="#cb121-652" aria-hidden="true" tabindex="-1"></a>In EPI 203 and @sec-intro-MLEs, we learned how to fit outcome-only models of the form $p(X=x|\theta)$ to iid data $\vx = (x_1,…,x_n)$ using maximum likelihood estimation.</span>
<span id="cb121-653"><a href="#cb121-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-654"><a href="#cb121-654" aria-hidden="true" tabindex="-1"></a>Now, we apply the same procedure to linear regression models:</span>
<span id="cb121-655"><a href="#cb121-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-656"><a href="#cb121-656" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-657"><a href="#cb121-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-658"><a href="#cb121-658" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-659"><a href="#cb121-659" aria-hidden="true" tabindex="-1"></a>\mathcal L(\vec y|\mat x,\beta, \sigma^2) = </span>
<span id="cb121-660"><a href="#cb121-660" aria-hidden="true" tabindex="-1"></a>\prod_{i=1}^n (2\pi\sigma^2)^{-1/2} </span>
<span id="cb121-661"><a href="#cb121-661" aria-hidden="true" tabindex="-1"></a>\exp{-\frac{1}{2\sigma^2}(y_i - \vec{x_i}'\beta)^2}</span>
<span id="cb121-662"><a href="#cb121-662" aria-hidden="true" tabindex="-1"></a>$$ {#eq-linreg-lik}</span>
<span id="cb121-663"><a href="#cb121-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-664"><a href="#cb121-664" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-665"><a href="#cb121-665" aria-hidden="true" tabindex="-1"></a>\ell(\vec y|\mat x,\beta, \sigma^2) </span>
<span id="cb121-666"><a href="#cb121-666" aria-hidden="true" tabindex="-1"></a>= -\frac{n}{2}\log{\sigma^2} - </span>
<span id="cb121-667"><a href="#cb121-667" aria-hidden="true" tabindex="-1"></a>\frac{1}{2\sigma^2}\sum_{i=1}^n (y_i - \vec{x_i}' \beta)^2</span>
<span id="cb121-668"><a href="#cb121-668" aria-hidden="true" tabindex="-1"></a>$$ {#eq-linreg-loglik}</span>
<span id="cb121-669"><a href="#cb121-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-670"><a href="#cb121-670" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-671"><a href="#cb121-671" aria-hidden="true" tabindex="-1"></a>\ell'_{\beta}(\vec y|\mat x,\beta, \sigma^2) </span>
<span id="cb121-672"><a href="#cb121-672" aria-hidden="true" tabindex="-1"></a>= - </span>
<span id="cb121-673"><a href="#cb121-673" aria-hidden="true" tabindex="-1"></a>\frac{1}{2\sigma^2}\deriv{\beta}</span>
<span id="cb121-674"><a href="#cb121-674" aria-hidden="true" tabindex="-1"></a>\paren{\sum_{i=1}^n (y_i - \vec{x_i}\' \beta)^2}</span>
<span id="cb121-675"><a href="#cb121-675" aria-hidden="true" tabindex="-1"></a>$$ {#eq-linreg-score}</span>
<span id="cb121-676"><a href="#cb121-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-677"><a href="#cb121-677" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-678"><a href="#cb121-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-679"><a href="#cb121-679" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-680"><a href="#cb121-680" aria-hidden="true" tabindex="-1"></a>Let's switch to matrix-vector notation:</span>
<span id="cb121-681"><a href="#cb121-681" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-682"><a href="#cb121-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-683"><a href="#cb121-683" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-684"><a href="#cb121-684" aria-hidden="true" tabindex="-1"></a>\sum_{i=1}^n (y_i - \vx_i\' \vb)^2 </span>
<span id="cb121-685"><a href="#cb121-685" aria-hidden="true" tabindex="-1"></a>= (\vy - \mX\vb)'(\vy - \mX\vb)</span>
<span id="cb121-686"><a href="#cb121-686" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-687"><a href="#cb121-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-688"><a href="#cb121-688" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-689"><a href="#cb121-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-690"><a href="#cb121-690" aria-hidden="true" tabindex="-1"></a>So</span>
<span id="cb121-691"><a href="#cb121-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-692"><a href="#cb121-692" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-693"><a href="#cb121-693" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-694"><a href="#cb121-694" aria-hidden="true" tabindex="-1"></a>(\vy - \mX\vb)'(\vy - \mX\vb) </span>
<span id="cb121-695"><a href="#cb121-695" aria-hidden="true" tabindex="-1"></a>&amp;= (\vy' - \vb'X')(\vy - \mX\vb)</span>
<span id="cb121-696"><a href="#cb121-696" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y'y - \vb'X'y - y'\mX\vb +\vb'\mX'\mX\beta</span>
<span id="cb121-697"><a href="#cb121-697" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y'y - 2y'\mX\beta +\beta'\mX'\mX\beta</span>
<span id="cb121-698"><a href="#cb121-698" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-699"><a href="#cb121-699" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-700"><a href="#cb121-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-701"><a href="#cb121-701" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deriving the linear regression score function</span></span>
<span id="cb121-702"><a href="#cb121-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-703"><a href="#cb121-703" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-704"><a href="#cb121-704" aria-hidden="true" tabindex="-1"></a>We will use some results from <span class="co">[</span><span class="ot">vector calculus</span><span class="co">](math-prereqs.qmd#sec-vector-calculus)</span>:</span>
<span id="cb121-705"><a href="#cb121-705" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-706"><a href="#cb121-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-707"><a href="#cb121-707" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-708"><a href="#cb121-708" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-709"><a href="#cb121-709" aria-hidden="true" tabindex="-1"></a>\deriv{\beta}\paren{\sum_{i=1}^n (y_i - x_i' \beta)^2} </span>
<span id="cb121-710"><a href="#cb121-710" aria-hidden="true" tabindex="-1"></a>   &amp;= \deriv{\beta}(\vy - X\beta)'(\vy - X\beta)</span>
<span id="cb121-711"><a href="#cb121-711" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \deriv{\beta} (y'y - 2y'X\beta +\beta'X'X\beta)</span>
<span id="cb121-712"><a href="#cb121-712" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= (- 2X'y +2X'X\beta)</span>
<span id="cb121-713"><a href="#cb121-713" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= - 2X'(y - X\beta)</span>
<span id="cb121-714"><a href="#cb121-714" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= - 2X'(y - \Expp<span class="co">[</span><span class="ot">y</span><span class="co">]</span>)</span>
<span id="cb121-715"><a href="#cb121-715" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= - 2X' \err(y)</span>
<span id="cb121-716"><a href="#cb121-716" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-717"><a href="#cb121-717" aria-hidden="true" tabindex="-1"></a>$${#eq-scorefun-linreg}</span>
<span id="cb121-718"><a href="#cb121-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-719"><a href="#cb121-719" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-720"><a href="#cb121-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-721"><a href="#cb121-721" aria-hidden="true" tabindex="-1"></a>So if $\ell(\beta,\sigma^2) =0$, then</span>
<span id="cb121-722"><a href="#cb121-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-723"><a href="#cb121-723" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-724"><a href="#cb121-724" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-725"><a href="#cb121-725" aria-hidden="true" tabindex="-1"></a>0 &amp;= (- 2X'y +2X'X\beta)<span class="sc">\\</span></span>
<span id="cb121-726"><a href="#cb121-726" aria-hidden="true" tabindex="-1"></a>2X'y &amp;= 2X'X\beta<span class="sc">\\</span></span>
<span id="cb121-727"><a href="#cb121-727" aria-hidden="true" tabindex="-1"></a>X'y &amp;= X'X\beta<span class="sc">\\</span></span>
<span id="cb121-728"><a href="#cb121-728" aria-hidden="true" tabindex="-1"></a>(X'X)^{-1}X'y &amp;= \beta</span>
<span id="cb121-729"><a href="#cb121-729" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-730"><a href="#cb121-730" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-731"><a href="#cb121-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-732"><a href="#cb121-732" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-733"><a href="#cb121-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-734"><a href="#cb121-734" aria-hidden="true" tabindex="-1"></a>The second derivative matrix $\ell_{\beta, \beta'} ''(\beta, \sigma^2;\mathbf X,\vy)$ is negative definite at $\beta = (X'X)^{-1}X'y$, so $\hat \beta_{ML} = (X'X)^{-1}X'y$ is the MLE for $\beta$.</span>
<span id="cb121-735"><a href="#cb121-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-736"><a href="#cb121-736" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-737"><a href="#cb121-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-738"><a href="#cb121-738" aria-hidden="true" tabindex="-1"></a>Similarly (not shown):</span>
<span id="cb121-739"><a href="#cb121-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-740"><a href="#cb121-740" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-741"><a href="#cb121-741" aria-hidden="true" tabindex="-1"></a>\hat\sigma^2_{ML} = \frac{1}{n} (Y-X\hat\beta)'(Y-X\hat\beta)</span>
<span id="cb121-742"><a href="#cb121-742" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-743"><a href="#cb121-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-744"><a href="#cb121-744" aria-hidden="true" tabindex="-1"></a>And</span>
<span id="cb121-745"><a href="#cb121-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-746"><a href="#cb121-746" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-747"><a href="#cb121-747" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-748"><a href="#cb121-748" aria-hidden="true" tabindex="-1"></a>\mathcal I_{\beta} &amp;= E<span class="co">[</span><span class="ot">-\ell_{\beta, \beta'} ''(Y|X,\beta, \sigma^2)</span><span class="co">]</span><span class="sc">\\</span></span>
<span id="cb121-749"><a href="#cb121-749" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\sigma^2}X'X</span>
<span id="cb121-750"><a href="#cb121-750" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-751"><a href="#cb121-751" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-752"><a href="#cb121-752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-753"><a href="#cb121-753" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-754"><a href="#cb121-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-755"><a href="#cb121-755" aria-hidden="true" tabindex="-1"></a>So:</span>
<span id="cb121-756"><a href="#cb121-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-757"><a href="#cb121-757" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-758"><a href="#cb121-758" aria-hidden="true" tabindex="-1"></a>Var(\hat \beta) \approx (\mathcal I_{\beta})^{-1} = \sigma^2 (X'X)^{-1}</span>
<span id="cb121-759"><a href="#cb121-759" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-760"><a href="#cb121-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-761"><a href="#cb121-761" aria-hidden="true" tabindex="-1"></a>and</span>
<span id="cb121-762"><a href="#cb121-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-763"><a href="#cb121-763" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-764"><a href="#cb121-764" aria-hidden="true" tabindex="-1"></a>\hat\beta \dot \sim N(\beta, \mathcal I_{\beta}^{-1})</span>
<span id="cb121-765"><a href="#cb121-765" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb121-766"><a href="#cb121-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-767"><a href="#cb121-767" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-768"><a href="#cb121-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-769"><a href="#cb121-769" aria-hidden="true" tabindex="-1"></a>These are all results you have hopefully seen before.</span>
<span id="cb121-770"><a href="#cb121-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-771"><a href="#cb121-771" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-772"><a href="#cb121-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-773"><a href="#cb121-773" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-774"><a href="#cb121-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-775"><a href="#cb121-775" aria-hidden="true" tabindex="-1"></a>In the Gaussian linear regression case, we also have exact results:</span>
<span id="cb121-776"><a href="#cb121-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-777"><a href="#cb121-777" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-778"><a href="#cb121-778" aria-hidden="true" tabindex="-1"></a>\frac{\hat\beta_j}{\hse{\hat\beta_j}} \dist t_{n-p}</span>
<span id="cb121-779"><a href="#cb121-779" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb121-780"><a href="#cb121-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-781"><a href="#cb121-781" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-782"><a href="#cb121-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-783"><a href="#cb121-783" aria-hidden="true" tabindex="-1"></a>In our model 2 above, $\heinf(\beta)$ is:</span>
<span id="cb121-784"><a href="#cb121-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-787"><a href="#cb121-787" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-788"><a href="#cb121-788" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> <span class="fu">vcov</span>()</span>
<span id="cb121-789"><a href="#cb121-789" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-790"><a href="#cb121-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-791"><a href="#cb121-791" aria-hidden="true" tabindex="-1"></a>If we take the square roots of the diagonals, we get the standard errors listed in the model output:</span>
<span id="cb121-792"><a href="#cb121-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-795"><a href="#cb121-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-796"><a href="#cb121-796" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> <span class="fu">vcov</span>() <span class="sc">|&gt;</span> <span class="fu">diag</span>() <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span>
<span id="cb121-797"><a href="#cb121-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-798"><a href="#cb121-798" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-799"><a href="#cb121-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-802"><a href="#cb121-802" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-803"><a href="#cb121-803" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-mod-intx</span></span>
<span id="cb121-804"><a href="#cb121-804" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Estimated model for `birthweight` data with interaction term"</span></span>
<span id="cb121-805"><a href="#cb121-805" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-806"><a href="#cb121-806" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-807"><a href="#cb121-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-808"><a href="#cb121-808" aria-hidden="true" tabindex="-1"></a>So we can do confidence intervals, hypothesis tests, and p-values exactly as in the one-variable case we looked at previously.</span>
<span id="cb121-809"><a href="#cb121-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-810"><a href="#cb121-810" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residual Standard Deviation</span></span>
<span id="cb121-811"><a href="#cb121-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-812"><a href="#cb121-812" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-813"><a href="#cb121-813" aria-hidden="true" tabindex="-1"></a>$\hs$ represents an *estimate* of the *Residual Standard Deviation* parameter, $\s$. </span>
<span id="cb121-814"><a href="#cb121-814" aria-hidden="true" tabindex="-1"></a>We can extract $\hs$ from the fitted model, using the <span class="in">`sigma()`</span> function:</span>
<span id="cb121-815"><a href="#cb121-815" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-816"><a href="#cb121-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-819"><a href="#cb121-819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-820"><a href="#cb121-820" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb121-821"><a href="#cb121-821" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(bw_lm2)</span>
<span id="cb121-822"><a href="#cb121-822" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-823"><a href="#cb121-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-824"><a href="#cb121-824" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-825"><a href="#cb121-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-826"><a href="#cb121-826" aria-hidden="true" tabindex="-1"></a><span class="fu">#### $\s$ is NOT "Residual standard error"</span></span>
<span id="cb121-827"><a href="#cb121-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-828"><a href="#cb121-828" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-829"><a href="#cb121-829" aria-hidden="true" tabindex="-1"></a>In the <span class="in">`summary.lm()`</span> output, this estimate is labeled as <span class="in">`"Residual standard error"`</span>:</span>
<span id="cb121-830"><a href="#cb121-830" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-831"><a href="#cb121-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-834"><a href="#cb121-834" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-835"><a href="#cb121-835" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb121-836"><a href="#cb121-836" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bw_lm2)</span>
<span id="cb121-837"><a href="#cb121-837" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-838"><a href="#cb121-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-839"><a href="#cb121-839" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-840"><a href="#cb121-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-841"><a href="#cb121-841" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-842"><a href="#cb121-842" aria-hidden="true" tabindex="-1"></a>However, this is a misnomer:</span>
<span id="cb121-843"><a href="#cb121-843" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-844"><a href="#cb121-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-845"><a href="#cb121-845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, printr.help.sections = c("description", "note")}</span></span>
<span id="cb121-846"><a href="#cb121-846" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: show</span></span>
<span id="cb121-847"><a href="#cb121-847" aria-hidden="true" tabindex="-1"></a><span class="in">library(printr) # captures ? documentation</span></span>
<span id="cb121-848"><a href="#cb121-848" aria-hidden="true" tabindex="-1"></a><span class="in">?stats::sigma</span></span>
<span id="cb121-849"><a href="#cb121-849" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-850"><a href="#cb121-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-851"><a href="#cb121-851" aria-hidden="true" tabindex="-1"></a><span class="fu">## Inference about Gaussian Linear Regression Models {#sec-infer-LMs}</span></span>
<span id="cb121-852"><a href="#cb121-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-853"><a href="#cb121-853" aria-hidden="true" tabindex="-1"></a><span class="fu">### Motivating example: `birthweight` data</span></span>
<span id="cb121-854"><a href="#cb121-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-855"><a href="#cb121-855" aria-hidden="true" tabindex="-1"></a>Research question: is there really an interaction between sex and age?</span>
<span id="cb121-856"><a href="#cb121-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-857"><a href="#cb121-857" aria-hidden="true" tabindex="-1"></a>$H_0: \beta_{AM} = 0$</span>
<span id="cb121-858"><a href="#cb121-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-859"><a href="#cb121-859" aria-hidden="true" tabindex="-1"></a>$H_A: \beta_{AM} \neq 0$</span>
<span id="cb121-860"><a href="#cb121-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-861"><a href="#cb121-861" aria-hidden="true" tabindex="-1"></a>$P(|\hat\beta_{AM}| &gt; |<span class="in">`r coef(bw_lm2)["sexmale:age"]`</span>| \mid H_0)$ = ?</span>
<span id="cb121-862"><a href="#cb121-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-863"><a href="#cb121-863" aria-hidden="true" tabindex="-1"></a><span class="fu">### Wald tests and CIs {.smaller}</span></span>
<span id="cb121-864"><a href="#cb121-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-865"><a href="#cb121-865" aria-hidden="true" tabindex="-1"></a>R can give you Wald tests for single coefficients and corresponding CIs:</span>
<span id="cb121-866"><a href="#cb121-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-867"><a href="#cb121-867" aria-hidden="true" tabindex="-1"></a><span class="in">```{r "wald tests bw_lm2"}</span></span>
<span id="cb121-868"><a href="#cb121-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-869"><a href="#cb121-869" aria-hidden="true" tabindex="-1"></a><span class="in">bw_lm2 |&gt; </span></span>
<span id="cb121-870"><a href="#cb121-870" aria-hidden="true" tabindex="-1"></a><span class="in">  parameters() |&gt;</span></span>
<span id="cb121-871"><a href="#cb121-871" aria-hidden="true" tabindex="-1"></a><span class="in">  print_md(</span></span>
<span id="cb121-872"><a href="#cb121-872" aria-hidden="true" tabindex="-1"></a><span class="in">    include_reference = TRUE)</span></span>
<span id="cb121-873"><a href="#cb121-873" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-874"><a href="#cb121-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-875"><a href="#cb121-875" aria-hidden="true" tabindex="-1"></a>To understand what's happening, let's replicate these results by hand for the interaction term.</span>
<span id="cb121-876"><a href="#cb121-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-877"><a href="#cb121-877" aria-hidden="true" tabindex="-1"></a><span class="fu">### P-values {.smaller}</span></span>
<span id="cb121-878"><a href="#cb121-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-881"><a href="#cb121-881" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-882"><a href="#cb121-882" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-883"><a href="#cb121-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">keep =</span> <span class="st">"sexmale:age"</span>) <span class="sc">|&gt;</span></span>
<span id="cb121-884"><a href="#cb121-884" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-885"><a href="#cb121-885" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-886"><a href="#cb121-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-887"><a href="#cb121-887" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-888"><a href="#cb121-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-889"><a href="#cb121-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-892"><a href="#cb121-892" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-893"><a href="#cb121-893" aria-hidden="true" tabindex="-1"></a>beta_hat <span class="ot">=</span> <span class="fu">coef</span>(<span class="fu">summary</span>(bw_lm2))[<span class="st">"sexmale:age"</span>, <span class="st">"Estimate"</span>]</span>
<span id="cb121-894"><a href="#cb121-894" aria-hidden="true" tabindex="-1"></a>se_hat <span class="ot">=</span> <span class="fu">coef</span>(<span class="fu">summary</span>(bw_lm2))[<span class="st">"sexmale:age"</span>, <span class="st">"Std. Error"</span>]</span>
<span id="cb121-895"><a href="#cb121-895" aria-hidden="true" tabindex="-1"></a>dfresid <span class="ot">=</span> bw_lm2<span class="sc">$</span>df.residual</span>
<span id="cb121-896"><a href="#cb121-896" aria-hidden="true" tabindex="-1"></a>t_stat <span class="ot">=</span> <span class="fu">abs</span>(beta_hat)<span class="sc">/</span>se_hat</span>
<span id="cb121-897"><a href="#cb121-897" aria-hidden="true" tabindex="-1"></a>pval_t <span class="ot">=</span> </span>
<span id="cb121-898"><a href="#cb121-898" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pt</span>(<span class="sc">-</span>t_stat, <span class="at">df =</span> dfresid, <span class="at">lower.tail =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb121-899"><a href="#cb121-899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pt</span>(t_stat, <span class="at">df =</span> dfresid, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb121-900"><a href="#cb121-900" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-901"><a href="#cb121-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-902"><a href="#cb121-902" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-903"><a href="#cb121-903" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-904"><a href="#cb121-904" aria-hidden="true" tabindex="-1"></a>&amp;P\paren{</span>
<span id="cb121-905"><a href="#cb121-905" aria-hidden="true" tabindex="-1"></a>| \hat \beta_{AM}  | &gt; </span>
<span id="cb121-906"><a href="#cb121-906" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r coef(bw_lm2)["sexmale:age"]`</span>| \middle| H_0</span>
<span id="cb121-907"><a href="#cb121-907" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb121-908"><a href="#cb121-908" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span></span>
<span id="cb121-909"><a href="#cb121-909" aria-hidden="true" tabindex="-1"></a>&amp;= \Pr \paren{</span>
<span id="cb121-910"><a href="#cb121-910" aria-hidden="true" tabindex="-1"></a>\abs{ \frac{\hat\beta_{AM}}{\hat{SE}(\hat\beta_{AM})} } &gt; </span>
<span id="cb121-911"><a href="#cb121-911" aria-hidden="true" tabindex="-1"></a>\abs{ \frac{<span class="in">`r beta_hat`</span>}{<span class="in">`r se_hat`</span>} } \middle| H_0</span>
<span id="cb121-912"><a href="#cb121-912" aria-hidden="true" tabindex="-1"></a>}<span class="sc">\\</span> </span>
<span id="cb121-913"><a href="#cb121-913" aria-hidden="true" tabindex="-1"></a>&amp;= \Pr \paren{</span>
<span id="cb121-914"><a href="#cb121-914" aria-hidden="true" tabindex="-1"></a>\abs{ T_{<span class="in">`r dfresid`</span>} }  &gt;  <span class="in">`r t_stat`</span> | H_0</span>
<span id="cb121-915"><a href="#cb121-915" aria-hidden="true" tabindex="-1"></a>}<span class="sc">\\</span></span>
<span id="cb121-916"><a href="#cb121-916" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r pval_t`</span></span>
<span id="cb121-917"><a href="#cb121-917" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-918"><a href="#cb121-918" aria-hidden="true" tabindex="-1"></a>$$ </span>
<span id="cb121-919"><a href="#cb121-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-920"><a href="#cb121-920" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-921"><a href="#cb121-921" aria-hidden="true" tabindex="-1"></a>This matches the result in the table above.</span>
<span id="cb121-922"><a href="#cb121-922" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-923"><a href="#cb121-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-924"><a href="#cb121-924" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confidence intervals</span></span>
<span id="cb121-925"><a href="#cb121-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-928"><a href="#cb121-928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-929"><a href="#cb121-929" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-930"><a href="#cb121-930" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">keep =</span> <span class="st">"sexmale:age"</span>) <span class="sc">|&gt;</span></span>
<span id="cb121-931"><a href="#cb121-931" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-932"><a href="#cb121-932" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-933"><a href="#cb121-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-934"><a href="#cb121-934" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-935"><a href="#cb121-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-938"><a href="#cb121-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-939"><a href="#cb121-939" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: confint-t</span></span>
<span id="cb121-940"><a href="#cb121-940" aria-hidden="true" tabindex="-1"></a>q_t <span class="ot">=</span> <span class="fu">qt</span>(</span>
<span id="cb121-941"><a href="#cb121-941" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.975</span>, </span>
<span id="cb121-942"><a href="#cb121-942" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> dfresid, </span>
<span id="cb121-943"><a href="#cb121-943" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-944"><a href="#cb121-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-945"><a href="#cb121-945" aria-hidden="true" tabindex="-1"></a>q_t <span class="ot">=</span> <span class="fu">qt</span>(</span>
<span id="cb121-946"><a href="#cb121-946" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> <span class="fl">0.025</span>, </span>
<span id="cb121-947"><a href="#cb121-947" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> dfresid, </span>
<span id="cb121-948"><a href="#cb121-948" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower.tail =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-949"><a href="#cb121-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-950"><a href="#cb121-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-951"><a href="#cb121-951" aria-hidden="true" tabindex="-1"></a>confint_radius_t <span class="ot">=</span> </span>
<span id="cb121-952"><a href="#cb121-952" aria-hidden="true" tabindex="-1"></a>  se_hat <span class="sc">*</span> q_t</span>
<span id="cb121-953"><a href="#cb121-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-954"><a href="#cb121-954" aria-hidden="true" tabindex="-1"></a>confint_t <span class="ot">=</span> beta_hat <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> confint_radius_t</span>
<span id="cb121-955"><a href="#cb121-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-956"><a href="#cb121-956" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confint_t)</span>
<span id="cb121-957"><a href="#cb121-957" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-958"><a href="#cb121-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-959"><a href="#cb121-959" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-960"><a href="#cb121-960" aria-hidden="true" tabindex="-1"></a>This also matches.</span>
<span id="cb121-961"><a href="#cb121-961" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-962"><a href="#cb121-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-963"><a href="#cb121-963" aria-hidden="true" tabindex="-1"></a><span class="fu">### Gaussian approximations</span></span>
<span id="cb121-964"><a href="#cb121-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-965"><a href="#cb121-965" aria-hidden="true" tabindex="-1"></a>Here are the asymptotic (Gaussian approximation) equivalents:</span>
<span id="cb121-966"><a href="#cb121-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-967"><a href="#cb121-967" aria-hidden="true" tabindex="-1"></a><span class="fu">### P-values {.smaller}</span></span>
<span id="cb121-968"><a href="#cb121-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-971"><a href="#cb121-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-972"><a href="#cb121-972" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-973"><a href="#cb121-973" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">keep =</span> <span class="st">"sexmale:age"</span>) <span class="sc">|&gt;</span></span>
<span id="cb121-974"><a href="#cb121-974" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-975"><a href="#cb121-975" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-976"><a href="#cb121-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-977"><a href="#cb121-977" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-978"><a href="#cb121-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-981"><a href="#cb121-981" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-982"><a href="#cb121-982" aria-hidden="true" tabindex="-1"></a>pval_z <span class="ot">=</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(t_stat), <span class="at">lower =</span> <span class="cn">FALSE</span>) <span class="sc">*</span> <span class="dv">2</span></span>
<span id="cb121-983"><a href="#cb121-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-984"><a href="#cb121-984" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pval_z)</span>
<span id="cb121-985"><a href="#cb121-985" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-986"><a href="#cb121-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-987"><a href="#cb121-987" aria-hidden="true" tabindex="-1"></a><span class="fu">### Confidence intervals  {.smaller}</span></span>
<span id="cb121-988"><a href="#cb121-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-991"><a href="#cb121-991" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-992"><a href="#cb121-992" aria-hidden="true" tabindex="-1"></a>bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-993"><a href="#cb121-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">keep =</span> <span class="st">"sexmale:age"</span>) <span class="sc">|&gt;</span></span>
<span id="cb121-994"><a href="#cb121-994" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>(</span>
<span id="cb121-995"><a href="#cb121-995" aria-hidden="true" tabindex="-1"></a>    <span class="at">include_reference =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-996"><a href="#cb121-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-997"><a href="#cb121-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-998"><a href="#cb121-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1001"><a href="#cb121-1001" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1002"><a href="#cb121-1002" aria-hidden="true" tabindex="-1"></a>confint_radius_z <span class="ot">=</span> se_hat <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.975</span>, <span class="at">lower =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-1003"><a href="#cb121-1003" aria-hidden="true" tabindex="-1"></a>confint_z <span class="ot">=</span> </span>
<span id="cb121-1004"><a href="#cb121-1004" aria-hidden="true" tabindex="-1"></a>  beta_hat <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>) <span class="sc">*</span> confint_radius_z</span>
<span id="cb121-1005"><a href="#cb121-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(confint_z)</span>
<span id="cb121-1006"><a href="#cb121-1006" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1007"><a href="#cb121-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1008"><a href="#cb121-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">### Likelihood ratio statistics</span></span>
<span id="cb121-1009"><a href="#cb121-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1012"><a href="#cb121-1012" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1013"><a href="#cb121-1013" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(bw_lm2)</span>
<span id="cb121-1014"><a href="#cb121-1014" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(bw_lm1)</span>
<span id="cb121-1015"><a href="#cb121-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1016"><a href="#cb121-1016" aria-hidden="true" tabindex="-1"></a>lLR <span class="ot">=</span> (<span class="fu">logLik</span>(bw_lm2) <span class="sc">-</span> <span class="fu">logLik</span>(bw_lm1)) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb121-1017"><a href="#cb121-1017" aria-hidden="true" tabindex="-1"></a>delta_df <span class="ot">=</span> (bw_lm1<span class="sc">$</span>df.residual <span class="sc">-</span> <span class="fu">df.residual</span>(bw_lm2))</span>
<span id="cb121-1018"><a href="#cb121-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1019"><a href="#cb121-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1020"><a href="#cb121-1020" aria-hidden="true" tabindex="-1"></a>x_max <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb121-1021"><a href="#cb121-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1022"><a href="#cb121-1022" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1023"><a href="#cb121-1023" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1024"><a href="#cb121-1024" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1025"><a href="#cb121-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1028"><a href="#cb121-1028" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1029"><a href="#cb121-1029" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chisq-plot</span></span>
<span id="cb121-1030"><a href="#cb121-1030" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Chi-square distribution"</span></span>
<span id="cb121-1031"><a href="#cb121-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1032"><a href="#cb121-1032" aria-hidden="true" tabindex="-1"></a>d_lLR <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">df =</span> delta_df) <span class="fu">dchisq</span>(x, <span class="at">df =</span> df)</span>
<span id="cb121-1033"><a href="#cb121-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1034"><a href="#cb121-1034" aria-hidden="true" tabindex="-1"></a>chisq_plot <span class="ot">=</span> </span>
<span id="cb121-1035"><a href="#cb121-1035" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb121-1036"><a href="#cb121-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> d_lLR) <span class="sc">+</span></span>
<span id="cb121-1037"><a href="#cb121-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>( <span class="at">fun =</span> d_lLR, <span class="at">xlim =</span> <span class="fu">c</span>(lLR, x_max), <span class="at">geom =</span> <span class="st">"area"</span>, <span class="at">fill =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb121-1038"><a href="#cb121-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> lLR, <span class="at">xend =</span> lLR, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="fu">d_lLR</span>(lLR)), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb121-1039"><a href="#cb121-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.0001</span>,x_max) <span class="sc">+</span> </span>
<span id="cb121-1040"><a href="#cb121-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb121-1041"><a href="#cb121-1041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"p(X=x)"</span>) <span class="sc">+</span> </span>
<span id="cb121-1042"><a href="#cb121-1042" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"log(likelihood ratio) statistic [x]"</span>) <span class="sc">+</span></span>
<span id="cb121-1043"><a href="#cb121-1043" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb121-1044"><a href="#cb121-1044" aria-hidden="true" tabindex="-1"></a>chisq_plot <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb121-1045"><a href="#cb121-1045" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1046"><a href="#cb121-1046" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1047"><a href="#cb121-1047" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1048"><a href="#cb121-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1049"><a href="#cb121-1049" aria-hidden="true" tabindex="-1"></a>Now we can get the p-value:</span>
<span id="cb121-1050"><a href="#cb121-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1053"><a href="#cb121-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1054"><a href="#cb121-1054" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: LRT-pval</span></span>
<span id="cb121-1055"><a href="#cb121-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">pchisq</span>(</span>
<span id="cb121-1056"><a href="#cb121-1056" aria-hidden="true" tabindex="-1"></a>  <span class="at">q =</span> <span class="dv">2</span><span class="sc">*</span>lLR, </span>
<span id="cb121-1057"><a href="#cb121-1057" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> delta_df, </span>
<span id="cb121-1058"><a href="#cb121-1058" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb121-1059"><a href="#cb121-1059" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb121-1060"><a href="#cb121-1060" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1061"><a href="#cb121-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1062"><a href="#cb121-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1063"><a href="#cb121-1063" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1064"><a href="#cb121-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1065"><a href="#cb121-1065" aria-hidden="true" tabindex="-1"></a>In practice you don't have to do this by hand; there are functions to do it for you:</span>
<span id="cb121-1066"><a href="#cb121-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1069"><a href="#cb121-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1070"><a href="#cb121-1070" aria-hidden="true" tabindex="-1"></a><span class="co"># built in</span></span>
<span id="cb121-1071"><a href="#cb121-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb121-1072"><a href="#cb121-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(bw_lm2, bw_lm1)</span>
<span id="cb121-1073"><a href="#cb121-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1074"><a href="#cb121-1074" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1075"><a href="#cb121-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1076"><a href="#cb121-1076" aria-hidden="true" tabindex="-1"></a><span class="fu">## Goodness of fit</span></span>
<span id="cb121-1077"><a href="#cb121-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1078"><a href="#cb121-1078" aria-hidden="true" tabindex="-1"></a><span class="fu">### AIC and BIC</span></span>
<span id="cb121-1079"><a href="#cb121-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1080"><a href="#cb121-1080" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1081"><a href="#cb121-1081" aria-hidden="true" tabindex="-1"></a>When we use likelihood ratio tests, we are comparing how well different models fit the data.</span>
<span id="cb121-1082"><a href="#cb121-1082" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1083"><a href="#cb121-1083" aria-hidden="true" tabindex="-1"></a>Likelihood ratio tests require "nested" models: one must be a special case of the other.</span>
<span id="cb121-1084"><a href="#cb121-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1085"><a href="#cb121-1085" aria-hidden="true" tabindex="-1"></a>If we have non-nested models, we can instead use the Akaike Information Criterion (AIC) or Bayesian Information Criterion (BIC):</span>
<span id="cb121-1086"><a href="#cb121-1086" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1087"><a href="#cb121-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1088"><a href="#cb121-1088" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>AIC = $-2 * \ell(\hat\theta) + 2 * p$</span>
<span id="cb121-1089"><a href="#cb121-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1090"><a href="#cb121-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BIC = $-2 * \ell(\hat\theta) + p * \text{log}(n)$</span>
<span id="cb121-1091"><a href="#cb121-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1092"><a href="#cb121-1092" aria-hidden="true" tabindex="-1"></a>where $\ell$ is the log-likelihood of the data evaluated using the parameter estimates $\hat\theta$, $p$ is the number of estimated parameters in the model (including $\hat\sigma^2$), and $n$ is the number of observations.</span>
<span id="cb121-1093"><a href="#cb121-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1094"><a href="#cb121-1094" aria-hidden="true" tabindex="-1"></a>You can calculate these criteria using the <span class="in">`logLik()`</span> function, or use the built-in R functions:</span>
<span id="cb121-1095"><a href="#cb121-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1096"><a href="#cb121-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">#### AIC in R</span></span>
<span id="cb121-1097"><a href="#cb121-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1100"><a href="#cb121-1100" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1101"><a href="#cb121-1101" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(bw_lm2) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() <span class="sc">+</span> </span>
<span id="cb121-1102"><a href="#cb121-1102" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="sc">*</span>(<span class="fu">length</span>(<span class="fu">coef</span>(bw_lm2))<span class="sc">+</span><span class="dv">1</span>) <span class="co"># sigma counts as a parameter here</span></span>
<span id="cb121-1103"><a href="#cb121-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1104"><a href="#cb121-1104" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(bw_lm2)</span>
<span id="cb121-1105"><a href="#cb121-1105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1106"><a href="#cb121-1106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1107"><a href="#cb121-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1108"><a href="#cb121-1108" aria-hidden="true" tabindex="-1"></a><span class="fu">#### BIC in R</span></span>
<span id="cb121-1109"><a href="#cb121-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1112"><a href="#cb121-1112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1113"><a href="#cb121-1113" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">logLik</span>(bw_lm2) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>() <span class="sc">+</span> </span>
<span id="cb121-1114"><a href="#cb121-1114" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">length</span>(<span class="fu">coef</span>(bw_lm2))<span class="sc">+</span><span class="dv">1</span>) <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">nobs</span>(bw_lm2))</span>
<span id="cb121-1115"><a href="#cb121-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1116"><a href="#cb121-1116" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(bw_lm2)</span>
<span id="cb121-1117"><a href="#cb121-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1118"><a href="#cb121-1118" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1119"><a href="#cb121-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1120"><a href="#cb121-1120" aria-hidden="true" tabindex="-1"></a>Large values of AIC and BIC are worse than small values. There are no hypothesis tests or p-values associated with these criteria.</span>
<span id="cb121-1121"><a href="#cb121-1121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1122"><a href="#cb121-1122" aria-hidden="true" tabindex="-1"></a><span class="fu">### (Residual) Deviance</span></span>
<span id="cb121-1123"><a href="#cb121-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1124"><a href="#cb121-1124" aria-hidden="true" tabindex="-1"></a>Let $q$ be the number of distinct covariate combinations in a data set.</span>
<span id="cb121-1125"><a href="#cb121-1125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1128"><a href="#cb121-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1129"><a href="#cb121-1129" aria-hidden="true" tabindex="-1"></a>bw.X.unique <span class="ot">=</span> </span>
<span id="cb121-1130"><a href="#cb121-1130" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1131"><a href="#cb121-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, age)</span>
<span id="cb121-1132"><a href="#cb121-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1133"><a href="#cb121-1133" aria-hidden="true" tabindex="-1"></a>n_unique.bw  <span class="ot">=</span> <span class="fu">nrow</span>(bw.X.unique)</span>
<span id="cb121-1134"><a href="#cb121-1134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1135"><a href="#cb121-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1136"><a href="#cb121-1136" aria-hidden="true" tabindex="-1"></a>For example, in the <span class="in">`birthweight`</span> data, there are $q = <span class="in">`r n_unique.bw`</span>$ unique patterns (@tbl-bw-x-combos).</span>
<span id="cb121-1137"><a href="#cb121-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1140"><a href="#cb121-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1141"><a href="#cb121-1141" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Unique covariate combinations in the `birthweight` data, with replicate counts"</span></span>
<span id="cb121-1142"><a href="#cb121-1142" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-bw-x-combos</span></span>
<span id="cb121-1143"><a href="#cb121-1143" aria-hidden="true" tabindex="-1"></a>bw.X.unique</span>
<span id="cb121-1144"><a href="#cb121-1144" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1145"><a href="#cb121-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1146"><a href="#cb121-1146" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1147"><a href="#cb121-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1148"><a href="#cb121-1148" aria-hidden="true" tabindex="-1"></a>::: {#def-replicates}</span>
<span id="cb121-1149"><a href="#cb121-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Replicates</span></span>
<span id="cb121-1150"><a href="#cb121-1150" aria-hidden="true" tabindex="-1"></a>If a given covariate pattern has more than one observation in a dataset, those observations are called **replicates**.</span>
<span id="cb121-1151"><a href="#cb121-1151" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1152"><a href="#cb121-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1153"><a href="#cb121-1153" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1154"><a href="#cb121-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1155"><a href="#cb121-1155" aria-hidden="true" tabindex="-1"></a>::: {#exm-replicate-bw}</span>
<span id="cb121-1156"><a href="#cb121-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1157"><a href="#cb121-1157" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Replicates in the `birthweight` data</span></span>
<span id="cb121-1158"><a href="#cb121-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1159"><a href="#cb121-1159" aria-hidden="true" tabindex="-1"></a>In the <span class="in">`birthweight`</span> dataset, there are 2 replicates of the combination "female, age 36" (@tbl-bw-x-combos).</span>
<span id="cb121-1160"><a href="#cb121-1160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1161"><a href="#cb121-1161" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1162"><a href="#cb121-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1163"><a href="#cb121-1163" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1164"><a href="#cb121-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1165"><a href="#cb121-1165" aria-hidden="true" tabindex="-1"></a>::: {#exr-replicate-bw}</span>
<span id="cb121-1166"><a href="#cb121-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1167"><a href="#cb121-1167" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Replicates in the `birthweight` data</span></span>
<span id="cb121-1168"><a href="#cb121-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1169"><a href="#cb121-1169" aria-hidden="true" tabindex="-1"></a>Which covariate pattern(s) in the <span class="in">`birthweight`</span> data has the most replicates?</span>
<span id="cb121-1170"><a href="#cb121-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1171"><a href="#cb121-1171" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1172"><a href="#cb121-1172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1173"><a href="#cb121-1173" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1174"><a href="#cb121-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1175"><a href="#cb121-1175" aria-hidden="true" tabindex="-1"></a>::: {#sol-replicate-bw}</span>
<span id="cb121-1176"><a href="#cb121-1176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1177"><a href="#cb121-1177" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Replicates in the `birthweight` data</span></span>
<span id="cb121-1178"><a href="#cb121-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1179"><a href="#cb121-1179" aria-hidden="true" tabindex="-1"></a>Two covariate patterns are tied for most replicates: males at age 40 weeks </span>
<span id="cb121-1180"><a href="#cb121-1180" aria-hidden="true" tabindex="-1"></a>and females at age 40 weeks.</span>
<span id="cb121-1181"><a href="#cb121-1181" aria-hidden="true" tabindex="-1"></a>40 weeks is the usual length for human pregnancy (@polin2011fetal), so this result makes sense.</span>
<span id="cb121-1182"><a href="#cb121-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1185"><a href="#cb121-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1186"><a href="#cb121-1186" aria-hidden="true" tabindex="-1"></a>bw.X.unique <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(n <span class="sc">==</span> <span class="fu">max</span>(n))</span>
<span id="cb121-1187"><a href="#cb121-1187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1188"><a href="#cb121-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1189"><a href="#cb121-1189" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1190"><a href="#cb121-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1191"><a href="#cb121-1191" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1192"><a href="#cb121-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1193"><a href="#cb121-1193" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Saturated models {.smaller}</span></span>
<span id="cb121-1194"><a href="#cb121-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1195"><a href="#cb121-1195" aria-hidden="true" tabindex="-1"></a>The most complicated model we could fit would have one parameter (a mean) for each covariate pattern, plus a variance parameter:</span>
<span id="cb121-1196"><a href="#cb121-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1199"><a href="#cb121-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1200"><a href="#cb121-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-bw-model-sat</span></span>
<span id="cb121-1201"><a href="#cb121-1201" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Saturated model for the `birthweight` data"</span></span>
<span id="cb121-1202"><a href="#cb121-1202" aria-hidden="true" tabindex="-1"></a>lm_max <span class="ot">=</span> </span>
<span id="cb121-1203"><a href="#cb121-1203" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1204"><a href="#cb121-1204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">factor</span>(age)) <span class="sc">|&gt;</span> </span>
<span id="cb121-1205"><a href="#cb121-1205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(</span>
<span id="cb121-1206"><a href="#cb121-1206" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> weight <span class="sc">~</span> sex<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>, </span>
<span id="cb121-1207"><a href="#cb121-1207" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _)</span>
<span id="cb121-1208"><a href="#cb121-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1209"><a href="#cb121-1209" aria-hidden="true" tabindex="-1"></a>lm_max <span class="sc">|&gt;</span> </span>
<span id="cb121-1210"><a href="#cb121-1210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span> </span>
<span id="cb121-1211"><a href="#cb121-1211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb121-1212"><a href="#cb121-1212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1213"><a href="#cb121-1213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1214"><a href="#cb121-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1215"><a href="#cb121-1215" aria-hidden="true" tabindex="-1"></a>We call this model the **full**, **maximal**, or **saturated** model for this dataset.</span>
<span id="cb121-1216"><a href="#cb121-1216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1217"><a href="#cb121-1217" aria-hidden="true" tabindex="-1"></a>We can calculate the log-likelihood of this model as usual:</span>
<span id="cb121-1218"><a href="#cb121-1218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1221"><a href="#cb121-1221" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1222"><a href="#cb121-1222" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(lm_max)</span>
<span id="cb121-1223"><a href="#cb121-1223" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1224"><a href="#cb121-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1225"><a href="#cb121-1225" aria-hidden="true" tabindex="-1"></a>We can compare this model to our other models using chi-square tests, as usual:</span>
<span id="cb121-1226"><a href="#cb121-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1229"><a href="#cb121-1229" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1230"><a href="#cb121-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(lm_max, bw_lm2)</span>
<span id="cb121-1231"><a href="#cb121-1231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1232"><a href="#cb121-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1233"><a href="#cb121-1233" aria-hidden="true" tabindex="-1"></a>The likelihood ratio statistic for this test is $$\lambda = 2 * (\ell_{\text{full}} - \ell) = <span class="in">`r 2 * (logLik(lm_max) - logLik(bw_lm2))`</span>$$ where:</span>
<span id="cb121-1234"><a href="#cb121-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1235"><a href="#cb121-1235" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell_{\text{max}}$ is the log-likelihood of the full model: <span class="in">`r logLik(lm_max)`</span></span>
<span id="cb121-1236"><a href="#cb121-1236" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell$ is the log-likelihood of our comparison model (two slopes, two intercepts): <span class="in">`r logLik(bw_lm2)`</span></span>
<span id="cb121-1237"><a href="#cb121-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1238"><a href="#cb121-1238" aria-hidden="true" tabindex="-1"></a>This statistic is called the **deviance** or **residual deviance** for our two-slopes and two-intercepts model; it tells us how much the likelihood of that model deviates from the likelihood of the maximal model.</span>
<span id="cb121-1239"><a href="#cb121-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1240"><a href="#cb121-1240" aria-hidden="true" tabindex="-1"></a>The corresponding p-value tells us whether there we have enough evidence to detect that our two-slopes, two-intercepts model is a worse fit for the data than the maximal model; in other words, it tells us if there's evidence that we missed any important patterns. (Remember, a nonsignificant p-value could mean that we didn't miss anything and a more complicated model is unnecessary, or it could mean we just don't have enough data to tell the difference between these models.)</span>
<span id="cb121-1241"><a href="#cb121-1241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1242"><a href="#cb121-1242" aria-hidden="true" tabindex="-1"></a><span class="fu">### Null Deviance</span></span>
<span id="cb121-1243"><a href="#cb121-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1244"><a href="#cb121-1244" aria-hidden="true" tabindex="-1"></a>Similarly, the *least* complicated model we could fit would have only one mean parameter, an intercept:</span>
<span id="cb121-1245"><a href="#cb121-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1246"><a href="#cb121-1246" aria-hidden="true" tabindex="-1"></a>$$\text E<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> = \beta_0$$ We can fit this model in R like so:</span>
<span id="cb121-1247"><a href="#cb121-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1250"><a href="#cb121-1250" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1251"><a href="#cb121-1251" aria-hidden="true" tabindex="-1"></a>lm0 <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> bw)</span>
<span id="cb121-1252"><a href="#cb121-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1253"><a href="#cb121-1253" aria-hidden="true" tabindex="-1"></a>lm0 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-1254"><a href="#cb121-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1255"><a href="#cb121-1255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1256"><a href="#cb121-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1257"><a href="#cb121-1257" aria-hidden="true" tabindex="-1"></a>This model also has a likelihood:</span>
<span id="cb121-1258"><a href="#cb121-1258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1261"><a href="#cb121-1261" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1262"><a href="#cb121-1262" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(lm0)</span>
<span id="cb121-1263"><a href="#cb121-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1264"><a href="#cb121-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1265"><a href="#cb121-1265" aria-hidden="true" tabindex="-1"></a>And we can compare it to more complicated models using a likelihood ratio test:</span>
<span id="cb121-1266"><a href="#cb121-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1269"><a href="#cb121-1269" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1270"><a href="#cb121-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(bw_lm2, lm0)</span>
<span id="cb121-1271"><a href="#cb121-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1272"><a href="#cb121-1272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1273"><a href="#cb121-1273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1274"><a href="#cb121-1274" aria-hidden="true" tabindex="-1"></a>The likelihood ratio statistic for the test comparing the null model to the maximal model is $$\lambda = 2 * (\ell_{\text{full}} - \ell_{0}) = <span class="in">`r 2 * (logLik(lm_max) - logLik(lm0))`</span>$$ where:</span>
<span id="cb121-1275"><a href="#cb121-1275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1276"><a href="#cb121-1276" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell_{\text{0}}$ is the log-likelihood of the null model: <span class="in">`r logLik(lm0)`</span></span>
<span id="cb121-1277"><a href="#cb121-1277" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\ell_{\text{full}}$ is the log-likelihood of the maximal model: <span class="in">`r logLik(lm_max)`</span></span>
<span id="cb121-1278"><a href="#cb121-1278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1279"><a href="#cb121-1279" aria-hidden="true" tabindex="-1"></a>In R, this test is:</span>
<span id="cb121-1280"><a href="#cb121-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1283"><a href="#cb121-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1284"><a href="#cb121-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">lrtest</span>(lm_max, lm0)</span>
<span id="cb121-1285"><a href="#cb121-1285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1286"><a href="#cb121-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1287"><a href="#cb121-1287" aria-hidden="true" tabindex="-1"></a>This log-likelihood ratio statistic is called the **null deviance**. It tells us whether we have enough data to detect a difference between the null and full models.</span>
<span id="cb121-1288"><a href="#cb121-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1289"><a href="#cb121-1289" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rescaling</span></span>
<span id="cb121-1290"><a href="#cb121-1290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1291"><a href="#cb121-1291" aria-hidden="true" tabindex="-1"></a><span class="fu">### Rescale age {.smaller}</span></span>
<span id="cb121-1292"><a href="#cb121-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1295"><a href="#cb121-1295" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1296"><a href="#cb121-1296" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-1297"><a href="#cb121-1297" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span></span>
<span id="cb121-1298"><a href="#cb121-1298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-1299"><a href="#cb121-1299" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">age - mean</span><span class="st">`</span> <span class="ot">=</span> age <span class="sc">-</span> <span class="fu">mean</span>(age),</span>
<span id="cb121-1300"><a href="#cb121-1300" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span> <span class="ot">=</span> age <span class="sc">-</span> <span class="dv">36</span></span>
<span id="cb121-1301"><a href="#cb121-1301" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-1302"><a href="#cb121-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1303"><a href="#cb121-1303" aria-hidden="true" tabindex="-1"></a>lm1c <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> <span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span>, <span class="at">data =</span> bw)</span>
<span id="cb121-1304"><a href="#cb121-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1305"><a href="#cb121-1305" aria-hidden="true" tabindex="-1"></a>lm2c <span class="ot">=</span> <span class="fu">lm</span>(weight <span class="sc">~</span> sex <span class="sc">+</span> <span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span> <span class="sc">+</span> sex<span class="sc">:</span><span class="st">`</span><span class="at">age - 36wks</span><span class="st">`</span>, <span class="at">data =</span> bw)</span>
<span id="cb121-1306"><a href="#cb121-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1307"><a href="#cb121-1307" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(lm2c, <span class="at">ci_method =</span> <span class="st">"wald"</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-1308"><a href="#cb121-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1309"><a href="#cb121-1309" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1310"><a href="#cb121-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1311"><a href="#cb121-1311" aria-hidden="true" tabindex="-1"></a>Compare with what we got without rescaling:</span>
<span id="cb121-1312"><a href="#cb121-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1315"><a href="#cb121-1315" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1316"><a href="#cb121-1316" aria-hidden="true" tabindex="-1"></a><span class="fu">parameters</span>(bw_lm2, <span class="at">ci_method =</span> <span class="st">"wald"</span>) <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-1317"><a href="#cb121-1317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1318"><a href="#cb121-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1319"><a href="#cb121-1319" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prediction</span></span>
<span id="cb121-1320"><a href="#cb121-1320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1321"><a href="#cb121-1321" aria-hidden="true" tabindex="-1"></a><span class="fu">### Prediction for linear models</span></span>
<span id="cb121-1322"><a href="#cb121-1322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1323"><a href="#cb121-1323" aria-hidden="true" tabindex="-1"></a>:::{#def-predicted-value}</span>
<span id="cb121-1324"><a href="#cb121-1324" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Predicted value</span></span>
<span id="cb121-1325"><a href="#cb121-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1326"><a href="#cb121-1326" aria-hidden="true" tabindex="-1"></a>In a regression model $\p(y|x)$, the **predicted value** of $y$ given $x$ is the estimated mean of $Y$ given $X$:</span>
<span id="cb121-1327"><a href="#cb121-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1328"><a href="#cb121-1328" aria-hidden="true" tabindex="-1"></a>$$\hat y \eqdef \hE{Y|X=x}$$</span>
<span id="cb121-1329"><a href="#cb121-1329" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1330"><a href="#cb121-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1331"><a href="#cb121-1331" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1332"><a href="#cb121-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1333"><a href="#cb121-1333" aria-hidden="true" tabindex="-1"></a>For linear models, the predicted value can be straightforwardly calculated by multiplying each predictor value $x_j$ by its corresponding coefficient $\beta_j$ and adding up the results:</span>
<span id="cb121-1334"><a href="#cb121-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1335"><a href="#cb121-1335" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1336"><a href="#cb121-1336" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb121-1337"><a href="#cb121-1337" aria-hidden="true" tabindex="-1"></a>\hat Y &amp;= \hat E<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> <span class="sc">\\</span></span>
<span id="cb121-1338"><a href="#cb121-1338" aria-hidden="true" tabindex="-1"></a>&amp;= x'\hat\beta <span class="sc">\\</span></span>
<span id="cb121-1339"><a href="#cb121-1339" aria-hidden="true" tabindex="-1"></a>&amp;= \hat\beta_0\cdot 1 + \hat\beta_1 x_1 + ... + \hat\beta_p x_p</span>
<span id="cb121-1340"><a href="#cb121-1340" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb121-1341"><a href="#cb121-1341" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1342"><a href="#cb121-1342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1343"><a href="#cb121-1343" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1344"><a href="#cb121-1344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1345"><a href="#cb121-1345" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: prediction for the `birthweight` data</span></span>
<span id="cb121-1346"><a href="#cb121-1346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1349"><a href="#cb121-1349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1350"><a href="#cb121-1350" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">40</span>)</span>
<span id="cb121-1351"><a href="#cb121-1351" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(X <span class="sc">*</span> <span class="fu">coef</span>(bw_lm1))</span>
<span id="cb121-1352"><a href="#cb121-1352" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1353"><a href="#cb121-1353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1354"><a href="#cb121-1354" aria-hidden="true" tabindex="-1"></a>R has built-in functions for prediction:</span>
<span id="cb121-1357"><a href="#cb121-1357" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1358"><a href="#cb121-1358" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="dv">40</span>, <span class="at">sex =</span> <span class="st">"male"</span>)</span>
<span id="cb121-1359"><a href="#cb121-1359" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> <span class="fu">predict</span>(<span class="at">newdata =</span> x)</span>
<span id="cb121-1360"><a href="#cb121-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1361"><a href="#cb121-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1362"><a href="#cb121-1362" aria-hidden="true" tabindex="-1"></a>If you don't provide <span class="in">`newdata`</span>, R will use the covariate values from the original dataset:</span>
<span id="cb121-1363"><a href="#cb121-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1366"><a href="#cb121-1366" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1367"><a href="#cb121-1367" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(bw_lm1)</span>
<span id="cb121-1368"><a href="#cb121-1368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1369"><a href="#cb121-1369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1370"><a href="#cb121-1370" aria-hidden="true" tabindex="-1"></a>These special predictions are called the *fitted values* of the dataset:</span>
<span id="cb121-1371"><a href="#cb121-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1372"><a href="#cb121-1372" aria-hidden="true" tabindex="-1"></a>:::{#def-fitted-value}</span>
<span id="cb121-1373"><a href="#cb121-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1374"><a href="#cb121-1374" aria-hidden="true" tabindex="-1"></a>For a given dataset $(\vY, \mX)$ and corresponding fitted model $\p_{\hb}(\vy|\mx)$, the **fitted value** of $y_i$ is the predicted value of $y$ when $\vX=\vx_i$ using the estimate parameters $\hb$.</span>
<span id="cb121-1375"><a href="#cb121-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1376"><a href="#cb121-1376" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1377"><a href="#cb121-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1378"><a href="#cb121-1378" aria-hidden="true" tabindex="-1"></a>R has an extra function to get these values:</span>
<span id="cb121-1379"><a href="#cb121-1379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1382"><a href="#cb121-1382" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1383"><a href="#cb121-1383" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(bw_lm1)</span>
<span id="cb121-1384"><a href="#cb121-1384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1385"><a href="#cb121-1385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1386"><a href="#cb121-1386" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quantifying uncertainty in predictions</span></span>
<span id="cb121-1387"><a href="#cb121-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1390"><a href="#cb121-1390" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1391"><a href="#cb121-1391" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> </span>
<span id="cb121-1392"><a href="#cb121-1392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb121-1393"><a href="#cb121-1393" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> x,</span>
<span id="cb121-1394"><a href="#cb121-1394" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb121-1395"><a href="#cb121-1395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1396"><a href="#cb121-1396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1397"><a href="#cb121-1397" aria-hidden="true" tabindex="-1"></a>The output of <span class="in">`predict.lm(se.fit = TRUE)`</span> is a <span class="in">`list()`</span>; </span>
<span id="cb121-1398"><a href="#cb121-1398" aria-hidden="true" tabindex="-1"></a>you can extract the elements with <span class="in">`$`</span> or <span class="in">`magrittr::use_series()`</span>:</span>
<span id="cb121-1399"><a href="#cb121-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1402"><a href="#cb121-1402" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1403"><a href="#cb121-1403" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb121-1404"><a href="#cb121-1404" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> </span>
<span id="cb121-1405"><a href="#cb121-1405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(</span>
<span id="cb121-1406"><a href="#cb121-1406" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> x,</span>
<span id="cb121-1407"><a href="#cb121-1407" aria-hidden="true" tabindex="-1"></a>    <span class="at">se.fit =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb121-1408"><a href="#cb121-1408" aria-hidden="true" tabindex="-1"></a>  magrittr<span class="sc">::</span><span class="fu">use_series</span>(se.fit)</span>
<span id="cb121-1409"><a href="#cb121-1409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1410"><a href="#cb121-1410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1411"><a href="#cb121-1411" aria-hidden="true" tabindex="-1"></a>You can get **confidence intervals** for $\E{Y|X=x}$:</span>
<span id="cb121-1412"><a href="#cb121-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1415"><a href="#cb121-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```{R}</span></span>
<span id="cb121-1416"><a href="#cb121-1416" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb121-1417"><a href="#cb121-1417" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> x,</span>
<span id="cb121-1418"><a href="#cb121-1418" aria-hidden="true" tabindex="-1"></a>  <span class="at">interval =</span> <span class="st">"confidence"</span>)</span>
<span id="cb121-1419"><a href="#cb121-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1420"><a href="#cb121-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1421"><a href="#cb121-1421" aria-hidden="true" tabindex="-1"></a>You can also get **prediction intervals** for the value of an individual outcome $Y$:</span>
<span id="cb121-1422"><a href="#cb121-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1425"><a href="#cb121-1425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1426"><a href="#cb121-1426" aria-hidden="true" tabindex="-1"></a>bw_lm1 <span class="sc">|&gt;</span> </span>
<span id="cb121-1427"><a href="#cb121-1427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">newdata =</span> x, <span class="at">interval =</span> <span class="st">"predict"</span>)</span>
<span id="cb121-1428"><a href="#cb121-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1429"><a href="#cb121-1429" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1430"><a href="#cb121-1430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1431"><a href="#cb121-1431" aria-hidden="true" tabindex="-1"></a>The warning from the last command is: "predictions on current data refer to *future* responses" (since you already know what happened to the current data, and thus don't need to predict it).</span>
<span id="cb121-1432"><a href="#cb121-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1433"><a href="#cb121-1433" aria-hidden="true" tabindex="-1"></a>See <span class="in">`?predict.lm`</span> for more.</span>
<span id="cb121-1434"><a href="#cb121-1434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1435"><a href="#cb121-1435" aria-hidden="true" tabindex="-1"></a><span class="fu">## Diagnostics {#sec-diagnose-LMs}</span></span>
<span id="cb121-1436"><a href="#cb121-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1437"><a href="#cb121-1437" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb121-1438"><a href="#cb121-1438" aria-hidden="true" tabindex="-1"></a>This section is adapted from @dobson4e <span class="co">[</span><span class="ot">§6.2-6.3</span><span class="co">]</span> and </span>
<span id="cb121-1439"><a href="#cb121-1439" aria-hidden="true" tabindex="-1"></a>@dunn2018generalized <span class="co">[</span><span class="ot">Chapter 3</span><span class="co">](https://link.springer.com/chapter/10.1007/978-1-4419-0118-7_3)</span>.</span>
<span id="cb121-1440"><a href="#cb121-1440" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1441"><a href="#cb121-1441" aria-hidden="true" tabindex="-1"></a><span class="fu">### Assumptions in linear regression models {.smaller .scrollable}</span></span>
<span id="cb121-1442"><a href="#cb121-1442" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1443"><a href="#cb121-1443" aria-hidden="true" tabindex="-1"></a>$$Y|\vX \simind N(\vX'\b,\ss)$$</span>
<span id="cb121-1444"><a href="#cb121-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1445"><a href="#cb121-1445" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Normality: The distribution conditional on a given $X$ value is normal</span>
<span id="cb121-1446"><a href="#cb121-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1447"><a href="#cb121-1447" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Correct Functional Form: The conditional means have the structure </span>
<span id="cb121-1448"><a href="#cb121-1448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1449"><a href="#cb121-1449" aria-hidden="true" tabindex="-1"></a>$$E<span class="co">[</span><span class="ot">Y|\vec X = \vec x</span><span class="co">]</span> = \vec x'\beta$$</span>
<span id="cb121-1450"><a href="#cb121-1450" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Homoskedasticity: The variance $\ss$ is constant (with respect to $\vx$)</span>
<span id="cb121-1451"><a href="#cb121-1451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1452"><a href="#cb121-1452" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Independence: The observations are statistically independent</span>
<span id="cb121-1453"><a href="#cb121-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1454"><a href="#cb121-1454" aria-hidden="true" tabindex="-1"></a><span class="fu">### Direct visualization</span></span>
<span id="cb121-1455"><a href="#cb121-1455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1456"><a href="#cb121-1456" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1457"><a href="#cb121-1457" aria-hidden="true" tabindex="-1"></a>The most direct way to examine the fit of a model is to compare it to the raw observed data.</span>
<span id="cb121-1458"><a href="#cb121-1458" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1459"><a href="#cb121-1459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1462"><a href="#cb121-1462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1463"><a href="#cb121-1463" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-bw-interaction2</span></span>
<span id="cb121-1464"><a href="#cb121-1464" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Birthweight model with interaction term"</span></span>
<span id="cb121-1465"><a href="#cb121-1465" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-1466"><a href="#cb121-1466" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1467"><a href="#cb121-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-1468"><a href="#cb121-1468" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(bw_lm2)</span>
<span id="cb121-1469"><a href="#cb121-1469" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb121-1470"><a href="#cb121-1470" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(sex, age)</span>
<span id="cb121-1471"><a href="#cb121-1471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1472"><a href="#cb121-1472" aria-hidden="true" tabindex="-1"></a>plot1_interact <span class="ot">=</span> </span>
<span id="cb121-1473"><a href="#cb121-1473" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">%+%</span> bw <span class="sc">+</span></span>
<span id="cb121-1474"><a href="#cb121-1474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predlm2))</span>
<span id="cb121-1475"><a href="#cb121-1475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1476"><a href="#cb121-1476" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1_interact)</span>
<span id="cb121-1477"><a href="#cb121-1477" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1478"><a href="#cb121-1478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1479"><a href="#cb121-1479" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1480"><a href="#cb121-1480" aria-hidden="true" tabindex="-1"></a>It's not easy to assess these assumptions from this model.</span>
<span id="cb121-1481"><a href="#cb121-1481" aria-hidden="true" tabindex="-1"></a>If there are multiple continuous covariates, it becomes even harder to visualize the raw data.</span>
<span id="cb121-1482"><a href="#cb121-1482" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1483"><a href="#cb121-1483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1484"><a href="#cb121-1484" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residuals</span></span>
<span id="cb121-1485"><a href="#cb121-1485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1486"><a href="#cb121-1486" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1487"><a href="#cb121-1487" aria-hidden="true" tabindex="-1"></a>Maybe we can transform the data and model in some way to make it easier to inspect.</span>
<span id="cb121-1488"><a href="#cb121-1488" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1489"><a href="#cb121-1489" aria-hidden="true" tabindex="-1"></a>:::{#def-resid-noise}</span>
<span id="cb121-1490"><a href="#cb121-1490" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residual noise</span></span>
<span id="cb121-1491"><a href="#cb121-1491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1492"><a href="#cb121-1492" aria-hidden="true" tabindex="-1"></a>The **residual noise** in a probabilistic model $p(Y)$ is the difference between an observed value $y$ and its distributional mean:</span>
<span id="cb121-1493"><a href="#cb121-1493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1494"><a href="#cb121-1494" aria-hidden="true" tabindex="-1"></a>$$\eps(y) \eqdef y - \Exp{Y}$$ {#eq-def-resid}</span>
<span id="cb121-1495"><a href="#cb121-1495" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1496"><a href="#cb121-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1497"><a href="#cb121-1497" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-1498"><a href="#cb121-1498" aria-hidden="true" tabindex="-1"></a>We use the same notation for residual noise that we used for <span class="co">[</span><span class="ot">errors</span><span class="co">](estimation.qmd#def-error)</span>. </span>
<span id="cb121-1499"><a href="#cb121-1499" aria-hidden="true" tabindex="-1"></a>$\Exp{Y}$ can be viewed as an estimate of $Y$, before $y$ is observed.</span>
<span id="cb121-1500"><a href="#cb121-1500" aria-hidden="true" tabindex="-1"></a>Conversely, each observation $y$ can be viewed as an estimate of $\Exp{Y}$ (albeit an imprecise one, individually, since $n=1$). </span>
<span id="cb121-1501"><a href="#cb121-1501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1502"><a href="#cb121-1502" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1503"><a href="#cb121-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1504"><a href="#cb121-1504" aria-hidden="true" tabindex="-1"></a>We can rearrange @eq-def-resid to view $y$ as the sum of its mean plus the residual noise:</span>
<span id="cb121-1505"><a href="#cb121-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1506"><a href="#cb121-1506" aria-hidden="true" tabindex="-1"></a>$$y = \Exp{Y} + \eps{y}$$</span>
<span id="cb121-1507"><a href="#cb121-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1508"><a href="#cb121-1508" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1509"><a href="#cb121-1509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1510"><a href="#cb121-1510" aria-hidden="true" tabindex="-1"></a>:::{#thm-gaussian-resid-noise}</span>
<span id="cb121-1511"><a href="#cb121-1511" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residuals in Gaussian models</span></span>
<span id="cb121-1512"><a href="#cb121-1512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1513"><a href="#cb121-1513" aria-hidden="true" tabindex="-1"></a>If $Y$ has a Gaussian distribution, then $\err(Y)$ also has a Gaussian distribution, and vice versa.</span>
<span id="cb121-1514"><a href="#cb121-1514" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1515"><a href="#cb121-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1516"><a href="#cb121-1516" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb121-1517"><a href="#cb121-1517" aria-hidden="true" tabindex="-1"></a>Left to the reader.</span>
<span id="cb121-1518"><a href="#cb121-1518" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1519"><a href="#cb121-1519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1520"><a href="#cb121-1520" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1521"><a href="#cb121-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1522"><a href="#cb121-1522" aria-hidden="true" tabindex="-1"></a>:::{#def-resid-fitted}</span>
<span id="cb121-1523"><a href="#cb121-1523" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residual errors of a fitted model value</span></span>
<span id="cb121-1524"><a href="#cb121-1524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1525"><a href="#cb121-1525" aria-hidden="true" tabindex="-1"></a>The **residual of a fitted value $\hat y$** (shorthand: "residual") is its <span class="co">[</span><span class="ot">error</span><span class="co">](estimation.qmd#def-error)</span>:</span>
<span id="cb121-1526"><a href="#cb121-1526" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1527"><a href="#cb121-1527" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-1528"><a href="#cb121-1528" aria-hidden="true" tabindex="-1"></a>e(\hat y) &amp;\eqdef \erf{\hat y}</span>
<span id="cb121-1529"><a href="#cb121-1529" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span>&amp;= y - \hat y</span>
<span id="cb121-1530"><a href="#cb121-1530" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-1531"><a href="#cb121-1531" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1532"><a href="#cb121-1532" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1533"><a href="#cb121-1533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1534"><a href="#cb121-1534" aria-hidden="true" tabindex="-1"></a>$e(\hat y)$ can be seen as the maximum likelihood estimate of the residual noise:</span>
<span id="cb121-1535"><a href="#cb121-1535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1536"><a href="#cb121-1536" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1537"><a href="#cb121-1537" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-1538"><a href="#cb121-1538" aria-hidden="true" tabindex="-1"></a>e(\hy) &amp;= y - \hat y</span>
<span id="cb121-1539"><a href="#cb121-1539" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \hat\eps_{ML}</span>
<span id="cb121-1540"><a href="#cb121-1540" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-1541"><a href="#cb121-1541" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1542"><a href="#cb121-1542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1543"><a href="#cb121-1543" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1544"><a href="#cb121-1544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1545"><a href="#cb121-1545" aria-hidden="true" tabindex="-1"></a><span class="fu">#### General characteristics of residuals</span></span>
<span id="cb121-1546"><a href="#cb121-1546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1547"><a href="#cb121-1547" aria-hidden="true" tabindex="-1"></a>:::{#thm-resid-unbiased}</span>
<span id="cb121-1548"><a href="#cb121-1548" aria-hidden="true" tabindex="-1"></a>For <span class="co">[</span><span class="ot">unbiased</span><span class="co">](estimation.qmd#sec-unbiased-estimators)</span> estimators $\hth$:</span>
<span id="cb121-1549"><a href="#cb121-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1550"><a href="#cb121-1550" aria-hidden="true" tabindex="-1"></a>$$\E{e(y)} = 0$$ {#eq-mean-resid-unbiased}</span>
<span id="cb121-1551"><a href="#cb121-1551" aria-hidden="true" tabindex="-1"></a>$$\Var{e(y)} \approx \ss$$ {#eq-var-resid-unbiased}</span>
<span id="cb121-1552"><a href="#cb121-1552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1553"><a href="#cb121-1553" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1554"><a href="#cb121-1554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1555"><a href="#cb121-1555" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb121-1556"><a href="#cb121-1556" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb121-1557"><a href="#cb121-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1558"><a href="#cb121-1558" aria-hidden="true" tabindex="-1"></a>@eq-mean-resid-unbiased:</span>
<span id="cb121-1559"><a href="#cb121-1559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1560"><a href="#cb121-1560" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1561"><a href="#cb121-1561" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-1562"><a href="#cb121-1562" aria-hidden="true" tabindex="-1"></a>\Ef{e(y)} &amp;= \Ef{y - \hat y}</span>
<span id="cb121-1563"><a href="#cb121-1563" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \Ef{y} - \Ef{\hat y}</span>
<span id="cb121-1564"><a href="#cb121-1564" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \Ef{y} - \Ef{y}</span>
<span id="cb121-1565"><a href="#cb121-1565" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= 0</span>
<span id="cb121-1566"><a href="#cb121-1566" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-1567"><a href="#cb121-1567" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1568"><a href="#cb121-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1569"><a href="#cb121-1569" aria-hidden="true" tabindex="-1"></a>@eq-var-resid-unbiased:</span>
<span id="cb121-1570"><a href="#cb121-1570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1571"><a href="#cb121-1571" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1572"><a href="#cb121-1572" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb121-1573"><a href="#cb121-1573" aria-hidden="true" tabindex="-1"></a>\Var{e(y)} &amp;= \Var{y - \hy}</span>
<span id="cb121-1574"><a href="#cb121-1574" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \Var{y} + \Var{\hy} - 2 \Cov{y, \hy}</span>
<span id="cb121-1575"><a href="#cb121-1575" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;{\dot{\approx}} \Var{y} + 0 - 2 \cdot 0</span>
<span id="cb121-1576"><a href="#cb121-1576" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \Var{y}</span>
<span id="cb121-1577"><a href="#cb121-1577" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \ss</span>
<span id="cb121-1578"><a href="#cb121-1578" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb121-1579"><a href="#cb121-1579" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1580"><a href="#cb121-1580" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1581"><a href="#cb121-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1582"><a href="#cb121-1582" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1583"><a href="#cb121-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1584"><a href="#cb121-1584" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Characteristics of residuals in Gaussian models</span></span>
<span id="cb121-1585"><a href="#cb121-1585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1586"><a href="#cb121-1586" aria-hidden="true" tabindex="-1"></a>With enough data and a correct model, the residuals will be approximately Guassian distributed, with variance $\sigma^2$, which we can estimate using $\hat\sigma^2$: that is:</span>
<span id="cb121-1587"><a href="#cb121-1587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1588"><a href="#cb121-1588" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1589"><a href="#cb121-1589" aria-hidden="true" tabindex="-1"></a>e_i \siid N(0, \hat\sigma^2)</span>
<span id="cb121-1590"><a href="#cb121-1590" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1591"><a href="#cb121-1591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1592"><a href="#cb121-1592" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1593"><a href="#cb121-1593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1594"><a href="#cb121-1594" aria-hidden="true" tabindex="-1"></a>:::{#exm-resid-bw}</span>
<span id="cb121-1595"><a href="#cb121-1595" aria-hidden="true" tabindex="-1"></a><span class="fu">#### residuals in `birthweight` data</span></span>
<span id="cb121-1596"><a href="#cb121-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1597"><a href="#cb121-1597" aria-hidden="true" tabindex="-1"></a>R provides a function for residuals:</span>
<span id="cb121-1598"><a href="#cb121-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1601"><a href="#cb121-1601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1602"><a href="#cb121-1602" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(bw_lm2)</span>
<span id="cb121-1603"><a href="#cb121-1603" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1604"><a href="#cb121-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1605"><a href="#cb121-1605" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1606"><a href="#cb121-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1607"><a href="#cb121-1607" aria-hidden="true" tabindex="-1"></a>:::{#exr-calc-resids}</span>
<span id="cb121-1608"><a href="#cb121-1608" aria-hidden="true" tabindex="-1"></a>Check R's output by computing the residuals directly.</span>
<span id="cb121-1609"><a href="#cb121-1609" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1610"><a href="#cb121-1610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1611"><a href="#cb121-1611" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb121-1612"><a href="#cb121-1612" aria-hidden="true" tabindex="-1"></a>\ </span>
<span id="cb121-1615"><a href="#cb121-1615" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1616"><a href="#cb121-1616" aria-hidden="true" tabindex="-1"></a>bw<span class="sc">$</span>weight <span class="sc">-</span> <span class="fu">fitted</span>(bw_lm2)</span>
<span id="cb121-1617"><a href="#cb121-1617" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1618"><a href="#cb121-1618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1619"><a href="#cb121-1619" aria-hidden="true" tabindex="-1"></a>This matches R's output!</span>
<span id="cb121-1620"><a href="#cb121-1620" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1621"><a href="#cb121-1621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1622"><a href="#cb121-1622" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1623"><a href="#cb121-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1624"><a href="#cb121-1624" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Graph the residuals</span></span>
<span id="cb121-1625"><a href="#cb121-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1628"><a href="#cb121-1628" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1629"><a href="#cb121-1629" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-resids-intxn</span></span>
<span id="cb121-1630"><a href="#cb121-1630" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Residuals of interaction model for `birthweight` data"</span></span>
<span id="cb121-1631"><a href="#cb121-1631" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1632"><a href="#cb121-1632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resids_intxn =</span> </span>
<span id="cb121-1633"><a href="#cb121-1633" aria-hidden="true" tabindex="-1"></a>           weight <span class="sc">-</span> <span class="fu">fitted</span>(bw_lm2))</span>
<span id="cb121-1634"><a href="#cb121-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1635"><a href="#cb121-1635" aria-hidden="true" tabindex="-1"></a>plot_bw_resid <span class="ot">=</span></span>
<span id="cb121-1636"><a href="#cb121-1636" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1637"><a href="#cb121-1637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb121-1638"><a href="#cb121-1638" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> age, </span>
<span id="cb121-1639"><a href="#cb121-1639" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> resids_intxn,</span>
<span id="cb121-1640"><a href="#cb121-1640" aria-hidden="true" tabindex="-1"></a>    <span class="at">linetype =</span> sex,</span>
<span id="cb121-1641"><a href="#cb121-1641" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> sex,</span>
<span id="cb121-1642"><a href="#cb121-1642" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> sex))  <span class="sc">+</span></span>
<span id="cb121-1643"><a href="#cb121-1643" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb121-1644"><a href="#cb121-1644" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Gestational age (weeks)"</span>) <span class="sc">+</span></span>
<span id="cb121-1645"><a href="#cb121-1645" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"residuals (grams)"</span>) <span class="sc">+</span></span>
<span id="cb121-1646"><a href="#cb121-1646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb121-1647"><a href="#cb121-1647" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expand_limits(y = 0, x = 0) +</span></span>
<span id="cb121-1648"><a href="#cb121-1648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">7</span>)</span>
<span id="cb121-1649"><a href="#cb121-1649" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot_bw_resid <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span> sex))</span>
<span id="cb121-1650"><a href="#cb121-1650" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1651"><a href="#cb121-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1652"><a href="#cb121-1652" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1653"><a href="#cb121-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1654"><a href="#cb121-1654" aria-hidden="true" tabindex="-1"></a>:::{#def-stred}</span>
<span id="cb121-1655"><a href="#cb121-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1656"><a href="#cb121-1656" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized residuals</span></span>
<span id="cb121-1657"><a href="#cb121-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1658"><a href="#cb121-1658" aria-hidden="true" tabindex="-1"></a>$$r_i = \frac{e_i}{\widehat{SD}(e_i)}$$</span>
<span id="cb121-1659"><a href="#cb121-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1660"><a href="#cb121-1660" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1661"><a href="#cb121-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1662"><a href="#cb121-1662" aria-hidden="true" tabindex="-1"></a>Hence, with enough data and a correct model, the standardized residuals will be approximately standard Gaussian; that is,</span>
<span id="cb121-1663"><a href="#cb121-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1664"><a href="#cb121-1664" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1665"><a href="#cb121-1665" aria-hidden="true" tabindex="-1"></a>r_i \siid N(0,1)</span>
<span id="cb121-1666"><a href="#cb121-1666" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb121-1667"><a href="#cb121-1667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1668"><a href="#cb121-1668" aria-hidden="true" tabindex="-1"></a><span class="fu">### Marginal distributions of residuals</span></span>
<span id="cb121-1669"><a href="#cb121-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1670"><a href="#cb121-1670" aria-hidden="true" tabindex="-1"></a>To look for problems with our model, we can check whether the residuals $e_i$ and standardized residuals $r_i$ look like they have the distributions that they are supposed to have, according to the model.</span>
<span id="cb121-1671"><a href="#cb121-1671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1672"><a href="#cb121-1672" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1673"><a href="#cb121-1673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1674"><a href="#cb121-1674" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized residuals in R</span></span>
<span id="cb121-1675"><a href="#cb121-1675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1678"><a href="#cb121-1678" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1679"><a href="#cb121-1679" aria-hidden="true" tabindex="-1"></a><span class="fu">rstandard</span>(bw_lm2)</span>
<span id="cb121-1680"><a href="#cb121-1680" aria-hidden="true" tabindex="-1"></a><span class="fu">resid</span>(bw_lm2)<span class="sc">/</span><span class="fu">sigma</span>(bw_lm2)</span>
<span id="cb121-1681"><a href="#cb121-1681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1682"><a href="#cb121-1682" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1683"><a href="#cb121-1683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1684"><a href="#cb121-1684" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1685"><a href="#cb121-1685" aria-hidden="true" tabindex="-1"></a>These are not quite the same, because R is doing something more complicated and precise to get the standard errors. Let's not worry about those details for now; the difference is pretty small in this case:</span>
<span id="cb121-1686"><a href="#cb121-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1687"><a href="#cb121-1687" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1688"><a href="#cb121-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1689"><a href="#cb121-1689" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1690"><a href="#cb121-1690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1693"><a href="#cb121-1693" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1694"><a href="#cb121-1694" aria-hidden="true" tabindex="-1"></a>rstandard_compare_plot <span class="ot">=</span> </span>
<span id="cb121-1695"><a href="#cb121-1695" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb121-1696"><a href="#cb121-1696" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">resid</span>(bw_lm2)<span class="sc">/</span><span class="fu">sigma</span>(bw_lm2), </span>
<span id="cb121-1697"><a href="#cb121-1697" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">rstandard</span>(bw_lm2)) <span class="sc">|&gt;</span> </span>
<span id="cb121-1698"><a href="#cb121-1698" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb121-1699"><a href="#cb121-1699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb121-1700"><a href="#cb121-1700" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb121-1701"><a href="#cb121-1701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb121-1702"><a href="#cb121-1702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"resid(bw_lm2)/sigma(bw_lm2)"</span>) <span class="sc">+</span></span>
<span id="cb121-1703"><a href="#cb121-1703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"rstandard(bw_lm2)"</span>) <span class="sc">+</span></span>
<span id="cb121-1704"><a href="#cb121-1704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb121-1705"><a href="#cb121-1705" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb121-1706"><a href="#cb121-1706" aria-hidden="true" tabindex="-1"></a>      <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb121-1707"><a href="#cb121-1707" aria-hidden="true" tabindex="-1"></a>      <span class="at">slope =</span> <span class="dv">1</span>, </span>
<span id="cb121-1708"><a href="#cb121-1708" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> <span class="st">"x=y"</span>)) <span class="sc">+</span></span>
<span id="cb121-1709"><a href="#cb121-1709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour=</span><span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb121-1710"><a href="#cb121-1710" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values=</span><span class="st">"red"</span>)</span>
<span id="cb121-1711"><a href="#cb121-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1712"><a href="#cb121-1712" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rstandard_compare_plot)</span>
<span id="cb121-1713"><a href="#cb121-1713" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1714"><a href="#cb121-1714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1715"><a href="#cb121-1715" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1716"><a href="#cb121-1716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1717"><a href="#cb121-1717" aria-hidden="true" tabindex="-1"></a>Let's add these residuals to the <span class="in">`tibble`</span> of our dataset:</span>
<span id="cb121-1718"><a href="#cb121-1718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1721"><a href="#cb121-1721" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1722"><a href="#cb121-1722" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-1723"><a href="#cb121-1723" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1724"><a href="#cb121-1724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-1725"><a href="#cb121-1725" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_lm2 =</span> <span class="fu">fitted</span>(bw_lm2),</span>
<span id="cb121-1726"><a href="#cb121-1726" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb121-1727"><a href="#cb121-1727" aria-hidden="true" tabindex="-1"></a>    <span class="at">resid_lm2 =</span> <span class="fu">resid</span>(bw_lm2),</span>
<span id="cb121-1728"><a href="#cb121-1728" aria-hidden="true" tabindex="-1"></a>    <span class="co"># resid_lm2 = weight - fitted_lm2,</span></span>
<span id="cb121-1729"><a href="#cb121-1729" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb121-1730"><a href="#cb121-1730" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_resid_lm2 =</span> <span class="fu">rstandard</span>(bw_lm2),</span>
<span id="cb121-1731"><a href="#cb121-1731" aria-hidden="true" tabindex="-1"></a>    <span class="co"># std_resid_lm2 = resid_lm2 / sigma(bw_lm2)</span></span>
<span id="cb121-1732"><a href="#cb121-1732" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-1733"><a href="#cb121-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1734"><a href="#cb121-1734" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1735"><a href="#cb121-1735" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb121-1736"><a href="#cb121-1736" aria-hidden="true" tabindex="-1"></a>    sex,</span>
<span id="cb121-1737"><a href="#cb121-1737" aria-hidden="true" tabindex="-1"></a>    age,</span>
<span id="cb121-1738"><a href="#cb121-1738" aria-hidden="true" tabindex="-1"></a>    weight,</span>
<span id="cb121-1739"><a href="#cb121-1739" aria-hidden="true" tabindex="-1"></a>    fitted_lm2,</span>
<span id="cb121-1740"><a href="#cb121-1740" aria-hidden="true" tabindex="-1"></a>    resid_lm2,</span>
<span id="cb121-1741"><a href="#cb121-1741" aria-hidden="true" tabindex="-1"></a>    std_resid_lm2</span>
<span id="cb121-1742"><a href="#cb121-1742" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-1743"><a href="#cb121-1743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1744"><a href="#cb121-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1745"><a href="#cb121-1745" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1746"><a href="#cb121-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1747"><a href="#cb121-1747" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1748"><a href="#cb121-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1749"><a href="#cb121-1749" aria-hidden="true" tabindex="-1"></a>Now let's build histograms:</span>
<span id="cb121-1750"><a href="#cb121-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1751"><a href="#cb121-1751" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1752"><a href="#cb121-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1755"><a href="#cb121-1755" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1756"><a href="#cb121-1756" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Marginal distribution of (nonstandardized) residuals"</span></span>
<span id="cb121-1757"><a href="#cb121-1757" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-marg-dist-resid</span></span>
<span id="cb121-1758"><a href="#cb121-1758" aria-hidden="true" tabindex="-1"></a>resid_marginal_hist <span class="ot">=</span> </span>
<span id="cb121-1759"><a href="#cb121-1759" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1760"><a href="#cb121-1760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> resid_lm2)) <span class="sc">+</span></span>
<span id="cb121-1761"><a href="#cb121-1761" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb121-1762"><a href="#cb121-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1763"><a href="#cb121-1763" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resid_marginal_hist)</span>
<span id="cb121-1764"><a href="#cb121-1764" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1765"><a href="#cb121-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1766"><a href="#cb121-1766" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1767"><a href="#cb121-1767" aria-hidden="true" tabindex="-1"></a>Hard to tell with this small amount of data, but I'm a bit concerned that the histogram doesn't show a bell-curve shape.</span>
<span id="cb121-1768"><a href="#cb121-1768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1769"><a href="#cb121-1769" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1770"><a href="#cb121-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1771"><a href="#cb121-1771" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1772"><a href="#cb121-1772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1773"><a href="#cb121-1773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1776"><a href="#cb121-1776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1777"><a href="#cb121-1777" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Marginal distribution of standardized residuals"</span></span>
<span id="cb121-1778"><a href="#cb121-1778" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-marg-stresd</span></span>
<span id="cb121-1779"><a href="#cb121-1779" aria-hidden="true" tabindex="-1"></a>std_resid_marginal_hist <span class="ot">=</span> </span>
<span id="cb121-1780"><a href="#cb121-1780" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1781"><a href="#cb121-1781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> std_resid_lm2)) <span class="sc">+</span></span>
<span id="cb121-1782"><a href="#cb121-1782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb121-1783"><a href="#cb121-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1784"><a href="#cb121-1784" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(std_resid_marginal_hist)</span>
<span id="cb121-1785"><a href="#cb121-1785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1786"><a href="#cb121-1786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1787"><a href="#cb121-1787" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1788"><a href="#cb121-1788" aria-hidden="true" tabindex="-1"></a>This looks similar, although the scale of the x-axis got narrower, because we divided by $\hat\sigma$ (roughly speaking).</span>
<span id="cb121-1789"><a href="#cb121-1789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1790"><a href="#cb121-1790" aria-hidden="true" tabindex="-1"></a>Still hard to tell if the distribution is Gaussian.</span>
<span id="cb121-1791"><a href="#cb121-1791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1792"><a href="#cb121-1792" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1793"><a href="#cb121-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1794"><a href="#cb121-1794" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1795"><a href="#cb121-1795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1796"><a href="#cb121-1796" aria-hidden="true" tabindex="-1"></a><span class="fu">### QQ plot of standardized residuals</span></span>
<span id="cb121-1797"><a href="#cb121-1797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1798"><a href="#cb121-1798" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1799"><a href="#cb121-1799" aria-hidden="true" tabindex="-1"></a>Another way to assess normality is the QQ plot of the standardized residuals versus normal quantiles:</span>
<span id="cb121-1800"><a href="#cb121-1800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1801"><a href="#cb121-1801" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1802"><a href="#cb121-1802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1805"><a href="#cb121-1805" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1806"><a href="#cb121-1806" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify) </span>
<span id="cb121-1807"><a href="#cb121-1807" aria-hidden="true" tabindex="-1"></a><span class="co"># needed to make ggplot2::autoplot() work for `lm` objects</span></span>
<span id="cb121-1808"><a href="#cb121-1808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1809"><a href="#cb121-1809" aria-hidden="true" tabindex="-1"></a>qqplot_lm2_auto <span class="ot">=</span> </span>
<span id="cb121-1810"><a href="#cb121-1810" aria-hidden="true" tabindex="-1"></a>  bw_lm2 <span class="sc">|&gt;</span> </span>
<span id="cb121-1811"><a href="#cb121-1811" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(</span>
<span id="cb121-1812"><a href="#cb121-1812" aria-hidden="true" tabindex="-1"></a>    <span class="at">which =</span> <span class="dv">2</span>, <span class="co"># options are 1:6; can do multiple at once</span></span>
<span id="cb121-1813"><a href="#cb121-1813" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb121-1814"><a href="#cb121-1814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb121-1815"><a href="#cb121-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1816"><a href="#cb121-1816" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(qqplot_lm2_auto)</span>
<span id="cb121-1817"><a href="#cb121-1817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1818"><a href="#cb121-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1819"><a href="#cb121-1819" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1820"><a href="#cb121-1820" aria-hidden="true" tabindex="-1"></a>If the Gaussian model were correct, these points should follow the dotted line.</span>
<span id="cb121-1821"><a href="#cb121-1821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1822"><a href="#cb121-1822" aria-hidden="true" tabindex="-1"></a>Fig 2.4 panel (c) in @dobson4e is a little different; they didn't specify how they produced it, but other statistical analysis systems do things differently from R.</span>
<span id="cb121-1823"><a href="#cb121-1823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1824"><a href="#cb121-1824" aria-hidden="true" tabindex="-1"></a>See also @dunn2018generalized <span class="co">[</span><span class="ot">§3.5.4</span><span class="co">](https://link.springer.com/chapter/10.1007/978-1-4419-0118-7_3#Sec14:~:text=3.5.4%20Q%E2%80%93Q%20Plots%20and%20Normality)</span>.</span>
<span id="cb121-1825"><a href="#cb121-1825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1826"><a href="#cb121-1826" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1827"><a href="#cb121-1827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1828"><a href="#cb121-1828" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1829"><a href="#cb121-1829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1830"><a href="#cb121-1830" aria-hidden="true" tabindex="-1"></a><span class="fu">#### QQ plot - how it's built</span></span>
<span id="cb121-1831"><a href="#cb121-1831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1832"><a href="#cb121-1832" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1833"><a href="#cb121-1833" aria-hidden="true" tabindex="-1"></a>Let's construct it by hand:</span>
<span id="cb121-1834"><a href="#cb121-1834" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1835"><a href="#cb121-1835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1838"><a href="#cb121-1838" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1839"><a href="#cb121-1839" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1840"><a href="#cb121-1840" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-1841"><a href="#cb121-1841" aria-hidden="true" tabindex="-1"></a>    <span class="at">p =</span> (<span class="fu">rank</span>(std_resid_lm2) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>)<span class="sc">/</span><span class="fu">n</span>(), <span class="co"># "Blom's method"</span></span>
<span id="cb121-1842"><a href="#cb121-1842" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected_quantiles_lm2 =</span> <span class="fu">qnorm</span>(p)</span>
<span id="cb121-1843"><a href="#cb121-1843" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-1844"><a href="#cb121-1844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1845"><a href="#cb121-1845" aria-hidden="true" tabindex="-1"></a>qqplot_lm2 <span class="ot">=</span> </span>
<span id="cb121-1846"><a href="#cb121-1846" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1847"><a href="#cb121-1847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-1848"><a href="#cb121-1848" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb121-1849"><a href="#cb121-1849" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> expected_quantiles_lm2, </span>
<span id="cb121-1850"><a href="#cb121-1850" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> std_resid_lm2, </span>
<span id="cb121-1851"><a href="#cb121-1851" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> sex, </span>
<span id="cb121-1852"><a href="#cb121-1852" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> sex)</span>
<span id="cb121-1853"><a href="#cb121-1853" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb121-1854"><a href="#cb121-1854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-1855"><a href="#cb121-1855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb121-1856"><a href="#cb121-1856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">'none'</span>) <span class="sc">+</span> <span class="co"># removing the plot legend</span></span>
<span id="cb121-1857"><a href="#cb121-1857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normal Q-Q"</span>) <span class="sc">+</span></span>
<span id="cb121-1858"><a href="#cb121-1858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Theoretical Quantiles"</span>) <span class="sc">+</span> </span>
<span id="cb121-1859"><a href="#cb121-1859" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Standardized residuals"</span>)</span>
<span id="cb121-1860"><a href="#cb121-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1861"><a href="#cb121-1861" aria-hidden="true" tabindex="-1"></a><span class="co"># find the expected line:</span></span>
<span id="cb121-1862"><a href="#cb121-1862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1863"><a href="#cb121-1863" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">75</span>)                  <span class="co"># reference probabilities</span></span>
<span id="cb121-1864"><a href="#cb121-1864" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">quantile</span>(<span class="fu">rstandard</span>(bw_lm2), ps)  <span class="co"># empirical quantiles</span></span>
<span id="cb121-1865"><a href="#cb121-1865" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(ps)                     <span class="co"># theoretical quantiles</span></span>
<span id="cb121-1866"><a href="#cb121-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1867"><a href="#cb121-1867" aria-hidden="true" tabindex="-1"></a>qq_slope <span class="ot">=</span> <span class="fu">diff</span>(a)<span class="sc">/</span><span class="fu">diff</span>(b)</span>
<span id="cb121-1868"><a href="#cb121-1868" aria-hidden="true" tabindex="-1"></a>qq_intcpt <span class="ot">=</span> a[<span class="dv">1</span>] <span class="sc">-</span> b[<span class="dv">1</span>] <span class="sc">*</span> qq_slope</span>
<span id="cb121-1869"><a href="#cb121-1869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1870"><a href="#cb121-1870" aria-hidden="true" tabindex="-1"></a>qqplot_lm2 <span class="ot">=</span> </span>
<span id="cb121-1871"><a href="#cb121-1871" aria-hidden="true" tabindex="-1"></a>  qqplot_lm2 <span class="sc">+</span></span>
<span id="cb121-1872"><a href="#cb121-1872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> qq_slope, <span class="at">intercept =</span> qq_intcpt)</span>
<span id="cb121-1873"><a href="#cb121-1873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1874"><a href="#cb121-1874" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(qqplot_lm2)</span>
<span id="cb121-1875"><a href="#cb121-1875" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1876"><a href="#cb121-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1877"><a href="#cb121-1877" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1878"><a href="#cb121-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1879"><a href="#cb121-1879" aria-hidden="true" tabindex="-1"></a><span class="fu">### Conditional distributions of residuals</span></span>
<span id="cb121-1880"><a href="#cb121-1880" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1881"><a href="#cb121-1881" aria-hidden="true" tabindex="-1"></a>If our Gaussian linear regression model is correct, the residuals $e_i$ and standardized residuals $r_i$ should have:</span>
<span id="cb121-1882"><a href="#cb121-1882" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1883"><a href="#cb121-1883" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>an approximately Gaussian distribution, with:</span>
<span id="cb121-1884"><a href="#cb121-1884" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>a mean of 0</span>
<span id="cb121-1885"><a href="#cb121-1885" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>a constant variance</span>
<span id="cb121-1886"><a href="#cb121-1886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1887"><a href="#cb121-1887" aria-hidden="true" tabindex="-1"></a>This should be true **for every** value of $x$.</span>
<span id="cb121-1888"><a href="#cb121-1888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1889"><a href="#cb121-1889" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1890"><a href="#cb121-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1891"><a href="#cb121-1891" aria-hidden="true" tabindex="-1"></a>If we didn't correctly guess the functional form of the linear component of the mean, </span>
<span id="cb121-1892"><a href="#cb121-1892" aria-hidden="true" tabindex="-1"></a>$$\text{E}<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p$$</span>
<span id="cb121-1893"><a href="#cb121-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1894"><a href="#cb121-1894" aria-hidden="true" tabindex="-1"></a>Then the the residuals might have nonzero mean.</span>
<span id="cb121-1895"><a href="#cb121-1895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1896"><a href="#cb121-1896" aria-hidden="true" tabindex="-1"></a>Regardless of whether we guessed the mean function correctly, ther the variance of the residuals might differ between values of $x$.</span>
<span id="cb121-1897"><a href="#cb121-1897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1898"><a href="#cb121-1898" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1899"><a href="#cb121-1899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1900"><a href="#cb121-1900" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residuals versus fitted values</span></span>
<span id="cb121-1901"><a href="#cb121-1901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1902"><a href="#cb121-1902" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1903"><a href="#cb121-1903" aria-hidden="true" tabindex="-1"></a>To look for these issues, we can plot the residuals $e_i$ against the fitted values $\hat y_i$ (@fig-bw_lm2-resid-vs-fitted).</span>
<span id="cb121-1904"><a href="#cb121-1904" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1907"><a href="#cb121-1907" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1908"><a href="#cb121-1908" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-bw_lm2-resid-vs-fitted</span></span>
<span id="cb121-1909"><a href="#cb121-1909" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`birthweight` model  (@eq-BW-lm-interact): residuals versus fitted values"</span></span>
<span id="cb121-1910"><a href="#cb121-1910" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb121-1911"><a href="#cb121-1911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1912"><a href="#cb121-1912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1913"><a href="#cb121-1913" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1914"><a href="#cb121-1914" aria-hidden="true" tabindex="-1"></a>If the model is correct, the blue line should stay flat and close to 0, and the cloud of dots should have the same vertical spread regardless of the fitted value.</span>
<span id="cb121-1915"><a href="#cb121-1915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1916"><a href="#cb121-1916" aria-hidden="true" tabindex="-1"></a>If not, we probably need to change the functional form of linear component of the mean, $$\text{E}<span class="co">[</span><span class="ot">Y|X=x</span><span class="co">]</span> = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p$$</span>
<span id="cb121-1917"><a href="#cb121-1917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1918"><a href="#cb121-1918" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1919"><a href="#cb121-1919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1920"><a href="#cb121-1920" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1921"><a href="#cb121-1921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1922"><a href="#cb121-1922" aria-hidden="true" tabindex="-1"></a>{{&lt; include exm-plot-fits.qmd &gt;}}</span>
<span id="cb121-1923"><a href="#cb121-1923" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1924"><a href="#cb121-1924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1925"><a href="#cb121-1925" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Scale-location plot</span></span>
<span id="cb121-1926"><a href="#cb121-1926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1927"><a href="#cb121-1927" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1928"><a href="#cb121-1928" aria-hidden="true" tabindex="-1"></a>We can also plot the square roots of the absolute values of the standardized residuals against the fitted values (@fig-bw-scale-loc).</span>
<span id="cb121-1929"><a href="#cb121-1929" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1930"><a href="#cb121-1930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1933"><a href="#cb121-1933" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1934"><a href="#cb121-1934" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-bw-scale-loc</span></span>
<span id="cb121-1935"><a href="#cb121-1935" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Scale-location plot of `birthweight` data"</span></span>
<span id="cb121-1936"><a href="#cb121-1936" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb121-1937"><a href="#cb121-1937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1938"><a href="#cb121-1938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1939"><a href="#cb121-1939" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1940"><a href="#cb121-1940" aria-hidden="true" tabindex="-1"></a>Here, the blue line doesn't need to be near 0, </span>
<span id="cb121-1941"><a href="#cb121-1941" aria-hidden="true" tabindex="-1"></a>but it should be flat. </span>
<span id="cb121-1942"><a href="#cb121-1942" aria-hidden="true" tabindex="-1"></a>If not, the residual variance $\sigma^2$ might not be constant, </span>
<span id="cb121-1943"><a href="#cb121-1943" aria-hidden="true" tabindex="-1"></a>and we might need to transform our outcome $Y$ </span>
<span id="cb121-1944"><a href="#cb121-1944" aria-hidden="true" tabindex="-1"></a>(or use a model that allows non-constant variance).</span>
<span id="cb121-1945"><a href="#cb121-1945" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1946"><a href="#cb121-1946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1947"><a href="#cb121-1947" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1948"><a href="#cb121-1948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1949"><a href="#cb121-1949" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residuals versus leverage</span></span>
<span id="cb121-1950"><a href="#cb121-1950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1951"><a href="#cb121-1951" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1952"><a href="#cb121-1952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1953"><a href="#cb121-1953" aria-hidden="true" tabindex="-1"></a>We can also plot our standardized residuals against "leverage", which roughly speaking is a measure of how unusual each $x_i$ value is. Very unusual $x_i$ values can have extreme effects on the model fit, so we might want to remove those observations as outliers, particularly if they have large residuals.</span>
<span id="cb121-1954"><a href="#cb121-1954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1955"><a href="#cb121-1955" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1956"><a href="#cb121-1956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1959"><a href="#cb121-1959" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1960"><a href="#cb121-1960" aria-hidden="true" tabindex="-1"></a><span class="co">#| labels: fig-bw_lm2_resid-vs-leverage</span></span>
<span id="cb121-1961"><a href="#cb121-1961" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "`birthweight` model with interactions (@eq-BW-lm-interact): residuals versus leverage"</span></span>
<span id="cb121-1962"><a href="#cb121-1962" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(bw_lm2, <span class="at">which =</span> <span class="dv">5</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb121-1963"><a href="#cb121-1963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1964"><a href="#cb121-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1965"><a href="#cb121-1965" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-1966"><a href="#cb121-1966" aria-hidden="true" tabindex="-1"></a>The blue line should be relatively flat and close to 0 here.</span>
<span id="cb121-1967"><a href="#cb121-1967" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-1968"><a href="#cb121-1968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1969"><a href="#cb121-1969" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-1970"><a href="#cb121-1970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1971"><a href="#cb121-1971" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagnostics constructed by hand</span></span>
<span id="cb121-1972"><a href="#cb121-1972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1975"><a href="#cb121-1975" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1976"><a href="#cb121-1976" aria-hidden="true" tabindex="-1"></a>bw <span class="ot">=</span> </span>
<span id="cb121-1977"><a href="#cb121-1977" aria-hidden="true" tabindex="-1"></a>  bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1978"><a href="#cb121-1978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-1979"><a href="#cb121-1979" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(bw_lm2),</span>
<span id="cb121-1980"><a href="#cb121-1980" aria-hidden="true" tabindex="-1"></a>    <span class="at">residlm2 =</span> weight <span class="sc">-</span> predlm2,</span>
<span id="cb121-1981"><a href="#cb121-1981" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_resid =</span> residlm2 <span class="sc">/</span> <span class="fu">sigma</span>(bw_lm2),</span>
<span id="cb121-1982"><a href="#cb121-1982" aria-hidden="true" tabindex="-1"></a>    <span class="co"># std_resid_builtin = rstandard(bw_lm2), # uses leverage</span></span>
<span id="cb121-1983"><a href="#cb121-1983" aria-hidden="true" tabindex="-1"></a>    <span class="at">sqrt_abs_std_resid =</span> std_resid <span class="sc">|&gt;</span> <span class="fu">abs</span>() <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()</span>
<span id="cb121-1984"><a href="#cb121-1984" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb121-1985"><a href="#cb121-1985" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-1986"><a href="#cb121-1986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1987"><a href="#cb121-1987" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-1988"><a href="#cb121-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1989"><a href="#cb121-1989" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Residuals vs fitted</span></span>
<span id="cb121-1990"><a href="#cb121-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-1993"><a href="#cb121-1993" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-1994"><a href="#cb121-1994" aria-hidden="true" tabindex="-1"></a>resid_vs_fit <span class="ot">=</span> bw <span class="sc">|&gt;</span> </span>
<span id="cb121-1995"><a href="#cb121-1995" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-1996"><a href="#cb121-1996" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> predlm2, <span class="at">y =</span> residlm2, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb121-1997"><a href="#cb121-1997" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb121-1998"><a href="#cb121-1998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-1999"><a href="#cb121-1999" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb121-2000"><a href="#cb121-2000" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb121-2001"><a href="#cb121-2001" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2002"><a href="#cb121-2002" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2003"><a href="#cb121-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2004"><a href="#cb121-2004" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb121-2007"><a href="#cb121-2007" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2008"><a href="#cb121-2008" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resid_vs_fit)</span>
<span id="cb121-2009"><a href="#cb121-2009" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2010"><a href="#cb121-2010" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-2011"><a href="#cb121-2011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2012"><a href="#cb121-2012" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb121-2015"><a href="#cb121-2015" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2016"><a href="#cb121-2016" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(resid_vs_fit)</span>
<span id="cb121-2017"><a href="#cb121-2017" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2018"><a href="#cb121-2018" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-2019"><a href="#cb121-2019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2020"><a href="#cb121-2020" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Standardized residuals vs fitted</span></span>
<span id="cb121-2021"><a href="#cb121-2021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2024"><a href="#cb121-2024" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2025"><a href="#cb121-2025" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb121-2026"><a href="#cb121-2026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-2027"><a href="#cb121-2027" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> predlm2, <span class="at">y =</span> std_resid, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb121-2028"><a href="#cb121-2028" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb121-2029"><a href="#cb121-2029" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-2030"><a href="#cb121-2030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb121-2031"><a href="#cb121-2031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb121-2032"><a href="#cb121-2032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2033"><a href="#cb121-2033" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2034"><a href="#cb121-2034" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2035"><a href="#cb121-2035" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Standardized residuals vs gestational age</span></span>
<span id="cb121-2036"><a href="#cb121-2036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2039"><a href="#cb121-2039" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2040"><a href="#cb121-2040" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb121-2041"><a href="#cb121-2041" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-2042"><a href="#cb121-2042" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> std_resid, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb121-2043"><a href="#cb121-2043" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb121-2044"><a href="#cb121-2044" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-2045"><a href="#cb121-2045" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb121-2046"><a href="#cb121-2046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb121-2047"><a href="#cb121-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2048"><a href="#cb121-2048" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2049"><a href="#cb121-2049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2050"><a href="#cb121-2050" aria-hidden="true" tabindex="-1"></a><span class="fu">##### `sqrt(abs(rstandard()))` vs fitted</span></span>
<span id="cb121-2051"><a href="#cb121-2051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2052"><a href="#cb121-2052" aria-hidden="true" tabindex="-1"></a>Compare with <span class="in">`autoplot(bw_lm2, 3)`</span></span>
<span id="cb121-2053"><a href="#cb121-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2056"><a href="#cb121-2056" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2057"><a href="#cb121-2057" aria-hidden="true" tabindex="-1"></a>bw <span class="sc">|&gt;</span> </span>
<span id="cb121-2058"><a href="#cb121-2058" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-2059"><a href="#cb121-2059" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> predlm2, <span class="at">y =</span> sqrt_abs_std_resid, <span class="at">col =</span> sex, <span class="at">shape =</span> sex)</span>
<span id="cb121-2060"><a href="#cb121-2060" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb121-2061"><a href="#cb121-2061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb121-2062"><a href="#cb121-2062" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb121-2063"><a href="#cb121-2063" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)</span>
<span id="cb121-2064"><a href="#cb121-2064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2065"><a href="#cb121-2065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2066"><a href="#cb121-2066" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2067"><a href="#cb121-2067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2068"><a href="#cb121-2068" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model selection</span></span>
<span id="cb121-2069"><a href="#cb121-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2070"><a href="#cb121-2070" aria-hidden="true" tabindex="-1"></a>(adapted from @dobson4e §6.3.3; for more information on prediction, see @james2013introduction and @rms2e).</span>
<span id="cb121-2071"><a href="#cb121-2071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2072"><a href="#cb121-2072" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-2073"><a href="#cb121-2073" aria-hidden="true" tabindex="-1"></a>If we have a lot of covariates in our dataset, we might want to choose a small subset to use in our model.</span>
<span id="cb121-2074"><a href="#cb121-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2075"><a href="#cb121-2075" aria-hidden="true" tabindex="-1"></a>There are a few possible metrics to consider for choosing a "best" model.</span>
<span id="cb121-2076"><a href="#cb121-2076" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-2077"><a href="#cb121-2077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2078"><a href="#cb121-2078" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mean squared error</span></span>
<span id="cb121-2079"><a href="#cb121-2079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2080"><a href="#cb121-2080" aria-hidden="true" tabindex="-1"></a>We might want to minimize the **mean squared error**, $\text E<span class="co">[</span><span class="ot">(y-\hat y)^2</span><span class="co">]</span>$, for new observations that weren't in our data set when we fit the model.</span>
<span id="cb121-2081"><a href="#cb121-2081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2082"><a href="#cb121-2082" aria-hidden="true" tabindex="-1"></a>Unfortunately, $$\frac{1}{n}\sum_{i=1}^n (y_i-\hat y_i)^2$$ gives a biased estimate of $\text E<span class="co">[</span><span class="ot">(y-\hat y)^2</span><span class="co">]</span>$ for new data. If we want an unbiased estimate, we will have to be clever.</span>
<span id="cb121-2083"><a href="#cb121-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2084"><a href="#cb121-2084" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2085"><a href="#cb121-2085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2086"><a href="#cb121-2086" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Cross-validation</span></span>
<span id="cb121-2087"><a href="#cb121-2087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2090"><a href="#cb121-2090" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2091"><a href="#cb121-2091" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"carbohydrate"</span>, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb121-2092"><a href="#cb121-2092" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cvTools)</span>
<span id="cb121-2093"><a href="#cb121-2093" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(carbohydrate <span class="sc">~</span> ., <span class="at">data =</span> carbohydrate)</span>
<span id="cb121-2094"><a href="#cb121-2094" aria-hidden="true" tabindex="-1"></a>cv_full <span class="ot">=</span> </span>
<span id="cb121-2095"><a href="#cb121-2095" aria-hidden="true" tabindex="-1"></a>  full_model <span class="sc">|&gt;</span> <span class="fu">cvFit</span>(</span>
<span id="cb121-2096"><a href="#cb121-2096" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> carbohydrate, <span class="at">K =</span> <span class="dv">5</span>, <span class="at">R =</span> <span class="dv">10</span>,</span>
<span id="cb121-2097"><a href="#cb121-2097" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> carbohydrate<span class="sc">$</span>carbohydrate)</span>
<span id="cb121-2098"><a href="#cb121-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2099"><a href="#cb121-2099" aria-hidden="true" tabindex="-1"></a>reduced_model <span class="ot">=</span> <span class="fu">update</span>(full_model, </span>
<span id="cb121-2100"><a href="#cb121-2100" aria-hidden="true" tabindex="-1"></a>                       <span class="at">formula =</span> <span class="sc">~</span> . <span class="sc">-</span> age)</span>
<span id="cb121-2101"><a href="#cb121-2101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2102"><a href="#cb121-2102" aria-hidden="true" tabindex="-1"></a>cv_reduced <span class="ot">=</span> </span>
<span id="cb121-2103"><a href="#cb121-2103" aria-hidden="true" tabindex="-1"></a>  reduced_model <span class="sc">|&gt;</span> <span class="fu">cvFit</span>(</span>
<span id="cb121-2104"><a href="#cb121-2104" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> carbohydrate, <span class="at">K =</span> <span class="dv">5</span>, <span class="at">R =</span> <span class="dv">10</span>,</span>
<span id="cb121-2105"><a href="#cb121-2105" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> carbohydrate<span class="sc">$</span>carbohydrate)</span>
<span id="cb121-2106"><a href="#cb121-2106" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2107"><a href="#cb121-2107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2108"><a href="#cb121-2108" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2109"><a href="#cb121-2109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2112"><a href="#cb121-2112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2113"><a href="#cb121-2113" aria-hidden="true" tabindex="-1"></a>results_reduced <span class="ot">=</span> </span>
<span id="cb121-2114"><a href="#cb121-2114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb121-2115"><a href="#cb121-2115" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> <span class="st">"wgt+protein"</span>,</span>
<span id="cb121-2116"><a href="#cb121-2116" aria-hidden="true" tabindex="-1"></a>      <span class="at">errs =</span> cv_reduced<span class="sc">$</span>reps[])</span>
<span id="cb121-2117"><a href="#cb121-2117" aria-hidden="true" tabindex="-1"></a>results_full <span class="ot">=</span> </span>
<span id="cb121-2118"><a href="#cb121-2118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">model =</span> <span class="st">"wgt+age+protein"</span>,</span>
<span id="cb121-2119"><a href="#cb121-2119" aria-hidden="true" tabindex="-1"></a>           <span class="at">errs =</span> cv_full<span class="sc">$</span>reps[])</span>
<span id="cb121-2120"><a href="#cb121-2120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2121"><a href="#cb121-2121" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">=</span> </span>
<span id="cb121-2122"><a href="#cb121-2122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(results_reduced, results_full)</span>
<span id="cb121-2123"><a href="#cb121-2123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2124"><a href="#cb121-2124" aria-hidden="true" tabindex="-1"></a>cv_results <span class="sc">|&gt;</span> </span>
<span id="cb121-2125"><a href="#cb121-2125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> model, <span class="at">x =</span> errs)) <span class="sc">+</span></span>
<span id="cb121-2126"><a href="#cb121-2126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb121-2127"><a href="#cb121-2127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2128"><a href="#cb121-2128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2129"><a href="#cb121-2129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2130"><a href="#cb121-2130" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2131"><a href="#cb121-2131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2132"><a href="#cb121-2132" aria-hidden="true" tabindex="-1"></a><span class="fu">##### comparing metrics</span></span>
<span id="cb121-2133"><a href="#cb121-2133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2136"><a href="#cb121-2136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2137"><a href="#cb121-2137" aria-hidden="true" tabindex="-1"></a>compare_results <span class="ot">=</span> <span class="fu">tribble</span>(</span>
<span id="cb121-2138"><a href="#cb121-2138" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> model, <span class="sc">~</span> cvRMSE, <span class="sc">~</span> r.squared, <span class="sc">~</span>adj.r.squared, <span class="sc">~</span> trainRMSE, <span class="sc">~</span>loglik,</span>
<span id="cb121-2139"><a href="#cb121-2139" aria-hidden="true" tabindex="-1"></a>  <span class="st">"full"</span>, cv_full<span class="sc">$</span>cv, <span class="fu">summary</span>(full_model)<span class="sc">$</span>r.squared,  <span class="fu">summary</span>(full_model)<span class="sc">$</span>adj.r.squared, <span class="fu">sigma</span>(full_model), <span class="fu">logLik</span>(full_model) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb121-2140"><a href="#cb121-2140" aria-hidden="true" tabindex="-1"></a>  <span class="st">"reduced"</span>, cv_reduced<span class="sc">$</span>cv, <span class="fu">summary</span>(reduced_model)<span class="sc">$</span>r.squared, <span class="fu">summary</span>(reduced_model)<span class="sc">$</span>adj.r.squared, <span class="fu">sigma</span>(reduced_model), <span class="fu">logLik</span>(reduced_model) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>())</span>
<span id="cb121-2141"><a href="#cb121-2141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2142"><a href="#cb121-2142" aria-hidden="true" tabindex="-1"></a>compare_results</span>
<span id="cb121-2143"><a href="#cb121-2143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2144"><a href="#cb121-2144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2145"><a href="#cb121-2145" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2146"><a href="#cb121-2146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2149"><a href="#cb121-2149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2150"><a href="#cb121-2150" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(full_model, reduced_model)</span>
<span id="cb121-2151"><a href="#cb121-2151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2152"><a href="#cb121-2152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2153"><a href="#cb121-2153" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2154"><a href="#cb121-2154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2155"><a href="#cb121-2155" aria-hidden="true" tabindex="-1"></a><span class="fu">#### stepwise regression</span></span>
<span id="cb121-2156"><a href="#cb121-2156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2159"><a href="#cb121-2159" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2160"><a href="#cb121-2160" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(olsrr)</span>
<span id="cb121-2161"><a href="#cb121-2161" aria-hidden="true" tabindex="-1"></a>olsrr<span class="sc">:::</span><span class="fu">ols_step_both_aic</span>(full_model)</span>
<span id="cb121-2162"><a href="#cb121-2162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2163"><a href="#cb121-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2164"><a href="#cb121-2164" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2165"><a href="#cb121-2165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2166"><a href="#cb121-2166" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Lasso</span></span>
<span id="cb121-2167"><a href="#cb121-2167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2168"><a href="#cb121-2168" aria-hidden="true" tabindex="-1"></a>$$\arg min_{\theta} \llik(\th) + \lambda \sum_{j=1}^p|\beta_j|$$</span>
<span id="cb121-2169"><a href="#cb121-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2172"><a href="#cb121-2172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2173"><a href="#cb121-2173" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb121-2174"><a href="#cb121-2174" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> carbohydrate<span class="sc">$</span>carbohydrate</span>
<span id="cb121-2175"><a href="#cb121-2175" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> carbohydrate <span class="sc">|&gt;</span> </span>
<span id="cb121-2176"><a href="#cb121-2176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(age, weight, protein) <span class="sc">|&gt;</span> </span>
<span id="cb121-2177"><a href="#cb121-2177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb121-2178"><a href="#cb121-2178" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glmnet</span>(x,y)</span>
<span id="cb121-2179"><a href="#cb121-2179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2180"><a href="#cb121-2180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2181"><a href="#cb121-2181" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2182"><a href="#cb121-2182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2185"><a href="#cb121-2185" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2186"><a href="#cb121-2186" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Lasso selection"</span></span>
<span id="cb121-2187"><a href="#cb121-2187" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-carbs-lasso</span></span>
<span id="cb121-2188"><a href="#cb121-2188" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fit, <span class="at">xvar =</span> <span class="st">'lambda'</span>)</span>
<span id="cb121-2189"><a href="#cb121-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2190"><a href="#cb121-2190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2191"><a href="#cb121-2191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2192"><a href="#cb121-2192" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2193"><a href="#cb121-2193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2196"><a href="#cb121-2196" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2197"><a href="#cb121-2197" aria-hidden="true" tabindex="-1"></a>cvfit <span class="ot">=</span> <span class="fu">cv.glmnet</span>(x,y)</span>
<span id="cb121-2198"><a href="#cb121-2198" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cvfit)</span>
<span id="cb121-2199"><a href="#cb121-2199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2200"><a href="#cb121-2200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2201"><a href="#cb121-2201" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2202"><a href="#cb121-2202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2205"><a href="#cb121-2205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2206"><a href="#cb121-2206" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(cvfit, <span class="at">s =</span> <span class="st">"lambda.1se"</span>)</span>
<span id="cb121-2207"><a href="#cb121-2207" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2208"><a href="#cb121-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2209"><a href="#cb121-2209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2210"><a href="#cb121-2210" aria-hidden="true" tabindex="-1"></a><span class="fu">## Categorical covariates with more than two levels</span></span>
<span id="cb121-2211"><a href="#cb121-2211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2212"><a href="#cb121-2212" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example: `birthweight`</span></span>
<span id="cb121-2213"><a href="#cb121-2213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2214"><a href="#cb121-2214" aria-hidden="true" tabindex="-1"></a>In the birthweight example, the variable <span class="in">`sex`</span> had only two observed values:</span>
<span id="cb121-2215"><a href="#cb121-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2218"><a href="#cb121-2218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2219"><a href="#cb121-2219" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(bw<span class="sc">$</span>sex)</span>
<span id="cb121-2220"><a href="#cb121-2220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2221"><a href="#cb121-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2222"><a href="#cb121-2222" aria-hidden="true" tabindex="-1"></a>If there are more than two observed values, we can't just use a single variable with 0s and 1s.</span>
<span id="cb121-2223"><a href="#cb121-2223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2224"><a href="#cb121-2224" aria-hidden="true" tabindex="-1"></a><span class="fu">### </span></span>
<span id="cb121-2225"><a href="#cb121-2225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2226"><a href="#cb121-2226" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb121-2227"><a href="#cb121-2227" aria-hidden="true" tabindex="-1"></a>For example, @tbl-iris-data shows the </span>
<span id="cb121-2228"><a href="#cb121-2228" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">(in)famous</span><span class="co">](https://www.meganstodel.com/posts/no-to-iris/)</span> </span>
<span id="cb121-2229"><a href="#cb121-2229" aria-hidden="true" tabindex="-1"></a><span class="in">`iris`</span> data (@anderson1935irises), </span>
<span id="cb121-2230"><a href="#cb121-2230" aria-hidden="true" tabindex="-1"></a>and @tbl-iris-summary provides summary statistics. </span>
<span id="cb121-2231"><a href="#cb121-2231" aria-hidden="true" tabindex="-1"></a>The data include three species: "setosa", "versicolor", and "virginica".</span>
<span id="cb121-2232"><a href="#cb121-2232" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-2233"><a href="#cb121-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2236"><a href="#cb121-2236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2237"><a href="#cb121-2237" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "The `iris` data"</span></span>
<span id="cb121-2238"><a href="#cb121-2238" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-data</span></span>
<span id="cb121-2239"><a href="#cb121-2239" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span>
<span id="cb121-2240"><a href="#cb121-2240" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2241"><a href="#cb121-2241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2244"><a href="#cb121-2244" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2245"><a href="#cb121-2245" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Summary statistics for the `iris` data"</span></span>
<span id="cb121-2246"><a href="#cb121-2246" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-summary</span></span>
<span id="cb121-2247"><a href="#cb121-2247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2248"><a href="#cb121-2248" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb121-2249"><a href="#cb121-2249" aria-hidden="true" tabindex="-1"></a><span class="fu">table1</span>(</span>
<span id="cb121-2250"><a href="#cb121-2250" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span> . <span class="sc">|</span> Species,</span>
<span id="cb121-2251"><a href="#cb121-2251" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> iris,</span>
<span id="cb121-2252"><a href="#cb121-2252" aria-hidden="true" tabindex="-1"></a>  <span class="at">overall =</span> <span class="cn">FALSE</span></span>
<span id="cb121-2253"><a href="#cb121-2253" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-2254"><a href="#cb121-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2255"><a href="#cb121-2255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2256"><a href="#cb121-2256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2257"><a href="#cb121-2257" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2258"><a href="#cb121-2258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2259"><a href="#cb121-2259" aria-hidden="true" tabindex="-1"></a>If we want to model <span class="in">`Sepal.Length`</span> by species, we could create a variable $X$ that represents "setosa" as $X=1$, "virginica" as $X=2$, and "versicolor" as $X=3$.</span>
<span id="cb121-2260"><a href="#cb121-2260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2263"><a href="#cb121-2263" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2264"><a href="#cb121-2264" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-numeric-coding</span></span>
<span id="cb121-2265"><a href="#cb121-2265" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "`iris` data with numeric coding of species"</span></span>
<span id="cb121-2266"><a href="#cb121-2266" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris) <span class="co"># this step is not always necessary, but ensures you're starting  </span></span>
<span id="cb121-2267"><a href="#cb121-2267" aria-hidden="true" tabindex="-1"></a><span class="co"># from the original version of a dataset stored in a loaded package</span></span>
<span id="cb121-2268"><a href="#cb121-2268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2269"><a href="#cb121-2269" aria-hidden="true" tabindex="-1"></a>iris <span class="ot">=</span> </span>
<span id="cb121-2270"><a href="#cb121-2270" aria-hidden="true" tabindex="-1"></a>  iris <span class="sc">|&gt;</span> </span>
<span id="cb121-2271"><a href="#cb121-2271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-2272"><a href="#cb121-2272" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-2273"><a href="#cb121-2273" aria-hidden="true" tabindex="-1"></a>    <span class="at">X =</span> <span class="fu">case_when</span>(</span>
<span id="cb121-2274"><a href="#cb121-2274" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"setosa"</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb121-2275"><a href="#cb121-2275" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"virginica"</span> <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb121-2276"><a href="#cb121-2276" aria-hidden="true" tabindex="-1"></a>      Species <span class="sc">==</span> <span class="st">"versicolor"</span> <span class="sc">~</span> <span class="dv">3</span></span>
<span id="cb121-2277"><a href="#cb121-2277" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb121-2278"><a href="#cb121-2278" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb121-2279"><a href="#cb121-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2280"><a href="#cb121-2280" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb121-2281"><a href="#cb121-2281" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Species, X)</span>
<span id="cb121-2282"><a href="#cb121-2282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2283"><a href="#cb121-2283" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2284"><a href="#cb121-2284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2285"><a href="#cb121-2285" aria-hidden="true" tabindex="-1"></a>Then we could fit a model like:</span>
<span id="cb121-2286"><a href="#cb121-2286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2289"><a href="#cb121-2289" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2290"><a href="#cb121-2290" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-numeric-species</span></span>
<span id="cb121-2291"><a href="#cb121-2291" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Model of `iris` data with numeric coding of `Species`"</span></span>
<span id="cb121-2292"><a href="#cb121-2292" aria-hidden="true" tabindex="-1"></a>iris_lm1 <span class="ot">=</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> X, <span class="at">data =</span> iris)</span>
<span id="cb121-2293"><a href="#cb121-2293" aria-hidden="true" tabindex="-1"></a>iris_lm1 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-2294"><a href="#cb121-2294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2295"><a href="#cb121-2295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2296"><a href="#cb121-2296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2297"><a href="#cb121-2297" aria-hidden="true" tabindex="-1"></a><span class="fu">### Let's see how that model looks:</span></span>
<span id="cb121-2298"><a href="#cb121-2298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2301"><a href="#cb121-2301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2302"><a href="#cb121-2302" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-numeric-species-model</span></span>
<span id="cb121-2303"><a href="#cb121-2303" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Model of `iris` data with numeric coding of `Species`"</span></span>
<span id="cb121-2304"><a href="#cb121-2304" aria-hidden="true" tabindex="-1"></a>iris_plot1 <span class="ot">=</span> iris <span class="sc">|&gt;</span> </span>
<span id="cb121-2305"><a href="#cb121-2305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb121-2306"><a href="#cb121-2306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb121-2307"><a href="#cb121-2307" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> X, </span>
<span id="cb121-2308"><a href="#cb121-2308" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> Sepal.Length)</span>
<span id="cb121-2309"><a href="#cb121-2309" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb121-2310"><a href="#cb121-2310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb121-2311"><a href="#cb121-2311" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb121-2312"><a href="#cb121-2312" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">1</span>], </span>
<span id="cb121-2313"><a href="#cb121-2313" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb121-2314"><a href="#cb121-2314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb121-2315"><a href="#cb121-2315" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(iris_plot1)</span>
<span id="cb121-2316"><a href="#cb121-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2317"><a href="#cb121-2317" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2318"><a href="#cb121-2318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2319"><a href="#cb121-2319" aria-hidden="true" tabindex="-1"></a>We have forced the model to use a straight line for the three estimated means. Maybe not a good idea?</span>
<span id="cb121-2320"><a href="#cb121-2320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2321"><a href="#cb121-2321" aria-hidden="true" tabindex="-1"></a><span class="fu">### Let's see what R does with categorical variables by default:</span></span>
<span id="cb121-2322"><a href="#cb121-2322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2325"><a href="#cb121-2325" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2326"><a href="#cb121-2326" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-model-factor1</span></span>
<span id="cb121-2327"><a href="#cb121-2327" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Model of `iris` data with `Species` as a categorical variable"</span></span>
<span id="cb121-2328"><a href="#cb121-2328" aria-hidden="true" tabindex="-1"></a>iris_lm2 <span class="ot">=</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Species, <span class="at">data =</span> iris)</span>
<span id="cb121-2329"><a href="#cb121-2329" aria-hidden="true" tabindex="-1"></a>iris_lm2 <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-2330"><a href="#cb121-2330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2331"><a href="#cb121-2331" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2332"><a href="#cb121-2332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2333"><a href="#cb121-2333" aria-hidden="true" tabindex="-1"></a><span class="fu">### Re-parametrize with no intercept</span></span>
<span id="cb121-2334"><a href="#cb121-2334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2335"><a href="#cb121-2335" aria-hidden="true" tabindex="-1"></a>If you don't want the default and offset option, you can use "-1" like we've seen previously:</span>
<span id="cb121-2336"><a href="#cb121-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2339"><a href="#cb121-2339" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2340"><a href="#cb121-2340" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-no-intcpt</span></span>
<span id="cb121-2341"><a href="#cb121-2341" aria-hidden="true" tabindex="-1"></a>iris.lm2b <span class="ot">=</span> <span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Species <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> iris)</span>
<span id="cb121-2342"><a href="#cb121-2342" aria-hidden="true" tabindex="-1"></a>iris.lm2b <span class="sc">|&gt;</span> <span class="fu">parameters</span>() <span class="sc">|&gt;</span> <span class="fu">print_md</span>()</span>
<span id="cb121-2343"><a href="#cb121-2343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2344"><a href="#cb121-2344" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2345"><a href="#cb121-2345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2346"><a href="#cb121-2346" aria-hidden="true" tabindex="-1"></a><span class="fu">### Let's see what these new models look like:</span></span>
<span id="cb121-2347"><a href="#cb121-2347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2350"><a href="#cb121-2350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2351"><a href="#cb121-2351" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-iris-no-intcpt</span></span>
<span id="cb121-2352"><a href="#cb121-2352" aria-hidden="true" tabindex="-1"></a>iris_plot2 <span class="ot">=</span> </span>
<span id="cb121-2353"><a href="#cb121-2353" aria-hidden="true" tabindex="-1"></a>  iris <span class="sc">|&gt;</span> </span>
<span id="cb121-2354"><a href="#cb121-2354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb121-2355"><a href="#cb121-2355" aria-hidden="true" tabindex="-1"></a>    <span class="at">predlm2 =</span> <span class="fu">predict</span>(iris_lm2)) <span class="sc">|&gt;</span> </span>
<span id="cb121-2356"><a href="#cb121-2356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(X) <span class="sc">|&gt;</span> </span>
<span id="cb121-2357"><a href="#cb121-2357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb121-2358"><a href="#cb121-2358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb121-2359"><a href="#cb121-2359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predlm2), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb121-2360"><a href="#cb121-2360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(</span>
<span id="cb121-2361"><a href="#cb121-2361" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">1</span>], </span>
<span id="cb121-2362"><a href="#cb121-2362" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">coef</span>(iris_lm1)[<span class="dv">2</span>]) <span class="sc">+</span> </span>
<span id="cb121-2363"><a href="#cb121-2363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb121-2364"><a href="#cb121-2364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2365"><a href="#cb121-2365" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(iris_plot2)</span>
<span id="cb121-2366"><a href="#cb121-2366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2367"><a href="#cb121-2367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2368"><a href="#cb121-2368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2369"><a href="#cb121-2369" aria-hidden="true" tabindex="-1"></a><span class="fu">### Let's see how R did that:</span></span>
<span id="cb121-2370"><a href="#cb121-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2373"><a href="#cb121-2373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2374"><a href="#cb121-2374" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-model-matrix-factor</span></span>
<span id="cb121-2375"><a href="#cb121-2375" aria-hidden="true" tabindex="-1"></a><span class="fu">formula</span>(iris_lm2)</span>
<span id="cb121-2376"><a href="#cb121-2376" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(iris_lm2) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb121-2377"><a href="#cb121-2377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2378"><a href="#cb121-2378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2379"><a href="#cb121-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2380"><a href="#cb121-2380" aria-hidden="true" tabindex="-1"></a>This format is called a "corner point parametrization" </span>
<span id="cb121-2381"><a href="#cb121-2381" aria-hidden="true" tabindex="-1"></a>(e.g., in @dobson4e) or "treatment coding" (e.g., in @dunn2018generalized).</span>
<span id="cb121-2382"><a href="#cb121-2382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2383"><a href="#cb121-2383" aria-hidden="true" tabindex="-1"></a>The default contrasts are controlled by <span class="in">`options("contrasts")`</span>:</span>
<span id="cb121-2384"><a href="#cb121-2384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2387"><a href="#cb121-2387" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2388"><a href="#cb121-2388" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"contrasts"</span>)</span>
<span id="cb121-2389"><a href="#cb121-2389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2390"><a href="#cb121-2390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2391"><a href="#cb121-2391" aria-hidden="true" tabindex="-1"></a>See <span class="in">`?options`</span> for more details.</span>
<span id="cb121-2392"><a href="#cb121-2392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2393"><a href="#cb121-2393" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2394"><a href="#cb121-2394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2397"><a href="#cb121-2397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2398"><a href="#cb121-2398" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-iris-group-point-parameterization</span></span>
<span id="cb121-2399"><a href="#cb121-2399" aria-hidden="true" tabindex="-1"></a><span class="fu">formula</span>(iris.lm2b)</span>
<span id="cb121-2400"><a href="#cb121-2400" aria-hidden="true" tabindex="-1"></a><span class="fu">model.matrix</span>(iris.lm2b) <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb121-2401"><a href="#cb121-2401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2402"><a href="#cb121-2402" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2403"><a href="#cb121-2403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2404"><a href="#cb121-2404" aria-hidden="true" tabindex="-1"></a>This format is called a "group point parametrization" (e.g., in @dobson4e).</span>
<span id="cb121-2405"><a href="#cb121-2405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2406"><a href="#cb121-2406" aria-hidden="true" tabindex="-1"></a>There are more options; see @dobson4e §6.4.1 and the </span>
<span id="cb121-2407"><a href="#cb121-2407" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">`codingMatrices` package</span><span class="co">](https://CRAN.R-project.org/package=codingMatrices)</span> </span>
<span id="cb121-2408"><a href="#cb121-2408" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">vignette</span><span class="co">](https://cran.r-project.org/web/packages/codingMatrices/vignettes/codingMatrices.pdf)</span> </span>
<span id="cb121-2409"><a href="#cb121-2409" aria-hidden="true" tabindex="-1"></a>(@venablescodingMatrices).</span>
<span id="cb121-2410"><a href="#cb121-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2411"><a href="#cb121-2411" aria-hidden="true" tabindex="-1"></a><span class="fu">## Ordinal covariates</span></span>
<span id="cb121-2412"><a href="#cb121-2412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2413"><a href="#cb121-2413" aria-hidden="true" tabindex="-1"></a>(c.f. @dobson4e §2.4.4)</span>
<span id="cb121-2414"><a href="#cb121-2414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2415"><a href="#cb121-2415" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2416"><a href="#cb121-2416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2417"><a href="#cb121-2417" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb121-2418"><a href="#cb121-2418" aria-hidden="true" tabindex="-1"></a>We can create ordinal variables in R using the <span class="in">`ordered()`</span> function^<span class="co">[</span><span class="ot">or equivalently, `factor(ordered = TRUE)`</span><span class="co">]</span>.</span>
<span id="cb121-2419"><a href="#cb121-2419" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-2420"><a href="#cb121-2420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2421"><a href="#cb121-2421" aria-hidden="true" tabindex="-1"></a>:::{#exm-ordinal-variable}</span>
<span id="cb121-2422"><a href="#cb121-2422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2425"><a href="#cb121-2425" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2426"><a href="#cb121-2426" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb121-2427"><a href="#cb121-2427" aria-hidden="true" tabindex="-1"></a>url <span class="ot">=</span> <span class="fu">paste0</span>(</span>
<span id="cb121-2428"><a href="#cb121-2428" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://regression.ucsf.edu/sites/g/files/tkssra6706/"</span>,</span>
<span id="cb121-2429"><a href="#cb121-2429" aria-hidden="true" tabindex="-1"></a>  <span class="st">"f/wysiwyg/home/data/hersdata.dta"</span>)</span>
<span id="cb121-2430"><a href="#cb121-2430" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb121-2431"><a href="#cb121-2431" aria-hidden="true" tabindex="-1"></a>hers <span class="ot">=</span> <span class="fu">read_dta</span>(url)</span>
<span id="cb121-2432"><a href="#cb121-2432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2433"><a href="#cb121-2433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2436"><a href="#cb121-2436" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2437"><a href="#cb121-2437" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb121-2438"><a href="#cb121-2438" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb121-2439"><a href="#cb121-2439" aria-hidden="true" tabindex="-1"></a>hers <span class="ot">=</span> <span class="fu">read_stata</span>(<span class="st">"Data/hersdata.dta"</span>)</span>
<span id="cb121-2440"><a href="#cb121-2440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2441"><a href="#cb121-2441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2444"><a href="#cb121-2444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2445"><a href="#cb121-2445" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "HERS dataset"</span></span>
<span id="cb121-2446"><a href="#cb121-2446" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-HERS</span></span>
<span id="cb121-2447"><a href="#cb121-2447" aria-hidden="true" tabindex="-1"></a>hers <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb121-2448"><a href="#cb121-2448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb121-2449"><a href="#cb121-2449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2450"><a href="#cb121-2450" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb121-2451"><a href="#cb121-2451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2452"><a href="#cb121-2452" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb121-2453"><a href="#cb121-2453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2456"><a href="#cb121-2456" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb121-2457"><a href="#cb121-2457" aria-hidden="true" tabindex="-1"></a><span class="co"># C(contr = codingMatrices::contr.diff)</span></span>
<span id="cb121-2458"><a href="#cb121-2458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2459"><a href="#cb121-2459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-2460"><a href="#cb121-2460" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
<li class="nav-item">
 Copyright 2024, Douglas Ezra Morrison
  </li>  
</ul>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/d-morrison/rme/edit/main/Linear-models-overview.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>


</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Models for Binary Outcomes – Regression Models for Epidemiology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./count-regression.html" rel="next">
<link href="./Linear-models-overview.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-d4d76bf8491c20bad77d141916dc28e1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-4379b0ccadffce622b03caf4c46266b3.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-a34d670291f06f286357e447776a572a.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c1bc4f463887108f52ae36d18b6ee8b3.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-W625DGE908"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-W625DGE908', { 'anonymize_ip': true});
</script>
<script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false,
  "enableExperimentalNewNoteButton": true
}
</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./logistic-regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Regression Models for Epidemiology</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/d-morrison/rme" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Regression-Models-for-Epidemiology.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Intro-to-GLMs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./glms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generalized Linear Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Linear-models-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistic-regression.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./count-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Models for Count Outcomes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-multilevel-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Introduction to multi-level models for correlated data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./time-to-event-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Time to Event Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to Survival Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./proportional-hazards-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Proportional Hazards Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parametric-survival-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Parametric survival models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendices-are-prereqs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Overview of Appendices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./math-prereqs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Mathematics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">E</span>&nbsp; <span class="chapter-title">Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-MLEs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">F</span>&nbsp; <span class="chapter-title">Introduction to Maximum Likelihood Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">G</span>&nbsp; <span class="chapter-title">Introduction to Bayesian inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./common-mistakes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">H</span>&nbsp; <span class="chapter-title">Common Mistakes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">I</span>&nbsp; <span class="chapter-title">Notation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-to-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">J</span>&nbsp; <span class="chapter-title">Statistical computing in R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CONTRIBUTING.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">K</span>&nbsp; <span class="chapter-title">Contributing to <code>rme</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#configuring-r" id="toc-configuring-r" class="nav-link active" data-scroll-target="#configuring-r">Configuring R</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">3.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#what-is-logistic-regression" id="toc-what-is-logistic-regression" class="nav-link" data-scroll-target="#what-is-logistic-regression"><span class="header-section-number">3.1.1</span> What is logistic regression?</a></li>
  <li><a href="#logistic-regression-versus-linear-regression" id="toc-logistic-regression-versus-linear-regression" class="nav-link" data-scroll-target="#logistic-regression-versus-linear-regression"><span class="header-section-number">3.1.2</span> Logistic regression versus linear regression</a></li>
  </ul></li>
  <li><a href="#risk-estimation-and-prediction" id="toc-risk-estimation-and-prediction" class="nav-link" data-scroll-target="#risk-estimation-and-prediction"><span class="header-section-number">3.2</span> Risk Estimation and Prediction</a></li>
  <li><a href="#comparing-probabilities" id="toc-comparing-probabilities" class="nav-link" data-scroll-target="#comparing-probabilities"><span class="header-section-number">3.3</span> Comparing Probabilities</a>
  <ul class="collapse">
  <li><a href="#risk-differences" id="toc-risk-differences" class="nav-link" data-scroll-target="#risk-differences"><span class="header-section-number">3.3.1</span> Risk differences</a></li>
  <li><a href="#risk-ratios" id="toc-risk-ratios" class="nav-link" data-scroll-target="#risk-ratios"><span class="header-section-number">3.3.2</span> Risk ratios</a></li>
  <li><a href="#relative-risk-differences" id="toc-relative-risk-differences" class="nav-link" data-scroll-target="#relative-risk-differences"><span class="header-section-number">3.3.3</span> Relative risk differences</a></li>
  <li><a href="#changing-reference-groups-in-risk-comparisons" id="toc-changing-reference-groups-in-risk-comparisons" class="nav-link" data-scroll-target="#changing-reference-groups-in-risk-comparisons"><span class="header-section-number">3.3.4</span> Changing reference groups in risk comparisons</a></li>
  </ul></li>
  <li><a href="#odds-and-odds-ratios" id="toc-odds-and-odds-ratios" class="nav-link" data-scroll-target="#odds-and-odds-ratios"><span class="header-section-number">3.4</span> Odds and Odds Ratios</a>
  <ul class="collapse">
  <li><a href="#odds-and-probabilities" id="toc-odds-and-probabilities" class="nav-link" data-scroll-target="#odds-and-probabilities"><span class="header-section-number">3.4.1</span> Odds and probabilities</a></li>
  <li><a href="#the-inverse-odds-function" id="toc-the-inverse-odds-function" class="nav-link" data-scroll-target="#the-inverse-odds-function"><span class="header-section-number">3.4.2</span> The inverse odds function</a></li>
  <li><a href="#odds-ratios" id="toc-odds-ratios" class="nav-link" data-scroll-target="#odds-ratios"><span class="header-section-number">3.4.3</span> Odds ratios</a></li>
  </ul></li>
  <li><a href="#the-logit-and-expit-functions" id="toc-the-logit-and-expit-functions" class="nav-link" data-scroll-target="#the-logit-and-expit-functions"><span class="header-section-number">3.5</span> The logit and expit functions</a>
  <ul class="collapse">
  <li><a href="#the-logit-function" id="toc-the-logit-function" class="nav-link" data-scroll-target="#the-logit-function"><span class="header-section-number">3.5.1</span> The logit function</a></li>
  <li><a href="#the-expit-function" id="toc-the-expit-function" class="nav-link" data-scroll-target="#the-expit-function"><span class="header-section-number">3.5.2</span> The expit function</a></li>
  <li><a href="#sec-expit-logit-diagram" id="toc-sec-expit-logit-diagram" class="nav-link" data-scroll-target="#sec-expit-logit-diagram"><span class="header-section-number">3.5.3</span> Diagram of expit and logit</a></li>
  </ul></li>
  <li><a href="#introduction-to-logistic-regression" id="toc-introduction-to-logistic-regression" class="nav-link" data-scroll-target="#introduction-to-logistic-regression"><span class="header-section-number">3.6</span> Introduction to logistic regression</a>
  <ul class="collapse">
  <li><a href="#binary-outcomes-models---one-group-no-covariates" id="toc-binary-outcomes-models---one-group-no-covariates" class="nav-link" data-scroll-target="#binary-outcomes-models---one-group-no-covariates"><span class="header-section-number">3.6.1</span> Binary outcomes models - one group, no covariates</a></li>
  <li><a href="#binary-outcomes---general" id="toc-binary-outcomes---general" class="nav-link" data-scroll-target="#binary-outcomes---general"><span class="header-section-number">3.6.2</span> Binary outcomes - general</a></li>
  <li><a href="#modeling-pi_i-as-a-function-of-x_i" id="toc-modeling-pi_i-as-a-function-of-x_i" class="nav-link" data-scroll-target="#modeling-pi_i-as-a-function-of-x_i"><span class="header-section-number">3.6.3</span> Modeling <span class="math inline">\(\pi_i\)</span> as a function of <span class="math inline">\(X_i\)</span></a></li>
  <li><a href="#meet-the-beetles" id="toc-meet-the-beetles" class="nav-link" data-scroll-target="#meet-the-beetles"><span class="header-section-number">3.6.4</span> Meet the beetles</a></li>
  <li><a href="#why-dont-we-use-linear-regression" id="toc-why-dont-we-use-linear-regression" class="nav-link" data-scroll-target="#why-dont-we-use-linear-regression"><span class="header-section-number">3.6.5</span> Why don’t we use linear regression?</a></li>
  <li><a href="#zoom-out" id="toc-zoom-out" class="nav-link" data-scroll-target="#zoom-out"><span class="header-section-number">3.6.6</span> Zoom out</a></li>
  <li><a href="#log-transformation-of-dose" id="toc-log-transformation-of-dose" class="nav-link" data-scroll-target="#log-transformation-of-dose"><span class="header-section-number">3.6.7</span> log transformation of dose?</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression"><span class="header-section-number">3.6.8</span> Logistic regression</a></li>
  <li><a href="#three-parts-to-regression-models" id="toc-three-parts-to-regression-models" class="nav-link" data-scroll-target="#three-parts-to-regression-models"><span class="header-section-number">3.6.9</span> Three parts to regression models</a></li>
  <li><a href="#logistic-regression-in-r" id="toc-logistic-regression-in-r" class="nav-link" data-scroll-target="#logistic-regression-in-r"><span class="header-section-number">3.6.10</span> Logistic regression in R</a></li>
  <li><a href="#individual-observations" id="toc-individual-observations" class="nav-link" data-scroll-target="#individual-observations"><span class="header-section-number">3.6.11</span> Individual observations</a></li>
  </ul></li>
  <li><a href="#multiple-logistic-regression" id="toc-multiple-logistic-regression" class="nav-link" data-scroll-target="#multiple-logistic-regression"><span class="header-section-number">3.7</span> Multiple logistic regression</a>
  <ul class="collapse">
  <li><a href="#coronary-heart-disease-wcgs-study-data" id="toc-coronary-heart-disease-wcgs-study-data" class="nav-link" data-scroll-target="#coronary-heart-disease-wcgs-study-data"><span class="header-section-number">3.7.1</span> Coronary heart disease (WCGS) study data</a></li>
  <li><a href="#baseline-data-collection" id="toc-baseline-data-collection" class="nav-link" data-scroll-target="#baseline-data-collection"><span class="header-section-number">3.7.2</span> Baseline data collection</a></li>
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data"><span class="header-section-number">3.7.3</span> Load the data</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning"><span class="header-section-number">3.7.4</span> Data cleaning</a></li>
  <li><a href="#whats-in-the-data" id="toc-whats-in-the-data" class="nav-link" data-scroll-target="#whats-in-the-data"><span class="header-section-number">3.7.5</span> What’s in the data</a></li>
  <li><a href="#data-by-age-and-personality-type" id="toc-data-by-age-and-personality-type" class="nav-link" data-scroll-target="#data-by-age-and-personality-type"><span class="header-section-number">3.7.6</span> Data by age and personality type</a></li>
  <li><a href="#graphical-exploration" id="toc-graphical-exploration" class="nav-link" data-scroll-target="#graphical-exploration"><span class="header-section-number">3.7.7</span> Graphical exploration</a></li>
  <li><a href="#logistic-regression-models-for-chd-data" id="toc-logistic-regression-models-for-chd-data" class="nav-link" data-scroll-target="#logistic-regression-models-for-chd-data"><span class="header-section-number">3.7.8</span> Logistic regression models for CHD data</a></li>
  <li><a href="#models-superimposed-on-data" id="toc-models-superimposed-on-data" class="nav-link" data-scroll-target="#models-superimposed-on-data"><span class="header-section-number">3.7.9</span> Models superimposed on data</a></li>
  <li><a href="#reference-group-and-contrast-parametrization" id="toc-reference-group-and-contrast-parametrization" class="nav-link" data-scroll-target="#reference-group-and-contrast-parametrization"><span class="header-section-number">3.7.10</span> reference-group and contrast parametrization</a></li>
  </ul></li>
  <li><a href="#fitting-logistic-regression-models" id="toc-fitting-logistic-regression-models" class="nav-link" data-scroll-target="#fitting-logistic-regression-models"><span class="header-section-number">3.8</span> Fitting logistic regression models</a>
  <ul class="collapse">
  <li><a href="#maximum-likelihood-estimation-for-textciid-data" id="toc-maximum-likelihood-estimation-for-textciid-data" class="nav-link" data-scroll-target="#maximum-likelihood-estimation-for-textciid-data"><span class="header-section-number">3.8.1</span> Maximum likelihood estimation for <span class="math inline">\(\text{ciid}\)</span> data</a></li>
  </ul></li>
  <li><a href="#sec-gof" id="toc-sec-gof" class="nav-link" data-scroll-target="#sec-gof"><span class="header-section-number">3.9</span> Model comparisons for logistic models</a>
  <ul class="collapse">
  <li><a href="#deviance-test" id="toc-deviance-test" class="nav-link" data-scroll-target="#deviance-test"><span class="header-section-number">3.9.1</span> Deviance test</a></li>
  <li><a href="#hosmer-lemeshow-test" id="toc-hosmer-lemeshow-test" class="nav-link" data-scroll-target="#hosmer-lemeshow-test"><span class="header-section-number">3.9.2</span> Hosmer-Lemeshow test</a></li>
  <li><a href="#comparing-models" id="toc-comparing-models" class="nav-link" data-scroll-target="#comparing-models"><span class="header-section-number">3.9.3</span> Comparing models</a></li>
  </ul></li>
  <li><a href="#residual-based-diagnostics" id="toc-residual-based-diagnostics" class="nav-link" data-scroll-target="#residual-based-diagnostics"><span class="header-section-number">3.10</span> Residual-based diagnostics</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-residuals-only-work-for-grouped-data" id="toc-logistic-regression-residuals-only-work-for-grouped-data" class="nav-link" data-scroll-target="#logistic-regression-residuals-only-work-for-grouped-data"><span class="header-section-number">3.10.1</span> Logistic regression residuals only work for grouped data</a></li>
  <li><a href="#response-residuals" id="toc-response-residuals" class="nav-link" data-scroll-target="#response-residuals"><span class="header-section-number">3.10.2</span> (Response) residuals</a></li>
  <li><a href="#pearson-residuals" id="toc-pearson-residuals" class="nav-link" data-scroll-target="#pearson-residuals"><span class="header-section-number">3.10.3</span> Pearson residuals</a></li>
  <li><a href="#pearson-chi-squared-goodness-of-fit-test" id="toc-pearson-chi-squared-goodness-of-fit-test" class="nav-link" data-scroll-target="#pearson-chi-squared-goodness-of-fit-test"><span class="header-section-number">3.10.4</span> Pearson chi-squared goodness of fit test</a></li>
  <li><a href="#deviance-residuals" id="toc-deviance-residuals" class="nav-link" data-scroll-target="#deviance-residuals"><span class="header-section-number">3.10.5</span> Deviance residuals</a></li>
  <li><a href="#diagnostic-plots" id="toc-diagnostic-plots" class="nav-link" data-scroll-target="#diagnostic-plots"><span class="header-section-number">3.10.6</span> Diagnostic plots</a></li>
  </ul></li>
  <li><a href="#objections-to-reporting-odds-ratios" id="toc-objections-to-reporting-odds-ratios" class="nav-link" data-scroll-target="#objections-to-reporting-odds-ratios"><span class="header-section-number">3.11</span> Objections to reporting odds ratios</a></li>
  <li><a href="#other-link-functions-for-bernoulli-outcomes" id="toc-other-link-functions-for-bernoulli-outcomes" class="nav-link" data-scroll-target="#other-link-functions-for-bernoulli-outcomes"><span class="header-section-number">3.12</span> Other link functions for Bernoulli outcomes</a>
  <ul class="collapse">
  <li><a href="#wcgs-link-functions" id="toc-wcgs-link-functions" class="nav-link" data-scroll-target="#wcgs-link-functions"><span class="header-section-number">3.12.1</span> WCGS: link functions</a></li>
  </ul></li>
  <li><a href="#quasibinomial" id="toc-quasibinomial" class="nav-link" data-scroll-target="#quasibinomial"><span class="header-section-number">3.13</span> Quasibinomial</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">3.14</span> Further reading</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/d-morrison/rme/edit/main/logistic-regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./glms.html">Generalized Linear Models</a></li><li class="breadcrumb-item"><a href="./logistic-regression.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-Bernoulli-models" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Models for Binary Outcomes</span></span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Logistic regression and variations</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Last modified: 2025-04-15: 20:42:47 (PM)</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<hr>
<!-- ::: {.content-hidden when-format="revealjs"} -->
<hr>
<section id="configuring-r" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="configuring-r">Configuring R</h3>
<p>Functions from these packages will be used throughout this document:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted) <span class="co"># check for conflicting function definitions</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># library(printr) # inserts help-file output into markdown output</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rmarkdown) <span class="co"># Convert R Markdown documents into a variety of formats.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander) <span class="co"># format tables for markdown</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># graphics</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeasy) <span class="co"># help with graphics</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify) <span class="co"># help with graphics</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># manipulate data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble) <span class="co"># `tibble`s extend `data.frame`s</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr) <span class="co"># `%&gt;%` and other additional piping tools</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># import Stata files</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co"># format R output for markdown</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># Tools to help to create tidy data</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly) <span class="co"># interactive graphics</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dobson) <span class="co"># datasets from Dobson and Barnett 2018</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters) <span class="co"># format model output tables for markdown</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven) <span class="co"># import Stata files</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp) <span class="co"># use LaTeX in R code (for figures and tables)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs) <span class="co"># filesystem path manipulations</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival) <span class="co"># survival analysis</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer) <span class="co"># survival analysis graphics</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(KMsurv) <span class="co"># datasets from Klein and Moeschberger</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters) <span class="co"># format model output tables for</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(webshot2) <span class="co"># convert interactive content to static for pdf</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats) <span class="co"># functions for categorical variables ("factors")</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr) <span class="co"># functions for dealing with strings</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># functions for dealing with dates and times</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are some R settings I use in this document:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># delete any data that's already loaded into R</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">theme_set</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ggplot2::labs(col = "") +</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">family =</span> <span class="st">"serif"</span>)))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">'digits'</span> <span class="ot">=</span> <span class="dv">2</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">panderOptions</span>(<span class="st">"big.mark"</span>, <span class="st">","</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">panderOptions</span>(<span class="st">"table.emphasize.rownames"</span>, <span class="cn">FALSE</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>pander<span class="sc">::</span><span class="fu">panderOptions</span>(<span class="st">"table.split.table"</span>, <span class="cn">Inf</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter) <span class="co"># use the `filter()` function from dplyr() by default</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>legend_text_size <span class="ot">=</span> <span class="dv">9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- ::: -->
<style>
.quarto-figure-center > figure {
text-align: center;
}
</style>
</section>
<section id="acknowledgements" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="acknowledgements">Acknowledgements</h3>
<p>This content is adapted from:</p>
<ul>
<li><span class="citation" data-cites="dobson4e">Dobson and Barnett (<a href="references.html#ref-dobson4e" role="doc-biblioref">2018</a>)</span>, Chapter 7</li>
<li><span class="citation" data-cites="vittinghoff2e">Vittinghoff et al. (<a href="references.html#ref-vittinghoff2e" role="doc-biblioref">2012</a>)</span>, Chapter 5</li>
<li><a href="https://dmrocke.ucdavis.edu/">David Rocke</a>’s materials from the <a href="https://dmrocke.ucdavis.edu/Class/EPI204-Spring-2021/EPI204-Spring-2021.html">2021 edition of Epi 204</a></li>
<li><span class="citation" data-cites="NahhasIRMPHR">Nahhas (<a href="references.html#ref-NahhasIRMPHR" role="doc-biblioref">2024</a>)</span> <a href="https://www.bookdown.org/rwnahhas/RMPH/blr.html">Chapter 6</a></li>
</ul>
</section>
<section id="introduction" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">3.1</span> Introduction</h2>
<section id="what-is-logistic-regression" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="what-is-logistic-regression"><span class="header-section-number">3.1.1</span> What is logistic regression?</h3>
<p><strong>Logistic regression</strong> is a framework for modeling <a href="./probability.html#def-binary">binary</a> outcomes, conditional on one or more <em>predictors</em> (a.k.a. <em>covariates</em>).</p>
<hr>
<div id="exr-binary-examples" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.1 (Examples of binary outcomes)</strong></span> What are some examples of binary outcomes in the health sciences?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>Examples of binary outcomes include:</p>
<ul>
<li>exposure (exposed vs unexposed)</li>
<li>disease (diseased vs healthy)</li>
<li>recovery (recovered vs unrecovered)</li>
<li>relapse (relapse vs remission)</li>
<li>return to hospital (returned vs not)</li>
<li>vital status (dead vs alive)</li>
</ul>
</div>
<hr>
<p>Logistic regression uses the <a href="./probability.html#def-bernoulli">Bernoulli</a> distribution to model the outcome variable, conditional on one or more covariates.</p>
<hr>
<div id="exr-def-bernoulli" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.2</strong></span> Write down a mathematical definition of the Bernoulli distribution.</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>The <strong>Bernoulli distribution</strong> family for a random variable <span class="math inline">\(X\)</span> is defined as:</p>
<p><span class="math display">\[
\begin{aligned}
\Pr(X=x) &amp;= \mathbb{1}_{x\in \left\{0,1\right\}}\pi^x(1-\pi)^{1-x}\\
&amp;= \left\{{\pi, x=1}\atop{1-\pi, x=0}\right.
\end{aligned}
\]</span></p>
</div>
<hr>
</section>
<section id="logistic-regression-versus-linear-regression" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="logistic-regression-versus-linear-regression"><span class="header-section-number">3.1.2</span> Logistic regression versus linear regression</h3>
<p>Logistic regression differs from linear regression, which uses the Gaussian (“normal”) distribution to model the outcome variable, conditional on the covariates.</p>
<hr>
<div id="exr-linear" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.3</strong></span> Recall: what kinds of outcomes is linear regression used for?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span>Linear regression is typically used for numerical outcomes that aren’t event counts or waiting times for an event. Examples of outcomes that are often analyzed using linear regression include include weight, height, and income.</p>
</div>
</section>
</section>
<section id="risk-estimation-and-prediction" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="risk-estimation-and-prediction"><span class="header-section-number">3.2</span> Risk Estimation and Prediction</h2>
<div class="notes">
<p>In Epi 203, you have already seen methods for modeling binary outcomes using one covariate that is also binary (such as exposure/non-exposure). In this section, we review one-covariate analyses, with a special focus on risk ratios and odds ratios, which are important concepts for interpreting logistic regression.</p>
</div>
<hr>
<div id="exm-oc-mi" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.1 (Oral Contraceptive Use and Heart Attack)</strong></span> &nbsp;</p>
<ul>
<li>Research question: how does oral contraceptive (OC) use affect the risk of myocardial infarction (MI; a.k.a. heart attack)?</li>
</ul>
<div class="notes">
<p>This was an issue when oral contraceptives were first developed, because the original formulations used higher concentrations of hormones. Modern OCs don’t have this issue.</p>
<p><a href="#tbl-oc-mi" class="quarto-xref">Table&nbsp;<span>3.1</span></a> contains simulated data for an imaginary follow-up (a.k.a. <em>prospective</em>) study in which two groups are identified, one using OCs and another not using OCs, and both groups are tracked for three years to determine how many in each groups have MIs.</p>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>oc_mi <span class="ot">&lt;-</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tribble</span>(</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>OC, <span class="sc">~</span>MI, <span class="sc">~</span>Total,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OC use"</span>, <span class="dv">13</span>, <span class="dv">5000</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"No OC use"</span>, <span class="dv">7</span>, <span class="dv">10000</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span> <span class="ot">=</span> Total <span class="sc">-</span> MI) <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, <span class="at">.after =</span> MI)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  oc_mi <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(MI, <span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, Total), sum)) <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OC =</span> <span class="st">"Total"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>tbl_oc_mi <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(oc_mi, totals)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>tbl_oc_mi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-oc-mi" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-oc-mi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.1: Simulated data from study of oral contraceptive use and heart attack risk
</figcaption>
<div aria-describedby="tbl-oc-mi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["OC"],"name":[1],"type":["chr"],"align":["left"]},{"label":["MI"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["No MI"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Total"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"OC use","2":"13","3":"4987","4":"5000"},{"1":"No OC use","2":"7","3":"9993","4":"10000"},{"1":"Total","2":"20","3":"14980","4":"15000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</figure>
</div>
</div>
<hr>
<div id="exr-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.4</strong></span> Review: estimate the probabilities of MI for OC users and non-OC users in <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>.</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[\hat{\text{p}}(MI|OC) = \frac{13}{5000} = 0\]</span></p>
<p><span class="math display">\[\hat{\text{p}}(MI|\neg OC) = \frac{7}{10000} = 7\times 10^{-4}\]</span></p>
</div>
<hr>
<section id="controls" class="level4">
<h4 class="anchored" data-anchor-id="controls">Controls</h4>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Two meanings of “controls”
</div>
</div>
<div class="callout-body-container callout-body">
<p>Depending on context, “controls” can mean either individuals who don’t experience an <em>exposure</em> of interest, or individuals who don’t experience an <em>outcome</em> of interest.</p>
</div>
</div>
<hr>
<div id="def-cases-retrospective" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.1 (cases and controls in retrospective studies)</strong></span> In <em>retrospective studies</em>, participants who experience the outcome of interest are called <strong>cases</strong>, while participants who don’t experience that outcome are called <strong>controls</strong>.</p>
</div>
<hr>
<div id="def-cases-prospective" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.2 (treatment groups and control groups in prospective studies)</strong></span> In <em>prospective studies</em>, the group of participants who experience the treatment or exposure of interest is called the <strong>treatment group</strong>, while the participants who receive the baseline or comparison treatment (for example, clinical trial participants who receive a placebo or a standard-of-care treatment rather than an experimental treatment) are called <strong>controls</strong>.</p>
</div>
</section>
</section>
<section id="comparing-probabilities" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="comparing-probabilities"><span class="header-section-number">3.3</span> Comparing Probabilities</h2>
<section id="risk-differences" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="risk-differences"><span class="header-section-number">3.3.1</span> Risk differences</h3>
<div class="notes">
<p>The simplest comparison of two probabilities, <span class="math inline">\(\pi_1\)</span>, and <span class="math inline">\(\pi_2\)</span>, is the difference of their values:</p>
</div>
<div id="def-RD" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.3 (Risk difference)</strong></span> The <strong>risk difference</strong> of two probabilities, <span class="math inline">\(\pi_1\)</span>, and <span class="math inline">\(\pi_2\)</span>, is the difference of their values: <span class="math display">\[\delta(\pi_1,\pi_2) \stackrel{\text{def}}{=}\pi_1 - \pi_2\]</span></p>
</div>
<hr>
<div id="exm-RD" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.2 (Difference in MI risk)</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, the maximum likelihood estimate of the difference in MI risk between OC users and OC non-users is:</p>
<p><span class="math display">\[
\begin{aligned}
\hat\delta(\pi(OC), \pi(\neg OC))
&amp;= \delta(\hat\pi(OC), \hat\pi(\neg OC))\\
&amp;= \hat\pi(OC) - \hat\pi(\neg OC)\\
&amp;= 0 - 7\times 10^{-4}\\
&amp;= 0
\end{aligned}
\]</span></p>
</div>
<hr>
</section>
<section id="risk-ratios" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="risk-ratios"><span class="header-section-number">3.3.2</span> Risk ratios</h3>
<div id="def-RR" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.4 (Relative risk ratios)</strong></span> &nbsp;</p>
<div class="notes">
<p>The <strong>relative risk</strong> of probability <span class="math inline">\(\pi_1\)</span> compared to another probability <span class="math inline">\(\pi_2\)</span>, also called the <strong>risk ratio</strong>, <strong>relative risk ratio</strong>, <strong>probability ratio</strong>, or <strong>rate ratio</strong>, is the ratio of those probabilities:</p>
</div>
<p><span class="math display">\[\rho(\pi_1,\pi_2) = \frac{\pi_1}{\pi_2}\]</span></p>
</div>
<hr>
<div id="exm-RR" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.3</strong></span> &nbsp;</p>
<div class="notes">
<p>Above, we estimated that:</p>
</div>
<p><span class="math display">\[\hat{\text{p}}(MI|OC) = 0\]</span></p>
<p><span class="math display">\[\hat{\text{p}}(MI|\neg OC) = 7\times 10^{-4}\]</span></p>
<div class="notes">
<p>So we might estimate that the <em>relative risk</em> of MI for OC versus non-OC is:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">&lt;-</span> (<span class="dv">13</span> <span class="sc">/</span> <span class="dv">5000</span>) <span class="sc">/</span> (<span class="dv">7</span> <span class="sc">/</span> <span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><span class="math display">\[
\begin{aligned}
\hat\rho(OC, \neg OC)
&amp;=\frac{\hat{\text{p}}(MI|OC)}{\hat{\text{p}}(MI|\neg OC)}\\
&amp;= \frac{0}{7\times 10^{-4}}\\
&amp;= 3.71
\end{aligned}
\]</span></p>
<div class="notes">
<p>We might summarize this result by saying that “the estimated probability of MI among OC users was 3.71 as high as the estimated probability among OC non-users.</p>
</div>
</div>
<hr>
</section>
<section id="relative-risk-differences" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="relative-risk-differences"><span class="header-section-number">3.3.3</span> Relative risk differences</h3>
<div id="def-RRD" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.5 (Relative risk difference)</strong></span> &nbsp;</p>
<div class="notes">
<p>Sometimes, we divide the risk difference by the comparison probability; the result is called the <strong>relative risk difference</strong>:</p>
</div>
<p><span class="math display">\[\xi(\pi_1,\pi_2) \stackrel{\text{def}}{=}\frac{\delta(\pi_1,\pi_2)}{\pi_2}\]</span></p>
</div>
<hr>
<div id="thm-rrd-vs-rr" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.1 (Relative risk difference equals risk ratio minus 1)</strong></span> <span class="math display">\[\xi(\pi_1,\pi_2) = \rho(\pi_1,\pi_2) - 1\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
\xi(\pi_1,\pi_2)
&amp;\stackrel{\text{def}}{=}\frac{\delta(\pi_1,\pi_2)}{\pi_2}
\\&amp;= \frac{\pi_1-\pi_2}{\pi_2}
\\&amp;= \frac{\pi_1}{\pi_2} - 1
\\&amp;= \rho(\pi_1,\pi_2) - 1
\end{aligned}
\]</span></p>
</div>
<hr>
</section>
<section id="changing-reference-groups-in-risk-comparisons" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="changing-reference-groups-in-risk-comparisons"><span class="header-section-number">3.3.4</span> Changing reference groups in risk comparisons</h3>
<div class="notes">
<p>Risk differences, risk ratios, and relative risk differences are defined by two probabilities, plus a choice of which probability is the <strong>baseline</strong> or <strong>reference</strong> probability (i.e., which probability is the subtrahend of the risk difference or the denominator of the risk ratio).</p>
</div>
<p><span class="math display">\[\delta(\pi_2,\pi_1) = -\delta(\pi_1, \pi_2)\]</span></p>
<p><span class="math display">\[\rho(\pi_2,\pi_1) = \left(\rho(\pi_1,\pi_2)\right)^{-1}\]</span> <span class="math display">\[\xi(\pi_2,\pi_1) = \left(\xi(\pi_2,\pi_1) + 1\right)^{-1} - 1\]</span></p>
<div id="exr-change-ref-group" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.5</strong></span> Prove the relationships above.</p>
</div>
<hr>
<div id="exm-ref" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.4 (Switching the reference group in a risk ratio)</strong></span> Above, we estimated that the risk ratio of OC versus non-OC is:</p>
<p><span class="math display">\[
\begin{aligned}
\rho(OC, \neg OC)
&amp;= 3.71
\end{aligned}
\]</span></p>
<p>In comparison, the risk ratio for non-OC versus OC is:</p>
<p><span class="math display">\[
\begin{aligned}
\rho(\neg OC, OC)
&amp;=\frac{\hat{\text{p}}(MI|\neg OC)}{\hat{\text{p}}(MI|OC)}\\
&amp;= \frac{7\times 10^{-4}}{0}\\
&amp;= 0.27\\
&amp;= \frac{1}{\rho(OC, \neg OC)}
\end{aligned}
\]</span></p>
</div>
</section>
</section>
<section id="odds-and-odds-ratios" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="odds-and-odds-ratios"><span class="header-section-number">3.4</span> Odds and Odds Ratios</h2>
<section id="odds-and-probabilities" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="odds-and-probabilities"><span class="header-section-number">3.4.1</span> Odds and probabilities</h3>
<div class="notes">
<p>In logistic regression, we will make use of a mathematically-convenient transformation of probability, called <em>odds</em>.</p>
</div>
<div id="def-odds" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.6 (Odds)</strong></span> The <strong>odds</strong> of an outcome <span class="math inline">\(A\)</span>, which we will represent using <span class="math inline">\(\omega\)</span> (“omega”), is the probability that the outcome occurs, divided by the probability that it doesn’t occur:</p>
<p><span class="math display">\[\omega(A) \stackrel{\text{def}}{=}\frac{\Pr(A)}{\Pr(\neg A)}\]</span></p>
</div>
<hr>
<div id="thm-prob-to-odds" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.2</strong></span> If the probability of an outcome <span class="math inline">\(A\)</span> is <span class="math inline">\(\Pr(A)=\pi\)</span>, then the corresponding odds of <span class="math inline">\(A\)</span> is:</p>
<p><span id="eq-odds-probs"><span class="math display">\[\text{odds}\left\{\pi\right\} = \frac{\pi}{1-\pi} \tag{3.1}\]</span></span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
\Pr(\neg A) &amp;= 1 - \Pr(A)
\\ &amp;= 1 - \pi
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\therefore\omega(A) &amp;\stackrel{\text{def}}{=}\frac{\Pr(A)}{\Pr(\neg A)}
\\ &amp;= \frac{\pi}{1-\pi}
\end{aligned}
\]</span></p>
</div>
<hr>
<div class="notes">
<p><a href="#eq-odds-probs" class="quarto-xref">Function&nbsp;<span>3.1</span></a>, which transforms probabilities into odds, can be called the <strong>odds function</strong>. <a href="#fig-odds-probs" class="quarto-xref">Figure&nbsp;<span>3.1</span></a> graphs the shape of this function.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="cf">function</span>(pi) pi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pi)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> odds,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"last"</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"odds function"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, .<span class="dv">99</span>) <span class="sc">+</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Odds"</span>) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">"y=x"</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-odds-probs" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-odds-probs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.1: Odds versus probability
</figcaption>
<div aria-describedby="fig-odds-probs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-odds-probs-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<div id="exm-odds" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.5 (Computing odds from probabilities)</strong></span> In <a href="#exr-probs" class="quarto-xref">Exercise&nbsp;<span>3.4</span></a>, we estimated that the probability of MI, given OC use, is <span class="math inline">\(\pi(OC) \stackrel{\text{def}}{=}\Pr(MI|OC) = 0\)</span>. If this estimate is correct, then the odds of MI, given OC use, is:</p>
<p><span class="math display">\[
\begin{aligned}
\omega(OC)
&amp;\stackrel{\text{def}}{=}\frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}\\
&amp;=\frac{\Pr(MI|OC)}{1-\Pr(MI|OC)}\\
&amp;=\frac{\pi(OC)}{1-\pi(OC)}\\
&amp;=\frac{0}{1-0}\\
&amp;\approx 0.002607
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="exr-odds" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.6 (Computing odds from probabilities)</strong></span> Estimate the odds of MI, for non-OC users.</p>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\omega(\neg OC) = 7\times 10^{-4}
\]</span></p>
</div>
</div>
<hr>
<div id="thm-est-odds" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.3 (One-sample MLE for odds)</strong></span> Let <span class="math inline">\(X_1,...X_n\)</span> be a set of <span class="math inline">\(n\)</span> <span class="math inline">\(\text{iid}\)</span> Bernoulli trials, and let <span class="math inline">\(X = \sum_{i=1}^nX_i\)</span> be their sum.</p>
<p>Then the maximum likelihood estimate of the odds of <span class="math inline">\(X=1\)</span>, <span class="math inline">\(\omega\)</span>, is:</p>
<p><span class="math display">\[
\hat{\omega}= \frac{x}{n-x}
\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
1-\hat\pi
&amp;= 1-\frac{x}{n}\\
&amp;= \frac{n}{n} - \frac{x}{n}\\
&amp;= \frac{n - x}{n}
\end{aligned}
\]</span></p>
<p>Thus, the estimated odds is:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\hat\pi}{1-\hat\pi}
&amp;= \frac{\left(\frac{x}{n}\right)}{\left(\frac{n-x}{n}\right)}\\
&amp;= \frac{x}{n-x}
\end{aligned}
\]</span></p>
<div class="notes">
<p>That is, odds can be calculated directly as “# events” divided by “# nonevents” (without needing to calculate <span class="math inline">\(\hat\pi\)</span> and <span class="math inline">\(1-\hat\pi\)</span> first).</p>
</div>
</div>
<hr>
<div id="exm-odds-shortcut" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.6 (calculating odds using the shortcut)</strong></span> In <a href="#exm-odds" class="quarto-xref">Example&nbsp;<span>3.5</span></a>, we calculated <span class="math display">\[
\begin{aligned}
\omega(OC)
&amp;=0
\end{aligned}
\]</span></p>
<p>Let’s recalculate this result using our shortcut.</p>
</div>
<hr>
<div id="sol-odds-shortcut" class="proof solution">
<p><span class="proof-title"><em>Solution 3.1</em>. </span><span class="math display">\[
\begin{aligned}
\omega(OC)
&amp;=\frac{13}{5000-13}\\
&amp;=0
\end{aligned}
\]</span></p>
<p>Same answer as in <a href="#exm-odds" class="quarto-xref">Example&nbsp;<span>3.5</span></a>!</p>
</div>
<hr>
<div id="thm-odds-simplified" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.4 (Simplified expression for odds function)</strong></span> &nbsp;</p>
<div class="notes">
<p>An equivalent expression for the odds function is</p>
</div>
<p><span id="eq-odds-reduced"><span class="math display">\[
\text{odds}\left\{\pi\right\} = \left(\left(\pi\right)^{-1}-1)\right)^{-1}
\tag{3.2}\]</span></span></p>
</div>
<hr>
<div id="exr-odds2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.7</strong></span> Prove that <a href="#eq-odds-reduced" class="quarto-xref">Equation&nbsp;<span>3.2</span></a> is equivalent to <a href="#def-odds" class="quarto-xref">Definition&nbsp;<span>3.6</span></a>.</p>
</div>
<hr>
<div id="thm-deriv-odds" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.5 (Derivative of odds function)</strong></span> <span class="math display">\[{\text{odds}}'\left\{\pi\right\} = \frac{1}{\left(1-\pi\right)^2}\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
{\text{odds}}'\left\{\pi\right\}
   &amp;= \frac{\partial}{\partial \pi}\left(\frac{\pi}{1-\pi}\right)
\\ &amp;=  \frac {\frac{\partial}{\partial \pi}\pi} {1-\pi} -
       \left(\frac{\pi}{\left(1-\pi\right)^2} \cdot\frac{\partial}{\partial \pi}\left(1-\pi\right)\right)
\\ &amp;=  \frac{1}{1-\pi} - \frac{\pi}{\left(1-\pi\right)^2} \cdot(-1)
\\ &amp;=  \frac{1}{1-\pi} + \frac{\pi}{\left(1-\pi\right)^2}
\\ &amp;=  \frac{1-\pi}{\left(1-\pi\right)^2} + \frac{\pi}{\left(1-\pi\right)^2}
\\ &amp;=  \frac{1-\pi + \pi}{\left(1-\pi\right)^2}
\\ &amp;=  \frac{1}{\left(1-\pi\right)^2}
\end{aligned}
\]</span></p>
</div>
<hr>
<section id="odds-of-rare-events" class="level4">
<h4 class="anchored" data-anchor-id="odds-of-rare-events">Odds of rare events</h4>
<p>For rare events (small <span class="math inline">\(\pi\)</span>), odds and probabilities are nearly equal, because <span class="math inline">\(1-\pi \approx 1\)</span> (see <a href="#fig-odds-probs" class="quarto-xref">Figure&nbsp;<span>3.1</span></a>).</p>
<p>For example, in <a href="#exm-odds" class="quarto-xref">Example&nbsp;<span>3.5</span></a>, the probability and odds differ by <span class="math inline">\(6.78\times 10^{-6}\)</span>.</p>
<hr>
<div id="exr-odds-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.8</strong></span> What odds value corresponds to the probability <span class="math inline">\(\pi = 0.2\)</span>, and what is the numerical difference between these two values?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\omega= \frac{\pi}{1-\pi}
=\frac{.2}{.8}
= .25
\]</span></p>
</div>
<hr>
<div id="thm-odds-minus-probs" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.6</strong></span> Let <span class="math inline">\(\omega= \frac{\pi}{1-\pi}\)</span>. Then:</p>
<p><span class="math display">\[\omega- \pi =  \omega\cdot\pi\]</span></p>
</div>
<hr>
<div id="exr-odds-minus-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.9</strong></span> Prove <a href="#thm-odds-minus-probs" class="quarto-xref">Theorem&nbsp;<span>3.6</span></a>.</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\begin{aligned}
\omega- \pi
&amp;= \frac{\pi}{1-\pi} - \pi
\\ &amp;= \frac{\pi}{1-\pi} - \frac{\pi(1-\pi)}{1-\pi}
\\ &amp;= \frac{\pi}{1-\pi} - \frac{\pi - \pi^2}{1-\pi}
\\ &amp;= \frac{\pi - (\pi - \pi^2)}{1-\pi}
\\ &amp;= \frac{\pi - \pi + \pi^2}{1-\pi}
\\ &amp;= \frac{\pi^2}{1-\pi}
\\ &amp;= \frac{\pi}{1-\pi} \pi
\\ &amp;= \omega\pi
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="lem-odds-neg" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 3.1 (Odds of a non-event)</strong></span> If <span class="math inline">\(\pi\)</span> is the odds of event <span class="math inline">\(A\)</span> and <span class="math inline">\(\omega\)</span> is the corresponding odds of <span class="math inline">\(A\)</span>, then the odds of <span class="math inline">\(\neg A\)</span> are:</p>
<p><span class="math display">\[
\omega(\neg A) = \frac{1-\pi}{\pi}
\]</span></p>
</div>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Left to the reader.</p>
</div>
<hr>
</section>
</section>
<section id="the-inverse-odds-function" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="the-inverse-odds-function"><span class="header-section-number">3.4.2</span> The inverse odds function</h3>
<div id="def-inv-odds" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.7 (inverse odds function)</strong></span> The <strong>inverse odds function</strong>,</p>
<p><span class="math display">\[\text{invodds}\left\{\omega\right\} \stackrel{\text{def}}{=}\frac{\omega}{1 + \omega}\]</span> converts odds into their corresponding probabilities (<a href="#fig-inv-odds" class="quarto-xref">Figure&nbsp;<span>3.2</span></a>).</p>
</div>
<div class="notes">
<p>The inverse-odds function takes an odds as input and produces a probability as output. Its domain of inputs is <span class="math inline">\([0,\infty)\)</span> and its range of outputs is <span class="math inline">\([0,1]\)</span>.</p>
<p>I haven’t seen anyone give the inverse-odds function a concise name; maybe <span class="math inline">\(\text{prob}()\)</span>?</p>
</div>
<hr>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>odds_inv <span class="ot">&lt;-</span> <span class="cf">function</span>(omega) (<span class="dv">1</span> <span class="sc">+</span> omega<span class="sc">^-</span><span class="dv">1</span>)<span class="sc">^-</span><span class="dv">1</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> odds_inv, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"inverse-odds"</span>)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Odds"</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"x=y"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-inv-odds" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-inv-odds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.2: The inverse odds function, <span class="math inline">\(\text{invodds}\left\{\omega\right\}\)</span>
</figcaption>
<div aria-describedby="fig-inv-odds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-inv-odds-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<div id="exr-odds-probs" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.10</strong></span> What probability corresponds to an odds of <span class="math inline">\(\omega= 1\)</span>, and what is the numerical difference between these two values?</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span><span class="math display">\[
\pi(1) = \frac{1}{1+1}
=\frac{1}{2}
= .5
\]</span> <span class="math display">\[
1 - \pi(1) = 1 - .5 = .5
\]</span></p>
</div>
<hr>
<div id="lem-invodds-simplified" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 3.2 (Simplified expression for inverse odds function)</strong></span> &nbsp;</p>
<div class="notes">
<p>An equivalent expression for the inverse odds function is</p>
</div>
<p><span id="eq-inv-odds-reduced"><span class="math display">\[
\pi(\omega) = (1+\omega^{-1})^{-1}
\tag{3.3}\]</span></span></p>
</div>
<hr>
<div id="exr-inv-odds2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.11</strong></span> Prove that <a href="#eq-inv-odds-reduced" class="quarto-xref">Equation&nbsp;<span>3.3</span></a> is equivalent to <a href="#def-inv-odds" class="quarto-xref">Definition&nbsp;<span>3.7</span></a>.</p>
</div>
<hr>
<div id="lem-one-minus-odds-inv" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 3.3 (One minus inverse-odds)</strong></span> <span class="math display">\[1 - \text{invodds}\left\{\omega\right\} = \frac{1}{1+\omega}\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
1 - \text{invodds}\left\{\omega\right\} &amp;= 1 - \frac{\omega}{1 + \omega}
\\ &amp;= \frac{{\color{red}1+\omega}}{1 + \omega} - \frac{{\color{blue}\omega}}{1 + \omega}
\\ &amp;= \frac{{\color{red}(1+\omega)} - {\color{blue}\omega}}{1 + \omega}
\\ &amp;= \frac{1 + \omega- \omega}{1 + \omega}
\\ &amp;= \frac{1}{1 + \omega}
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="thm-inverse-odds-nonevent" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.7</strong></span> If <span class="math inline">\(\omega\)</span> is the odds of event <span class="math inline">\(A\)</span>, then the probability that <span class="math inline">\(A\)</span> does not occur is:</p>
<p><span class="math display">\[\Pr(\neg A) = \frac{1}{1+\omega}\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span></p>
<div class="notes">
<p>Use <a href="#lem-one-minus-odds-inv" class="quarto-xref">Lemma&nbsp;<span>3.3</span></a>:</p>
</div>
<p><span class="math display">\[
\begin{aligned}
\Pr(\neg A)
&amp;= 1 - \Pr(A)
\\ &amp;= 1 - \text{invodds}\left\{\omega\right\}
\\ &amp;= \frac{1}{1 + \omega}
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="thm-deriv-invodds" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.8 (Derivative of inverse odds function)</strong></span> <span class="math display">\[{\text{invodds}}'\left\{\omega\right\} = \frac{1}{\left(1+\omega\right)^2}\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span></p>
<div class="notes">
<p>Use the quotient rule:</p>
</div>
<p><span class="math display">\[
\begin{aligned}
{\text{invodds}}'(\omega)
&amp;= \frac{\partial}{\partial \omega} \text{invodds}\left\{\omega\right\}
\\ &amp;= \frac{\partial}{\partial \omega} \frac{\omega}{1+\omega}
\\ &amp;= \frac{\frac{\partial}{\partial \omega}\omega}{1+\omega} - \frac{\omega}{\left(1+\omega\right)^2} \cdot\frac{\partial}{\partial \omega}(1+\omega)
\\ &amp;= \frac{1}{1+\omega} - \frac{\omega}{\left(1+\omega\right)^2} \cdot 1
\\ &amp;= \frac{1}{1+\omega} - \frac{\omega}{\left(1+\omega\right)^2}
\\ &amp;= \frac{1+\omega}{\left(1+\omega\right)^2} - \frac{\omega}{\left(1+\omega\right)^2}
\\ &amp;= \frac{1+\omega- \omega}{\left(1+\omega\right)^2}
\\ &amp;= \frac{1}{\left(1+\omega\right)^2}
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="cor-deriv-invodds" class="theorem corollary">
<p><span class="theorem-title"><strong>Corollary 3.1</strong></span> <span class="math display">\[{\text{invodds}}'\left\{\omega\right\} = \left(1 - \text{invodds}\left\{\omega\right\}\right)^2\]</span></p>
</div>
<hr>
</section>
<section id="odds-ratios" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="odds-ratios"><span class="header-section-number">3.4.3</span> Odds ratios</h3>
<div class="notes">
<p>Now that we have defined odds, we can introduce another way of comparing event probabilities: odds ratios.</p>
</div>
<div id="def-OR" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.8 (Odds ratio)</strong></span> The <strong>odds ratio</strong> for two odds <span class="math inline">\(\omega_1\)</span>, <span class="math inline">\(\omega_2\)</span> is their ratio:</p>
<p><span class="math display">\[\theta(\omega_1, \omega_2) = \frac{\omega_1}{\omega_2}\]</span></p>
</div>
<hr>
<div id="exm-OR" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.7 (Calculating odds ratios)</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, the odds ratio for OC users versus OC-non-users is:</p>
<p><span class="math display">\[
\begin{aligned}
\theta(\omega(OC), \omega(\neg OC))
&amp;= \frac{\omega(OC)}{\omega(\neg OC)}\\
&amp;= \frac{0}{7\times 10^{-4}}\\
&amp;= 3.71\\
\end{aligned}
\]</span></p>
</div>
<hr>
<section id="a-shortcut-for-calculating-odds-ratio-estimates" class="level4 smaller">
<h4 class="smaller anchored" data-anchor-id="a-shortcut-for-calculating-odds-ratio-estimates">A shortcut for calculating odds ratio estimates</h4>
<div class="notes">
<p>The general form of a two-by-two table is shown in <a href="#tbl-2x2-generic" class="quarto-xref">Table&nbsp;<span>3.2</span></a>.</p>
<div id="tbl-2x2-generic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-2x2-generic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.2: A generic 2x2 table
</figcaption>
<div aria-describedby="tbl-2x2-generic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th>Event</th>
<th>Non-Event</th>
<th>Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Exposed</td>
<td>a</td>
<td>b</td>
<td>a+b</td>
</tr>
<tr class="even">
<td>Non-exposed</td>
<td>c</td>
<td>d</td>
<td>c+d</td>
</tr>
<tr class="odd">
<td>Total</td>
<td>a+c</td>
<td>b+d</td>
<td>a+b+c+d</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="notes">
<p>From this table, we have:</p>
</div>
<ul>
<li><p><span class="math inline">\(\hat\pi(Event|Exposed) = a/(a+b)\)</span></p></li>
<li><p><span class="math inline">\(\hat\pi(\neg Event|Exposed) = b/(a+b)\)</span></p></li>
<li><p><span class="math inline">\(\hat\omega(Event|Exposed) = \frac{\left(\frac{a}{a+b}\right)}{\left(\frac{b}{a+b}\right)}=\frac{a}{b}\)</span></p></li>
<li><p><span class="math inline">\(\hat\omega(Event|\neg Exposed) = \frac{c}{d}\)</span> (see <a href="#exr-odds-generic" class="quarto-xref">Exercise&nbsp;<span>3.12</span></a>)</p></li>
<li><p><span class="math inline">\(\theta(Exposed,\neg Exposed) = \frac{\frac{a}{b}}{\frac{c}{d}} = \frac{ad}{bc}\)</span></p></li>
</ul>
<hr>
<div id="exr-odds-generic" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.12</strong></span> Given <a href="#tbl-2x2-generic" class="quarto-xref">Table&nbsp;<span>3.2</span></a>, show that <span class="math inline">\(\hat\omega(Event|\neg Exposed) = \frac{c}{d}\)</span>.</p>
</div>
<hr>
</section>
<section id="sec-OR-props" class="level4">
<h4 class="anchored" data-anchor-id="sec-OR-props">Properties of odds ratios</h4>
<div class="notes">
<p>Odds ratios have a special property: we can swap a covariate with the outcome, and the odds ratio remains the same.</p>
</div>
<div id="thm-or-swap" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.9 (Odds ratios are reversible)</strong></span> For any two events <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>:</p>
<p><span class="math display">\[\theta(A|B) = \theta(B|A)\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
\theta(A|B) &amp;\stackrel{\text{def}}{=}\frac{\omega(A|B)}{\omega(A|\neg B)}
\\ &amp;= \frac
{\left(\frac{\text{p}(A|B)}{\text{p}(\neg A|B)}\right)}
{\left(\frac{\text{p}(A|\neg B)}{\text{p}(\neg A| \neg B)}\right)}
\\ &amp;=
\left(\frac{\text{p}(A|B)}{\text{p}(\neg A|B)}\right)
\left(\frac{\text{p}(A|\neg B)}{\text{p}(\neg A| \neg B)}\right)^{-1}
\\ &amp;=
\left(\frac{\text{p}(A|B)}{\text{p}(\neg A|B)}\right)
\left(\frac{\text{p}(\neg A| \neg B)}{\text{p}(A|\neg B)}\right)
\\ &amp;=
\left(\frac{\text{p}(A|B)}{\text{p}(\neg A|B)} \cdot \frac{\text{p}(B)}{\text{p}(B)}\right)
\left(\frac{\text{p}(\neg A| \neg B)}{\text{p}(A|\neg B)} \cdot \frac{\text{p}(\neg B)}{\text{p}(\neg B)}\right)
\\ &amp;=
\left(\frac{\text{p}(A,B)}{\text{p}(\neg A,B)}\right)
\left(\frac{\text{p}(\neg A, \neg B)}{\text{p}(A, \neg B)}\right)
\\ &amp;=
\left(\frac{\text{p}(B,A)}{{\color{red}\text{p}(B,\neg A)}}\right)
\left(\frac{\text{p}(\neg B, \neg A)}{{\color{blue}\text{p}(\neg B, A)}}\right)
\\ &amp;=
\left(\frac{\text{p}(B,A)}{{\color{blue}\text{p}(\neg B, A)}}\right)
\left(\frac{\text{p}(\neg B, \neg A)}{{\color{red}\text{p}(B,\neg A)}}\right)
\\ &amp;= \text{[reverse the preceding steps]}
\\ &amp;= \theta(B|A)
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="exm-or-inv-MI" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.8</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, we have:</p>
<p><span class="math display">\[
\begin{aligned}
\theta(MI; OC)
&amp;\stackrel{\text{def}}{=}
\frac{\omega(MI|OC)}{\omega(MI|\neg OC)}\\
&amp;\stackrel{\text{def}}{=}\frac
{\left(\frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}\right)}
{\left(\frac{\Pr(MI|\neg OC)}{\Pr(\neg MI|\neg OC)}\right)}\\
&amp;= \frac
{\left(\frac{\Pr(MI,OC)}{\Pr(\neg MI,OC)}\right)}
{\left(\frac{\Pr(MI,\neg OC)}{\Pr(\neg MI,\neg OC)}\right)}\\
&amp;= \left(\frac{\Pr(MI,OC)}{\Pr(\neg MI,OC)}\right)
\left(\frac{\Pr(\neg MI,\neg OC)}{\Pr(MI,\neg OC)}\right)\\
&amp;= \left(\frac{\Pr(MI,OC)}{\Pr(MI,\neg OC)}\right)
\left(\frac{\Pr(\neg MI,\neg OC)}{\Pr(\neg MI,OC)}\right)\\
&amp;= \left(\frac{\Pr(OC,MI)}{\Pr(\neg OC,MI)}\right)
\left(\frac{\Pr(\neg OC,\neg MI)}{\Pr(OC,\neg MI)}\right)\\
&amp;= \left(\frac{\Pr(OC|MI)}{\Pr(\neg OC|MI)}\right)
\left(\frac{\Pr(\neg OC|\neg MI)}{\Pr(OC|\neg MI)}\right)\\
&amp;= \frac{\left(\frac{\Pr(OC|MI)}{\Pr(\neg OC|MI)}\right)}
{\left(\frac{\Pr(OC|\neg MI)}{\Pr(\neg OC|\neg MI)}\right)}\\
&amp;\stackrel{\text{def}}{=}\frac{\omega(OC|MI)}
{\omega(OC|\neg MI)}\\
&amp;\stackrel{\text{def}}{=}\theta(OC; MI)
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="exr-2x2-generic" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.13</strong></span> For <a href="#tbl-2x2-generic" class="quarto-xref">Table&nbsp;<span>3.2</span></a>, show that <span class="math inline">\(\hat\theta(Exposed, Unexposed) = \hat\theta(Event, \neg Event)\)</span>.</p>
</div>
<hr>
<div class="notes">
<p>Conditional odds ratios have the same reversibility property:</p>
</div>
<div id="thm-conditional-OR-swap" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.10 (Conditional odds ratios are reversible)</strong></span> For any three events <span class="math inline">\(A\)</span>, <span class="math inline">\(B\)</span>, <span class="math inline">\(C\)</span>:</p>
<p><span class="math display">\[\theta(A|B,C) = \theta(B|A,C)\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Apply the same steps as for <a href="#thm-or-swap" class="quarto-xref">Theorem&nbsp;<span>3.9</span></a>, inserting <span class="math inline">\(C\)</span> into the conditions (RHS of <span class="math inline">\(|\)</span>) of every expression.</p>
</div>
<hr>
</section>
<section id="sec-OR-RR" class="level4">
<h4 class="anchored" data-anchor-id="sec-OR-RR">Odds Ratios vs Probability (Risk) Ratios</h4>
<div class="notes">
<p>When the outcome is rare (i.e., its probability is small) for both groups being compared in an odds ratio, the odds of the outcome will be similar to the probability of the outcome, and thus the risk ratio will be similar to the odds ratio.</p>
</div>
<section id="case-1-rare-events" class="level5">
<h5 class="anchored" data-anchor-id="case-1-rare-events">Case 1: rare events</h5>
<p>For rare events, odds ratios and probability (a.k.a. risk, a.k.a. prevalence) ratios will be close:</p>
<p><span class="math inline">\(\pi_1 = .01\)</span> <span class="math inline">\(\pi_2 = .02\)</span></p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">&lt;-</span> .<span class="dv">01</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pi2 <span class="ot">&lt;-</span> .<span class="dv">02</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>pi2 <span class="sc">/</span> pi1</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">odds</span>(pi2) <span class="sc">/</span> <span class="fu">odds</span>(pi1)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div id="exm-or-rr-OC-MI" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.9</strong></span> In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, the outcome is rare for both OC and non-OC participants, so the odds for both groups are similar to the corresponding probabilities, and the odds ratio is similar the risk ratio.</p>
</div>
<hr>
</section>
<section id="case-2-frequent-events" class="level5">
<h5 class="anchored" data-anchor-id="case-2-frequent-events">Case 2: frequent events</h5>
<p><span class="math inline">\(\pi_1 = .4\)</span> <span class="math inline">\(\pi_2 = .5\)</span></p>
<p>For more frequently-occurring outcomes, this won’t be the case:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pi1 <span class="ot">&lt;-</span> .<span class="dv">4</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pi2 <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pi2 <span class="sc">/</span> pi1</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.2</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">odds</span>(pi2) <span class="sc">/</span> <span class="fu">odds</span>(pi1)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="odds-ratios-in-case-control-studies" class="level4">
<h4 class="anchored" data-anchor-id="odds-ratios-in-case-control-studies">Odds Ratios in Case-Control Studies</h4>
<div class="notes">
<p><a href="#tbl-oc-mi" class="quarto-xref">Table&nbsp;<span>3.1</span></a> simulates a follow-up study in which two populations were followed and the number of MI’s was observed. The risks are <span class="math inline">\(P(MI|OC)\)</span> and <span class="math inline">\(P(MI|\neg OC)\)</span> and we can estimate these risks from the data.</p>
<p>But suppose we had a case-control study in which we had 100 women with MI and selected a comparison group of 100 women without MI (matched as groups on age, etc.). Then MI is not random, and we cannot compute P(MI|OC) and we cannot compute the risk ratio. However, the odds ratio however can be computed.</p>
<p>The disease odds ratio is the odds for the disease in the exposed group divided by the odds for the disease in the unexposed group, and we cannot validly compute and use these separate parts.</p>
<p>We can still validly compute and use the exposure odds ratio, which is the odds for exposure in the disease group divided by the odds for exposure in the non-diseased group (because exposure can be treated as random):</p>
</div>
<p><span class="math display">\[
\hat\theta(OC|MI) =
\frac{\hat{\omega}(OC|MI)}{\hat{\omega}(OC|\neg MI)}
\]</span></p>
<div class="notes">
<p>And these two odds ratios, <span class="math inline">\(\hat\theta(MI|OC)\)</span> and <span class="math inline">\(\hat\theta(OC|MI)\)</span>, are mathematically equivalent, as we saw in <a href="#sec-OR-props" class="quarto-xref"><span>Section 3.4.3.2</span></a>:</p>
</div>
<p><span class="math display">\[\hat\theta(MI|OC) = \hat\theta(OC|MI)\]</span></p>
<hr>
<div id="exr-or-rev" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.14</strong></span> Calculate the odds ratio of MI with respect to OC use, assuming that <a href="#tbl-oc-mi" class="quarto-xref">Table&nbsp;<span>3.1</span></a> comes from a case-control study. Confirm that the result is the same as in <a href="#exm-OR" class="quarto-xref">Example&nbsp;<span>3.7</span></a>.</p>
</div>
<hr>
<div class="proof solution">
<p><span class="proof-title"><em>Solution</em>. </span></p>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>tbl_oc_mi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-oc-mi2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-oc-mi2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.3: Simulated data from study of oral contraceptive use and heart attack risk
</figcaption>
<div aria-describedby="tbl-oc-mi2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["OC"],"name":[1],"type":["chr"],"align":["left"]},{"label":["MI"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["No MI"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["Total"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"OC use","2":"13","3":"4987","4":"5000"},{"1":"No OC use","2":"7","3":"9993","4":"10000"},{"1":"Total","2":"20","3":"14980","4":"15000"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
</figure>
</div>
<ul>
<li><p><span class="math inline">\(\omega(OC|MI) = P(OC|MI)/(1 – P(OC|MI) = \frac{13}{7} = 1.86\)</span></p></li>
<li><p><span class="math inline">\(\omega(OC|\neg MI) = P(OC|\neg MI)/(1 – P(OC|\neg MI) = \frac{4987}{9993} = 0.5\)</span></p></li>
<li><p><span class="math inline">\(\theta(OC,MI) = \frac{\omega(OC|MI)}{\omega(OC|\neg MI)} = \frac{13/7}{4987/9993} = 3.72\)</span></p></li>
</ul>
<div class="notes">
<p>This is the same estimate we calculated in <a href="#exm-OR" class="quarto-xref">Example&nbsp;<span>3.7</span></a>.</p>
</div>
</div>
<hr>
</section>
<section id="odds-ratios-in-cross-sectional-studies" class="level4">
<h4 class="anchored" data-anchor-id="odds-ratios-in-cross-sectional-studies">Odds Ratios in Cross-Sectional Studies</h4>
<ul>
<li><p>If a cross-sectional study is a probability sample of a population (which it rarely is) then we can estimate risks.</p></li>
<li><p>If it is a sample, but not an unbiased probability sample, then we need to treat it in the same way as a case-control study.</p></li>
<li><p>We can validly estimate odds ratios in either case.</p></li>
<li><p>But we can usually not validly estimate risks and risk ratios.</p></li>
</ul>
</section>
</section>
</section>
<section id="the-logit-and-expit-functions" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="the-logit-and-expit-functions"><span class="header-section-number">3.5</span> The logit and expit functions</h2>
<section id="the-logit-function" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="the-logit-function"><span class="header-section-number">3.5.1</span> The logit function</h3>
<div id="def-logit" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.9 (logit function)</strong></span> &nbsp;</p>
<div class="notes">
<p>The <strong>logit function</strong> of a probability <span class="math inline">\(\pi\)</span> is the natural logarithm of the odds function of <span class="math inline">\(\pi\)</span>:</p>
</div>
<p><span class="math display">\[\text{logit}(\pi) \stackrel{\text{def}}{=}\text{log}\left\{\omega(\pi)\right\}\]</span></p>
</div>
<hr>
<div class="notes">
<p><a href="#fig-logit" class="quarto-xref">Figure&nbsp;<span>3.3</span></a> shows the shape of the <span class="math inline">\(\text{logit}()\)</span> function.</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="cf">function</span>(pi) pi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pi)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">log</span>(<span class="fu">odds</span>(p))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>logit_plot <span class="ot">&lt;-</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> logit,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"both"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(.<span class="dv">001</span>, .<span class="dv">999</span>) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"logit(p)"</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"p"</span>) <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(logit_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-logit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.3: The logit function
</figcaption>
<div aria-describedby="fig-logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-logit-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<div id="thm-logit-function" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.11</strong></span> <span id="eq-logit"><span class="math display">\[\text{logit}(\pi) = \text{log}\left\{\frac{\pi}{1-\pi}\right\} \tag{3.4}\]</span></span></p>
</div>
<hr>
<div id="exr-prove-eq-logit" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.15 (Compose the logit function)</strong></span> Prove <a href="#thm-logit-function" class="quarto-xref">Theorem&nbsp;<span>3.11</span></a>.</p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Apply <a href="#def-logit" class="quarto-xref">Definition&nbsp;<span>3.9</span></a> and then <a href="#def-odds" class="quarto-xref">Definition&nbsp;<span>3.6</span></a> (details left to the reader).</p>
</div>
<hr>
<div id="thm-deriv-logit" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.12 (Derivative of logit function)</strong></span> <span class="math display">\[\text{logit}'(\pi) = \frac{1}{(\pi)(1-\pi)}\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
\text{logit}'(\pi)
   &amp;= \frac{\partial}{\partial \pi}\text{logit}(\pi)
\\ &amp;= \frac{\partial}{\partial \pi}\text{log}\left\{\omega(\pi)\right\}
\\ &amp;= \frac{\omega'(\pi)}{\omega(\pi)}
\\ &amp;= \omega'(\pi) \frac{1}{\omega(\pi)}
\\ &amp;= \frac{1}{\left(1-\pi\right)^2}\frac{1-\pi}{\pi}
\\ &amp;= \frac{1}{(\pi)(1-\pi)}
\end{aligned}
\]</span></p>
</div>
<hr>
</section>
<section id="the-expit-function" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="the-expit-function"><span class="header-section-number">3.5.2</span> The expit function</h3>
<div id="def-expit" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.10 (expit, logistic, inverse-logit)</strong></span> The <strong>expit function</strong> (<a href="#fig-expit-plot" class="quarto-xref">Figure&nbsp;<span>3.4</span></a>) of a log-odds <span class="math inline">\(\eta\)</span>, also known as the <strong>inverse-logit function</strong> or <strong>logistic function</strong>, is the inverse-odds of the exponential of <span class="math inline">\(\eta\)</span>:</p>
<p><span class="math display">\[\text{expit}(\eta) \stackrel{\text{def}}{=}\text{invodds}\left\{\text{exp}\left\{\eta\right\}\right\}\]</span></p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(eta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(eta))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>expit_plot <span class="ot">&lt;-</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> expit,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"both"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">expit</span>(eta))) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(eta)) <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expit_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-expit-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-expit-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.4: The expit function
</figcaption>
<div aria-describedby="fig-expit-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-expit-plot-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<div id="thm-logit-expit" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.13 (logit and expit are each others’ inverses)</strong></span> <span class="math display">\[\text{logit}\left\{\text{expit}\left\{\eta\right\}\right\} = \eta\]</span></p>
<p><span class="math display">\[\text{expit}\left\{\text{logit}\left\{\pi\right\}\right\} = \pi\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Left to the reader.</p>
</div>
<hr>
<div id="thm-expit" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.14 (Expressions for expit function)</strong></span> <span class="math display">\[
\begin{aligned}
\text{expit}(\eta)
   &amp;= \frac{\text{exp}\left\{\eta\right\}}{1+\text{exp}\left\{\eta\right\}}
\\ &amp;= (1 + \text{exp}\left\{-\eta\right\})^{-1}
\end{aligned}
\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Apply definitions and <a href="#lem-invodds-simplified" class="quarto-xref">Lemma&nbsp;<span>3.2</span></a>. Details left to the reader.</p>
</div>
<hr>
<div id="lem-one-minus-expit" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 3.4</strong></span> <span class="math display">\[1-\text{expit}\left\{\eta\right\} = \left(1+\text{exp}\left\{\eta\right\}\right)^{-1}\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Using <a href="#lem-one-minus-odds-inv" class="quarto-xref">Lemma&nbsp;<span>3.3</span></a>:</p>
<p><span class="math display">\[
\begin{aligned}
1 - \text{expit}\left\{\eta\right\} &amp;= 1 - \text{invodds}\left\{\text{exp}\left\{\eta\right\}\right\}
\\ &amp;= \frac{1}{1+\text{exp}\left\{\eta\right\}}
\\ &amp;= \left(1 + \text{exp}\left\{\eta\right\}\right)^{-1}
\end{aligned}
\]</span></p>
</div>
<hr>
<div id="lem-deriv-expit" class="theorem lemma">
<p><span class="theorem-title"><strong>Lemma 3.5</strong></span> <span class="math display">\[\text{expit}'\left\{\eta\right\} = (\text{expit}\left\{\eta\right\}) (1 - \text{expit}\left\{\eta\right\})\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Using <a href="#thm-deriv-invodds" class="quarto-xref">Theorem&nbsp;<span>3.8</span></a>:</p>
<p><span class="math display">\[
\begin{aligned}
\text{expit}'\left\{\eta\right\}
   &amp;= \frac{\partial}{\partial \eta} \text{expit}\left\{\eta\right\}   
\\ &amp;= \frac{\partial}{\partial \eta} \text{invodds}\left\{\text{exp}\left\{\eta\right\}\right\}
\\ &amp;= {\text{invodds}}'\left\{\text{exp}\left\{\eta\right\}\right\}  \frac{\partial}{\partial \eta}\text{exp}\left\{\eta\right\}
\\ &amp;=  \frac{1}{\left(1 + \text{exp}\left\{\eta\right\}\right)^2} \text{exp}\left\{\eta\right\}
\\ &amp;=  \frac{\text{exp}\left\{\eta\right\}}{\left(1 + \text{exp}\left\{\eta\right\}\right)^2}
\\ &amp;=  \frac{\text{exp}\left\{\eta\right\}}{1 + \text{exp}\left\{\eta\right\}} \frac{1}{1 + \text{exp}\left\{\eta\right\}}
\\ &amp;=  \text{expit}\left\{\eta\right\} (1-\text{expit}\left\{\eta\right\})
\end{aligned}
\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span>Alternatively, we can use <a href="#thm-expit" class="quarto-xref">Theorem&nbsp;<span>3.14</span></a>:</p>
<p><span class="math display">\[
\begin{aligned}
\text{expit}'\left\{\eta\right\}
   &amp;= \frac{\partial}{\partial \eta} \text{expit}\left\{\eta\right\}
\\ &amp;= \frac{\partial}{\partial \eta} (1 + \text{exp}\left\{-\eta\right\})^{-1}
\\ &amp;= -(1 + \text{exp}\left\{-\eta\right\})^{-2} \frac{\partial}{\partial \eta} (1 + \text{exp}\left\{-\eta\right\})
\\ &amp;= -(1 + \text{exp}\left\{-\eta\right\})^{-2} (-\text{exp}\left\{-\eta\right\})
\\ &amp;= (1 + \text{exp}\left\{-\eta\right\})^{-2} (\text{exp}\left\{-\eta\right\})
\\ &amp;= (1 + \text{exp}\left\{-\eta\right\})^{-1} \frac{\text{exp}\left\{-\eta\right\}}{1 + \text{exp}\left\{-\eta\right\}}
\\ &amp;= (1 + \text{exp}\left\{-\eta\right\})^{-1} \frac{1}{1 + \text{exp}\left\{\eta\right\}}
\\ &amp;= \text{expit}\left\{\eta\right\} (1-\text{expit}\left\{\eta\right\})
\end{aligned}
\]</span></p>
</div>
</section>
<section id="sec-expit-logit-diagram" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="sec-expit-logit-diagram"><span class="header-section-number">3.5.3</span> Diagram of expit and logit</h3>
<p><span class="math display">\[
\underbrace{\pi}_{\atop{\Pr(Y=1)} }
\overbrace{
\underbrace{
\underset{
\xleftarrow[\frac{\omega}{1+\omega}]{}
}
{
\xrightarrow{\frac{\pi}{1-\pi}}
}
\underbrace{\omega}_{\text{odds}(Y=1)}
\underset{
\xleftarrow[\text{exp}\left\{\eta\right\}]{}
}
{
\xrightarrow{\text{log}\left\{\omega\right\}}
}
}_{\text{expit}(\eta)}
}^{\text{logit}(\pi)}
\underbrace{\eta}_{\atop{\text{log-odds}(Y=1)}}
\]</span></p>
</section>
</section>
<section id="introduction-to-logistic-regression" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="introduction-to-logistic-regression"><span class="header-section-number">3.6</span> Introduction to logistic regression</h2>
<div class="notes">
<ul>
<li><p>In <a href="#exm-oc-mi" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, we estimated the risk and the odds of MI for two groups, defined by oral contraceptive use.</p></li>
<li><p>If the predictor is quantitative (dose) or there is more than one predictor, the task becomes more difficult.</p></li>
<li><p>In this case, we will use logistic regression, which is a generalization of the linear regression models you have been using that can account for a binary response instead of a continuous one.</p></li>
</ul>
</div>
<section id="binary-outcomes-models---one-group-no-covariates" class="level3 smaller" data-number="3.6.1">
<h3 class="smaller anchored" data-number="3.6.1" data-anchor-id="binary-outcomes-models---one-group-no-covariates"><span class="header-section-number">3.6.1</span> Binary outcomes models - one group, no covariates</h3>
<p><span class="math display">\[
\begin{aligned}
\text{P}(Y=1) &amp;= \pi\\
\text{P}(Y=0) &amp;= 1-\pi\\
\text{P}(Y=y) &amp;= \pi^y (1-\pi)^{1-y}\\
\mathbf y  &amp;= (y_1, ..., y_n)\\
\mathcal L(\pi;\mathbf y) &amp;= \pi^{\sum y_i} (1-\pi)^{n - \sum y_i}\\
\ell(\pi, \mathbf y) &amp;= \left({\sum y_i}\right) \text{log}\left\{\pi\right\} + \left(n - \sum y_i\right) \text{log}\left\{1-\pi\right\}\\
&amp;= \left({\sum y_i}\right) \left(\text{log}\left\{\pi\right\} - \text{log}\left\{1-\pi\right\}\right) + n \cdot \text{log}\left\{1-\pi\right\}\\
&amp;= \left({\sum y_i}\right) \text{log}\left\{\frac{\pi}{ 1-\pi}\right\} + n \cdot \text{log}\left\{1-\pi\right\}
\\ &amp;= \left({\sum y_i}\right) \text{logit}(\pi) + n \cdot \text{log}\left\{1-\pi\right\}
\end{aligned}
\]</span></p>
</section>
<section id="binary-outcomes---general" class="level3 smaller" data-number="3.6.2">
<h3 class="smaller anchored" data-number="3.6.2" data-anchor-id="binary-outcomes---general"><span class="header-section-number">3.6.2</span> Binary outcomes - general</h3>
<p><span class="math display">\[
\begin{aligned}
\text{P}(Y_i=1) &amp;= \pi_i
\\ \text{P}(Y_i=0) &amp;= 1-\pi_i
\end{aligned}
\]</span></p>
<p><span class="math display">\[\text{P}(Y_i=y_i) = (\pi_i)^y_i (1-\pi_i)^{1-y_i}\]</span></p>
<p><span class="math display">\[\mathcal{L}_i(\pi_i) = \text{P}(Y_i=y_i)\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\ell_i(\pi_i)
   &amp;= \text{log}\left\{\mathcal{L}_i(\pi_i)\right\}
\\ &amp;= y_i \text{log}\left\{\pi_i\right\} + (1-y_i) \text{log}\left\{1-\pi_i\right\}
\end{aligned}
\]</span></p>
<hr>
<p>For <span class="math inline">\(\text{iid}\)</span> data <span class="math inline">\(\tilde{y}  = (y_1, ..., y_n)\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal{L}(\pi;\tilde{y}) &amp;= \text{P}(Y_1=y_1, \ldots, Y_n = y_n)
\\ &amp;= \prod_{i=1}^n \text{P}(Y_i=y_i)
\\ &amp;= \prod_{i=1}^n \mathcal{L}_i(\pi_i)
\end{aligned}
\]</span></p>
</section>
<section id="modeling-pi_i-as-a-function-of-x_i" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="modeling-pi_i-as-a-function-of-x_i"><span class="header-section-number">3.6.3</span> Modeling <span class="math inline">\(\pi_i\)</span> as a function of <span class="math inline">\(X_i\)</span></h3>
<p>If there are only a few distinct <span class="math inline">\(X_i\)</span> values, we can model <span class="math inline">\(\pi_i\)</span> separately for each value of <span class="math inline">\(X_i\)</span>.</p>
<p>Otherwise, we need regression.</p>
<p><span class="math display">\[
\begin{aligned}
\pi(x) &amp;\equiv \text{E}(Y=1|X=x)\\
&amp;= f(x^\top\beta)
\end{aligned}
\]</span></p>
<p>Typically, we use the <span class="math inline">\(\text{expit}\)</span> inverse-link:</p>
<p><span id="eq-logistic-link"><span class="math display">\[\pi(\tilde{x}) = \text{expit}(\tilde{x}'\beta) \tag{3.5}\]</span></span></p>
</section>
<section id="meet-the-beetles" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="meet-the-beetles"><span class="header-section-number">3.6.4</span> Meet the beetles</h3>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmx)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BeetleMortality, <span class="at">package =</span> <span class="st">"glmx"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>beetles <span class="ot">&lt;-</span> BeetleMortality <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> died <span class="sc">/</span> n,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">survived =</span> n <span class="sc">-</span> died</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Dose (log mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mortality rate (%)"</span>) <span class="sc">+</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-beetles_1a" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-beetles_1a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.5: Mortality rates of adult flour beetles after five hours’ exposure to gaseous carbon disulphide (Bliss 1935)
</figcaption>
<div aria-describedby="fig-beetles_1a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
</section>
<section id="why-dont-we-use-linear-regression" class="level3" data-number="3.6.5">
<h3 data-number="3.6.5" class="anchored" data-anchor-id="why-dont-we-use-linear-regression"><span class="header-section-number">3.6.5</span> Why don’t we use linear regression?</h3>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>beetles_long <span class="ot">&lt;-</span> beetles <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died),</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> beetles_long <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> dose)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>f_linear <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>range1 <span class="ot">&lt;-</span> <span class="fu">range</span>(beetles<span class="sc">$</span>dose) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, .<span class="dv">2</span>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">+</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> f_linear,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Straight line"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Model"</span>, <span class="at">size =</span> <span class="st">""</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>plot2 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-beetles_2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-beetles_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.6: Mortality rates of adult flour beetles after five hours’ exposure to gaseous carbon disulphide (Bliss 1935)
</figcaption>
<div aria-describedby="fig-beetles_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
</section>
<section id="zoom-out" class="level3" data-number="3.6.6">
<h3 data-number="3.6.6" class="anchored" data-anchor-id="zoom-out"><span class="header-section-number">3.6.6</span> Zoom out</h3>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>(plot2 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-beetles_3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-beetles_3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.7: Mortality rates of adult flour beetles after five hours’ exposure to gaseous carbon disulphide (Bliss 1935)
</figcaption>
<div aria-describedby="fig-beetles_3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
</section>
<section id="log-transformation-of-dose" class="level3" data-number="3.6.7">
<h3 data-number="3.6.7" class="anchored" data-anchor-id="log-transformation-of-dose"><span class="header-section-number">3.6.7</span> log transformation of dose?</h3>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> beetles_long <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> <span class="fu">log</span>(dose))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>f_linearlog <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> plot2 <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> f_linearlog, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Log-transform dose"</span>))</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>(plot3 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-beetles_4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-beetles_4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.8: Mortality rates of adult flour beetles after five hours’ exposure to gaseous carbon disulphide (Bliss 1935)
</figcaption>
<div aria-describedby="fig-beetles_4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
</section>
<section id="logistic-regression" class="level3" data-number="3.6.8">
<h3 data-number="3.6.8" class="anchored" data-anchor-id="logistic-regression"><span class="header-section-number">3.6.8</span> Logistic regression</h3>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">&lt;-</span> beetles <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> plot3 <span class="sc">+</span> <span class="fu">geom_function</span>(<span class="at">fun =</span> f, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Logistic regression"</span>))</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-beetles_5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-beetles_5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.9: Mortality rates of adult flour beetles after five hours’ exposure to gaseous carbon disulphide (Bliss 1935)
</figcaption>
<div aria-describedby="fig-beetles_5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<hr>
</section>
<section id="three-parts-to-regression-models" class="level3" data-number="3.6.9">
<h3 data-number="3.6.9" class="anchored" data-anchor-id="three-parts-to-regression-models"><span class="header-section-number">3.6.9</span> Three parts to regression models</h3>
<ul>
<li><p>What distribution does the outcome have for a specific subpopulation defined by covariates? (outcome model)</p></li>
<li><p>How does the combination of covariates relate to the mean? (link function)</p></li>
<li><p>How do the covariates combine? (linear predictor, interactions)</p></li>
</ul>
<hr>
</section>
<section id="logistic-regression-in-r" class="level3" data-number="3.6.10">
<h3 data-number="3.6.10" class="anchored" data-anchor-id="logistic-regression-in-r"><span class="header-section-number">3.6.10</span> Logistic regression in R</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">&lt;-</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-60.72</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">(-71.44, -51.08)</td>
<td style="text-align: center;">-11.72</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dose</td>
<td style="text-align: center;">34.27</td>
<td style="text-align: center;">2.91</td>
<td style="text-align: center;">(28.85, 40.30)</td>
<td style="text-align: center;">11.77</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p>Fitted values:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted.values</span>(beetles_glm_grouped)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1     2     3     4     5     6     7     8 </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.059 0.164 0.362 0.605 0.795 0.903 0.955 0.979</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1     2     3     4     5     6     7     8 </span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.059 0.164 0.362 0.605 0.795 0.903 0.955 0.979</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"link"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     1     2     3     4     5     6     7     8 </span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -2.78 -1.63 -0.57  0.43  1.36  2.23  3.06  3.84</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>fit_y <span class="ot">&lt;-</span> beetles<span class="sc">$</span>n <span class="sc">*</span> <span class="fu">fitted.values</span>(beetles_glm_grouped)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
<section id="individual-observations" class="level3" data-number="3.6.11">
<h3 data-number="3.6.11" class="anchored" data-anchor-id="individual-observations"><span class="header-section-number">3.6.11</span> Individual observations</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>beetles_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-beetles-long" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-beetles-long-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.4: <code>beetles</code> data in long format
</figcaption>
<div aria-describedby="tbl-beetles-long-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["dose"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["died"],"name":[2],"type":["int"],"align":["right"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]},{"label":["pct"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["survived"],"name":[5],"type":["int"],"align":["right"]},{"label":["outcome"],"name":[6],"type":["dbl"],"align":["right"]}],"data":[{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"1"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"1"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"1"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"1"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"1"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"1"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"6","3":"59","4":"0.10","5":"53","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"1"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.7","2":"13","3":"60","4":"0.22","5":"47","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"1"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"18","3":"62","4":"0.29","5":"44","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"1"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"28","3":"56","4":"0.50","5":"28","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"1"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"52","3":"63","4":"0.83","5":"11","6":"0"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"1"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"0"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"0"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"0"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"0"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"0"},{"1":"1.8","2":"53","3":"59","4":"0.90","5":"6","6":"0"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"1"},{"1":"1.9","2":"61","3":"62","4":"0.98","5":"1","6":"0"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"},{"1":"1.9","2":"60","3":"60","4":"1.00","5":"0","6":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</figure>
</div>
</div>
<hr>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="ot">&lt;-</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  beetles_long <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> dose,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-beetles-model-ungrouped" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-beetles-model-ungrouped-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.5: logistic regression model for beetles data with individual Bernoulli data
</figcaption>
<div aria-describedby="tbl-beetles-model-ungrouped-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-60.72</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">(-71.44, -51.08)</td>
<td style="text-align: center;">-11.72</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dose</td>
<td style="text-align: center;">34.27</td>
<td style="text-align: center;">2.91</td>
<td style="text-align: center;">(28.85, 40.30)</td>
<td style="text-align: center;">11.77</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
<div class="notes">
<p>Here’s the previous version again:</p>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-beetles-model-grouped" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-beetles-model-grouped-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.6: logistic regression model for beetles data with grouped (binomial) data
</figcaption>
<div aria-describedby="tbl-beetles-model-grouped-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-60.72</td>
<td style="text-align: center;">5.18</td>
<td style="text-align: center;">(-71.44, -51.08)</td>
<td style="text-align: center;">-11.72</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dose</td>
<td style="text-align: center;">34.27</td>
<td style="text-align: center;">2.91</td>
<td style="text-align: center;">(28.85, 40.30)</td>
<td style="text-align: center;">11.77</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</figure>
</div>
<hr>
<div class="notes">
<p>They seem the same! But not quite:</p>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_grouped)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 'log Lik.' -19 (df=2)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_ungrouped)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 'log Lik.' -186 (df=2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="notes">
<p>The difference is due to the binomial coefficient <span class="math inline">\(\left(n\atop x \right)\)</span> which isn’t included in the individual-observations (Bernoulli) version of the model.</p>
</div>
</section>
</section>
<section id="multiple-logistic-regression" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="multiple-logistic-regression"><span class="header-section-number">3.7</span> Multiple logistic regression</h2>
<section id="coronary-heart-disease-wcgs-study-data" class="level3" data-number="3.7.1">
<h3 data-number="3.7.1" class="anchored" data-anchor-id="coronary-heart-disease-wcgs-study-data"><span class="header-section-number">3.7.1</span> Coronary heart disease (WCGS) study data</h3>
<div class="notes">
<p>Let’s use the data from the Western Collaborative Group Study (WCGS) (<span class="citation" data-cites="rosenman1975coronary">Rosenman et al. (<a href="references.html#ref-rosenman1975coronary" role="doc-biblioref">1975</a>)</span>) to explore multiple logistic regression:</p>
</div>
<p><em>From <span class="citation" data-cites="vittinghoff2e">Vittinghoff et al. (<a href="references.html#ref-vittinghoff2e" role="doc-biblioref">2012</a>)</span>:</em></p>
<p>“The <strong>Western Collaborative Group Study (WCGS)</strong> was a large epidemiological study designed to investigate the association between the”type A” behavior pattern and coronary heart disease (CHD)“.</p>
<p><em>From Wikipedia, “Type A and Type B personality theory”:</em></p>
<p>“The hypothesis describes Type A individuals as outgoing, ambitious, rigidly organized, highly status-conscious, impatient, anxious, proactive, and concerned with time management….</p>
<p>The hypothesis describes Type B individuals as a contrast to those of Type A. Type B personalities, by definition, are noted to live at lower stress levels. They typically work steadily and may enjoy achievement, although they have a greater tendency to disregard physical or mental stress when they do not achieve.”</p>
<hr>
<section id="study-design" class="level4">
<h4 class="anchored" data-anchor-id="study-design">Study design</h4>
<p><em>from <code>?faraway::wcgs</code>:</em></p>
<p>3154 healthy young men aged 39-59 from the San Francisco area were assessed for their personality type. All were free from coronary heart disease at the start of the research. Eight and a half years later change in CHD status was recorded.</p>
<p><em>Details (from <code>faraway::wcgs</code>)</em></p>
<p>The WCGS began in 1960 with 3,524 male volunteers who were employed by 11 California companies. Subjects were 39 to 59 years old and free of heart disease as determined by electrocardiogram. After the initial screening, the study population dropped to 3,154 and the number of companies to 10 because of various exclusions. The cohort comprised both blue- and white-collar employees.</p>
<hr>
</section>
</section>
<section id="baseline-data-collection" class="level3" data-number="3.7.2">
<h3 data-number="3.7.2" class="anchored" data-anchor-id="baseline-data-collection"><span class="header-section-number">3.7.2</span> Baseline data collection</h3>
<p>socio-demographic characteristics:</p>
<ul>
<li>age</li>
<li>education</li>
<li>marital status</li>
<li>income</li>
<li>occupation</li>
<li>physical and physiological including:</li>
<li>height</li>
<li>weight</li>
<li>blood pressure</li>
<li>electrocardiogram</li>
<li>corneal arcus;</li>
</ul>
<hr>
<p>biochemical measurements:</p>
<ul>
<li>cholesterol and lipoprotein fractions;</li>
<li>medical and family history and use of medications;</li>
</ul>
<hr>
<p>behavioral data:</p>
<ul>
<li>Type A interview,</li>
<li>smoking,</li>
<li>exercise</li>
<li>alcohol use.</li>
</ul>
<hr>
<p>Later surveys added data on:</p>
<ul>
<li>anthropometry</li>
<li>triglycerides</li>
<li>Jenkins Activity Survey</li>
<li>caffeine use</li>
</ul>
<p>Average follow-up continued for 8.5 years with repeat examinations.</p>
</section>
<section id="load-the-data" class="level3" data-number="3.7.3">
<h3 data-number="3.7.3" class="anchored" data-anchor-id="load-the-data"><span class="header-section-number">3.7.3</span> Load the data</h3>
<p>Here, I load the data:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">### load the data directly from a UCSF website:</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I'm breaking up the url into two chunks for readability</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://regression.ucsf.edu/sites/g/files/"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tkssra6706/f/wysiwyg/home/data/wcgs.dta"</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-wcgs" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wcgs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.7: <code>wcgs</code> data
</figcaption>
<div aria-describedby="tbl-wcgs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["age"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["arcus"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["behpat"],"name":[3],"type":["fct"],"align":["left"]},{"label":["bmi"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["chd69"],"name":[5],"type":["fct"],"align":["left"]},{"label":["chol"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["dbp"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["dibpat"],"name":[8],"type":["fct"],"align":["left"]},{"label":["height"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["id"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["lnsbp"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["lnwght"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["ncigs"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["sbp"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["smoke"],"name":[15],"type":["fct"],"align":["left"]},{"label":["t1"],"name":[16],"type":["dbl"],"align":["right"]},{"label":["time169"],"name":[17],"type":["dbl"],"align":["right"]},{"label":["typchd69"],"name":[18],"type":["fct"],"align":["left"]},{"label":["uni"],"name":[19],"type":["dbl"],"align":["right"]},{"label":["weight"],"name":[20],"type":["dbl"],"align":["right"]},{"label":["wghtcat"],"name":[21],"type":["fct"],"align":["left"]},{"label":["agec"],"name":[22],"type":["fct"],"align":["left"]}],"data":[{"1":"50","2":"TRUE","3":"A1","4":"31","5":"No","6":"249","7":"90","8":"Type A","9":"67","10":"2343","11":"4.9","12":"5.3","13":"25","14":"132","15":"Yes","16":"-1.63","17":"1367","18":"None","19":"0.49","20":"200","21":"170-200","22":"46-50"},{"1":"51","2":"FALSE","3":"A1","4":"25","5":"No","6":"194","7":"74","8":"Type A","9":"73","10":"3656","11":"4.8","12":"5.3","13":"25","14":"120","15":"Yes","16":"-4.06","17":"2991","18":"None","19":"0.19","20":"192","21":"170-200","22":"51-55"},{"1":"59","2":"TRUE","3":"A1","4":"29","5":"No","6":"258","7":"94","8":"Type A","9":"70","10":"3526","11":"5.1","12":"5.3","13":"0","14":"158","15":"No","16":"0.64","17":"2960","18":"None","19":"0.73","20":"200","21":"170-200","22":"56-60"},{"1":"51","2":"TRUE","3":"A1","4":"22","5":"No","6":"173","7":"80","8":"Type A","9":"69","10":"22057","11":"4.8","12":"5.0","13":"0","14":"126","15":"No","16":"1.12","17":"3069","18":"None","19":"0.62","20":"150","21":"140-170","22":"51-55"},{"1":"44","2":"FALSE","3":"A1","4":"22","5":"No","6":"214","7":"80","8":"Type A","9":"71","10":"12927","11":"4.8","12":"5.1","13":"0","14":"126","15":"No","16":"2.43","17":"3081","18":"None","19":"0.38","20":"160","21":"140-170","22":"41-45"},{"1":"47","2":"FALSE","3":"A1","4":"27","5":"No","6":"206","7":"76","8":"Type A","9":"64","10":"16029","11":"4.8","12":"5.1","13":"80","14":"116","15":"Yes","16":"-0.79","17":"2114","18":"None","19":"0.74","20":"158","21":"140-170","22":"46-50"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="data-cleaning" class="level3" data-number="3.7.4">
<h3 data-number="3.7.4" class="anchored" data-anchor-id="data-cleaning"><span class="header-section-number">3.7.4</span> Data cleaning</h3>
<div class="notes">
<p>Now let’s do some data cleaning</p>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arsenal) <span class="co"># provides `set_labels()`</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats) <span class="co"># provides `as_factor()`</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span> wcgs <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> age <span class="sc">|&gt;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Age (years)"</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">arcus =</span> arcus <span class="sc">|&gt;</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.logical</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Arcus Senilis"</span>),</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">time169 =</span> time169 <span class="sc">|&gt;</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Observation (follow up) time (days)"</span>),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">dibpat =</span> dibpat <span class="sc">|&gt;</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_factor</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">relevel</span>(<span class="at">ref =</span> <span class="st">"Type B"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Behavioral Pattern"</span>),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">typchd69 =</span> typchd69 <span class="sc">|&gt;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Type of CHD Event"</span>,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">"None"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infdeath"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">"silent"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">"angina"</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turn stata-style labelled variables in to R-style factors:</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.labelled),</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>      haven<span class="sc">::</span>as_factor</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="whats-in-the-data" class="level3 smaller" data-number="3.7.5">
<h3 class="smaller anchored" data-number="3.7.5" data-anchor-id="whats-in-the-data"><span class="header-section-number">3.7.5</span> What’s in the data</h3>
<p>Here’s a table of the data:</p>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(id, uni, t1)) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tableby</span>(chd69 <span class="sc">~</span> ., <span class="at">data =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pfootnote =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Baseline characteristics by CHD status at end of follow-up"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="caption-top table">
<caption>Baseline characteristics by CHD status at end of follow-up</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 18%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: center;">No (N=2897)</th>
<th style="text-align: center;">Yes (N=257)</th>
<th style="text-align: center;">Total (N=3154)</th>
<th style="text-align: right;">p value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Age (years)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">46.082 (5.457)</td>
<td style="text-align: center;">48.490 (5.801)</td>
<td style="text-align: center;">46.279 (5.524)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">39.000 - 59.000</td>
<td style="text-align: center;">39.000 - 59.000</td>
<td style="text-align: center;">39.000 - 59.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Arcus Senilis</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;N-Miss</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;FALSE</td>
<td style="text-align: center;">2058 (71.0%)</td>
<td style="text-align: center;">153 (60.0%)</td>
<td style="text-align: center;">2211 (70.1%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;TRUE</td>
<td style="text-align: center;">839 (29.0%)</td>
<td style="text-align: center;">102 (40.0%)</td>
<td style="text-align: center;">941 (29.9%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Behavioral Pattern</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;A1</td>
<td style="text-align: center;">234 (8.1%)</td>
<td style="text-align: center;">30 (11.7%)</td>
<td style="text-align: center;">264 (8.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;A2</td>
<td style="text-align: center;">1177 (40.6%)</td>
<td style="text-align: center;">148 (57.6%)</td>
<td style="text-align: center;">1325 (42.0%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;B3</td>
<td style="text-align: center;">1155 (39.9%)</td>
<td style="text-align: center;">61 (23.7%)</td>
<td style="text-align: center;">1216 (38.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;B4</td>
<td style="text-align: center;">331 (11.4%)</td>
<td style="text-align: center;">18 (7.0%)</td>
<td style="text-align: center;">349 (11.1%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Body Mass Index (kg/m2)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">24.471 (2.561)</td>
<td style="text-align: center;">25.055 (2.579)</td>
<td style="text-align: center;">24.518 (2.567)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">11.191 - 37.653</td>
<td style="text-align: center;">19.225 - 38.947</td>
<td style="text-align: center;">11.191 - 38.947</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Total Cholesterol</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;N-Miss</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">12</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">224.261 (42.217)</td>
<td style="text-align: center;">250.070 (49.396)</td>
<td style="text-align: center;">226.372 (43.420)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">103.000 - 400.000</td>
<td style="text-align: center;">155.000 - 645.000</td>
<td style="text-align: center;">103.000 - 645.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Diastolic Blood Pressure</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">81.723 (9.621)</td>
<td style="text-align: center;">85.315 (10.311)</td>
<td style="text-align: center;">82.016 (9.727)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">58.000 - 150.000</td>
<td style="text-align: center;">64.000 - 122.000</td>
<td style="text-align: center;">58.000 - 150.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Behavioral Pattern</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Type B</td>
<td style="text-align: center;">1486 (51.3%)</td>
<td style="text-align: center;">79 (30.7%)</td>
<td style="text-align: center;">1565 (49.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Type A</td>
<td style="text-align: center;">1411 (48.7%)</td>
<td style="text-align: center;">178 (69.3%)</td>
<td style="text-align: center;">1589 (50.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Height (inches)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">0.290<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">69.764 (2.539)</td>
<td style="text-align: center;">69.938 (2.410)</td>
<td style="text-align: center;">69.778 (2.529)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">60.000 - 78.000</td>
<td style="text-align: center;">63.000 - 77.000</td>
<td style="text-align: center;">60.000 - 78.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Ln of Systolic Blood Pressure</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">4.846 (0.110)</td>
<td style="text-align: center;">4.900 (0.125)</td>
<td style="text-align: center;">4.850 (0.112)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">4.585 - 5.438</td>
<td style="text-align: center;">4.605 - 5.298</td>
<td style="text-align: center;">4.585 - 5.438</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Ln of Weight</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">5.126 (0.123)</td>
<td style="text-align: center;">5.155 (0.118)</td>
<td style="text-align: center;">5.128 (0.123)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">4.357 - 5.670</td>
<td style="text-align: center;">4.868 - 5.768</td>
<td style="text-align: center;">4.357 - 5.768</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Cigarettes per day</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">11.151 (14.329)</td>
<td style="text-align: center;">16.665 (15.657)</td>
<td style="text-align: center;">11.601 (14.518)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">0.000 - 99.000</td>
<td style="text-align: center;">0.000 - 60.000</td>
<td style="text-align: center;">0.000 - 99.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Systolic Blood Pressure</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">128.034 (14.746)</td>
<td style="text-align: center;">135.385 (17.473)</td>
<td style="text-align: center;">128.633 (15.118)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">98.000 - 230.000</td>
<td style="text-align: center;">100.000 - 200.000</td>
<td style="text-align: center;">98.000 - 230.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Current smoking</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;No</td>
<td style="text-align: center;">1554 (53.6%)</td>
<td style="text-align: center;">98 (38.1%)</td>
<td style="text-align: center;">1652 (52.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Yes</td>
<td style="text-align: center;">1343 (46.4%)</td>
<td style="text-align: center;">159 (61.9%)</td>
<td style="text-align: center;">1502 (47.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Observation (follow up) time (days)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">2775.158 (562.205)</td>
<td style="text-align: center;">1654.700 (859.297)</td>
<td style="text-align: center;">2683.859 (666.524)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">238.000 - 3430.000</td>
<td style="text-align: center;">18.000 - 3229.000</td>
<td style="text-align: center;">18.000 - 3430.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Type of CHD Event</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;None</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;infdeath</td>
<td style="text-align: center;">2897 (100.0%)</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">2897 (91.9%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;silent</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">135 (52.5%)</td>
<td style="text-align: center;">135 (4.3%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;angina</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">71 (27.6%)</td>
<td style="text-align: center;">71 (2.3%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;4</td>
<td style="text-align: center;">0 (0.0%)</td>
<td style="text-align: center;">51 (19.8%)</td>
<td style="text-align: center;">51 (1.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Weight (lbs)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>1</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Mean (SD)</td>
<td style="text-align: center;">169.554 (21.010)</td>
<td style="text-align: center;">174.463 (21.573)</td>
<td style="text-align: center;">169.954 (21.096)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;Range</td>
<td style="text-align: center;">78.000 - 290.000</td>
<td style="text-align: center;">130.000 - 320.000</td>
<td style="text-align: center;">78.000 - 320.000</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Weight Category</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;&lt; 140</td>
<td style="text-align: center;">217 (7.5%)</td>
<td style="text-align: center;">15 (5.8%)</td>
<td style="text-align: center;">232 (7.4%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;140-170</td>
<td style="text-align: center;">1440 (49.7%)</td>
<td style="text-align: center;">98 (38.1%)</td>
<td style="text-align: center;">1538 (48.8%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;170-200</td>
<td style="text-align: center;">1049 (36.2%)</td>
<td style="text-align: center;">122 (47.5%)</td>
<td style="text-align: center;">1171 (37.1%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;&gt; 200</td>
<td style="text-align: center;">191 (6.6%)</td>
<td style="text-align: center;">22 (8.6%)</td>
<td style="text-align: center;">213 (6.8%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>RECODE of age (Age)</strong></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: right;">&lt; 0.001<sup>2</sup></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;35-40</td>
<td style="text-align: center;">512 (17.7%)</td>
<td style="text-align: center;">31 (12.1%)</td>
<td style="text-align: center;">543 (17.2%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;41-45</td>
<td style="text-align: center;">1036 (35.8%)</td>
<td style="text-align: center;">55 (21.4%)</td>
<td style="text-align: center;">1091 (34.6%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;46-50</td>
<td style="text-align: center;">680 (23.5%)</td>
<td style="text-align: center;">70 (27.2%)</td>
<td style="text-align: center;">750 (23.8%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;51-55</td>
<td style="text-align: center;">463 (16.0%)</td>
<td style="text-align: center;">65 (25.3%)</td>
<td style="text-align: center;">528 (16.7%)</td>
<td style="text-align: right;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">&nbsp;&nbsp;&nbsp;56-60</td>
<td style="text-align: center;">206 (7.1%)</td>
<td style="text-align: center;">36 (14.0%)</td>
<td style="text-align: center;">242 (7.7%)</td>
<td style="text-align: right;"></td>
</tr>
</tbody>
</table>
<ol type="1">
<li>Linear Model ANOVA</li>
<li>Pearson’s Chi-squared test</li>
</ol>
</section>
<section id="data-by-age-and-personality-type" class="level3" data-number="3.7.6">
<h3 data-number="3.7.6" class="anchored" data-anchor-id="data-by-age-and-personality-type"><span class="header-section-number">3.7.6</span> Data by age and personality type</h3>
<p>For now, we will look at the interaction between age and personality type (<code>dibpat</code>). To make it easier to visualize the data, we summarize the event rates for each combination of age:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>chd_grouped_data <span class="ot">&lt;-</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(age, dibpat),</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(chd69 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>)),</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">n - x</span><span class="st">`</span> <span class="ot">=</span> n <span class="sc">-</span> x,</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span> <span class="ot">=</span> (x <span class="sc">/</span> n) <span class="sc">|&gt;</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(<span class="at">label =</span> <span class="st">"CHD Event by 1969"</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">logit(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>chd_grouped_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["age"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["dibpat"],"name":[2],"type":["fct"],"align":["left"]},{"label":["n"],"name":[3],"type":["int"],"align":["right"]},{"label":["x"],"name":[4],"type":["int"],"align":["right"]},{"label":["n - x"],"name":[5],"type":["int"],"align":["right"]},{"label":["p(chd)"],"name":[6],"type":["dbl+lbl"],"align":["right"]},{"label":["odds(chd)"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["logit(chd)"],"name":[8],"type":["dbl"],"align":["right"]}],"data":[{"1":"50","2":"Type A","3":"76","4":"8","5":"68","6":"0.1053","7":"0.1176","8":"-2.1"},{"1":"51","2":"Type A","3":"67","4":"11","5":"56","6":"0.1642","7":"0.1964","8":"-1.6"},{"1":"59","2":"Type A","3":"30","4":"7","5":"23","6":"0.2333","7":"0.3043","8":"-1.2"},{"1":"44","2":"Type A","3":"113","4":"9","5":"104","6":"0.0796","7":"0.0865","8":"-2.4"},{"1":"47","2":"Type A","3":"72","4":"7","5":"65","6":"0.0972","7":"0.1077","8":"-2.2"},{"1":"40","2":"Type A","3":"133","4":"9","5":"124","6":"0.0677","7":"0.0726","8":"-2.6"},{"1":"41","2":"Type A","3":"108","4":"7","5":"101","6":"0.0648","7":"0.0693","8":"-2.7"},{"1":"43","2":"Type A","3":"97","4":"7","5":"90","6":"0.0722","7":"0.0778","8":"-2.6"},{"1":"54","2":"Type A","3":"53","4":"7","5":"46","6":"0.1321","7":"0.1522","8":"-1.9"},{"1":"48","2":"Type A","3":"80","4":"12","5":"68","6":"0.1500","7":"0.1765","8":"-1.7"},{"1":"39","2":"Type A","3":"128","4":"11","5":"117","6":"0.0859","7":"0.0940","8":"-2.4"},{"1":"49","2":"Type A","3":"67","4":"16","5":"51","6":"0.2388","7":"0.3137","8":"-1.2"},{"1":"55","2":"Type A","3":"55","4":"9","5":"46","6":"0.1636","7":"0.1957","8":"-1.6"},{"1":"56","2":"Type A","3":"49","4":"12","5":"37","6":"0.2449","7":"0.3243","8":"-1.1"},{"1":"42","2":"Type A","3":"101","4":"4","5":"97","6":"0.0396","7":"0.0412","8":"-3.2"},{"1":"45","2":"Type A","3":"77","4":"7","5":"70","6":"0.0909","7":"0.1000","8":"-2.3"},{"1":"46","2":"Type A","3":"91","4":"6","5":"85","6":"0.0659","7":"0.0706","8":"-2.7"},{"1":"57","2":"Type A","3":"31","4":"4","5":"27","6":"0.1290","7":"0.1481","8":"-1.9"},{"1":"53","2":"Type A","3":"62","4":"7","5":"55","6":"0.1129","7":"0.1273","8":"-2.1"},{"1":"52","2":"Type A","3":"65","4":"13","5":"52","6":"0.2000","7":"0.2500","8":"-1.4"},{"1":"58","2":"Type A","3":"34","4":"5","5":"29","6":"0.1471","7":"0.1724","8":"-1.8"},{"1":"45","2":"Type B","3":"109","4":"5","5":"104","6":"0.0459","7":"0.0481","8":"-3.0"},{"1":"41","2":"Type B","3":"125","4":"5","5":"120","6":"0.0400","7":"0.0417","8":"-3.2"},{"1":"47","2":"Type B","3":"75","4":"1","5":"74","6":"0.0133","7":"0.0135","8":"-4.3"},{"1":"39","2":"Type B","3":"138","4":"8","5":"130","6":"0.0580","7":"0.0615","8":"-2.8"},{"1":"49","2":"Type B","3":"67","4":"5","5":"62","6":"0.0746","7":"0.0806","8":"-2.5"},{"1":"51","2":"Type B","3":"56","4":"6","5":"50","6":"0.1071","7":"0.1200","8":"-2.1"},{"1":"42","2":"Type B","3":"121","4":"1","5":"120","6":"0.0083","7":"0.0083","8":"-4.8"},{"1":"50","2":"Type B","3":"59","4":"3","5":"56","6":"0.0508","7":"0.0536","8":"-2.9"},{"1":"44","2":"Type B","3":"122","4":"4","5":"118","6":"0.0328","7":"0.0339","8":"-3.4"},{"1":"56","2":"Type B","3":"27","4":"0","5":"27","6":"0.0000","7":"0.0000","8":"-Inf"},{"1":"40","2":"Type B","3":"144","4":"3","5":"141","6":"0.0208","7":"0.0213","8":"-3.9"},{"1":"58","2":"Type B","3":"22","4":"1","5":"21","6":"0.0455","7":"0.0476","8":"-3.0"},{"1":"48","2":"Type B","3":"84","4":"7","5":"77","6":"0.0833","7":"0.0909","8":"-2.4"},{"1":"43","2":"Type B","3":"118","4":"6","5":"112","6":"0.0508","7":"0.0536","8":"-2.9"},{"1":"53","2":"Type B","3":"43","4":"5","5":"38","6":"0.1163","7":"0.1316","8":"-2.0"},{"1":"54","2":"Type B","3":"54","4":"4","5":"50","6":"0.0741","7":"0.0800","8":"-2.5"},{"1":"46","2":"Type B","3":"79","4":"5","5":"74","6":"0.0633","7":"0.0676","8":"-2.7"},{"1":"52","2":"Type B","3":"48","4":"2","5":"46","6":"0.0417","7":"0.0435","8":"-3.1"},{"1":"55","2":"Type B","3":"25","4":"1","5":"24","6":"0.0400","7":"0.0417","8":"-3.2"},{"1":"57","2":"Type B","3":"32","4":"3","5":"29","6":"0.0938","7":"0.1034","8":"-2.3"},{"1":"59","2":"Type B","3":"17","4":"4","5":"13","6":"0.2353","7":"0.3077","8":"-1.2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="graphical-exploration" class="level3" data-number="3.7.7">
<h3 data-number="3.7.7" class="anchored" data-anchor-id="graphical-exploration"><span class="header-section-number">3.7.7</span> Graphical exploration</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeasy)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>chd_plot_probs <span class="ot">&lt;-</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"P(CHD Event by 1969)"</span>) <span class="sc">+</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>() <span class="sc">+</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_probs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chd-graph-prob-scale" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd-graph-prob-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.10: CHD rates by age group, probability scale
</figcaption>
<div aria-describedby="fig-chd-graph-prob-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-chd-graph-prob-scale-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
<section id="odds-scale" class="level4">
<h4 class="anchored" data-anchor-id="odds-scale">Odds scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>trans_odds <span class="ot">&lt;-</span> <span class="fu">trans_new</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"odds"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> odds,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> odds_inv</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>chd_plot_odds <span class="ot">&lt;-</span> chd_plot_probs <span class="sc">+</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> trans_odds, <span class="co"># this line changes the vertical spacing</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> chd_plot_probs<span class="sc">$</span>labels<span class="sc">$</span>y,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_odds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chd-odds-scale" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd-odds-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.11: CHD rates by age group, odds spacing
</figcaption>
<div aria-describedby="fig-chd-odds-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-chd-odds-scale-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="log-odds-logit-scale" class="level4">
<h4 class="anchored" data-anchor-id="log-odds-logit-scale">Log-odds (logit) scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>trans_logit <span class="ot">&lt;-</span> <span class="fu">trans_new</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"logit"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> logit,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> expit</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>chd_plot_logit <span class="ot">&lt;-</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  chd_plot_probs <span class="sc">+</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> trans_logit, <span class="co"># this line changes the vertical spacing</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> chd_plot_probs<span class="sc">$</span>labels<span class="sc">$</span>y,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(.<span class="dv">01</span>, .<span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">01</span>), .<span class="dv">15</span>, .<span class="dv">2</span>),</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="cn">NULL</span>,</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">logit</span>(.),</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"log(odds(CHD Event by 1969))"</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chd_plot_logit" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd_plot_logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.12: CHD data (logit-scale)
</figcaption>
<div aria-describedby="fig-chd_plot_logit-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-chd_plot_logit-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="logistic-regression-models-for-chd-data" class="level3 smaller" data-number="3.7.8">
<h3 class="smaller anchored" data-number="3.7.8" data-anchor-id="logistic-regression-models-for-chd-data"><span class="header-section-number">3.7.8</span> Logistic regression models for CHD data</h3>
<p>Here, we fit stratified models for CHD by personality type.</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-chd-strat" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-chd-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.8: CHD model, stratified parametrization
</figcaption>
<div aria-describedby="tbl-chd-strat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">-5.80</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">(-7.73, -3.90)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">-5.50</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">(-6.83, -4.19)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(0.02, 0.10)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(0.05, 0.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>We can get the corresponding odds ratios (<span class="math inline">\(e^{\beta}\)</span>s) by passing <code>exponentiate = TRUE</code> to <code>parameters()</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-chd-glm-strat-OR" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-chd-glm-strat-OR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.9: Odds ratio estimates for CHD model
</figcaption>
<div aria-describedby="tbl-chd-glm-strat-OR-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 28%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 23%">
<col style="width: 9%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Odds Ratio</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">3.02e-03</td>
<td style="text-align: center;">2.94e-03</td>
<td style="text-align: center;">(4.40e-04, 0.02)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">4.09e-03</td>
<td style="text-align: center;">2.75e-03</td>
<td style="text-align: center;">(1.08e-03, 0.02)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">1.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(1.02, 1.11)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">1.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(1.05, 1.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="models-superimposed-on-data" class="level3" data-number="3.7.9">
<h3 data-number="3.7.9" class="anchored" data-anchor-id="models-superimposed-on-data"><span class="header-section-number">3.7.9</span> Models superimposed on data</h3>
<p>We can graph our fitted models on each scale (probability, odds, log-odds).</p>
<hr>
<section id="probability-scale" class="level4">
<h4 class="anchored" data-anchor-id="probability-scale">probability scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co"># nolint: object_name_linter</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co"># nolint: object_name_linter</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>chd_plot_probs_2 <span class="ot">&lt;-</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  chd_plot_probs <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_probs_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
<div class="{fig-fitted-odds-chd}">
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>chd_plot_odds_2 <span class="ot">&lt;-</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  chd_plot_odds <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_odds_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>odds scale</p>
</div>
<hr>
</section>
<section id="log-odds-logit-scale-1" class="level4">
<h4 class="anchored" data-anchor-id="log-odds-logit-scale-1">log-odds (logit) scale</h4>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>chd_plot_logit_2 <span class="ot">&lt;-</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  chd_plot_logit <span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fitted-log-odds" class="quarto-float quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-fitted-log-odds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.13
</figcaption>
<div aria-describedby="fig-fitted-log-odds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-fitted-log-odds-1.png" id="fig-fitted-log-odds" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="reference-group-and-contrast-parametrization" class="level3" data-number="3.7.10">
<h3 data-number="3.7.10" class="anchored" data-anchor-id="reference-group-and-contrast-parametrization"><span class="header-section-number">3.7.10</span> reference-group and contrast parametrization</h3>
<p>We can also use the corner-point parametrization (with reference groups and contrasts):</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="ot">&lt;-</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">*</span> <span class="fu">I</span>(age <span class="sc">-</span> <span class="dv">50</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="sc">|&gt;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-model-corner-point" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-corner-point-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3.10: CHD model (corner-point parametrization)
</figcaption>
<div aria-describedby="tbl-model-corner-point-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 36%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 21%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-2.73</td>
<td style="text-align: center;">0.13</td>
<td style="text-align: center;">(-2.98, -2.49)</td>
<td style="text-align: center;">-21.45</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">0.82</td>
<td style="text-align: center;">0.15</td>
<td style="text-align: center;">(0.53, 1.13)</td>
<td style="text-align: center;">5.42</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age - 50</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(0.02, 0.10)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A) × age - 50</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(-0.04, 0.06)</td>
<td style="text-align: center;">0.42</td>
<td style="text-align: center;">0.674</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div class="notes">
<p>Compare with <a href="#tbl-chd-glm-strat-OR" class="quarto-xref">Table&nbsp;<span>3.9</span></a>.</p>
</div>
<hr>
<div id="exr-strat-to-contrast" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.16</strong></span> If I give you model 1, how would you get the coefficients of model 2?</p>
</div>
<hr>
<div id="thm-logistic-OR" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.15</strong></span> For the logistic regression model:</p>
<ul>
<li><span class="math inline">\(Y_i|\tilde{X}_i \ \sim_{⫫}\ \text{Ber}(\pi(\tilde{X}_i))\)</span></li>
<li><span class="math inline">\(\pi(\tilde{x}) = \text{expit}\left\{\tilde{x}'\tilde{\beta}\right\}\)</span></li>
</ul>
<p>Consider two covariate patterns, <span class="math inline">\(\tilde{x}\)</span> and <span class="math inline">\(\tilde{x^*}\)</span>.</p>
<p>The odds ratio comparing these covariate patterns is:</p>
<p><span class="math display">\[
\omega(\tilde{x},\tilde{x^*}) = \text{exp}\left\{(\tilde{x}-\tilde{x^*})^{\top} \tilde{\beta}\right\}
\]</span></p>
</div>
<hr>
<div class="proof">
<p><span class="proof-title"><em>Proof</em>. </span><span class="math display">\[
\begin{aligned}
\omega(\tilde{x},\tilde{x^*})
&amp;= \frac {\omega(Y=1 | \tilde{X}= \tilde{x})} {\omega(Y=1 | \tilde{X}= \tilde{x^*})}
\\ &amp;= \frac{\text{exp}\left\{\tilde{x}^{\top}\tilde{\beta}\right\}}{\text{exp}\left\{{\tilde{x^*}}^{\top} \tilde{\beta}\right\}}
\\ &amp;= \text{exp}\left\{\tilde{x}^{\top}\tilde{\beta}- {\tilde{x^*}}^{\top} \tilde{\beta}\right\}
\\ &amp;= \text{exp}\left\{(\tilde{x}^{\top} - {\tilde{x^*}}^{\top}) \tilde{\beta}\right\}
\\ &amp;= \text{exp}\left\{{(\tilde{x}- \tilde{x^*})}^{\top} \tilde{\beta}\right\}
\end{aligned}
\]</span></p>
</div>
</section>
</section>
<section id="fitting-logistic-regression-models" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="fitting-logistic-regression-models"><span class="header-section-number">3.8</span> Fitting logistic regression models</h2>
<section id="maximum-likelihood-estimation-for-textciid-data" class="level3" data-number="3.8.1">
<h3 data-number="3.8.1" class="anchored" data-anchor-id="maximum-likelihood-estimation-for-textciid-data"><span class="header-section-number">3.8.1</span> Maximum likelihood estimation for <span class="math inline">\(\text{ciid}\)</span> data</h3>
<p>Assume:</p>
<ul>
<li><span class="math inline">\(Y_i|\tilde{X}_i \ \sim_{⫫}\ \text{Ber}(\pi(X_i))\)</span></li>
<li><span class="math inline">\(\pi(\tilde{x}) = \text{expit}\left\{\tilde{x}'\tilde{\beta}\right\}\)</span></li>
</ul>
<hr>
<section id="log-likelihood-function" class="level4">
<h4 class="anchored" data-anchor-id="log-likelihood-function">log-likelihood function</h4>
<p><span id="eq-loglik-bernoulli-iid"><span class="math display">\[
\begin{aligned}
\ell(\tilde{\beta}, \tilde{y})
   &amp;= \text{log}\left\{\mathcal{L}(\tilde{\beta}, \tilde{y}) \right\}
\\ &amp;= \sum_{i=1}^n{\color{red}\ell_i}(\pi(\tilde{x}_i))
\end{aligned}
\tag{3.6}\]</span></span></p>
<hr>
<p><span class="math display">\[
\begin{aligned}
{\color{red}\ell_i}(\pi)
   &amp;= y_i \text{log}\left\{\pi\right\} + (1 - y_i) \text{log}\left\{1-\pi\right\}
\\ &amp;= y_i \text{log}\left\{\pi\right\} + (1 \cdot\text{log}\left\{1-\pi\right\} - y_i \cdot\text{log}\left\{1-\pi\right\})
\\ &amp;= y_i \text{log}\left\{\pi\right\} + (\text{log}\left\{1-\pi\right\} - y_i \text{log}\left\{1-\pi\right\})
\\ &amp;= y_i \text{log}\left\{\pi\right\} + \text{log}\left\{1-\pi\right\} - y_i \text{log}\left\{{\color{blue}1-\pi}\right\}
\\ &amp;= y_i \text{log}\left\{\pi\right\} - y_i \text{log}\left\{{\color{blue}1-\pi}\right\} + \text{log}\left\{1-\pi\right\}
\\ &amp;= (y_i \text{log}\left\{\pi\right\} - y_i \text{log}\left\{{\color{blue}1-\pi}\right\}) + \text{log}\left\{1-\pi\right\}
\\ &amp;= y_i (\text{log}\left\{{\color{red}\pi}\right\} - \text{log}\left\{{\color{blue}1-\pi}\right\}) + \text{log}\left\{1-\pi\right\}
\\ &amp;= y_i \left(\text{log}\left\{\frac{{\color{red}\pi}}{{\color{blue}1-\pi}}\right\}\right) + \text{log}\left\{1-\pi\right\}
\\ &amp;= y_i (\text{logit}(\pi)) + \text{log}\left\{1-\pi\right\}
\end{aligned}
\]</span></p>
<hr>
</section>
<section id="score-function" class="level4">
<h4 class="anchored" data-anchor-id="score-function">score function</h4>
<p><span class="math display">\[
\begin{aligned}
\ell'(\tilde{\beta})
   &amp;\stackrel{\text{def}}{=}\frac{\partial}{\partial \tilde{\beta}} \ell(\tilde{\beta})
\\ &amp;=      \frac{\partial}{\partial \tilde{\beta}} \sum_{i=1}^n\ell_i(\tilde{\beta})
\\ &amp;=      \sum_{i=1}^n\frac{\partial}{\partial \tilde{\beta}} \ell_i(\tilde{\beta})
\\ &amp;=      \sum_{i=1}^n\ell'_i(\tilde{\beta})
\end{aligned}
\]</span></p>
<hr>
<p><span class="math display">\[
\begin{aligned}
\ell_i'(\tilde{\beta})
   &amp;= \frac{\partial}{\partial \tilde{\beta}} y_i \left(\text{logit}\left\{\pi_i\right\}\right) + \text{log}\left\{1-\pi_i\right\}
\\ &amp;= \frac{\partial}{\partial \tilde{\beta}}\left\{y_i \left(\tilde{x}_i'\tilde{\beta}\right) + \text{log}\left\{1-\pi_i\right\}\right\}
\\ &amp;= \left\{y_i \frac{\partial}{\partial \tilde{\beta}}\left(\tilde{x}_i'\tilde{\beta}\right) + \frac{\partial}{\partial \tilde{\beta}}\text{log}\left\{1-\pi_i\right\}\right\}
\\ &amp;= \left\{\tilde{x}_i y_i + \frac{\partial}{\partial \tilde{\beta}}\text{log}\left\{1-\text{expit}(\tilde{x}_i'\tilde{\beta})\right\}\right\}
\\ &amp;= \left\{\tilde{x}_i y_i + \frac{\partial}{\partial \tilde{\beta}}\text{log}\left\{\left(1+\text{exp}\left\{\tilde{x}_i'\tilde{\beta}\right\}\right)^{-1}\right\}\right\}
\\ &amp;= \left\{\tilde{x}_i y_i - \frac{\partial}{\partial \tilde{\beta}}\text{log}\left\{1+\text{exp}\left\{\tilde{x}_i'\tilde{\beta}\right\}\right\}\right\}
\end{aligned}
\]</span></p>
<hr>
<p>Now we need to apply the <a href="./math-prereqs.html#thm-chain-rule">chain rule</a>:</p>
<p><span class="math display">\[
\frac{\partial}{\partial \beta}\text{log}\left\{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}\right\} =
\frac{1}{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}} \frac{\partial}{\partial \beta}\left\{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}\right\}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial \beta}\left\{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}\right\}
   &amp;= \text{exp}\left\{\tilde{x}_i'\beta\right\} \frac{\partial}{\partial \beta}\tilde{x}_i'\beta
\\ &amp;= \tilde{x}_i \text{exp}\left\{\tilde{x}_i'\beta\right\}
\end{aligned}
\]</span></p>
<p>So:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial \beta}\text{log}\left\{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}\right\}
   &amp;= \frac{1}{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}} \text{exp}\left\{\tilde{x}_i'\beta\right\} \tilde{x}_i
\\ &amp;= \frac{\text{exp}\left\{\tilde{x}_i'\beta\right\}}{1+\text{exp}\left\{\tilde{x}_i'\beta\right\}}  \tilde{x}_i
\\ &amp;= \tilde{x}_i \text{expit}\left\{\tilde{x}_i'\beta\right\}
\end{aligned}
\]</span></p>
<hr>
<p>So:</p>
<p><span class="math display">\[
\begin{aligned}
\ell_i'(\tilde{\beta})
&amp;= \tilde{x}_i y_i - \tilde{x}_i \text{expit}\left\{\tilde{x}_i'\beta\right\}
\\ &amp;= \tilde{x}_i (y_i - \text{expit}\left\{\tilde{x}_i'\beta\right\})
\\ &amp;= \tilde{x}_i (y_i - \pi_i)
\\ &amp;= \tilde{x}_i (y_i - \mathbb{E}[Y_i|\tilde{X}_i=\tilde{x}_i])
\\ &amp;= \tilde{x}_i \ \varepsilon(y_i|\tilde{X}_i=\tilde{x}_i)
\end{aligned}
\]</span></p>
<div class="notes">
<p>This last expression is essentially the same as we found in <a href="./Linear-models-overview.html#eq-scorefun-linreg">linear regression</a>.</p>
</div>
<hr>
<p>Putting the pieces of <span class="math inline">\(\ell'(\tilde{\beta})\)</span> back together, we have:</p>
<p><span class="math display">\[
\ell'(\tilde{\beta}) = \sum_{i=1}^n\left\{\tilde{x}_i(y_i - \text{expit}\left\{\tilde{x}_i'\beta\right\}) \right\}
\]</span></p>
<p>Setting <span class="math inline">\(\ell'(\tilde{\beta}; \tilde{y}) = 0\)</span> gives us:</p>
<p><span id="eq-score-logistic"><span class="math display">\[\sum_{i=1}^n\left\{\tilde{x}_i(y_i - \text{expit}\left\{\tilde{x}_i'\beta\right\}) \right\} = 0 \tag{3.7}\]</span></span></p>
<hr>
<div class="notes">
<p>In general, the estimating equation <span class="math inline">\(\ell'(\tilde{\beta}; \tilde{y}) = 0\)</span> cannot be solved analytically.</p>
<p>Instead, we can use the <a href="./intro-MLEs.html#sec-newton-raphson">Newton-Raphson method</a>:</p>
</div>
<p><span class="math display">\[
{\widehat{\theta}}^*
\leftarrow {\widehat{\theta}}^* - \left(\ell''\left(\tilde{y};{\widehat{\theta}}^*\right)\right)^{-1}
\ell'\left(\tilde{y};{\widehat{\theta}}^*\right)
\]</span></p>
<div class="notes">
<p>We make an iterative series of guesses, and each guess helps us make the next guess better (i.e., higher log-likelihood). You can see some information about this process like so:</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">8</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glm.control</span>(<span class="at">trace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">*</span> age,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1775.7899 Iterations - 1</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1708.5396 Iterations - 2</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1704.0434 Iterations - 3</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1703.9833 Iterations - 4</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1703.9832 Iterations - 5</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Deviance = 1703.9832 Iterations - 6</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="notes">
<p>After each iteration of the fitting procedure, the deviance (<span class="math inline">\(2(\ell_{\text{full}} - \ell(\hat\beta))\)</span> ) is printed. You can see that the algorithm took six iterations to converge to a solution where the likelihood wasn’t changing much anymore.</p>
</div>
</section>
</section>
</section>
<section id="sec-gof" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="sec-gof"><span class="header-section-number">3.9</span> Model comparisons for logistic models</h2>
<section id="deviance-test" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1" class="anchored" data-anchor-id="deviance-test"><span class="header-section-number">3.9.1</span> Deviance test</h3>
<p>We can compare the maximized log-likelihood of our model, <span class="math inline">\(\ell(\hat\beta; \mathbf x)\)</span>, versus the log-likelihood of the full model (aka saturated model aka maximal model), <span class="math inline">\(\ell_{\text{full}}\)</span>, which has one parameter per covariate pattern. With enough data, <span class="math inline">\(2(\ell_{\text{full}} - \ell(\hat\beta; \mathbf x)) \dot \sim \chi^2(N - p)\)</span>, where <span class="math inline">\(N\)</span> is the number of distinct covariate patterns and <span class="math inline">\(p\)</span> is the number of <span class="math inline">\(\beta\)</span> parameters in our model. A significant p-value for this <strong>deviance</strong> statistic indicates that there’s some detectable pattern in the data that our model isn’t flexible enough to catch.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The deviance statistic needs to have a large amount of data <strong>for each covariate pattern</strong> for the <span class="math inline">\(\chi^2\)</span> approximation to hold. A guideline from Dobson is that if there are <span class="math inline">\(q\)</span> distinct covariate patterns <span class="math inline">\(x_1...,x_q\)</span>, with <span class="math inline">\(n_1,...,n_q\)</span> observations per pattern, then the expected frequencies <span class="math inline">\(n_k \cdot \pi(x_k)\)</span> should be at least 1 for every pattern <span class="math inline">\(k\in 1:q\)</span>.</p>
</div>
</div>
<p>If you have covariates measured on a continuous scale, you may not be able to use the deviance tests to assess goodness of fit.</p>
</section>
<section id="hosmer-lemeshow-test" class="level3" data-number="3.9.2">
<h3 data-number="3.9.2" class="anchored" data-anchor-id="hosmer-lemeshow-test"><span class="header-section-number">3.9.2</span> Hosmer-Lemeshow test</h3>
<p>If our covariate patterns produce groups that are too small, a reasonable solution is to make bigger groups by merging some of the covariate-pattern groups together.</p>
<p>Hosmer and Lemeshow (1980) proposed that we group the patterns by their predicted probabilities according to the model of interest. For example, you could group all of the observations with predicted probabilities of 10% or less together, then group the observations with 11%-20% probability together, and so on; <span class="math inline">\(g=10\)</span> categories in all.</p>
<p>Then we can construct a statistic <span class="math display">\[X^2 = \sum_{c=1}^g \frac{(o_c - e_c)^2}{e_c}\]</span> where <span class="math inline">\(o_c\)</span> is the number of events <em>observed</em> in group <span class="math inline">\(c\)</span>, and <span class="math inline">\(e_c\)</span> is the number of events expected in group <span class="math inline">\(c\)</span> (based on the sum of the fitted values <span class="math inline">\(\hat\pi_i\)</span> for observations in group <span class="math inline">\(c\)</span>).</p>
<p>If each group has enough observations in it, you can compare <span class="math inline">\(X^2\)</span> to a <span class="math inline">\(\chi^2\)</span> distribution; by simulation, the degrees of freedom has been found to be approximately <span class="math inline">\(g-2\)</span>.</p>
<p>For our CHD model, this procedure would be:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> pred_probs_glm1 <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">&lt;-</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">pred_prob_cats1</th>
<th style="text-align: center;">n</th>
<th style="text-align: center;">o</th>
<th style="text-align: center;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(0.1,0.2]</td>
<td style="text-align: center;">785</td>
<td style="text-align: center;">116</td>
<td style="text-align: center;">108</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.2,0.3]</td>
<td style="text-align: center;">64</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">13.77</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[0,0.1]</td>
<td style="text-align: center;">2,305</td>
<td style="text-align: center;">129</td>
<td style="text-align: center;">135.2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> HL_table <span class="sc">|&gt;</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o <span class="sc">-</span> e)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> e)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.1102871</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our statistic is <span class="math inline">\(X^2 = 1.11028711\)</span>; <span class="math inline">\(p(\chi^2(1) &gt; 1.11028711) = 0.29201955\)</span>, which is our p-value for detecting a lack of goodness of fit.</p>
<p>Unfortunately that grouping plan left us with just three categories with any observations, so instead of grouping by 10% increments of predicted probability, typically analysts use deciles of the predicted probabilities:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> pred_probs_glm1 <span class="sc">|&gt;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">quantile</span>(pred_probs_glm1, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">&lt;-</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">pred_prob_cats1</th>
<th style="text-align: center;">n</th>
<th style="text-align: center;">o</th>
<th style="text-align: center;">e</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">(0.114,0.147]</td>
<td style="text-align: center;">275</td>
<td style="text-align: center;">48</td>
<td style="text-align: center;">36.81</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.147,0.222]</td>
<td style="text-align: center;">314</td>
<td style="text-align: center;">51</td>
<td style="text-align: center;">57.19</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(0.0774,0.0942]</td>
<td style="text-align: center;">371</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">32.56</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.0942,0.114]</td>
<td style="text-align: center;">282</td>
<td style="text-align: center;">30</td>
<td style="text-align: center;">29.89</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(0.0633,0.069]</td>
<td style="text-align: center;">237</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">15.97</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.069,0.0774]</td>
<td style="text-align: center;">306</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">22.95</td>
</tr>
<tr class="odd">
<td style="text-align: center;">(0.0487,0.0633]</td>
<td style="text-align: center;">413</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">24.1</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.0409,0.0487]</td>
<td style="text-align: center;">310</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">14.15</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[0.0322,0.0363]</td>
<td style="text-align: center;">407</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">13.91</td>
</tr>
<tr class="even">
<td style="text-align: center;">(0.0363,0.0409]</td>
<td style="text-align: center;">239</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">9.48</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> HL_table <span class="sc">|&gt;</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o <span class="sc">-</span> e)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> e)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 6.7811383</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we have more evenly split categories. The p-value is <span class="math inline">\(0.56041994\)</span>, still not significant.</p>
<p>Graphically, we have compared:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>HL_plot <span class="ot">&lt;-</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  HL_table <span class="sc">|&gt;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_prob_cats1)) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">x =</span> pred_prob_cats1, <span class="at">group =</span> <span class="st">"Expected"</span>, <span class="at">col =</span> <span class="st">"Expected"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Expected"</span>)) <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">col =</span> <span class="st">"Observed"</span>, <span class="at">group =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"number of CHD events"</span>) <span class="sc">+</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(HL_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-410bd821a48d1eaf6bfe" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-410bd821a48d1eaf6bfe">{"x":{"data":[{"x":[1,2,3,4,5,6,7,8,9,10],"y":[13.908463615435309,9.4804170060421917,14.147082276065026,24.097195841138749,15.965627048323716,22.950027038870335,32.56412045198477,29.88884072191177,36.812443563295503,57.185782436933273],"text":["pred_prob_cats1: [0.0322,0.0363]<br />e: 13.908464<br />colour: Expected","pred_prob_cats1: (0.0363,0.0409]<br />e:  9.480417<br />colour: Expected","pred_prob_cats1: (0.0409,0.0487]<br />e: 14.147082<br />colour: Expected","pred_prob_cats1: (0.0487,0.0633]<br />e: 24.097196<br />colour: Expected","pred_prob_cats1: (0.0633,0.069]<br />e: 15.965627<br />colour: Expected","pred_prob_cats1: (0.069,0.0774]<br />e: 22.950027<br />colour: Expected","pred_prob_cats1: (0.0774,0.0942]<br />e: 32.564120<br />colour: Expected","pred_prob_cats1: (0.0942,0.114]<br />e: 29.888841<br />colour: Expected","pred_prob_cats1: (0.114,0.147]<br />e: 36.812444<br />colour: Expected","pred_prob_cats1: (0.147,0.222]<br />e: 57.185782<br />colour: Expected"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)","dash":"solid"},"hoveron":"points","name":"Expected","legendgroup":"Expected","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,10,7,8,5,6,4,3,1,2],"y":[36.812443563295503,57.185782436933273,32.56412045198477,29.88884072191177,15.965627048323716,22.950027038870335,24.097195841138749,14.147082276065026,13.908463615435309,9.4804170060421917],"text":["pred_prob_cats1: (0.114,0.147]<br />e: 36.812444<br />n: 275<br />colour: Expected","pred_prob_cats1: (0.147,0.222]<br />e: 57.185782<br />n: 314<br />colour: Expected","pred_prob_cats1: (0.0774,0.0942]<br />e: 32.564120<br />n: 371<br />colour: Expected","pred_prob_cats1: (0.0942,0.114]<br />e: 29.888841<br />n: 282<br />colour: Expected","pred_prob_cats1: (0.0633,0.069]<br />e: 15.965627<br />n: 237<br />colour: Expected","pred_prob_cats1: (0.069,0.0774]<br />e: 22.950027<br />n: 306<br />colour: Expected","pred_prob_cats1: (0.0487,0.0633]<br />e: 24.097196<br />n: 413<br />colour: Expected","pred_prob_cats1: (0.0409,0.0487]<br />e: 14.147082<br />n: 310<br />colour: Expected","pred_prob_cats1: [0.0322,0.0363]<br />e: 13.908464<br />n: 407<br />colour: Expected","pred_prob_cats1: (0.0363,0.0409]<br />e:  9.480417<br />n: 239<br />colour: Expected"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":[9.0481155247630038,11.279295054986243,13.673138690569633,9.5128807201598544,3.7795275590551185,10.879014793162673,15.118110236220474,11.081898115260863,14.923163051908769,4.9882245336696025],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Expected","legendgroup":"Expected","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[9,10,7,8,5,6,4,3,1,2],"y":[48,51,27,30,17,20,27,14,16,7],"text":["pred_prob_cats1: (0.114,0.147]<br />o: 48<br />n: 275<br />colour: Observed","pred_prob_cats1: (0.147,0.222]<br />o: 51<br />n: 314<br />colour: Observed","pred_prob_cats1: (0.0774,0.0942]<br />o: 27<br />n: 371<br />colour: Observed","pred_prob_cats1: (0.0942,0.114]<br />o: 30<br />n: 282<br />colour: Observed","pred_prob_cats1: (0.0633,0.069]<br />o: 17<br />n: 237<br />colour: Observed","pred_prob_cats1: (0.069,0.0774]<br />o: 20<br />n: 306<br />colour: Observed","pred_prob_cats1: (0.0487,0.0633]<br />o: 27<br />n: 413<br />colour: Observed","pred_prob_cats1: (0.0409,0.0487]<br />o: 14<br />n: 310<br />colour: Observed","pred_prob_cats1: [0.0322,0.0363]<br />o: 16<br />n: 407<br />colour: Observed","pred_prob_cats1: (0.0363,0.0409]<br />o:  7<br />n: 239<br />colour: Observed"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":[9.0481155247630038,11.279295054986243,13.673138690569633,9.5128807201598544,3.7795275590551185,10.879014793162673,15.118110236220474,11.081898115260863,14.923163051908769,4.9882245336696025],"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Observed","legendgroup":"Observed","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10],"y":[16,7,14,27,17,20,27,30,48,51],"text":["pred_prob_cats1: [0.0322,0.0363]<br />o: 16<br />colour: Observed","pred_prob_cats1: (0.0363,0.0409]<br />o:  7<br />colour: Observed","pred_prob_cats1: (0.0409,0.0487]<br />o: 14<br />colour: Observed","pred_prob_cats1: (0.0487,0.0633]<br />o: 27<br />colour: Observed","pred_prob_cats1: (0.0633,0.069]<br />o: 17<br />colour: Observed","pred_prob_cats1: (0.069,0.0774]<br />o: 20<br />colour: Observed","pred_prob_cats1: (0.0774,0.0942]<br />o: 27<br />colour: Observed","pred_prob_cats1: (0.0942,0.114]<br />o: 30<br />colour: Observed","pred_prob_cats1: (0.114,0.147]<br />o: 48<br />colour: Observed","pred_prob_cats1: (0.147,0.222]<br />o: 51<br />colour: Observed"],"type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)","dash":"solid"},"hoveron":"points","name":"Observed","legendgroup":"Observed","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":74.956356961893121,"l":37.260273972602747},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,10.6],"tickmode":"array","ticktext":["[0.0322,0.0363]","(0.0363,0.0409]","(0.0409,0.0487]","(0.0487,0.0633]","(0.0633,0.069]","(0.069,0.0774]","(0.0774,0.0942]","(0.0942,0.114]","(0.114,0.147]","(0.147,0.222]"],"tickvals":[1,2,3,4,5,6.0000000000000009,7,8,9,10],"categoryorder":"array","categoryarray":["[0.0322,0.0363]","(0.0363,0.0409]","(0.0409,0.0487]","(0.0487,0.0633]","(0.0633,0.069]","(0.069,0.0774]","(0.0774,0.0942]","(0.0942,0.114]","(0.114,0.147]","(0.147,0.222]"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-45,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"pred_prob_cats1","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.4907108781533367,59.695071558779937],"tickmode":"array","ticktext":["10","20","30","40","50"],"tickvals":[10,20,30,40,50],"categoryorder":"array","categoryarray":["10","20","30","40","50"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.68949771689498},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"number of CHD events","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.68949771689498},"title":{"text":"n<br />colour","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"29785fbf04fe":{"x":{},"y":{},"colour":{},"type":"scatter"},"297836531d8b":{"x":{},"y":{},"size":{},"colour":{}},"297826d33f2a":{"x":{},"y":{},"size":{},"colour":{}},"297851886d00":{"x":{},"y":{},"colour":{}}},"cur_data":"29785fbf04fe","visdat":{"29785fbf04fe":["function (y) ","x"],"297836531d8b":["function (y) ","x"],"297826d33f2a":["function (y) ","x"],"297851886d00":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="comparing-models" class="level3" data-number="3.9.3">
<h3 data-number="3.9.3" class="anchored" data-anchor-id="comparing-models"><span class="header-section-number">3.9.3</span> Comparing models</h3>
<ul>
<li>AIC = <span class="math inline">\(-2 * \ell(\hat\theta) + 2 * p\)</span> [lower is better]</li>
<li>BIC = <span class="math inline">\(-2 * \ell(\hat\theta) + p * \text{log}(n)\)</span> [lower is better]</li>
<li>likelihood ratio [higher is better]</li>
</ul>
</section>
</section>
<section id="residual-based-diagnostics" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="residual-based-diagnostics"><span class="header-section-number">3.10</span> Residual-based diagnostics</h2>
<section id="logistic-regression-residuals-only-work-for-grouped-data" class="level3" data-number="3.10.1">
<h3 data-number="3.10.1" class="anchored" data-anchor-id="logistic-regression-residuals-only-work-for-grouped-data"><span class="header-section-number">3.10.1</span> Logistic regression residuals only work for grouped data</h3>
<p>Residuals only work if there is more than one observation for most covariate patterns.</p>
<p>Here we will create the grouped-data version of our CHD model from the WCGS study:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">&lt;-</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(dibpat, age),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">chd =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">!chd</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"No"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(chd, <span class="st">`</span><span class="at">!chd</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs_grouped,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 31%">
<col style="width: 14%">
<col style="width: 8%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Odds</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">dibpat (Type B)</td>
<td style="text-align: center;">-5.80</td>
<td style="text-align: center;">0.98</td>
<td style="text-align: center;">(-7.73, -3.90)</td>
<td style="text-align: center;">-5.95</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A)</td>
<td style="text-align: center;">-5.50</td>
<td style="text-align: center;">0.67</td>
<td style="text-align: center;">(-6.83, -4.19)</td>
<td style="text-align: center;">-8.18</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dibpat (Type B) × age</td>
<td style="text-align: center;">0.06</td>
<td style="text-align: center;">0.02</td>
<td style="text-align: center;">(0.02, 0.10)</td>
<td style="text-align: center;">3.01</td>
<td style="text-align: center;">0.003</td>
</tr>
<tr class="even">
<td style="text-align: left;">dibpat (Type A) × age</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">0.01</td>
<td style="text-align: center;">(0.05, 0.10)</td>
<td style="text-align: center;">5.24</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="response-residuals" class="level3" data-number="3.10.2">
<h3 data-number="3.10.2" class="anchored" data-anchor-id="response-residuals"><span class="header-section-number">3.10.2</span> (Response) residuals</h3>
<p><span class="math display">\[e_k \stackrel{\text{def}}{=}\bar y_k - \hat{\pi}(x_k)\]</span></p>
<p>(<span class="math inline">\(k\)</span> indexes the covariate patterns)</p>
<p>We can graph these residuals <span class="math inline">\(e_k\)</span> against the fitted values <span class="math inline">\(\hat\pi(x_k)\)</span>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="annotated-cell-32"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-32-1"><a href="#annotated-cell-32-1" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">&lt;-</span></span>
<span id="annotated-cell-32-2"><a href="#annotated-cell-32-2" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="annotated-cell-32-3"><a href="#annotated-cell-32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="annotated-cell-32-4"><a href="#annotated-cell-32-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="annotated-cell-32-5"><a href="#annotated-cell-32-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="annotated-cell-32-6"><a href="#annotated-cell-32-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">response_resids =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="annotated-cell-32-7"><a href="#annotated-cell-32-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="annotated-cell-32-8"><a href="#annotated-cell-32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-32-9"><a href="#annotated-cell-32-9" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="ot">&lt;-</span></span>
<span id="annotated-cell-32-10"><a href="#annotated-cell-32-10" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="annotated-cell-32-11"><a href="#annotated-cell-32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="annotated-cell-32-12"><a href="#annotated-cell-32-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="annotated-cell-32-13"><a href="#annotated-cell-32-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted,</span>
<span id="annotated-cell-32-14"><a href="#annotated-cell-32-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> response_resids</span>
<span id="annotated-cell-32-15"><a href="#annotated-cell-32-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="annotated-cell-32-16"><a href="#annotated-cell-32-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="annotated-cell-32-17"><a href="#annotated-cell-32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="annotated-cell-32-18"><a href="#annotated-cell-32-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="annotated-cell-32-19"><a href="#annotated-cell-32-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="annotated-cell-32-20"><a href="#annotated-cell-32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-32" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-32-21" class="code-annotation-target"><a href="#annotated-cell-32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="annotated-cell-32-22"><a href="#annotated-cell-32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-32-23"><a href="#annotated-cell-32-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-32-24"><a href="#annotated-cell-32-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">span =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="annotated-cell-32-25"><a href="#annotated-cell-32-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="annotated-cell-32-26"><a href="#annotated-cell-32-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"symmetric"</span>,</span>
<span id="annotated-cell-32-27"><a href="#annotated-cell-32-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations =</span> <span class="dv">3</span></span>
<span id="annotated-cell-32-28"><a href="#annotated-cell-32-28" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="annotated-cell-32-29"><a href="#annotated-cell-32-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> stats<span class="sc">::</span>loess</span>
<span id="annotated-cell-32-30"><a href="#annotated-cell-32-30" aria-hidden="true" tabindex="-1"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-32" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-32" data-code-lines="21,22,23,24,25,26,28,30" data-code-annotation="1">Don’t worry about these options for now; I chose them to match <code>autoplot()</code> as closely as I can. <code>plot.glm</code> and <code>autoplot</code> use <code>stats::lowess</code> instead of <code>stats::loess</code>; <code>stats::lowess</code> is older, hard to use with <code>geom_smooth</code>, and hard to match exactly with <code>stats::loess</code>; see https://support.bioconductor.org/p/2323/.]</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-69f914e87f9137f36527" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-69f914e87f9137f36527">{"x":{"data":[{"x":[0.045961436757712824,0.036293263960852619,0.051672477906886234,0.03222423443380476,0.058049978197733408,0.065160515946172365,0.038509063821240842,0.061509303008180707,0.04333615674648298,0.086613433425361763,0.034200425478447295,0.096862923630182118,0.054773853205468445,0.040854409187417909,0.073074455042508007,0.077355593240057363,0.048737652497125951,0.06901252819945132,0.081865394323964127,0.091609373353503179,0.10238379421453488],"y":[-8.9877124685298904e-05,0.0037067360391473819,-0.038339144573552898,0.025746780058948864,0.016576887473908376,0.041982341196684772,-0.030244601011323487,-0.01066184538106206,-0.010549271500581339,-0.086613433425361763,-0.013367092145113963,-0.051408378175636663,0.028559480127864884,0.0099930484397007385,0.043204614724933851,-0.0032815191659832932,0.014553486743380382,-0.027345861532784656,-0.041865394323964127,0.002140626646496821,0.13291032343252396],"text":["fitted: 0.045961437<br />response_resids: -8.9877125e-05<br />dibpat: Type B","fitted: 0.036293264<br />response_resids:  3.7067360e-03<br />dibpat: Type B","fitted: 0.051672478<br />response_resids: -3.8339145e-02<br />dibpat: Type B","fitted: 0.032224234<br />response_resids:  2.5746780e-02<br />dibpat: Type B","fitted: 0.058049978<br />response_resids:  1.6576887e-02<br />dibpat: Type B","fitted: 0.065160516<br />response_resids:  4.1982341e-02<br />dibpat: Type B","fitted: 0.038509064<br />response_resids: -3.0244601e-02<br />dibpat: Type B","fitted: 0.061509303<br />response_resids: -1.0661845e-02<br />dibpat: Type B","fitted: 0.043336157<br />response_resids: -1.0549272e-02<br />dibpat: Type B","fitted: 0.086613433<br />response_resids: -8.6613433e-02<br />dibpat: Type B","fitted: 0.034200425<br />response_resids: -1.3367092e-02<br />dibpat: Type B","fitted: 0.096862924<br />response_resids: -5.1408378e-02<br />dibpat: Type B","fitted: 0.054773853<br />response_resids:  2.8559480e-02<br />dibpat: Type B","fitted: 0.040854409<br />response_resids:  9.9930484e-03<br />dibpat: Type B","fitted: 0.073074455<br />response_resids:  4.3204615e-02<br />dibpat: Type B","fitted: 0.077355593<br />response_resids: -3.2815192e-03<br />dibpat: Type B","fitted: 0.048737652<br />response_resids:  1.4553487e-02<br />dibpat: Type B","fitted: 0.069012528<br />response_resids: -2.7345862e-02<br />dibpat: Type B","fitted: 0.081865394<br />response_resids: -4.1865394e-02<br />dibpat: Type B","fitted: 0.091609373<br />response_resids:  2.1406266e-03<br />dibpat: Type B","fitted: 0.102383794<br />response_resids:  1.3291032e-01<br />dibpat: Type B"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.12971234222919351,0.1380480865336724,0.22160454144193362,0.088269692096500568,0.10724215304817945,0.067699524830557259,0.072381563936101928,0.082651492829173057,0.16577440958807005,0.11432357792947541,0.063299679011386709,0.12180880417146144,0.17595906456335259,0.18662945062136357,0.077360539928739772,0.0942305575802347,0.10054956755065432,0.19779158979409472,0.15606760433147907,0.14682913656358498,0.20944941476199175],"y":[-0.024449184334456669,0.026131017943939544,0.01172879189139972,-0.0086236743973855251,-0.01001993082595723,-3.0351898226435581e-05,-0.0075667491212871169,-0.010486544375564816,-0.033698937889956843,0.035676422070524585,0.022637820988613291,0.11699716597779229,-0.01232270092698895,0.05826850856230989,-0.037756579532700167,-0.0033214666711437885,-0.034615501616588384,-0.068759331729578599,-0.043164378525027455,0.053170863436415028,-0.062390591232579978],"text":["fitted: 0.129712342<br />response_resids: -2.4449184e-02<br />dibpat: Type A","fitted: 0.138048087<br />response_resids:  2.6131018e-02<br />dibpat: Type A","fitted: 0.221604541<br />response_resids:  1.1728792e-02<br />dibpat: Type A","fitted: 0.088269692<br />response_resids: -8.6236744e-03<br />dibpat: Type A","fitted: 0.107242153<br />response_resids: -1.0019931e-02<br />dibpat: Type A","fitted: 0.067699525<br />response_resids: -3.0351898e-05<br />dibpat: Type A","fitted: 0.072381564<br />response_resids: -7.5667491e-03<br />dibpat: Type A","fitted: 0.082651493<br />response_resids: -1.0486544e-02<br />dibpat: Type A","fitted: 0.165774410<br />response_resids: -3.3698938e-02<br />dibpat: Type A","fitted: 0.114323578<br />response_resids:  3.5676422e-02<br />dibpat: Type A","fitted: 0.063299679<br />response_resids:  2.2637821e-02<br />dibpat: Type A","fitted: 0.121808804<br />response_resids:  1.1699717e-01<br />dibpat: Type A","fitted: 0.175959065<br />response_resids: -1.2322701e-02<br />dibpat: Type A","fitted: 0.186629451<br />response_resids:  5.8268509e-02<br />dibpat: Type A","fitted: 0.077360540<br />response_resids: -3.7756580e-02<br />dibpat: Type A","fitted: 0.094230558<br />response_resids: -3.3214667e-03<br />dibpat: Type A","fitted: 0.100549568<br />response_resids: -3.4615502e-02<br />dibpat: Type A","fitted: 0.197791590<br />response_resids: -6.8759332e-02<br />dibpat: Type A","fitted: 0.156067604<br />response_resids: -4.3164379e-02<br />dibpat: Type A","fitted: 0.146829137<br />response_resids:  5.3170863e-02<br />dibpat: Type A","fitted: 0.209449415<br />response_resids: -6.2390591e-02<br />dibpat: Type A"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.022755219083398316,0.23107355679234007],"y":[0,0],"text":"yintercept: 0","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.03222423443380476,0.034621453509857021,0.037018672585909289,0.03941589166196155,0.041813110738013817,0.044210329814066078,0.046607548890118339,0.049004767966170606,0.051401987042222874,0.053799206118275135,0.056196425194327396,0.058593644270379663,0.060990863346431924,0.063388082422484185,0.065785301498536453,0.06818252057458872,0.070579739650640988,0.072976958726693242,0.075374177802745509,0.077771396878797777,0.080168615954850031,0.082565835030902299,0.084963054106954566,0.08736027318300682,0.089757492259059088,0.092154711335111356,0.094551930411163609,0.096949149487215877,0.099346368563268145,0.10174358763932041,0.10414080671537268,0.10653802579142493,0.1089352448674772,0.11133246394352947,0.11372968301958172,0.11612690209563399,0.11852412117168626,0.12092134024773853,0.12331855932379078,0.12571577839984305,0.12811299747589533,0.13051021655194756,0.13290743562799984,0.13530465470405212,0.13770187378010437,0.14009909285615663,0.14249631193220891,0.14489353100826116,0.14729075008431342,0.1496879691603657,0.15208518823641795,0.1544824073124702,0.15687962638852249,0.15927684546457474,0.16167406454062699,0.16407128361667928,0.16646850269273153,0.16886572176878378,0.17126294084483606,0.17366015992088832,0.1760573789969406,0.17845459807299285,0.18085181714904511,0.18324903622509739,0.18564625530114964,0.1880434743772019,0.19044069345325418,0.19283791252930643,0.19523513160535869,0.19763235068141097,0.20002956975746322,0.2024267888335155,0.20482400790956776,0.20722122698562001,0.20961844606167229,0.21201566513772455,0.2144128842137768,0.21681010328982908,0.21920732236588134,0.22160454144193362],"y":[0.0022873786418898963,0.0022855473977323481,0.0021280389946747302,0.0019864408924874983,0.0018485964064637143,0.001553786913037694,0.0012177186055594114,0.00087584068918244496,0.00050571153491427135,8.4889513762365705e-05,-0.00040906700326579805,-0.00098044561236803099,-0.0012676916653127509,-0.0014151484052982266,-0.0018150206943960527,-0.0028595133946778262,-0.0046042492494452998,-0.0061773548575779725,-0.0076184909053805963,-0.0090564613961363616,-0.010620070333128451,-0.012307065012777941,-0.012576456285260574,-0.01243543683305638,-0.012951353084147998,-0.012351663434359259,-0.011308336195763651,-0.010790229676235837,-0.010673770207606115,-0.010333915551222414,-0.0098059247101167941,-0.0091250566873213278,-0.0083265704858680751,-0.0074457251087891108,-0.006517779559116507,-0.0055779928398823186,-0.0046616239541186211,-0.0038039319048574828,-0.0030706766518606783,-0.0025845113062177472,-0.0023352534294965258,-0.002300872924856502,-0.0024593396954571589,-0.0027886236444579849,-0.0032666946750184583,-0.0038715226902980683,-0.0045810775934563078,-0.0053733292876526478,-0.0062262476760465823,-0.0071178026617976014,-0.0080259641480651817,-0.0089287020380088081,-0.0098039862347879831,-0.010629786641562168,-0.01138407316149086,-0.01204481569773355,-0.012596088072212156,-0.013124543847799488,-0.013664464071742667,-0.01421517565419341,-0.014776005505303461,-0.015346280535224539,-0.015925327654108371,-0.016512473772106708,-0.017107045799371251,-0.017708370646053746,-0.018315775222305927,-0.018928586438279514,-0.019546131204126228,-0.020167736429997828,-0.020792729026046015,-0.021420435902422534,-0.022050183969279109,-0.022681300136767463,-0.02331311131503935,-0.02394494441424647,-0.024576126344540563,-0.025205984016073373,-0.025833844338996614,-0.026459034223462026],"text":["fitted: 0.032224234<br />response_resids:  2.2873786e-03","fitted: 0.034621454<br />response_resids:  2.2855474e-03","fitted: 0.037018673<br />response_resids:  2.1280390e-03","fitted: 0.039415892<br />response_resids:  1.9864409e-03","fitted: 0.041813111<br />response_resids:  1.8485964e-03","fitted: 0.044210330<br />response_resids:  1.5537869e-03","fitted: 0.046607549<br />response_resids:  1.2177186e-03","fitted: 0.049004768<br />response_resids:  8.7584069e-04","fitted: 0.051401987<br />response_resids:  5.0571153e-04","fitted: 0.053799206<br />response_resids:  8.4889514e-05","fitted: 0.056196425<br />response_resids: -4.0906700e-04","fitted: 0.058593644<br />response_resids: -9.8044561e-04","fitted: 0.060990863<br />response_resids: -1.2676917e-03","fitted: 0.063388082<br />response_resids: -1.4151484e-03","fitted: 0.065785301<br />response_resids: -1.8150207e-03","fitted: 0.068182521<br />response_resids: -2.8595134e-03","fitted: 0.070579740<br />response_resids: -4.6042492e-03","fitted: 0.072976959<br />response_resids: -6.1773549e-03","fitted: 0.075374178<br />response_resids: -7.6184909e-03","fitted: 0.077771397<br />response_resids: -9.0564614e-03","fitted: 0.080168616<br />response_resids: -1.0620070e-02","fitted: 0.082565835<br />response_resids: -1.2307065e-02","fitted: 0.084963054<br />response_resids: -1.2576456e-02","fitted: 0.087360273<br />response_resids: -1.2435437e-02","fitted: 0.089757492<br />response_resids: -1.2951353e-02","fitted: 0.092154711<br />response_resids: -1.2351663e-02","fitted: 0.094551930<br />response_resids: -1.1308336e-02","fitted: 0.096949149<br />response_resids: -1.0790230e-02","fitted: 0.099346369<br />response_resids: -1.0673770e-02","fitted: 0.101743588<br />response_resids: -1.0333916e-02","fitted: 0.104140807<br />response_resids: -9.8059247e-03","fitted: 0.106538026<br />response_resids: -9.1250567e-03","fitted: 0.108935245<br />response_resids: -8.3265705e-03","fitted: 0.111332464<br />response_resids: -7.4457251e-03","fitted: 0.113729683<br />response_resids: -6.5177796e-03","fitted: 0.116126902<br />response_resids: -5.5779928e-03","fitted: 0.118524121<br />response_resids: -4.6616240e-03","fitted: 0.120921340<br />response_resids: -3.8039319e-03","fitted: 0.123318559<br />response_resids: -3.0706767e-03","fitted: 0.125715778<br />response_resids: -2.5845113e-03","fitted: 0.128112997<br />response_resids: -2.3352534e-03","fitted: 0.130510217<br />response_resids: -2.3008729e-03","fitted: 0.132907436<br />response_resids: -2.4593397e-03","fitted: 0.135304655<br />response_resids: -2.7886236e-03","fitted: 0.137701874<br />response_resids: -3.2666947e-03","fitted: 0.140099093<br />response_resids: -3.8715227e-03","fitted: 0.142496312<br />response_resids: -4.5810776e-03","fitted: 0.144893531<br />response_resids: -5.3733293e-03","fitted: 0.147290750<br />response_resids: -6.2262477e-03","fitted: 0.149687969<br />response_resids: -7.1178027e-03","fitted: 0.152085188<br />response_resids: -8.0259641e-03","fitted: 0.154482407<br />response_resids: -8.9287020e-03","fitted: 0.156879626<br />response_resids: -9.8039862e-03","fitted: 0.159276845<br />response_resids: -1.0629787e-02","fitted: 0.161674065<br />response_resids: -1.1384073e-02","fitted: 0.164071284<br />response_resids: -1.2044816e-02","fitted: 0.166468503<br />response_resids: -1.2596088e-02","fitted: 0.168865722<br />response_resids: -1.3124544e-02","fitted: 0.171262941<br />response_resids: -1.3664464e-02","fitted: 0.173660160<br />response_resids: -1.4215176e-02","fitted: 0.176057379<br />response_resids: -1.4776006e-02","fitted: 0.178454598<br />response_resids: -1.5346281e-02","fitted: 0.180851817<br />response_resids: -1.5925328e-02","fitted: 0.183249036<br />response_resids: -1.6512474e-02","fitted: 0.185646255<br />response_resids: -1.7107046e-02","fitted: 0.188043474<br />response_resids: -1.7708371e-02","fitted: 0.190440693<br />response_resids: -1.8315775e-02","fitted: 0.192837913<br />response_resids: -1.8928586e-02","fitted: 0.195235132<br />response_resids: -1.9546131e-02","fitted: 0.197632351<br />response_resids: -2.0167736e-02","fitted: 0.200029570<br />response_resids: -2.0792729e-02","fitted: 0.202426789<br />response_resids: -2.1420436e-02","fitted: 0.204824008<br />response_resids: -2.2050184e-02","fitted: 0.207221227<br />response_resids: -2.2681300e-02","fitted: 0.209618446<br />response_resids: -2.3313111e-02","fitted: 0.212015665<br />response_resids: -2.3944944e-02","fitted: 0.214412884<br />response_resids: -2.4576126e-02","fitted: 0.216810103<br />response_resids: -2.5205984e-02","fitted: 0.219207322<br />response_resids: -2.5833844e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.7795275590551185,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0.03222423443380476,0.034621453509857021,0.037018672585909289,0.03941589166196155,0.041813110738013817,0.044210329814066078,0.046607548890118339,0.049004767966170606,0.051401987042222874,0.053799206118275135,0.056196425194327396,0.058593644270379663,0.060990863346431924,0.063388082422484185,0.065785301498536453,0.06818252057458872,0.070579739650640988,0.072976958726693242,0.075374177802745509,0.077771396878797777,0.080168615954850031,0.082565835030902299,0.084963054106954566,0.08736027318300682,0.089757492259059088,0.092154711335111356,0.094551930411163609,0.096949149487215877,0.099346368563268145,0.10174358763932041,0.10414080671537268,0.10653802579142493,0.1089352448674772,0.11133246394352947,0.11372968301958172,0.11612690209563399,0.11852412117168626,0.12092134024773853,0.12331855932379078,0.12571577839984305,0.12811299747589533,0.13051021655194756,0.13290743562799984,0.13530465470405212,0.13770187378010437,0.14009909285615663,0.14249631193220891,0.14489353100826116,0.14729075008431342,0.1496879691603657,0.15208518823641795,0.1544824073124702,0.15687962638852249,0.15927684546457474,0.16167406454062699,0.16407128361667928,0.16646850269273153,0.16886572176878378,0.17126294084483606,0.17366015992088832,0.1760573789969406,0.17845459807299285,0.18085181714904511,0.18324903622509739,0.18564625530114964,0.1880434743772019,0.19044069345325418,0.19283791252930643,0.19523513160535869,0.19763235068141097,0.20002956975746322,0.2024267888335155,0.20482400790956776,0.20722122698562001,0.20961844606167229,0.21201566513772455,0.2144128842137768,0.21681010328982908,0.21920732236588134,0.22160454144193362,0.22160454144193362,0.22160454144193362,0.21920732236588134,0.21681010328982908,0.2144128842137768,0.21201566513772455,0.20961844606167229,0.20722122698562001,0.20482400790956776,0.2024267888335155,0.20002956975746322,0.19763235068141097,0.19523513160535869,0.19283791252930643,0.19044069345325418,0.1880434743772019,0.18564625530114964,0.18324903622509739,0.18085181714904511,0.17845459807299285,0.1760573789969406,0.17366015992088832,0.17126294084483606,0.16886572176878378,0.16646850269273153,0.16407128361667928,0.16167406454062699,0.15927684546457474,0.15687962638852249,0.1544824073124702,0.15208518823641795,0.1496879691603657,0.14729075008431342,0.14489353100826116,0.14249631193220891,0.14009909285615663,0.13770187378010437,0.13530465470405212,0.13290743562799984,0.13051021655194756,0.12811299747589533,0.12571577839984305,0.12331855932379078,0.12092134024773853,0.11852412117168626,0.11612690209563399,0.11372968301958172,0.11133246394352947,0.1089352448674772,0.10653802579142493,0.10414080671537268,0.10174358763932041,0.099346368563268145,0.096949149487215877,0.094551930411163609,0.092154711335111356,0.089757492259059088,0.08736027318300682,0.084963054106954566,0.082565835030902299,0.080168615954850031,0.077771396878797777,0.075374177802745509,0.072976958726693242,0.070579739650640988,0.06818252057458872,0.065785301498536453,0.063388082422484185,0.060990863346431924,0.058593644270379663,0.056196425194327396,0.053799206118275135,0.051401987042222874,0.049004767966170606,0.046607548890118339,0.044210329814066078,0.041813110738013817,0.03941589166196155,0.037018672585909289,0.034621453509857021,0.03222423443380476,0.03222423443380476],"y":[-0.029120796272046286,-0.026928673147919111,-0.025049668515905427,-0.023240004042525395,-0.021546955218634589,-0.020186525297769996,-0.019027858198610956,-0.018083361190101,-0.017422746720973003,-0.017078117023036202,-0.017039939312035127,-0.017269628078552694,-0.017604109969972116,-0.01817776582696479,-0.019105887664343572,-0.020423791084051592,-0.022115418182448304,-0.023513820224467994,-0.024691917091792422,-0.025924945293692866,-0.027500664314999756,-0.029492087333190847,-0.029853450281078352,-0.029922110016604907,-0.030973077994924131,-0.030448115725570619,-0.029509183566823912,-0.029581299982453249,-0.030169517519175151,-0.030166439136312929,-0.029667017598640655,-0.028812559687027364,-0.027763822063088264,-0.026680165811469869,-0.0256996713406785,-0.024922125499696787,-0.024401397192934909,-0.024152647460435443,-0.024135688192630095,-0.024193011121636881,-0.024285625937470308,-0.024402803718567959,-0.024544616322062326,-0.024718429424116523,-0.024936580507690889,-0.02521459864827845,-0.025569541213304663,-0.026018164976515497,-0.02657478829279121,-0.02724888387052515,-0.028042669242849802,-0.028949167022406075,-0.02995127103979929,-0.031022191389127173,-0.03212730575909091,-0.033227092735687205,-0.034284984307128279,-0.035345832380259595,-0.036434633709330075,-0.037554357842104744,-0.038708305309187452,-0.039899762555305085,-0.041131720683424633,-0.042406654379143649,-0.043726358147657282,-0.045091836697197532,-0.046503245276595884,-0.047959874451746896,-0.049460172597461632,-0.051001798593147879,-0.052581696999508022,-0.05419618836726476,-0.055841068182683529,-0.057511709121243981,-0.059203162581216204,-0.060910256749119762,-0.062627689599425954,-0.064350116189812373,-0.06607223036051714,-0.067788841491228644,-0.067788841491228644,0.014870773044304592,0.014404541682523909,0.013938148157665628,0.013475436910344831,0.013020367920626819,0.012576939951137501,0.012149108847709058,0.01174070024412531,0.011355316562419691,0.010996238947415991,0.01066632573315222,0.010367910189209181,0.010102701575187868,0.0098716948319840306,0.009675095405090043,0.0095122665489147835,0.0093817068349302327,0.0092810653752078871,0.0092072014848560077,0.0091562942985805341,0.0091240065337179228,0.009105705565844743,0.009096744684660622,0.0090928081627039675,0.0091374613402201068,0.0093591594361091858,0.0097626181060028339,0.010343298570223322,0.011091762946388459,0.011990740946719439,0.013013278546929945,0.014122292940698044,0.015271506401210201,0.016407386026392048,0.017471553267682315,0.018403191157653973,0.019141182135200555,0.019625936931148009,0.019801057868854954,0.01961511907847726,0.019023988509201388,0.017994334888908739,0.016544783650720474,0.015078149284697667,0.013766139819932148,0.012664112222445484,0.011788715593891649,0.011110681091352112,0.010562446312384708,0.010055168178407068,0.0094986080338681014,0.0088219771039629198,0.008000840629981576,0.006892511175296611,0.0057447888568521004,0.0050703718266281329,0.0050512363504921446,0.0047005377105572062,0.0048779573076349649,0.0062605236487428551,0.0078120225014201433,0.0094549352810312307,0.011159110509312047,0.012906919683557706,0.01470476429469594,0.015475846275551467,0.015347469016368336,0.015068726639346615,0.015308736853816632,0.016221805305503535,0.017247896050560936,0.018434169790801546,0.019835042568465893,0.021463295409729778,0.023294099123845387,0.025244148031562018,0.027212885827500394,0.029305746505254887,0.031499767943383807,0.033695553555826076,-0.029120796272046286],"text":["fitted: 0.032224234<br />response_resids:  2.2873786e-03","fitted: 0.034621454<br />response_resids:  2.2855474e-03","fitted: 0.037018673<br />response_resids:  2.1280390e-03","fitted: 0.039415892<br />response_resids:  1.9864409e-03","fitted: 0.041813111<br />response_resids:  1.8485964e-03","fitted: 0.044210330<br />response_resids:  1.5537869e-03","fitted: 0.046607549<br />response_resids:  1.2177186e-03","fitted: 0.049004768<br />response_resids:  8.7584069e-04","fitted: 0.051401987<br />response_resids:  5.0571153e-04","fitted: 0.053799206<br />response_resids:  8.4889514e-05","fitted: 0.056196425<br />response_resids: -4.0906700e-04","fitted: 0.058593644<br />response_resids: -9.8044561e-04","fitted: 0.060990863<br />response_resids: -1.2676917e-03","fitted: 0.063388082<br />response_resids: -1.4151484e-03","fitted: 0.065785301<br />response_resids: -1.8150207e-03","fitted: 0.068182521<br />response_resids: -2.8595134e-03","fitted: 0.070579740<br />response_resids: -4.6042492e-03","fitted: 0.072976959<br />response_resids: -6.1773549e-03","fitted: 0.075374178<br />response_resids: -7.6184909e-03","fitted: 0.077771397<br />response_resids: -9.0564614e-03","fitted: 0.080168616<br />response_resids: -1.0620070e-02","fitted: 0.082565835<br />response_resids: -1.2307065e-02","fitted: 0.084963054<br />response_resids: -1.2576456e-02","fitted: 0.087360273<br />response_resids: -1.2435437e-02","fitted: 0.089757492<br />response_resids: -1.2951353e-02","fitted: 0.092154711<br />response_resids: -1.2351663e-02","fitted: 0.094551930<br />response_resids: -1.1308336e-02","fitted: 0.096949149<br />response_resids: -1.0790230e-02","fitted: 0.099346369<br />response_resids: -1.0673770e-02","fitted: 0.101743588<br />response_resids: -1.0333916e-02","fitted: 0.104140807<br />response_resids: -9.8059247e-03","fitted: 0.106538026<br />response_resids: -9.1250567e-03","fitted: 0.108935245<br />response_resids: -8.3265705e-03","fitted: 0.111332464<br />response_resids: -7.4457251e-03","fitted: 0.113729683<br />response_resids: -6.5177796e-03","fitted: 0.116126902<br />response_resids: -5.5779928e-03","fitted: 0.118524121<br />response_resids: -4.6616240e-03","fitted: 0.120921340<br />response_resids: -3.8039319e-03","fitted: 0.123318559<br />response_resids: -3.0706767e-03","fitted: 0.125715778<br />response_resids: -2.5845113e-03","fitted: 0.128112997<br />response_resids: -2.3352534e-03","fitted: 0.130510217<br />response_resids: -2.3008729e-03","fitted: 0.132907436<br />response_resids: -2.4593397e-03","fitted: 0.135304655<br />response_resids: -2.7886236e-03","fitted: 0.137701874<br />response_resids: -3.2666947e-03","fitted: 0.140099093<br />response_resids: -3.8715227e-03","fitted: 0.142496312<br />response_resids: -4.5810776e-03","fitted: 0.144893531<br />response_resids: -5.3733293e-03","fitted: 0.147290750<br />response_resids: -6.2262477e-03","fitted: 0.149687969<br />response_resids: -7.1178027e-03","fitted: 0.152085188<br />response_resids: -8.0259641e-03","fitted: 0.154482407<br />response_resids: -8.9287020e-03","fitted: 0.156879626<br />response_resids: -9.8039862e-03","fitted: 0.159276845<br />response_resids: -1.0629787e-02","fitted: 0.161674065<br />response_resids: -1.1384073e-02","fitted: 0.164071284<br />response_resids: -1.2044816e-02","fitted: 0.166468503<br />response_resids: -1.2596088e-02","fitted: 0.168865722<br />response_resids: -1.3124544e-02","fitted: 0.171262941<br />response_resids: -1.3664464e-02","fitted: 0.173660160<br />response_resids: -1.4215176e-02","fitted: 0.176057379<br />response_resids: -1.4776006e-02","fitted: 0.178454598<br />response_resids: -1.5346281e-02","fitted: 0.180851817<br />response_resids: -1.5925328e-02","fitted: 0.183249036<br />response_resids: -1.6512474e-02","fitted: 0.185646255<br />response_resids: -1.7107046e-02","fitted: 0.188043474<br />response_resids: -1.7708371e-02","fitted: 0.190440693<br />response_resids: -1.8315775e-02","fitted: 0.192837913<br />response_resids: -1.8928586e-02","fitted: 0.195235132<br />response_resids: -1.9546131e-02","fitted: 0.197632351<br />response_resids: -2.0167736e-02","fitted: 0.200029570<br />response_resids: -2.0792729e-02","fitted: 0.202426789<br />response_resids: -2.1420436e-02","fitted: 0.204824008<br />response_resids: -2.2050184e-02","fitted: 0.207221227<br />response_resids: -2.2681300e-02","fitted: 0.209618446<br />response_resids: -2.3313111e-02","fitted: 0.212015665<br />response_resids: -2.3944944e-02","fitted: 0.214412884<br />response_resids: -2.4576126e-02","fitted: 0.216810103<br />response_resids: -2.5205984e-02","fitted: 0.219207322<br />response_resids: -2.5833844e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02","fitted: 0.221604541<br />response_resids: -2.6459034e-02","fitted: 0.219207322<br />response_resids: -2.5833844e-02","fitted: 0.216810103<br />response_resids: -2.5205984e-02","fitted: 0.214412884<br />response_resids: -2.4576126e-02","fitted: 0.212015665<br />response_resids: -2.3944944e-02","fitted: 0.209618446<br />response_resids: -2.3313111e-02","fitted: 0.207221227<br />response_resids: -2.2681300e-02","fitted: 0.204824008<br />response_resids: -2.2050184e-02","fitted: 0.202426789<br />response_resids: -2.1420436e-02","fitted: 0.200029570<br />response_resids: -2.0792729e-02","fitted: 0.197632351<br />response_resids: -2.0167736e-02","fitted: 0.195235132<br />response_resids: -1.9546131e-02","fitted: 0.192837913<br />response_resids: -1.8928586e-02","fitted: 0.190440693<br />response_resids: -1.8315775e-02","fitted: 0.188043474<br />response_resids: -1.7708371e-02","fitted: 0.185646255<br />response_resids: -1.7107046e-02","fitted: 0.183249036<br />response_resids: -1.6512474e-02","fitted: 0.180851817<br />response_resids: -1.5925328e-02","fitted: 0.178454598<br />response_resids: -1.5346281e-02","fitted: 0.176057379<br />response_resids: -1.4776006e-02","fitted: 0.173660160<br />response_resids: -1.4215176e-02","fitted: 0.171262941<br />response_resids: -1.3664464e-02","fitted: 0.168865722<br />response_resids: -1.3124544e-02","fitted: 0.166468503<br />response_resids: -1.2596088e-02","fitted: 0.164071284<br />response_resids: -1.2044816e-02","fitted: 0.161674065<br />response_resids: -1.1384073e-02","fitted: 0.159276845<br />response_resids: -1.0629787e-02","fitted: 0.156879626<br />response_resids: -9.8039862e-03","fitted: 0.154482407<br />response_resids: -8.9287020e-03","fitted: 0.152085188<br />response_resids: -8.0259641e-03","fitted: 0.149687969<br />response_resids: -7.1178027e-03","fitted: 0.147290750<br />response_resids: -6.2262477e-03","fitted: 0.144893531<br />response_resids: -5.3733293e-03","fitted: 0.142496312<br />response_resids: -4.5810776e-03","fitted: 0.140099093<br />response_resids: -3.8715227e-03","fitted: 0.137701874<br />response_resids: -3.2666947e-03","fitted: 0.135304655<br />response_resids: -2.7886236e-03","fitted: 0.132907436<br />response_resids: -2.4593397e-03","fitted: 0.130510217<br />response_resids: -2.3008729e-03","fitted: 0.128112997<br />response_resids: -2.3352534e-03","fitted: 0.125715778<br />response_resids: -2.5845113e-03","fitted: 0.123318559<br />response_resids: -3.0706767e-03","fitted: 0.120921340<br />response_resids: -3.8039319e-03","fitted: 0.118524121<br />response_resids: -4.6616240e-03","fitted: 0.116126902<br />response_resids: -5.5779928e-03","fitted: 0.113729683<br />response_resids: -6.5177796e-03","fitted: 0.111332464<br />response_resids: -7.4457251e-03","fitted: 0.108935245<br />response_resids: -8.3265705e-03","fitted: 0.106538026<br />response_resids: -9.1250567e-03","fitted: 0.104140807<br />response_resids: -9.8059247e-03","fitted: 0.101743588<br />response_resids: -1.0333916e-02","fitted: 0.099346369<br />response_resids: -1.0673770e-02","fitted: 0.096949149<br />response_resids: -1.0790230e-02","fitted: 0.094551930<br />response_resids: -1.1308336e-02","fitted: 0.092154711<br />response_resids: -1.2351663e-02","fitted: 0.089757492<br />response_resids: -1.2951353e-02","fitted: 0.087360273<br />response_resids: -1.2435437e-02","fitted: 0.084963054<br />response_resids: -1.2576456e-02","fitted: 0.082565835<br />response_resids: -1.2307065e-02","fitted: 0.080168616<br />response_resids: -1.0620070e-02","fitted: 0.077771397<br />response_resids: -9.0564614e-03","fitted: 0.075374178<br />response_resids: -7.6184909e-03","fitted: 0.072976959<br />response_resids: -6.1773549e-03","fitted: 0.070579740<br />response_resids: -4.6042492e-03","fitted: 0.068182521<br />response_resids: -2.8595134e-03","fitted: 0.065785301<br />response_resids: -1.8150207e-03","fitted: 0.063388082<br />response_resids: -1.4151484e-03","fitted: 0.060990863<br />response_resids: -1.2676917e-03","fitted: 0.058593644<br />response_resids: -9.8044561e-04","fitted: 0.056196425<br />response_resids: -4.0906700e-04","fitted: 0.053799206<br />response_resids:  8.4889514e-05","fitted: 0.051401987<br />response_resids:  5.0571153e-04","fitted: 0.049004768<br />response_resids:  8.7584069e-04","fitted: 0.046607549<br />response_resids:  1.2177186e-03","fitted: 0.044210330<br />response_resids:  1.5537869e-03","fitted: 0.041813111<br />response_resids:  1.8485964e-03","fitted: 0.039415892<br />response_resids:  1.9864409e-03","fitted: 0.037018673<br />response_resids:  2.1280390e-03","fitted: 0.034621454<br />response_resids:  2.2855474e-03","fitted: 0.032224234<br />response_resids:  2.2873786e-03","fitted: 0.032224234<br />response_resids:  2.2873786e-03"],"type":"scatter","mode":"lines","line":{"width":3.7795275590551185,"color":"transparent","dash":"solid"},"fill":"toself","fillcolor":"rgba(153,153,153,0.4)","hoveron":"points","hoverinfo":"x+y","showlegend":false,"xaxis":"x","yaxis":"y","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":42.573682025736829,"l":58.779576587795781},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.022755219083398316,0.23107355679234007],"tickmode":"array","ticktext":["0.05","0.10","0.15","0.20"],"tickvals":[0.050000000000000003,0.10000000000000001,0.15000000000000002,0.20000000000000001],"categoryorder":"array","categoryarray":["0.05","0.10","0.15","0.20"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"serif","size":12.7521793275218},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"fitted","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.097589621268256044,0.14388651127541824],"tickmode":"array","ticktext":["-0.05","0.00","0.05","0.10"],"tickvals":[-0.050000000000000003,0,0.050000000000000017,0.10000000000000001],"categoryorder":"array","categoryarray":["-0.05","0.00","0.05","0.10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"serif","size":12.7521793275218},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"response_resids","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"serif","size":12.7521793275218},"title":{"text":"dibpat","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"29787f280a5e":{"x":{},"y":{},"colour":{},"type":"scatter"},"2978648dfec4":{"yintercept":{}},"29785fe9fcc4":{"x":{},"y":{}}},"cur_data":"29787f280a5e","visdat":{"29787f280a5e":["function (y) ","x"],"2978648dfec4":["function (y) ","x"],"29785fe9fcc4":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We can see a slight fan-shape here: observations on the right have larger variance (as expected since <span class="math inline">\(var(\bar y) = \pi(1-\pi)/n\)</span> is maximized when <span class="math inline">\(\pi = 0.5\)</span>).</p>
</section>
<section id="pearson-residuals" class="level3" data-number="3.10.3">
<h3 data-number="3.10.3" class="anchored" data-anchor-id="pearson-residuals"><span class="header-section-number">3.10.3</span> Pearson residuals</h3>
<p>The fan-shape in the response residuals plot isn’t necessarily a concern here, since we haven’t made an assumption of constant residual variance, as we did for linear regression.</p>
<p>However, we might want to divide by the standard error in order to make the graph easier to interpret. Here’s one way to do that:</p>
<p>The Pearson (chi-squared) residual for covariate pattern <span class="math inline">\(k\)</span> is: <span class="math display">\[
\begin{aligned}
X_k &amp;= \frac{\bar y_k - \hat\pi_k}{\sqrt{\hat \pi_k (1-\hat\pi_k)/n_k}}
\end{aligned}
\]</span></p>
<p>where <span class="math display">\[
\begin{aligned}
\hat\pi_k
&amp;\stackrel{\text{def}}{=}\hat\pi(x_k)\\
&amp;\stackrel{\text{def}}{=}\hat P(Y=1|X=x_k)\\
&amp;\stackrel{\text{def}}{=}\text{expit}(x_i'\hat \beta)\\
&amp;\stackrel{\text{def}}{=}\text{expit}(\hat \beta_0 + \sum_{j=1}^p \hat \beta_j x_{ij})
\end{aligned}
\]</span></p>
<p>Let’s take a look at the Pearson residuals for our CHD model from the WCGS data (graphed against the fitted values on the logit scale):</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The fan-shape is gone, and these residuals don’t show any obvious signs of model fit issues.</p>
<section id="pearson-residuals-plot-for-beetles-data" class="level4">
<h4 class="anchored" data-anchor-id="pearson-residuals-plot-for-beetles-data">Pearson residuals plot for <code>beetles</code> data</h4>
<p>If we create the same plot for the <code>beetles</code> model, we see some strong evidence of a lack of fit:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(beetles_glm_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="pearson-residuals-with-individual-ungrouped-data" class="level4">
<h4 class="anchored" data-anchor-id="pearson-residuals-with-individual-ungrouped-data">Pearson residuals with individual (ungrouped) data</h4>
<p>What happens if we try to compute residuals without grouping the data by covariate pattern?</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="logistic-regression_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Meaningless.</p>
</section>
<section id="residuals-plot-by-hand-optional-section" class="level4">
<h4 class="anchored" data-anchor-id="residuals-plot-by-hand-optional-section">Residuals plot by hand (<em>optional section</em>)</h4>
<p>If you want to check your understanding of what these residual plots are, try building them yourself:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">&lt;-</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">resids =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="ot">&lt;-</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted_logit,</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> resids</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">span =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"symmetric"</span>,</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations =</span> <span class="dv">3</span>,</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">surface =</span> <span class="st">"direct"</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> stats<span class="sc">::</span>loess</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="co"># plot.glm and autoplot use stats::lowess, which is hard to use with</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_smooth and hard to match exactly;</span></span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://support.bioconductor.org/p/2323/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-84605f29c848bc72e5f6" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-84605f29c848bc72e5f6">{"x":{"data":[{"x":[-3.0329013797783677,-3.2791548743659225,-2.9097746324845901,-3.4022816216596996,-2.786647885190813,-2.6635211378970354,-3.2175915007190339,-2.7250845115439244,-3.0944647534252563,-2.3557042696625921,-3.340718248012811,-2.2325775223688149,-2.8482112588377015,-3.1560281270721449,-2.5403943906032582,-2.4788310169563692,-2.9713380061314787,-2.6019577642501468,-2.4172676433094806,-2.2941408960157035,-2.1710141487219259],"y":[-0.0044810795747202495,0.22159563738581595,-1.4999066438812154,1.7127098317633704,0.58026373624415295,1.2729164139631561,-1.7289660562707454,-0.34085761194085346,-0.5722654257278228,-1.6001002734221939,-0.88258984970818233,-0.81524777266671533,1.1503643930417931,0.54837451298717932,1.0885769806515944,-0.090262797175269333,0.60075603631230234,-0.74744001042634256,-0.76352248832054637,0.041976829957373313,1.8076827891719753],"text":["fitted_logit: -3.0329014<br />resids: -0.0044810796<br />dibpat: Type B","fitted_logit: -3.2791549<br />resids:  0.2215956374<br />dibpat: Type B","fitted_logit: -2.9097746<br />resids: -1.4999066439<br />dibpat: Type B","fitted_logit: -3.4022816<br />resids:  1.7127098318<br />dibpat: Type B","fitted_logit: -2.7866479<br />resids:  0.5802637362<br />dibpat: Type B","fitted_logit: -2.6635211<br />resids:  1.2729164140<br />dibpat: Type B","fitted_logit: -3.2175915<br />resids: -1.7289660563<br />dibpat: Type B","fitted_logit: -2.7250845<br />resids: -0.3408576119<br />dibpat: Type B","fitted_logit: -3.0944648<br />resids: -0.5722654257<br />dibpat: Type B","fitted_logit: -2.3557043<br />resids: -1.6001002734<br />dibpat: Type B","fitted_logit: -3.3407182<br />resids: -0.8825898497<br />dibpat: Type B","fitted_logit: -2.2325775<br />resids: -0.8152477727<br />dibpat: Type B","fitted_logit: -2.8482113<br />resids:  1.1503643930<br />dibpat: Type B","fitted_logit: -3.1560281<br />resids:  0.5483745130<br />dibpat: Type B","fitted_logit: -2.5403944<br />resids:  1.0885769807<br />dibpat: Type B","fitted_logit: -2.4788310<br />resids: -0.0902627972<br />dibpat: Type B","fitted_logit: -2.9713380<br />resids:  0.6007560363<br />dibpat: Type B","fitted_logit: -2.6019578<br />resids: -0.7474400104<br />dibpat: Type B","fitted_logit: -2.4172676<br />resids: -0.7635224883<br />dibpat: Type B","fitted_logit: -2.2941409<br />resids:  0.0419768300<br />dibpat: Type B","fitted_logit: -2.1710141<br />resids:  1.8076827892<br />dibpat: Type B"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"Type B","legendgroup":"Type B","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-1.9035045514956221,-1.8315974066617522,-1.2563402479907932,-2.3349474204988412,-2.1192259859972316,-2.6225759998343205,-2.5506688550004508,-2.4068545653327109,-1.615875972160143,-2.0473188411633618,-2.6944831446681898,-1.9754116963294921,-1.5439688273262728,-1.4720616824924031,-2.4787617101665811,-2.2630402756649715,-2.1911331308311013,-1.4001545376585334,-1.6877831169940127,-1.7596902618278825,-1.3282473928246634],"y":[-0.63437945290860098,0.62006470991396589,0.15467653440940657,-0.32314137640606277,-0.27477762864565924,-0.0013932880580653764,-0.30347473837675176,-0.37508157915285151,-0.65971088380033849,1.0028150453407505,1.0518129601938313,2.9280525317855259,-0.23999767668657723,1.0468817563438408,-1.4202917745639023,-0.09976324076337198,-1.0980259512257837,-0.9610920350140133,-0.93650721161429329,1.2111732236224588,-0.89403423992455422],"text":["fitted_logit: -1.9035046<br />resids: -0.6343794529<br />dibpat: Type A","fitted_logit: -1.8315974<br />resids:  0.6200647099<br />dibpat: Type A","fitted_logit: -1.2563402<br />resids:  0.1546765344<br />dibpat: Type A","fitted_logit: -2.3349474<br />resids: -0.3231413764<br />dibpat: Type A","fitted_logit: -2.1192260<br />resids: -0.2747776286<br />dibpat: Type A","fitted_logit: -2.6225760<br />resids: -0.0013932881<br />dibpat: Type A","fitted_logit: -2.5506689<br />resids: -0.3034747384<br />dibpat: Type A","fitted_logit: -2.4068546<br />resids: -0.3750815792<br />dibpat: Type A","fitted_logit: -1.6158760<br />resids: -0.6597108838<br />dibpat: Type A","fitted_logit: -2.0473188<br />resids:  1.0028150453<br />dibpat: Type A","fitted_logit: -2.6944831<br />resids:  1.0518129602<br />dibpat: Type A","fitted_logit: -1.9754117<br />resids:  2.9280525318<br />dibpat: Type A","fitted_logit: -1.5439688<br />resids: -0.2399976767<br />dibpat: Type A","fitted_logit: -1.4720617<br />resids:  1.0468817563<br />dibpat: Type A","fitted_logit: -2.4787617<br />resids: -1.4202917746<br />dibpat: Type A","fitted_logit: -2.2630403<br />resids: -0.0997632408<br />dibpat: Type A","fitted_logit: -2.1911331<br />resids: -1.0980259512<br />dibpat: Type A","fitted_logit: -1.4001545<br />resids: -0.9610920350<br />dibpat: Type A","fitted_logit: -1.6877831<br />resids: -0.9365072116<br />dibpat: Type A","fitted_logit: -1.7596903<br />resids:  1.2111732236<br />dibpat: Type A","fitted_logit: -1.3282474<br />resids: -0.8940342399<br />dibpat: Type A"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,191,196,1)","opacity":1,"size":5.6692913385826778,"symbol":"circle","line":{"width":1.8897637795275593,"color":"rgba(0,191,196,1)"}},"hoveron":"points","name":"Type A","legendgroup":"Type A","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-3.5095786903431447,-1.1490431793073479],"y":[0,0],"text":"yintercept: 0","type":"scatter","mode":"lines","line":{"width":1.8897637795275593,"color":"rgba(0,0,0,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[-3.4022816216596996,-3.3751178068031313,-3.3479539919465626,-3.3207901770899944,-3.2936263622334261,-3.2664625473768574,-3.2392987325202891,-3.2121349176637204,-3.1849711028071521,-3.1578072879505839,-3.1306434730940151,-3.1034796582374469,-3.0763158433808786,-3.0491520285243099,-3.0219882136677416,-2.9948243988111729,-2.9676605839546046,-2.9404967690980364,-2.9133329542414677,-2.8861691393848994,-2.8590053245283311,-2.8318415096717624,-2.8046776948151941,-2.7775138799586259,-2.7503500651020572,-2.7231862502454889,-2.6960224353889206,-2.6688586205323519,-2.6416948056757836,-2.6145309908192149,-2.5873671759626466,-2.5602033611060779,-2.5330395462495097,-2.5058757313929414,-2.4787119165363727,-2.4515481016798044,-2.4243842868232361,-2.3972204719666674,-2.3700566571100992,-2.3428928422535309,-2.3157290273969622,-2.2885652125403939,-2.2614013976838256,-2.2342375828272569,-2.2070737679706887,-2.1799099531141204,-2.1527461382575517,-2.125582323400983,-2.0984185085444151,-2.0712546936878464,-2.0440908788312777,-2.0169270639747099,-1.9897632491181412,-1.9625994342615727,-1.9354356194050042,-1.9082718045484359,-1.8811079896918674,-1.8539441748352989,-1.8267803599787305,-1.7996165451221622,-1.7724527302655937,-1.7452889154090252,-1.7181251005524567,-1.6909612856958884,-1.6637974708393199,-1.6366336559827515,-1.6094698411261832,-1.5823060262696147,-1.5551422114130462,-1.5279783965564777,-1.5008145816999094,-1.473650766843341,-1.4464869519867725,-1.419323137130204,-1.3921593222736357,-1.364995507417067,-1.3378316925604987,-1.3106678777039305,-1.2835040628473617,-1.2563402479907932],"y":[-0.0056926112342824964,-0.0014655068031595234,0.0028627248026840343,0.007137636371560209,0.01124651375101633,0.015097338111743876,0.018582045097171491,0.021574826921379988,0.02397431549875749,0.025751021327794762,0.026887889906032057,0.027346860434061385,0.027094217114688898,0.026147923881664023,0.024585005309460117,0.022544904276453046,0.020263582531734822,0.018113137646754884,0.016657754155375019,0.01684246903111945,0.020289606626683613,0.029174973065879,0.044375051881825139,0.046783001239038273,0.051484393544900538,0.033586659195389307,0.033856473652579294,0.0052100346390700769,-0.0045353664964397356,-0.026157728281580278,-0.04713338338082497,-0.064813583771289707,-0.085002087709817986,-0.1062730827907744,-0.12126748905293354,-0.13514659576641028,-0.15240532995624723,-0.14988788107448164,-0.16679400995316979,-0.1580675528373604,-0.15273952587831763,-0.14460201576937895,-0.11795052084855447,-0.10817191909296406,-0.084246034162128891,-0.067064948514254027,-0.051085251977570592,-0.047066257502926534,-0.024492049868058613,-0.032743711707005865,-0.023582312823518178,-0.028707823097404259,-0.019260001872358185,-0.027058464148151398,-0.014836382606268933,-0.028272022204860546,-0.041759652010194007,-0.053375393311705648,-0.062892322941487763,-0.070772843049213996,-0.077592345129058507,-0.083820381064168267,-0.089839591346044398,-0.095952844437168561,-0.1023660984657879,-0.10919046577719442,-0.11649054204259791,-0.12429788044746898,-0.13261049809425512,-0.14141701050857824,-0.15069818115325204,-0.16042975672316906,-0.17059476616469024,-0.18121455529686525,-0.1923166296491457,-0.20390758940744635,-0.21596504491026478,-0.22846234289960826,-0.24134957275708849,-0.25456360364553748],"text":["fitted_logit: -3.4022816<br />resids: -0.0056926112","fitted_logit: -3.3751178<br />resids: -0.0014655068","fitted_logit: -3.3479540<br />resids:  0.0028627248","fitted_logit: -3.3207902<br />resids:  0.0071376364","fitted_logit: -3.2936264<br />resids:  0.0112465138","fitted_logit: -3.2664625<br />resids:  0.0150973381","fitted_logit: -3.2392987<br />resids:  0.0185820451","fitted_logit: -3.2121349<br />resids:  0.0215748269","fitted_logit: -3.1849711<br />resids:  0.0239743155","fitted_logit: -3.1578073<br />resids:  0.0257510213","fitted_logit: -3.1306435<br />resids:  0.0268878899","fitted_logit: -3.1034797<br />resids:  0.0273468604","fitted_logit: -3.0763158<br />resids:  0.0270942171","fitted_logit: -3.0491520<br />resids:  0.0261479239","fitted_logit: -3.0219882<br />resids:  0.0245850053","fitted_logit: -2.9948244<br />resids:  0.0225449043","fitted_logit: -2.9676606<br />resids:  0.0202635825","fitted_logit: -2.9404968<br />resids:  0.0181131376","fitted_logit: -2.9133330<br />resids:  0.0166577542","fitted_logit: -2.8861691<br />resids:  0.0168424690","fitted_logit: -2.8590053<br />resids:  0.0202896066","fitted_logit: -2.8318415<br />resids:  0.0291749731","fitted_logit: -2.8046777<br />resids:  0.0443750519","fitted_logit: -2.7775139<br />resids:  0.0467830012","fitted_logit: -2.7503501<br />resids:  0.0514843935","fitted_logit: -2.7231863<br />resids:  0.0335866592","fitted_logit: -2.6960224<br />resids:  0.0338564737","fitted_logit: -2.6688586<br />resids:  0.0052100346","fitted_logit: -2.6416948<br />resids: -0.0045353665","fitted_logit: -2.6145310<br />resids: -0.0261577283","fitted_logit: -2.5873672<br />resids: -0.0471333834","fitted_logit: -2.5602034<br />resids: -0.0648135838","fitted_logit: -2.5330395<br />resids: -0.0850020877","fitted_logit: -2.5058757<br />resids: -0.1062730828","fitted_logit: -2.4787119<br />resids: -0.1212674891","fitted_logit: -2.4515481<br />resids: -0.1351465958","fitted_logit: -2.4243843<br />resids: -0.1524053300","fitted_logit: -2.3972205<br />resids: -0.1498878811","fitted_logit: -2.3700567<br />resids: -0.1667940100","fitted_logit: -2.3428928<br />resids: -0.1580675528","fitted_logit: -2.3157290<br />resids: -0.1527395259","fitted_logit: -2.2885652<br />resids: -0.1446020158","fitted_logit: -2.2614014<br />resids: -0.1179505208","fitted_logit: -2.2342376<br />resids: -0.1081719191","fitted_logit: -2.2070738<br />resids: -0.0842460342","fitted_logit: -2.1799100<br />resids: -0.0670649485","fitted_logit: -2.1527461<br />resids: -0.0510852520","fitted_logit: -2.1255823<br />resids: -0.0470662575","fitted_logit: -2.0984185<br />resids: -0.0244920499","fitted_logit: -2.0712547<br />resids: -0.0327437117","fitted_logit: -2.0440909<br />resids: -0.0235823128","fitted_logit: -2.0169271<br />resids: -0.0287078231","fitted_logit: -1.9897632<br />resids: -0.0192600019","fitted_logit: -1.9625994<br />resids: -0.0270584641","fitted_logit: -1.9354356<br />resids: -0.0148363826","fitted_logit: -1.9082718<br />resids: -0.0282720222","fitted_logit: -1.8811080<br />resids: -0.0417596520","fitted_logit: -1.8539442<br />resids: -0.0533753933","fitted_logit: -1.8267804<br />resids: -0.0628923229","fitted_logit: -1.7996165<br />resids: -0.0707728430","fitted_logit: -1.7724527<br />resids: -0.0775923451","fitted_logit: -1.7452889<br />resids: -0.0838203811","fitted_logit: -1.7181251<br />resids: -0.0898395913","fitted_logit: -1.6909613<br />resids: -0.0959528444","fitted_logit: -1.6637975<br />resids: -0.1023660985","fitted_logit: -1.6366337<br />resids: -0.1091904658","fitted_logit: -1.6094698<br />resids: -0.1164905420","fitted_logit: -1.5823060<br />resids: -0.1242978804","fitted_logit: -1.5551422<br />resids: -0.1326104981","fitted_logit: -1.5279784<br />resids: -0.1414170105","fitted_logit: -1.5008146<br />resids: -0.1506981812","fitted_logit: -1.4736508<br />resids: -0.1604297567","fitted_logit: -1.4464870<br />resids: -0.1705947662","fitted_logit: -1.4193231<br />resids: -0.1812145553","fitted_logit: -1.3921593<br />resids: -0.1923166296","fitted_logit: -1.3649955<br />resids: -0.2039075894","fitted_logit: -1.3378317<br />resids: -0.2159650449","fitted_logit: -1.3106679<br />resids: -0.2284623429","fitted_logit: -1.2835041<br />resids: -0.2413495728","fitted_logit: -1.2563402<br />resids: -0.2545636036"],"type":"scatter","mode":"lines","name":"fitted values","line":{"width":3.7795275590551185,"color":"rgba(51,102,255,1)","dash":"solid"},"hoveron":"points","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.228310502283104,"r":7.3059360730593621,"b":42.573682025736829,"l":39.651307596513085},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-3.5095786903431447,-1.1490431793073479],"tickmode":"array","ticktext":["-3.5","-3.0","-2.5","-2.0","-1.5"],"tickvals":[-3.5,-3,-2.5,-2,-1.5],"categoryorder":"array","categoryarray":["-3.5","-3.0","-2.5","-2.0","-1.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"serif","size":12.7521793275218},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"y","title":{"text":"fitted_logit","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.961816985673559,3.1609034611883393],"tickmode":"array","ticktext":["-1","0","1","2","3"],"tickvals":[-1,0,1.0000000000000004,2,3.0000000000000004],"categoryorder":"array","categoryarray":["-1","0","1","2","3"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.6529680365296811,"tickwidth":0.66417600664176002,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"serif","size":12.7521793275218},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176002,"zeroline":false,"anchor":"x","title":{"text":"resids","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176002,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.8897637795275593,"font":{"color":"rgba(0,0,0,1)","family":"serif","size":12.7521793275218},"title":{"text":"dibpat","font":{"color":"rgba(0,0,0,1)","family":"serif","size":15.940224159402243}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"297830b28e29":{"x":{},"y":{},"colour":{},"type":"scatter"},"29783a279fe4":{"yintercept":{}},"297825fdd17f":{"x":{},"y":{}}},"cur_data":"297830b28e29","visdat":{"297830b28e29":["function (y) ","x"],"29783a279fe4":["function (y) ","x"],"297825fdd17f":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="pearson-chi-squared-goodness-of-fit-test" class="level3" data-number="3.10.4">
<h3 data-number="3.10.4" class="anchored" data-anchor-id="pearson-chi-squared-goodness-of-fit-test"><span class="header-section-number">3.10.4</span> Pearson chi-squared goodness of fit test</h3>
<p>The Pearson chi-squared goodness of fit statistic is: <span class="math display">\[X^2 = \sum_{k=1}^m X_k^2\]</span></p>
<p>Under the null hypothesis that the model in question is correct (i.e., sufficiently complex), <span class="math inline">\(X^2\ \dot \sim\ \chi^2(N-p)\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>x_pearson <span class="ot">&lt;-</span> chd_glm_strat_grouped <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>chisq_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>(x_pearson<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  chisq_stat,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">FALSE</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">length</span>(x_pearson) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(chd_glm_strat_grouped))</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For our CHD model, the p-value for this test is 0.26523556; no significant evidence of a lack of fit at the 0.05 level.</p>
<section id="standardized-pearson-residuals" class="level4">
<h4 class="anchored" data-anchor-id="standardized-pearson-residuals">Standardized Pearson residuals</h4>
<p>Especially for small data sets, we might want to adjust our residuals for leverage (since outliers in <span class="math inline">\(X\)</span> add extra variance to the residuals):</p>
<p><span class="math display">\[r_{P_k} = \frac{X_k}{\sqrt{1-h_k}}\]</span></p>
<p>where <span class="math inline">\(h_k\)</span> is the leverage of <span class="math inline">\(X_k\)</span>. The functions <code>autoplot()</code> and <code>plot.lm()</code> use these for some of their graphs.</p>
</section>
</section>
<section id="deviance-residuals" class="level3" data-number="3.10.5">
<h3 data-number="3.10.5" class="anchored" data-anchor-id="deviance-residuals"><span class="header-section-number">3.10.5</span> Deviance residuals</h3>
<p>For large sample sizes, the Pearson and deviance residuals will be approximately the same. For small sample sizes, the deviance residuals from covariate patterns with small sample sizes can be unreliable (high variance).</p>
<p><span class="math display">\[d_k = \text{sign}(y_k - n_k \hat \pi_k)\left\{\sqrt{2[\ell_{\text{full}}(x_k) - \ell(\hat\beta; x_k)]}\right\}\]</span></p>
<section id="standardized-deviance-residuals" class="level4">
<h4 class="anchored" data-anchor-id="standardized-deviance-residuals">Standardized deviance residuals</h4>
<p><span class="math display">\[r_{D_k} = \frac{d_k}{\sqrt{1-h_k}}\]</span></p>
</section>
</section>
<section id="diagnostic-plots" class="level3" data-number="3.10.6">
<h3 data-number="3.10.6" class="anchored" data-anchor-id="diagnostic-plots"><span class="header-section-number">3.10.6</span> Diagnostic plots</h3>
<p>Let’s take a look at the full set of <code>autoplot()</code> diagnostics now for our <code>CHD</code> model:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-chd-model-diagnostics" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-chd-model-diagnostics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.14: Diagnostics for CHD model
</figcaption>
<div aria-describedby="fig-chd-model-diagnostics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-chd-model-diagnostics-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<div class="notes">
<p>Things look pretty good here. The QQ plot is still usable; with large samples; the residuals should be approximately Gaussian.</p>
</div>
<section id="beetles" class="level4">
<h4 class="anchored" data-anchor-id="beetles">Beetles</h4>
<p>Let’s look at the beetles model diagnostic plots for comparison:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-beetles-glm-diag" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-beetles-glm-diag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.15: Diagnostics for logistic model of <code>BeetleMortality</code> data
</figcaption>
<div aria-describedby="fig-beetles-glm-diag-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-beetles-glm-diag-1.png" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>Hard to tell much from so little data, but there might be some issues here.</p>
</section>
</section>
</section>
<section id="objections-to-reporting-odds-ratios" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="objections-to-reporting-odds-ratios"><span class="header-section-number">3.11</span> Objections to reporting odds ratios</h2>
<p>Some scholars have raised objections to the use of odds ratios as an effect measurement <span class="citation" data-cites="sackett1996down norton2024requiem">(<a href="references.html#ref-sackett1996down" role="doc-biblioref">Sackett, Deeks, and Altman 1996</a>; <a href="references.html#ref-norton2024requiem" role="doc-biblioref">Norton et al. 2024</a>)</span>. One objection is that odds ratios depend on the set of covariates in a model, even when those covariates are independent of the exposure of interest and do not interact with that exposure. For example, consider the following model:</p>
<p><span class="math display">\[\text{P}(Y=y|X=x,C=c) = {\color{red}\pi(x,c)}^y (1-{\color{red}\pi(x,c)})^{1-y}\]</span></p>
<p><span class="math display">\[{\color{red}\pi(x,c)} = \text{expit}\left\{\eta_0 + \beta_Xx + \beta_Cc\right\}\]</span></p>
<p>Then:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}\left[Y|X=x\right] &amp;= \mathbb{E}\left[\mathbb{E}\left[Y | X, C\right] | X\right]
\\ &amp;= \mathbb{E}\left[\text{expit}\left\{\eta_0 + \beta_X X + \beta_C C\right\} | X\right]
\end{aligned}
\]</span></p>
<p>Since the <span class="math inline">\(\text{expit}\left\{\right\}\)</span> function is nonlinear, we can’t change the order of the expectation and <span class="math inline">\(\text{expit}\left\{\right\}\)</span> operators:</p>
<p><span class="math display">\[\mathbb{E}\left[\text{expit}\left\{\eta_0 + \beta_XX + \beta_CC\right\} | X\right] \neq \text{expit}\left\{\mathbb{E}\left[\eta_0 + \beta_XX + \beta_CC\right] | X\right\}\]</span></p>
<p>In contrast, with a linear link function:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}\left[Y|X\right] &amp;= \mathbb{E}\left[\mathbb{E}\left[Y | X, C\right] | X\right]
\\ &amp;= \mathbb{E}\left[\eta_0 + \beta_X X + \beta_C C | X=x\right]
\\ &amp;= \eta_0 + \beta_X X +  {\color{red}\mathbb{E}\left[ \beta_C C | X\right]}
\end{aligned}
\]</span></p>
<p>If <span class="math inline">\(C ⫫X\)</span>, then:</p>
<p><span class="math display">\[{\color{red}\mathbb{E}\left[ \beta_CC | X\right]} = \beta_C \mathbb{E}\left[C\right]\]</span></p>
<p>and</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}\left[Y|X\right] &amp;= {\color{red}(\eta_0 + \beta_C \mathbb{E}\left[C\right])} + {\color{blue}\beta_XX}
\\ &amp;= {\color{red}\eta_0^*}  + {\color{blue}\beta_XX}
\end{aligned}
\]</span></p>
<p>So:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial x} \mathbb{E}\left[Y|X=x\right] = {\color{blue}\beta_XX} = \frac{\partial}{\partial x} \mathbb{E}\left[Y|X=x,C=c\right]
\end{aligned}
\]</span></p>
</section>
<section id="other-link-functions-for-bernoulli-outcomes" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="other-link-functions-for-bernoulli-outcomes"><span class="header-section-number">3.12</span> Other link functions for Bernoulli outcomes</h2>
<p>If you want risk ratios, you can sometimes get them by changing the link function:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(anthers, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>anthers_sum <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  anthers[<span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"y"</span>)],</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> anthers[<span class="fu">c</span>(<span class="st">"storage"</span>)], <span class="at">FUN =</span> sum</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y, n <span class="sc">-</span> y) <span class="sc">~</span> storage,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> anthers_sum,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"log"</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Log-Risk</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">-0.80</td>
<td style="text-align: center;">0.12</td>
<td style="text-align: center;">(-1.04, -0.58)</td>
<td style="text-align: center;">-6.81</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">storage</td>
<td style="text-align: center;">0.17</td>
<td style="text-align: center;">0.07</td>
<td style="text-align: center;">(0.02, 0.31)</td>
<td style="text-align: center;">2.31</td>
<td style="text-align: center;">0.021</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p>Now <span class="math inline">\(\text{exp}\left\{\beta\right\}\)</span> gives us risk ratios instead of odds ratios:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Risk Ratio</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">0.05</td>
<td style="text-align: center;">(0.35, 0.56)</td>
<td style="text-align: center;">-6.81</td>
<td style="text-align: center;">&lt; .001</td>
</tr>
<tr class="even">
<td style="text-align: left;">storage</td>
<td style="text-align: center;">1.18</td>
<td style="text-align: center;">0.09</td>
<td style="text-align: center;">(1.03, 1.36)</td>
<td style="text-align: center;">2.31</td>
<td style="text-align: center;">0.021</td>
</tr>
</tbody>
</table>
</div>
</div>
<hr>
<p>Let’s compare this model with a logistic model:</p>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y, n <span class="sc">-</span> y) <span class="sc">~</span> storage,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> anthers_sum,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="sc">|&gt;</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: center;">Odds Ratio</th>
<th style="text-align: center;">SE</th>
<th style="text-align: center;">95% CI</th>
<th style="text-align: center;">z</th>
<th style="text-align: center;">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">0.76</td>
<td style="text-align: center;">0.20</td>
<td style="text-align: center;">(0.45, 1.27)</td>
<td style="text-align: center;">-1.05</td>
<td style="text-align: center;">0.296</td>
</tr>
<tr class="even">
<td style="text-align: left;">storage</td>
<td style="text-align: center;">1.49</td>
<td style="text-align: center;">0.26</td>
<td style="text-align: center;">(1.06, 2.10)</td>
<td style="text-align: center;">2.29</td>
<td style="text-align: center;">0.022</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>[to add: fitted plots on each outcome scale]</p>
<hr>
<p>When I try to use <code>link ="log"</code> in practice, I often get errors about not finding good starting values for the estimation procedure. This is likely because the model is producing fitted probabilities greater than 1.</p>
<p>When this happens, you can try to fit Poisson regression models instead (we will see those soon!). But then the outcome distribution isn’t quite right, and you won’t get warnings about fitted probabilities greater than 1. In my opinion, the Poisson model for binary outcomes is confusing and not very appealing.</p>
<section id="wcgs-link-functions" class="level3" data-number="3.12.1">
<h3 data-number="3.12.1" class="anchored" data-anchor-id="wcgs-link-functions"><span class="header-section-number">3.12.1</span> WCGS: link functions</h3>
<div class="cell">
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>wcgs_glm_logit_link <span class="ot">&lt;-</span> chd_grouped_data <span class="sc">|&gt;</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">relevel</span>(dibpat, <span class="at">ref =</span> <span class="st">"Type B"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(x, <span class="st">`</span><span class="at">n - x</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">*</span> age,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>wcgs_glm_identity_link <span class="ot">&lt;-</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">relevel</span>(dibpat, <span class="at">ref =</span> <span class="st">"Type B"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(x, <span class="st">`</span><span class="at">n - x</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">*</span> age,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"identity"</span>)</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>wcgs_glm_identity_link <span class="sc">|&gt;</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">|&gt;</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pander</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">(Intercept)</th>
<th style="text-align: center;">dibpatType A</th>
<th style="text-align: center;">age</th>
<th style="text-align: center;">dibpatType A:age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">-0.08257</td>
<td style="text-align: center;">-0.1374</td>
<td style="text-align: center;">0.002906</td>
<td style="text-align: center;">0.004194</td>
</tr>
</tbody>
</table>
</div>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>wcgs_glm_logit_link <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>dibpat)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>wcgs_glm_identity_link <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>dibpat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-diagnostics-glm1" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-diagnostics-glm1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.16: Residuals vs Fitted plot for <code>wcgs</code> models
</figcaption>
<div aria-describedby="fig-diagnostics-glm1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-diagnostics-glm1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-diagnostics-glm1-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-diagnostics-glm1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Logistic link
</figcaption>
<div aria-describedby="fig-diagnostics-glm1-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-diagnostics-glm1-1.png" class="img-fluid figure-img" data-ref-parent="fig-diagnostics-glm1" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-diagnostics-glm1" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-diagnostics-glm1-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-diagnostics-glm1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Identity link
</figcaption>
<div aria-describedby="fig-diagnostics-glm1-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-diagnostics-glm1-2.png" class="img-fluid figure-img" data-ref-parent="fig-diagnostics-glm1" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
<details class="code-fold">
<summary>Show R code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>beetles_lm <span class="ot">&lt;-</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  beetles_long <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="at">formula =</span> died <span class="sc">~</span> dose)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>beetles <span class="ot">&lt;-</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">resid_logit =</span> beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>beetles_lm <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-diagnostics-beetles" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-diagnostics-beetles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3.17: Residuals vs Fitted plot for <code>BeetleMortality</code> models
</figcaption>
<div aria-describedby="fig-diagnostics-beetles-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-diagnostics-beetles" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-diagnostics-beetles-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-diagnostics-beetles-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Logistic link
</figcaption>
<div aria-describedby="fig-diagnostics-beetles-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-diagnostics-beetles-1.png" class="img-fluid figure-img" data-ref-parent="fig-diagnostics-beetles" width="672">
</div>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-diagnostics-beetles" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-diagnostics-beetles-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<figcaption class="quarto-float-caption-top quarto-subfloat-caption quarto-subfloat-fig" id="fig-diagnostics-beetles-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Identity link
</figcaption>
<div aria-describedby="fig-diagnostics-beetles-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="logistic-regression_files/figure-html/fig-diagnostics-beetles-2.png" class="img-fluid figure-img" data-ref-parent="fig-diagnostics-beetles" width="672">
</div>
</figure>
</div>
</div>
</div>
</div>
</figure>
</div>
</section>
</section>
<section id="quasibinomial" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="quasibinomial"><span class="header-section-number">3.13</span> Quasibinomial</h2>
<p>See <a href="https://hua-zhou.github.io/">Hua Zhou</a>’s <a href="https://ucla-biostat-200c-2020spring.github.io/slides/04-binomial/binomial.html#:~:text=0.05%20%27.%27%200.1%20%27%20%27%201-,Quasi%2Dbinomial,-Another%20way%20to">lecture notes</a></p>
</section>
<section id="further-reading" class="level2" data-number="3.14">
<h2 data-number="3.14" class="anchored" data-anchor-id="further-reading"><span class="header-section-number">3.14</span> Further reading</h2>
<ul>
<li><span class="citation" data-cites="hosmer2013applied">Hosmer, Lemeshow, and Sturdivant (<a href="references.html#ref-hosmer2013applied" role="doc-biblioref">2013</a>)</span> is a classic textbook on logistic regression</li>
</ul>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-dobson4e" class="csl-entry" role="listitem">
Dobson, Annette J, and Adrian G Barnett. 2018. <em>An Introduction to Generalized Linear Models</em>. 4th ed. CRC press. <a href="https://doi.org/10.1201/9781315182780">https://doi.org/10.1201/9781315182780</a>.
</div>
<div id="ref-hosmer2013applied" class="csl-entry" role="listitem">
Hosmer, David W, Stanley Lemeshow, and Rodney X Sturdivant. 2013. <em>Applied Logistic Regression</em>. John Wiley &amp; Sons. <a href="https://onlinelibrary.wiley.com/doi/book/10.1002/9781118548387">https://onlinelibrary.wiley.com/doi/book/10.1002/9781118548387</a>.
</div>
<div id="ref-NahhasIRMPHR" class="csl-entry" role="listitem">
Nahhas, Ramzi W. 2024. <em>Introduction to Regression Methods for Public Health Using r</em>. CRC Press. <a href="https://www.bookdown.org/rwnahhas/RMPH/">https://www.bookdown.org/rwnahhas/RMPH/</a>.
</div>
<div id="ref-norton2024requiem" class="csl-entry" role="listitem">
Norton, Edward C., Bryan E. Dowd, Melissa M. Garrido, and Matthew L. Maciejewski. 2024. <span>“Requiem for Odds Ratios.”</span> <em>Health Services Research</em> 59 (4): e14337. https://doi.org/<a href="https://doi.org/10.1111/1475-6773.14337">https://doi.org/10.1111/1475-6773.14337</a>.
</div>
<div id="ref-rosenman1975coronary" class="csl-entry" role="listitem">
Rosenman, Ray H, Richard J Brand, C David Jenkins, Meyer Friedman, Reuben Straus, and Moses Wurm. 1975. <span>“Coronary Heart Disease in the Western Collaborative Group Study: Final Follow-up Experience of 8 1/2 Years.”</span> <em>JAMA</em> 233 (8): 872–77. <a href="https://doi.org/10.1001/jama.1975.03260080034016">https://doi.org/10.1001/jama.1975.03260080034016</a>.
</div>
<div id="ref-sackett1996down" class="csl-entry" role="listitem">
Sackett, David L, Jonathan J Deeks, and Doughs G Altman. 1996. <span>“Down with Odds Ratios!”</span> <em>BMJ Evidence-Based Medicine</em> 1 (6): 164.
</div>
<div id="ref-vittinghoff2e" class="csl-entry" role="listitem">
Vittinghoff, Eric, David V Glidden, Stephen C Shiboski, and Charles E McCulloch. 2012. <em>Regression Methods in Biostatistics: Linear, Logistic, Survival, and Repeated Measures Models</em>. 2nd ed. Springer. <a href="https://doi.org/10.1007/978-1-4614-1353-0">https://doi.org/10.1007/978-1-4614-1353-0</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Linear-models-overview.html" class="pagination-link" aria-label="Linear (Gaussian) Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Linear (Gaussian) Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./count-regression.html" class="pagination-link" aria-label="Models for Count Outcomes">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Models for Count Outcomes</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb62" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Logistic regression and variations"</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu"># Models for Binary Outcomes {#sec-Bernoulli-models}</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>{{&lt; include shared-config.qmd &gt;}}</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">### Acknowledgements {.unnumbered}</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>This content is adapted from:</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@dobson4e, Chapter 7</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@vittinghoff2e, Chapter 5</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">David Rocke</span><span class="co">](https://dmrocke.ucdavis.edu/)</span>'s materials from the <span class="co">[</span><span class="ot">2021 edition of Epi 204</span><span class="co">](https://dmrocke.ucdavis.edu/Class/EPI204-Spring-2021/EPI204-Spring-2021.html)</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>@NahhasIRMPHR <span class="co">[</span><span class="ot">Chapter 6</span><span class="co">](https://www.bookdown.org/rwnahhas/RMPH/blr.html)</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="fu">### What is logistic regression?</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>**Logistic regression** is a framework for modeling <span class="co">[</span><span class="ot">binary</span><span class="co">](probability.qmd#def-binary)</span> outcomes, conditional on one or more *predictors* (a.k.a. *covariates*).</span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>::: {#exr-binary-examples}</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Examples of binary outcomes</span></span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>What are some examples of binary outcomes in the health sciences?</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a>----</span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>:::: {.solution}</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-39"><a href="#cb62-39" aria-hidden="true" tabindex="-1"></a>{{&lt; include binary-outcome-examples.qmd &gt;}}</span>
<span id="cb62-40"><a href="#cb62-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a>Logistic regression uses the <span class="co">[</span><span class="ot">Bernoulli</span><span class="co">](probability.qmd#def-bernoulli)</span> distribution to model the outcome variable, conditional on one or more covariates. </span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a>::: {#exr-def-bernoulli}</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a>Write down a mathematical definition of the Bernoulli distribution.</span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a>::::{.solution}</span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a>{{&lt; include def-bernoulli.qmd &gt;}}</span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression versus linear regression</span></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a>Logistic regression differs from linear regression, which uses the Gaussian ("normal") distribution to model the outcome variable, conditional on the covariates.</span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a>:::: {#exr-linear}</span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a>Recall: what kinds of outcomes is linear regression used for?</span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>::: {.solution}</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>Linear regression is typically used for numerical outcomes that aren't event counts or waiting times for an event. Examples of outcomes that are often analyzed using linear regression include include weight, height, and income.</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a><span class="fu">## Risk Estimation and Prediction</span></span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a>In Epi 203, </span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a>you have already seen </span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>methods for modeling binary outcomes </span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a>using one covariate that is also binary </span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>(such as exposure/non-exposure).</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a>In this section, we review one-covariate analyses, </span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a>with a special focus on risk ratios and odds ratios, </span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a>which are important concepts for interpreting logistic regression.</span>
<span id="cb62-95"><a href="#cb62-95" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-96"><a href="#cb62-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a>:::::{#exm-oc-mi}</span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a><span class="fu">### Oral Contraceptive Use and Heart Attack</span></span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Research question: </span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a>how does oral contraceptive (OC) use </span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a>affect the risk of myocardial infarction (MI; a.k.a. heart attack)?</span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a>:::{.notes}</span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a>This was an issue when oral contraceptives were first developed, </span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a>because the original formulations used </span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a>higher concentrations of hormones. </span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a>Modern OCs don't have this issue.</span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a>@tbl-oc-mi contains simulated data for </span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a>an imaginary follow-up (a.k.a. *prospective*) study </span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a>in which two groups are identified, </span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a>one using OCs and another not using OCs, </span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a>and both groups are tracked for three years </span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a>to determine how many in each groups have MIs.</span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a>:::{#tbl-oc-mi}</span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a>oc_mi <span class="ot">&lt;-</span></span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tribble</span>(</span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span>OC, <span class="sc">~</span>MI, <span class="sc">~</span>Total,</span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a>    <span class="st">"OC use"</span>, <span class="dv">13</span>, <span class="dv">5000</span>,</span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a>    <span class="st">"No OC use"</span>, <span class="dv">7</span>, <span class="dv">10000</span></span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span> <span class="ot">=</span> Total <span class="sc">-</span> MI) <span class="sc">|&gt;</span></span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, <span class="at">.after =</span> MI)</span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a>totals <span class="ot">&lt;-</span></span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a>  oc_mi <span class="sc">|&gt;</span></span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(MI, <span class="st">`</span><span class="at">No MI</span><span class="st">`</span>, Total), sum)) <span class="sc">|&gt;</span></span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OC =</span> <span class="st">"Total"</span>)</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a>tbl_oc_mi <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(oc_mi, totals)</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a>tbl_oc_mi</span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a>Simulated data from study of oral contraceptive use and heart attack risk</span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a>:::::</span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a>::::{#exr-probs}</span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a>Review: estimate the probabilities of MI for OC users and non-OC users in @exm-oc-mi.</span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a>----</span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-163"><a href="#cb62-163" aria-hidden="true" tabindex="-1"></a>:::{.solution}</span>
<span id="cb62-164"><a href="#cb62-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: calc-prs</span></span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a><span class="in">p_MI_OC &lt;- 13 / 5000 # nolint: object_name_linter</span></span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a><span class="in">p_MI_nOC &lt;- 7 / 10000 # nolint: object_name_linter</span></span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-170"><a href="#cb62-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-171"><a href="#cb62-171" aria-hidden="true" tabindex="-1"></a>$$\ph(MI|OC) = \frac{13}{5000} = <span class="in">`r p_MI_OC`</span>$$</span>
<span id="cb62-172"><a href="#cb62-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-173"><a href="#cb62-173" aria-hidden="true" tabindex="-1"></a>$$\ph(MI|\neg OC) = \frac{7}{10000} = <span class="in">`r p_MI_nOC`</span>$$</span>
<span id="cb62-174"><a href="#cb62-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-175"><a href="#cb62-175" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-176"><a href="#cb62-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-177"><a href="#cb62-177" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-178"><a href="#cb62-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-179"><a href="#cb62-179" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Controls</span></span>
<span id="cb62-180"><a href="#cb62-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-181"><a href="#cb62-181" aria-hidden="true" tabindex="-1"></a>::::{.callout-note}</span>
<span id="cb62-182"><a href="#cb62-182" aria-hidden="true" tabindex="-1"></a><span class="fu">##### Two meanings of "controls"</span></span>
<span id="cb62-183"><a href="#cb62-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-184"><a href="#cb62-184" aria-hidden="true" tabindex="-1"></a>Depending on context, "controls" can mean either individuals who don't experience an *exposure* of interest, or individuals who don't experience an *outcome* of interest.</span>
<span id="cb62-185"><a href="#cb62-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-186"><a href="#cb62-186" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-187"><a href="#cb62-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-188"><a href="#cb62-188" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-189"><a href="#cb62-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-190"><a href="#cb62-190" aria-hidden="true" tabindex="-1"></a>:::{#def-cases-retrospective}</span>
<span id="cb62-191"><a href="#cb62-191" aria-hidden="true" tabindex="-1"></a><span class="fu">##### cases and controls in retrospective studies</span></span>
<span id="cb62-192"><a href="#cb62-192" aria-hidden="true" tabindex="-1"></a>In *retrospective studies*, participants who experience the outcome of interest are called **cases**, while participants who don't experience that outcome are called **controls**. </span>
<span id="cb62-193"><a href="#cb62-193" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-194"><a href="#cb62-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-195"><a href="#cb62-195" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-196"><a href="#cb62-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-197"><a href="#cb62-197" aria-hidden="true" tabindex="-1"></a>:::{#def-cases-prospective}</span>
<span id="cb62-198"><a href="#cb62-198" aria-hidden="true" tabindex="-1"></a><span class="fu">##### treatment groups and control groups in prospective studies</span></span>
<span id="cb62-199"><a href="#cb62-199" aria-hidden="true" tabindex="-1"></a>In *prospective studies*, the group of participants who experience the treatment or exposure of interest is called the **treatment group**, while the participants who receive the baseline or comparison treatment  (for example, clinical trial participants who receive a placebo or a standard-of-care treatment rather than an experimental treatment) are called **controls**.</span>
<span id="cb62-200"><a href="#cb62-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-201"><a href="#cb62-201" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-202"><a href="#cb62-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-203"><a href="#cb62-203" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comparing Probabilities</span></span>
<span id="cb62-204"><a href="#cb62-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-205"><a href="#cb62-205" aria-hidden="true" tabindex="-1"></a><span class="fu">### Risk differences</span></span>
<span id="cb62-206"><a href="#cb62-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-207"><a href="#cb62-207" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-208"><a href="#cb62-208" aria-hidden="true" tabindex="-1"></a>The simplest comparison of two probabilities, $\pi_1$, and $\pi_2$, is the difference of their values:</span>
<span id="cb62-209"><a href="#cb62-209" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-210"><a href="#cb62-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-211"><a href="#cb62-211" aria-hidden="true" tabindex="-1"></a>:::{#def-RD}</span>
<span id="cb62-212"><a href="#cb62-212" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Risk difference</span></span>
<span id="cb62-213"><a href="#cb62-213" aria-hidden="true" tabindex="-1"></a>The **risk difference** of two probabilities, $\pi_1$, and $\pi_2$, is the difference of their values: </span>
<span id="cb62-214"><a href="#cb62-214" aria-hidden="true" tabindex="-1"></a>$$\delta(\pi_1,\pi_2) \eqdef \pi_1 - \pi_2$$</span>
<span id="cb62-215"><a href="#cb62-215" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-216"><a href="#cb62-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-217"><a href="#cb62-217" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-218"><a href="#cb62-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-219"><a href="#cb62-219" aria-hidden="true" tabindex="-1"></a>:::{#exm-RD}</span>
<span id="cb62-220"><a href="#cb62-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-221"><a href="#cb62-221" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Difference in MI risk</span></span>
<span id="cb62-222"><a href="#cb62-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-223"><a href="#cb62-223" aria-hidden="true" tabindex="-1"></a>In @exm-oc-mi, the maximum likelihood estimate of the difference in MI risk between OC users and OC non-users is:</span>
<span id="cb62-224"><a href="#cb62-224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, include = FALSE}</span></span>
<span id="cb62-225"><a href="#cb62-225" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: compute-risk-diff</span></span>
<span id="cb62-226"><a href="#cb62-226" aria-hidden="true" tabindex="-1"></a><span class="in">rd_OC &lt;- p_MI_OC - p_MI_nOC # nolint: object_name_linter</span></span>
<span id="cb62-227"><a href="#cb62-227" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-228"><a href="#cb62-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-229"><a href="#cb62-229" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-230"><a href="#cb62-230" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-231"><a href="#cb62-231" aria-hidden="true" tabindex="-1"></a>\hat\delta(\pi(OC), \pi(\neg OC))</span>
<span id="cb62-232"><a href="#cb62-232" aria-hidden="true" tabindex="-1"></a>&amp;= \delta(\hat\pi(OC), \hat\pi(\neg OC))<span class="sc">\\</span></span>
<span id="cb62-233"><a href="#cb62-233" aria-hidden="true" tabindex="-1"></a>&amp;= \hat\pi(OC) - \hat\pi(\neg OC)<span class="sc">\\</span></span>
<span id="cb62-234"><a href="#cb62-234" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r p_MI_OC`</span> - <span class="in">`r p_MI_nOC`</span><span class="sc">\\</span></span>
<span id="cb62-235"><a href="#cb62-235" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r rd_OC`</span></span>
<span id="cb62-236"><a href="#cb62-236" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-237"><a href="#cb62-237" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-238"><a href="#cb62-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-239"><a href="#cb62-239" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-240"><a href="#cb62-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-241"><a href="#cb62-241" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-242"><a href="#cb62-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-243"><a href="#cb62-243" aria-hidden="true" tabindex="-1"></a><span class="fu">### Risk ratios</span></span>
<span id="cb62-244"><a href="#cb62-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-245"><a href="#cb62-245" aria-hidden="true" tabindex="-1"></a>:::{#def-RR}</span>
<span id="cb62-246"><a href="#cb62-246" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relative risk ratios</span></span>
<span id="cb62-247"><a href="#cb62-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-248"><a href="#cb62-248" aria-hidden="true" tabindex="-1"></a>:::: notes</span>
<span id="cb62-249"><a href="#cb62-249" aria-hidden="true" tabindex="-1"></a>The **relative risk** of probability $\pi_1$ compared to another probability $\pi_2$, also called the **risk ratio**, **relative risk ratio**, **probability ratio**, or **rate ratio**, is the ratio of those probabilities:</span>
<span id="cb62-250"><a href="#cb62-250" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-251"><a href="#cb62-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-252"><a href="#cb62-252" aria-hidden="true" tabindex="-1"></a>$$\rho(\pi_1,\pi_2) = \frac{\pi_1}{\pi_2}$$</span>
<span id="cb62-253"><a href="#cb62-253" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-254"><a href="#cb62-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-255"><a href="#cb62-255" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-256"><a href="#cb62-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-257"><a href="#cb62-257" aria-hidden="true" tabindex="-1"></a>:::{#exm-RR}</span>
<span id="cb62-258"><a href="#cb62-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-259"><a href="#cb62-259" aria-hidden="true" tabindex="-1"></a>:::: notes</span>
<span id="cb62-260"><a href="#cb62-260" aria-hidden="true" tabindex="-1"></a>Above, we estimated that:</span>
<span id="cb62-261"><a href="#cb62-261" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-262"><a href="#cb62-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-263"><a href="#cb62-263" aria-hidden="true" tabindex="-1"></a>$$\ph(MI|OC) = <span class="in">`r 13/5000`</span>$$</span>
<span id="cb62-264"><a href="#cb62-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-265"><a href="#cb62-265" aria-hidden="true" tabindex="-1"></a>$$\ph(MI|\neg OC) = <span class="in">`r 7/10000`</span>$$</span>
<span id="cb62-266"><a href="#cb62-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-267"><a href="#cb62-267" aria-hidden="true" tabindex="-1"></a>:::: notes</span>
<span id="cb62-268"><a href="#cb62-268" aria-hidden="true" tabindex="-1"></a>So we might estimate that the *relative risk* of MI for OC versus non-OC is:</span>
<span id="cb62-269"><a href="#cb62-269" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-270"><a href="#cb62-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-273"><a href="#cb62-273" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-274"><a href="#cb62-274" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compute-risk-ratio</span></span>
<span id="cb62-275"><a href="#cb62-275" aria-hidden="true" tabindex="-1"></a>rr <span class="ot">&lt;-</span> (<span class="dv">13</span> <span class="sc">/</span> <span class="dv">5000</span>) <span class="sc">/</span> (<span class="dv">7</span> <span class="sc">/</span> <span class="dv">10000</span>)</span>
<span id="cb62-276"><a href="#cb62-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-277"><a href="#cb62-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-278"><a href="#cb62-278" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-279"><a href="#cb62-279" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-280"><a href="#cb62-280" aria-hidden="true" tabindex="-1"></a>\hat\rho(OC, \neg OC)</span>
<span id="cb62-281"><a href="#cb62-281" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{\ph(MI|OC)}{\ph(MI|\neg OC)}<span class="sc">\\</span></span>
<span id="cb62-282"><a href="#cb62-282" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{<span class="in">`r 13/5000`</span>}{<span class="in">`r 7/10000`</span>}<span class="sc">\\</span></span>
<span id="cb62-283"><a href="#cb62-283" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r rr`</span></span>
<span id="cb62-284"><a href="#cb62-284" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-285"><a href="#cb62-285" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-286"><a href="#cb62-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-287"><a href="#cb62-287" aria-hidden="true" tabindex="-1"></a>:::: notes</span>
<span id="cb62-288"><a href="#cb62-288" aria-hidden="true" tabindex="-1"></a>We might summarize this result by saying that "the estimated probability of MI among OC users was <span class="in">`r rr`</span> as high as the estimated probability among OC non-users. </span>
<span id="cb62-289"><a href="#cb62-289" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-290"><a href="#cb62-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-291"><a href="#cb62-291" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-292"><a href="#cb62-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-293"><a href="#cb62-293" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-294"><a href="#cb62-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-295"><a href="#cb62-295" aria-hidden="true" tabindex="-1"></a><span class="fu">### Relative risk differences</span></span>
<span id="cb62-296"><a href="#cb62-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-297"><a href="#cb62-297" aria-hidden="true" tabindex="-1"></a>:::{#def-RRD}</span>
<span id="cb62-298"><a href="#cb62-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-299"><a href="#cb62-299" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Relative risk difference</span></span>
<span id="cb62-300"><a href="#cb62-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-301"><a href="#cb62-301" aria-hidden="true" tabindex="-1"></a>:::: notes</span>
<span id="cb62-302"><a href="#cb62-302" aria-hidden="true" tabindex="-1"></a>Sometimes, we divide the risk difference by the comparison probability; the result is called the **relative risk difference**:</span>
<span id="cb62-303"><a href="#cb62-303" aria-hidden="true" tabindex="-1"></a>::::</span>
<span id="cb62-304"><a href="#cb62-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-305"><a href="#cb62-305" aria-hidden="true" tabindex="-1"></a>$$\xi(\pi_1,\pi_2) \eqdef \frac{\delta(\pi_1,\pi_2)}{\pi_2}$$</span>
<span id="cb62-306"><a href="#cb62-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-307"><a href="#cb62-307" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-308"><a href="#cb62-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-309"><a href="#cb62-309" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-310"><a href="#cb62-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-311"><a href="#cb62-311" aria-hidden="true" tabindex="-1"></a>:::{#thm-rrd-vs-rr}</span>
<span id="cb62-312"><a href="#cb62-312" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Relative risk difference equals risk ratio minus 1</span></span>
<span id="cb62-313"><a href="#cb62-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-314"><a href="#cb62-314" aria-hidden="true" tabindex="-1"></a>$$\xi(\pi_1,\pi_2) = \rho(\pi_1,\pi_2) - 1$$</span>
<span id="cb62-315"><a href="#cb62-315" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-316"><a href="#cb62-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-317"><a href="#cb62-317" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-318"><a href="#cb62-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-319"><a href="#cb62-319" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-320"><a href="#cb62-320" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-321"><a href="#cb62-321" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-322"><a href="#cb62-322" aria-hidden="true" tabindex="-1"></a>\xi(\pi_1,\pi_2) </span>
<span id="cb62-323"><a href="#cb62-323" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \frac{\delta(\pi_1,\pi_2)}{\pi_2}</span>
<span id="cb62-324"><a href="#cb62-324" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span>&amp;= \frac{\pi_1-\pi_2}{\pi_2}</span>
<span id="cb62-325"><a href="#cb62-325" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span>&amp;= \frac{\pi_1}{\pi_2} - 1</span>
<span id="cb62-326"><a href="#cb62-326" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span>&amp;= \rho(\pi_1,\pi_2) - 1</span>
<span id="cb62-327"><a href="#cb62-327" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-328"><a href="#cb62-328" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-329"><a href="#cb62-329" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-330"><a href="#cb62-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-331"><a href="#cb62-331" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-332"><a href="#cb62-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-333"><a href="#cb62-333" aria-hidden="true" tabindex="-1"></a><span class="fu">### Changing reference groups in risk comparisons</span></span>
<span id="cb62-334"><a href="#cb62-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-335"><a href="#cb62-335" aria-hidden="true" tabindex="-1"></a>:::: notes</span>
<span id="cb62-336"><a href="#cb62-336" aria-hidden="true" tabindex="-1"></a>Risk differences, risk ratios, and relative risk differences are defined by two probabilities, plus a choice of which probability is the **baseline** or **reference** probability (i.e., which probability is the subtrahend of the risk difference or the denominator of the risk ratio).</span>
<span id="cb62-337"><a href="#cb62-337" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-338"><a href="#cb62-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-339"><a href="#cb62-339" aria-hidden="true" tabindex="-1"></a>$$\delta(\pi_2,\pi_1) = -\delta(\pi_1, \pi_2)$$</span>
<span id="cb62-340"><a href="#cb62-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-341"><a href="#cb62-341" aria-hidden="true" tabindex="-1"></a>$$\rho(\pi_2,\pi_1) = \inv{\rho(\pi_1,\pi_2)}$$</span>
<span id="cb62-342"><a href="#cb62-342" aria-hidden="true" tabindex="-1"></a>$$\xi(\pi_2,\pi_1) = \inv{\xi(\pi_2,\pi_1) + 1} - 1$$</span>
<span id="cb62-343"><a href="#cb62-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-344"><a href="#cb62-344" aria-hidden="true" tabindex="-1"></a>:::{#exr-change-ref-group}</span>
<span id="cb62-345"><a href="#cb62-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-346"><a href="#cb62-346" aria-hidden="true" tabindex="-1"></a>Prove the relationships above.</span>
<span id="cb62-347"><a href="#cb62-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-348"><a href="#cb62-348" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-349"><a href="#cb62-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-350"><a href="#cb62-350" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-351"><a href="#cb62-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-352"><a href="#cb62-352" aria-hidden="true" tabindex="-1"></a>:::{#exm-ref}</span>
<span id="cb62-353"><a href="#cb62-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-354"><a href="#cb62-354" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Switching the reference group in a risk ratio</span></span>
<span id="cb62-355"><a href="#cb62-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-356"><a href="#cb62-356" aria-hidden="true" tabindex="-1"></a>Above, we estimated that the risk ratio of OC versus non-OC is:</span>
<span id="cb62-357"><a href="#cb62-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-358"><a href="#cb62-358" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-359"><a href="#cb62-359" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-360"><a href="#cb62-360" aria-hidden="true" tabindex="-1"></a>\rho(OC, \neg OC)</span>
<span id="cb62-361"><a href="#cb62-361" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r (13/5000)/(7/10000)`</span></span>
<span id="cb62-362"><a href="#cb62-362" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-363"><a href="#cb62-363" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-364"><a href="#cb62-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-365"><a href="#cb62-365" aria-hidden="true" tabindex="-1"></a>In comparison, the risk ratio for non-OC versus OC is:</span>
<span id="cb62-366"><a href="#cb62-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-367"><a href="#cb62-367" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-368"><a href="#cb62-368" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-369"><a href="#cb62-369" aria-hidden="true" tabindex="-1"></a>\rho(\neg OC, OC)</span>
<span id="cb62-370"><a href="#cb62-370" aria-hidden="true" tabindex="-1"></a>&amp;=\frac{\ph(MI|\neg OC)}{\ph(MI|OC)}<span class="sc">\\</span></span>
<span id="cb62-371"><a href="#cb62-371" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{<span class="in">`r 7/10000`</span>}{<span class="in">`r 13/5000`</span>}<span class="sc">\\</span></span>
<span id="cb62-372"><a href="#cb62-372" aria-hidden="true" tabindex="-1"></a>&amp;= <span class="in">`r (7/10000)/(13/5000)`</span><span class="sc">\\</span></span>
<span id="cb62-373"><a href="#cb62-373" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{1}{\rho(OC, \neg OC)}</span>
<span id="cb62-374"><a href="#cb62-374" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-375"><a href="#cb62-375" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-376"><a href="#cb62-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-377"><a href="#cb62-377" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-378"><a href="#cb62-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-379"><a href="#cb62-379" aria-hidden="true" tabindex="-1"></a><span class="fu">## Odds and Odds Ratios</span></span>
<span id="cb62-380"><a href="#cb62-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-381"><a href="#cb62-381" aria-hidden="true" tabindex="-1"></a>{{&lt; include _sec_odds.qmd &gt;}}</span>
<span id="cb62-382"><a href="#cb62-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-383"><a href="#cb62-383" aria-hidden="true" tabindex="-1"></a><span class="fu">## The logit and expit functions</span></span>
<span id="cb62-384"><a href="#cb62-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-385"><a href="#cb62-385" aria-hidden="true" tabindex="-1"></a><span class="fu">### The logit function</span></span>
<span id="cb62-386"><a href="#cb62-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-387"><a href="#cb62-387" aria-hidden="true" tabindex="-1"></a>:::{#def-logit}</span>
<span id="cb62-388"><a href="#cb62-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-389"><a href="#cb62-389" aria-hidden="true" tabindex="-1"></a><span class="fu">#### logit function</span></span>
<span id="cb62-390"><a href="#cb62-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-391"><a href="#cb62-391" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-392"><a href="#cb62-392" aria-hidden="true" tabindex="-1"></a>The **logit function**  of a probability $\pi$ is </span>
<span id="cb62-393"><a href="#cb62-393" aria-hidden="true" tabindex="-1"></a>the natural logarithm of the odds function of $\pi$:</span>
<span id="cb62-394"><a href="#cb62-394" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-395"><a href="#cb62-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-396"><a href="#cb62-396" aria-hidden="true" tabindex="-1"></a>$$\logit(\pi) \eqdef \log{\odds(\pi)}$$</span>
<span id="cb62-397"><a href="#cb62-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-398"><a href="#cb62-398" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-399"><a href="#cb62-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-400"><a href="#cb62-400" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-401"><a href="#cb62-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-402"><a href="#cb62-402" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-403"><a href="#cb62-403" aria-hidden="true" tabindex="-1"></a>@fig-logit shows the shape of the $\logit()$ function.</span>
<span id="cb62-404"><a href="#cb62-404" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-405"><a href="#cb62-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-408"><a href="#cb62-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-409"><a href="#cb62-409" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb62-410"><a href="#cb62-410" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The logit function"</span></span>
<span id="cb62-411"><a href="#cb62-411" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logit</span></span>
<span id="cb62-412"><a href="#cb62-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-413"><a href="#cb62-413" aria-hidden="true" tabindex="-1"></a>odds <span class="ot">&lt;-</span> <span class="cf">function</span>(pi) pi <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pi)</span>
<span id="cb62-414"><a href="#cb62-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-415"><a href="#cb62-415" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(p) <span class="fu">log</span>(<span class="fu">odds</span>(p))</span>
<span id="cb62-416"><a href="#cb62-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-417"><a href="#cb62-417" aria-hidden="true" tabindex="-1"></a>logit_plot <span class="ot">&lt;-</span></span>
<span id="cb62-418"><a href="#cb62-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-419"><a href="#cb62-419" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-420"><a href="#cb62-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> logit,</span>
<span id="cb62-421"><a href="#cb62-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"both"</span>)</span>
<span id="cb62-422"><a href="#cb62-422" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-423"><a href="#cb62-423" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(.<span class="dv">001</span>, .<span class="dv">999</span>) <span class="sc">+</span></span>
<span id="cb62-424"><a href="#cb62-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"logit(p)"</span>) <span class="sc">+</span></span>
<span id="cb62-425"><a href="#cb62-425" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"p"</span>) <span class="sc">+</span></span>
<span id="cb62-426"><a href="#cb62-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb62-427"><a href="#cb62-427" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(logit_plot)</span>
<span id="cb62-428"><a href="#cb62-428" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-429"><a href="#cb62-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-430"><a href="#cb62-430" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-431"><a href="#cb62-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-432"><a href="#cb62-432" aria-hidden="true" tabindex="-1"></a>:::{#thm-logit-function}</span>
<span id="cb62-433"><a href="#cb62-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-434"><a href="#cb62-434" aria-hidden="true" tabindex="-1"></a>$$\logit(\pi) = \log{\frac{\pi}{1-\pi}}$${#eq-logit}</span>
<span id="cb62-435"><a href="#cb62-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-436"><a href="#cb62-436" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-437"><a href="#cb62-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-438"><a href="#cb62-438" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-439"><a href="#cb62-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-440"><a href="#cb62-440" aria-hidden="true" tabindex="-1"></a>:::{#exr-prove-eq-logit}</span>
<span id="cb62-441"><a href="#cb62-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-442"><a href="#cb62-442" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Compose the logit function</span></span>
<span id="cb62-443"><a href="#cb62-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-444"><a href="#cb62-444" aria-hidden="true" tabindex="-1"></a>Prove @thm-logit-function.</span>
<span id="cb62-445"><a href="#cb62-445" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-446"><a href="#cb62-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-447"><a href="#cb62-447" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-448"><a href="#cb62-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-449"><a href="#cb62-449" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-450"><a href="#cb62-450" aria-hidden="true" tabindex="-1"></a>Apply @def-logit and then @def-odds (details left to the reader).</span>
<span id="cb62-451"><a href="#cb62-451" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-452"><a href="#cb62-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-453"><a href="#cb62-453" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-454"><a href="#cb62-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-455"><a href="#cb62-455" aria-hidden="true" tabindex="-1"></a>:::{#thm-deriv-logit}</span>
<span id="cb62-456"><a href="#cb62-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-457"><a href="#cb62-457" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Derivative of logit function</span></span>
<span id="cb62-458"><a href="#cb62-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-459"><a href="#cb62-459" aria-hidden="true" tabindex="-1"></a>$$\logit'(\pi) = \frac{1}{(\pi)(1-\pi)}$$</span>
<span id="cb62-460"><a href="#cb62-460" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-461"><a href="#cb62-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-462"><a href="#cb62-462" aria-hidden="true" tabindex="-1"></a>--- </span>
<span id="cb62-463"><a href="#cb62-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-464"><a href="#cb62-464" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-465"><a href="#cb62-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-466"><a href="#cb62-466" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-467"><a href="#cb62-467" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-468"><a href="#cb62-468" aria-hidden="true" tabindex="-1"></a>\logit'(\pi)</span>
<span id="cb62-469"><a href="#cb62-469" aria-hidden="true" tabindex="-1"></a>   &amp;= \deriv{\pi}\logit(\pi)</span>
<span id="cb62-470"><a href="#cb62-470" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \deriv{\pi}\log{\odds(\pi)}</span>
<span id="cb62-471"><a href="#cb62-471" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{\odds'(\pi)}{\odds(\pi)}</span>
<span id="cb62-472"><a href="#cb62-472" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \odds'(\pi) \frac{1}{\odds(\pi)}</span>
<span id="cb62-473"><a href="#cb62-473" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{\sqf{1-\pi}}\frac{1-\pi}{\pi}</span>
<span id="cb62-474"><a href="#cb62-474" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{(\pi)(1-\pi)}</span>
<span id="cb62-475"><a href="#cb62-475" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-476"><a href="#cb62-476" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-477"><a href="#cb62-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-478"><a href="#cb62-478" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-479"><a href="#cb62-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-480"><a href="#cb62-480" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-481"><a href="#cb62-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-482"><a href="#cb62-482" aria-hidden="true" tabindex="-1"></a><span class="fu">### The expit function</span></span>
<span id="cb62-483"><a href="#cb62-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-484"><a href="#cb62-484" aria-hidden="true" tabindex="-1"></a>:::{#def-expit}</span>
<span id="cb62-485"><a href="#cb62-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-486"><a href="#cb62-486" aria-hidden="true" tabindex="-1"></a><span class="fu">#### expit, logistic, inverse-logit</span></span>
<span id="cb62-487"><a href="#cb62-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-488"><a href="#cb62-488" aria-hidden="true" tabindex="-1"></a>The **expit function** (@fig-expit-plot) of a log-odds $\logodds$, also known as the **inverse-logit function** or **logistic function**, is the inverse-odds of the exponential of $\logodds$:</span>
<span id="cb62-489"><a href="#cb62-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-490"><a href="#cb62-490" aria-hidden="true" tabindex="-1"></a>$$\expit(\logodds) \eqdef \oddsinvf{\expf{\logodds}}$$</span>
<span id="cb62-491"><a href="#cb62-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-492"><a href="#cb62-492" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-493"><a href="#cb62-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-496"><a href="#cb62-496" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-497"><a href="#cb62-497" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-expit-plot</span></span>
<span id="cb62-498"><a href="#cb62-498" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: The expit function</span></span>
<span id="cb62-499"><a href="#cb62-499" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb62-500"><a href="#cb62-500" aria-hidden="true" tabindex="-1"></a>expit <span class="ot">&lt;-</span> <span class="cf">function</span>(eta) {</span>
<span id="cb62-501"><a href="#cb62-501" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(eta) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(eta))</span>
<span id="cb62-502"><a href="#cb62-502" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-503"><a href="#cb62-503" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-504"><a href="#cb62-504" aria-hidden="true" tabindex="-1"></a>expit_plot <span class="ot">&lt;-</span></span>
<span id="cb62-505"><a href="#cb62-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-506"><a href="#cb62-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-507"><a href="#cb62-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> expit,</span>
<span id="cb62-508"><a href="#cb62-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"both"</span>)</span>
<span id="cb62-509"><a href="#cb62-509" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-510"><a href="#cb62-510" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb62-511"><a href="#cb62-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-512"><a href="#cb62-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">expit</span>(eta))) <span class="sc">+</span></span>
<span id="cb62-513"><a href="#cb62-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(eta)) <span class="sc">+</span></span>
<span id="cb62-514"><a href="#cb62-514" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb62-515"><a href="#cb62-515" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(expit_plot)</span>
<span id="cb62-516"><a href="#cb62-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-517"><a href="#cb62-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-518"><a href="#cb62-518" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-519"><a href="#cb62-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-520"><a href="#cb62-520" aria-hidden="true" tabindex="-1"></a>:::{#thm-logit-expit}</span>
<span id="cb62-521"><a href="#cb62-521" aria-hidden="true" tabindex="-1"></a><span class="fu">#### logit and expit are each others' inverses</span></span>
<span id="cb62-522"><a href="#cb62-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-523"><a href="#cb62-523" aria-hidden="true" tabindex="-1"></a>$$\logitf{\expitf{\logodds}} = \logodds$$</span>
<span id="cb62-524"><a href="#cb62-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-525"><a href="#cb62-525" aria-hidden="true" tabindex="-1"></a>$$\expitf{\logitf{\pi}} = \pi$$</span>
<span id="cb62-526"><a href="#cb62-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-527"><a href="#cb62-527" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-528"><a href="#cb62-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-529"><a href="#cb62-529" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-530"><a href="#cb62-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-531"><a href="#cb62-531" aria-hidden="true" tabindex="-1"></a>:::{.proof}</span>
<span id="cb62-532"><a href="#cb62-532" aria-hidden="true" tabindex="-1"></a>Left to the reader.</span>
<span id="cb62-533"><a href="#cb62-533" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-534"><a href="#cb62-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-535"><a href="#cb62-535" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-536"><a href="#cb62-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-537"><a href="#cb62-537" aria-hidden="true" tabindex="-1"></a>:::{#thm-expit}</span>
<span id="cb62-538"><a href="#cb62-538" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-539"><a href="#cb62-539" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Expressions for expit function</span></span>
<span id="cb62-540"><a href="#cb62-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-541"><a href="#cb62-541" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-542"><a href="#cb62-542" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-543"><a href="#cb62-543" aria-hidden="true" tabindex="-1"></a>\expit(\logodds) </span>
<span id="cb62-544"><a href="#cb62-544" aria-hidden="true" tabindex="-1"></a>   &amp;= \frac{\exp{\logodds}}{1+\exp{\logodds}}</span>
<span id="cb62-545"><a href="#cb62-545" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= (1 + \exp{-\logodds})^{-1}</span>
<span id="cb62-546"><a href="#cb62-546" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-547"><a href="#cb62-547" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-548"><a href="#cb62-548" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-549"><a href="#cb62-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-550"><a href="#cb62-550" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-551"><a href="#cb62-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-552"><a href="#cb62-552" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-553"><a href="#cb62-553" aria-hidden="true" tabindex="-1"></a>Apply definitions and @lem-invodds-simplified.</span>
<span id="cb62-554"><a href="#cb62-554" aria-hidden="true" tabindex="-1"></a>Details left to the reader.</span>
<span id="cb62-555"><a href="#cb62-555" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-556"><a href="#cb62-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-557"><a href="#cb62-557" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-558"><a href="#cb62-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-559"><a href="#cb62-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-560"><a href="#cb62-560" aria-hidden="true" tabindex="-1"></a>:::{#lem-one-minus-expit}</span>
<span id="cb62-561"><a href="#cb62-561" aria-hidden="true" tabindex="-1"></a>$$1-\expitf{\logodds} = \inv{1+\exp{\logodds}}$$</span>
<span id="cb62-562"><a href="#cb62-562" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-563"><a href="#cb62-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-564"><a href="#cb62-564" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-565"><a href="#cb62-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-566"><a href="#cb62-566" aria-hidden="true" tabindex="-1"></a>::: {.proof}</span>
<span id="cb62-567"><a href="#cb62-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-568"><a href="#cb62-568" aria-hidden="true" tabindex="-1"></a>Using @lem-one-minus-odds-inv:</span>
<span id="cb62-569"><a href="#cb62-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-570"><a href="#cb62-570" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-571"><a href="#cb62-571" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-572"><a href="#cb62-572" aria-hidden="true" tabindex="-1"></a>1 - \expitf{\logodds} &amp;= 1 - \oddsinvf{\expf{\logodds}}</span>
<span id="cb62-573"><a href="#cb62-573" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{1}{1+\expf{\logodds}}</span>
<span id="cb62-574"><a href="#cb62-574" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \inv{1 + \exp{\logodds}}</span>
<span id="cb62-575"><a href="#cb62-575" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-576"><a href="#cb62-576" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-577"><a href="#cb62-577" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-578"><a href="#cb62-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-579"><a href="#cb62-579" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-580"><a href="#cb62-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-581"><a href="#cb62-581" aria-hidden="true" tabindex="-1"></a>:::{#lem-deriv-expit}</span>
<span id="cb62-582"><a href="#cb62-582" aria-hidden="true" tabindex="-1"></a>$$\dexpitf{\logodds} = (\expitf{\logodds}) (1 - \expitf{\logodds})$$</span>
<span id="cb62-583"><a href="#cb62-583" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-584"><a href="#cb62-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-585"><a href="#cb62-585" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-586"><a href="#cb62-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-587"><a href="#cb62-587" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-588"><a href="#cb62-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-589"><a href="#cb62-589" aria-hidden="true" tabindex="-1"></a>Using @thm-deriv-invodds:</span>
<span id="cb62-590"><a href="#cb62-590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-591"><a href="#cb62-591" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-592"><a href="#cb62-592" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-593"><a href="#cb62-593" aria-hidden="true" tabindex="-1"></a>\dexpitf{\logodds}</span>
<span id="cb62-594"><a href="#cb62-594" aria-hidden="true" tabindex="-1"></a>   &amp;= \deriv{\logodds} \expitf{\logodds}   </span>
<span id="cb62-595"><a href="#cb62-595" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \deriv{\logodds} \invoddsf{\expf{\logodds}}</span>
<span id="cb62-596"><a href="#cb62-596" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \dinvoddsf{\expf{\logodds}}  \deriv{\logodds}\expf{\logodds}</span>
<span id="cb62-597"><a href="#cb62-597" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=  \frac{1}{\sqf{1 + \expf{\logodds}}} \expf{\logodds}</span>
<span id="cb62-598"><a href="#cb62-598" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=  \frac{\expf{\logodds}}{\sqf{1 + \expf{\logodds}}} </span>
<span id="cb62-599"><a href="#cb62-599" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=  \frac{\expf{\logodds}}{1 + \expf{\logodds}} \frac{1}{1 + \expf{\logodds}} </span>
<span id="cb62-600"><a href="#cb62-600" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=  \expitf{\logodds} (1-\expitf{\logodds})</span>
<span id="cb62-601"><a href="#cb62-601" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-602"><a href="#cb62-602" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-603"><a href="#cb62-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-604"><a href="#cb62-604" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-605"><a href="#cb62-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-606"><a href="#cb62-606" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-607"><a href="#cb62-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-608"><a href="#cb62-608" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-609"><a href="#cb62-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-610"><a href="#cb62-610" aria-hidden="true" tabindex="-1"></a>Alternatively, we can use @thm-expit:</span>
<span id="cb62-611"><a href="#cb62-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-612"><a href="#cb62-612" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-613"><a href="#cb62-613" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-614"><a href="#cb62-614" aria-hidden="true" tabindex="-1"></a>\dexpitf{\logodds}</span>
<span id="cb62-615"><a href="#cb62-615" aria-hidden="true" tabindex="-1"></a>   &amp;= \deriv{\logodds} \expitf{\logodds}</span>
<span id="cb62-616"><a href="#cb62-616" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \deriv{\logodds} (1 + \exp{-\logodds})^{-1}</span>
<span id="cb62-617"><a href="#cb62-617" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= -(1 + \exp{-\logodds})^{-2} \deriv{\logodds} (1 + \exp{-\logodds})</span>
<span id="cb62-618"><a href="#cb62-618" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= -(1 + \exp{-\logodds})^{-2} (-\exp{-\logodds})</span>
<span id="cb62-619"><a href="#cb62-619" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= (1 + \exp{-\logodds})^{-2} (\exp{-\logodds})</span>
<span id="cb62-620"><a href="#cb62-620" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= (1 + \exp{-\logodds})^{-1} \frac{\exp{-\logodds}}{1 + \exp{-\logodds}}</span>
<span id="cb62-621"><a href="#cb62-621" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= (1 + \exp{-\logodds})^{-1} \frac{1}{1 + \exp{\logodds}}</span>
<span id="cb62-622"><a href="#cb62-622" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \expitf{\logodds} (1-\expitf{\logodds})</span>
<span id="cb62-623"><a href="#cb62-623" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-624"><a href="#cb62-624" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-625"><a href="#cb62-625" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-626"><a href="#cb62-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-627"><a href="#cb62-627" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagram of expit and logit {#sec-expit-logit-diagram}</span></span>
<span id="cb62-628"><a href="#cb62-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-629"><a href="#cb62-629" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-630"><a href="#cb62-630" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-631"><a href="#cb62-631" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot"> \pi  \eqdef\Pr(Y=1)\right</span><span class="co">]</span></span>
<span id="cb62-632"><a href="#cb62-632" aria-hidden="true" tabindex="-1"></a>\underbrace{</span>
<span id="cb62-633"><a href="#cb62-633" aria-hidden="true" tabindex="-1"></a>\overbrace{</span>
<span id="cb62-634"><a href="#cb62-634" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb62-635"><a href="#cb62-635" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot"> \frac{\odds}{1+\odds}</span><span class="co">]</span>{}</span>
<span id="cb62-636"><a href="#cb62-636" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-637"><a href="#cb62-637" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb62-638"><a href="#cb62-638" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\frac{\pi}{1-\pi}}</span>
<span id="cb62-639"><a href="#cb62-639" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-640"><a href="#cb62-640" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot">\odds \eqdef \text{odds}(Y=1)\right</span><span class="co">]</span></span>
<span id="cb62-641"><a href="#cb62-641" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb62-642"><a href="#cb62-642" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot">\exp{\logodds}</span><span class="co">]</span>{}</span>
<span id="cb62-643"><a href="#cb62-643" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-644"><a href="#cb62-644" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb62-645"><a href="#cb62-645" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\log{\odds}}</span>
<span id="cb62-646"><a href="#cb62-646" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-647"><a href="#cb62-647" aria-hidden="true" tabindex="-1"></a>}^{\logit(\pi)}</span>
<span id="cb62-648"><a href="#cb62-648" aria-hidden="true" tabindex="-1"></a>}_{\expit(\logodds)}</span>
<span id="cb62-649"><a href="#cb62-649" aria-hidden="true" tabindex="-1"></a>\left<span class="co">[</span><span class="ot">\logodds \eqdef \text{log-odds}(Y=1)\right</span><span class="co">]</span></span>
<span id="cb62-650"><a href="#cb62-650" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-651"><a href="#cb62-651" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-652"><a href="#cb62-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-653"><a href="#cb62-653" aria-hidden="true" tabindex="-1"></a>::: {.content-hidden when-format="pdf"}</span>
<span id="cb62-654"><a href="#cb62-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-655"><a href="#cb62-655" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-656"><a href="#cb62-656" aria-hidden="true" tabindex="-1"></a>\underbrace{\pi}_{\atop{\Pr(Y=1)} }</span>
<span id="cb62-657"><a href="#cb62-657" aria-hidden="true" tabindex="-1"></a>\overbrace{</span>
<span id="cb62-658"><a href="#cb62-658" aria-hidden="true" tabindex="-1"></a>\underbrace{</span>
<span id="cb62-659"><a href="#cb62-659" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb62-660"><a href="#cb62-660" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot">\frac{\odds}{1+\odds}</span><span class="co">]</span>{}</span>
<span id="cb62-661"><a href="#cb62-661" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-662"><a href="#cb62-662" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb62-663"><a href="#cb62-663" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\frac{\pi}{1-\pi}}</span>
<span id="cb62-664"><a href="#cb62-664" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-665"><a href="#cb62-665" aria-hidden="true" tabindex="-1"></a>\underbrace{\odds}_{\text{odds}(Y=1)}</span>
<span id="cb62-666"><a href="#cb62-666" aria-hidden="true" tabindex="-1"></a>\underset{</span>
<span id="cb62-667"><a href="#cb62-667" aria-hidden="true" tabindex="-1"></a>\xleftarrow<span class="co">[</span><span class="ot">\exp{\logodds}</span><span class="co">]</span>{}</span>
<span id="cb62-668"><a href="#cb62-668" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-669"><a href="#cb62-669" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb62-670"><a href="#cb62-670" aria-hidden="true" tabindex="-1"></a>\xrightarrow{\log{\odds}}</span>
<span id="cb62-671"><a href="#cb62-671" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-672"><a href="#cb62-672" aria-hidden="true" tabindex="-1"></a>}_{\expit(\logodds)}</span>
<span id="cb62-673"><a href="#cb62-673" aria-hidden="true" tabindex="-1"></a>}^{\logit(\pi)}</span>
<span id="cb62-674"><a href="#cb62-674" aria-hidden="true" tabindex="-1"></a>\underbrace{\logodds}_{\atop{\text{log-odds}(Y=1)}}</span>
<span id="cb62-675"><a href="#cb62-675" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-676"><a href="#cb62-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-677"><a href="#cb62-677" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-678"><a href="#cb62-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-679"><a href="#cb62-679" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction to logistic regression</span></span>
<span id="cb62-680"><a href="#cb62-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-681"><a href="#cb62-681" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-682"><a href="#cb62-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-683"><a href="#cb62-683" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In @exm-oc-mi, we estimated the risk and the odds of MI for two groups, </span>
<span id="cb62-684"><a href="#cb62-684" aria-hidden="true" tabindex="-1"></a>defined by oral contraceptive use.</span>
<span id="cb62-685"><a href="#cb62-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-686"><a href="#cb62-686" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>If the predictor is quantitative (dose) or there is more than one predictor, the task becomes more difficult.</span>
<span id="cb62-687"><a href="#cb62-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-688"><a href="#cb62-688" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>In this case, we will use logistic regression, which is a generalization of the linear regression models you have been using that can account for a binary response instead of a continuous one.</span>
<span id="cb62-689"><a href="#cb62-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-690"><a href="#cb62-690" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-691"><a href="#cb62-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-692"><a href="#cb62-692" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary outcomes models - one group, no covariates {.smaller}</span></span>
<span id="cb62-693"><a href="#cb62-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-694"><a href="#cb62-694" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-695"><a href="#cb62-695" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-696"><a href="#cb62-696" aria-hidden="true" tabindex="-1"></a>\P(Y=1) &amp;= \pi<span class="sc">\\</span></span>
<span id="cb62-697"><a href="#cb62-697" aria-hidden="true" tabindex="-1"></a>\P(Y=0) &amp;= 1-\pi<span class="sc">\\</span></span>
<span id="cb62-698"><a href="#cb62-698" aria-hidden="true" tabindex="-1"></a>\P(Y=y) &amp;= \pi^y (1-\pi)^{1-y}<span class="sc">\\</span></span>
<span id="cb62-699"><a href="#cb62-699" aria-hidden="true" tabindex="-1"></a>\mathbf y  &amp;= (y_1, ..., y_n)<span class="sc">\\</span></span>
<span id="cb62-700"><a href="#cb62-700" aria-hidden="true" tabindex="-1"></a>\mathcal L(\pi;\mathbf y) &amp;= \pi^{\sum y_i} (1-\pi)^{n - \sum y_i}<span class="sc">\\</span></span>
<span id="cb62-701"><a href="#cb62-701" aria-hidden="true" tabindex="-1"></a>\ell(\pi, \mathbf y) &amp;= \left({\sum y_i}\right) \log{\pi} + \left(n - \sum y_i\right) \log{1-\pi}<span class="sc">\\</span></span>
<span id="cb62-702"><a href="#cb62-702" aria-hidden="true" tabindex="-1"></a>&amp;= \left({\sum y_i}\right) \left(\log{\pi} - \log{1-\pi}\right) + n \cdot \log{1-\pi}<span class="sc">\\</span></span>
<span id="cb62-703"><a href="#cb62-703" aria-hidden="true" tabindex="-1"></a>&amp;= \left({\sum y_i}\right) \log{\frac{\pi}{ 1-\pi}} + n \cdot \log{1-\pi}</span>
<span id="cb62-704"><a href="#cb62-704" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \left({\sum y_i}\right) \logit(\pi) + n \cdot \log{1-\pi}</span>
<span id="cb62-705"><a href="#cb62-705" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-706"><a href="#cb62-706" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-707"><a href="#cb62-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-708"><a href="#cb62-708" aria-hidden="true" tabindex="-1"></a><span class="fu">### Binary outcomes - general  {.smaller}</span></span>
<span id="cb62-709"><a href="#cb62-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-710"><a href="#cb62-710" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-711"><a href="#cb62-711" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-712"><a href="#cb62-712" aria-hidden="true" tabindex="-1"></a>\P(Y_i=1) &amp;= \pi_i</span>
<span id="cb62-713"><a href="#cb62-713" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> \P(Y_i=0) &amp;= 1-\pi_i</span>
<span id="cb62-714"><a href="#cb62-714" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-715"><a href="#cb62-715" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-716"><a href="#cb62-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-717"><a href="#cb62-717" aria-hidden="true" tabindex="-1"></a>$$\P(Y_i=y_i) = (\pi_i)^y_i (1-\pi_i)^{1-y_i}$$</span>
<span id="cb62-718"><a href="#cb62-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-719"><a href="#cb62-719" aria-hidden="true" tabindex="-1"></a>$$\Lik_i(\pi_i) = \P(Y_i=y_i)$$</span>
<span id="cb62-720"><a href="#cb62-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-721"><a href="#cb62-721" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-722"><a href="#cb62-722" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-723"><a href="#cb62-723" aria-hidden="true" tabindex="-1"></a>\ell_i(\pi_i) </span>
<span id="cb62-724"><a href="#cb62-724" aria-hidden="true" tabindex="-1"></a>   &amp;= \log{\Lik_i(\pi_i)}</span>
<span id="cb62-725"><a href="#cb62-725" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i \log{\pi_i} + (1-y_i) \log{1-\pi_i}</span>
<span id="cb62-726"><a href="#cb62-726" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-727"><a href="#cb62-727" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-728"><a href="#cb62-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-729"><a href="#cb62-729" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-730"><a href="#cb62-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-731"><a href="#cb62-731" aria-hidden="true" tabindex="-1"></a>For $\iid$ data $\vec y  = (y_1, ..., y_n)$:</span>
<span id="cb62-732"><a href="#cb62-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-733"><a href="#cb62-733" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-734"><a href="#cb62-734" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-735"><a href="#cb62-735" aria-hidden="true" tabindex="-1"></a>\Lik(\pi;\vec y) &amp;= \P(\dsvn{Y}{y})</span>
<span id="cb62-736"><a href="#cb62-736" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \prod_{i=1}^n \P(Y_i=y_i)</span>
<span id="cb62-737"><a href="#cb62-737" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \prod_{i=1}^n \Lik_i(\pi_i) </span>
<span id="cb62-738"><a href="#cb62-738" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-739"><a href="#cb62-739" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-740"><a href="#cb62-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-741"><a href="#cb62-741" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modeling $\pi_i$ as a function of $X_i$</span></span>
<span id="cb62-742"><a href="#cb62-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-743"><a href="#cb62-743" aria-hidden="true" tabindex="-1"></a>If there are only a few distinct $X_i$ values, we can model $\pi_i$</span>
<span id="cb62-744"><a href="#cb62-744" aria-hidden="true" tabindex="-1"></a>separately for each value of $X_i$.</span>
<span id="cb62-745"><a href="#cb62-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-746"><a href="#cb62-746" aria-hidden="true" tabindex="-1"></a>Otherwise, we need regression.</span>
<span id="cb62-747"><a href="#cb62-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-748"><a href="#cb62-748" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-749"><a href="#cb62-749" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-750"><a href="#cb62-750" aria-hidden="true" tabindex="-1"></a>\pi(x) &amp;\equiv \text{E}(Y=1|X=x)<span class="sc">\\</span></span>
<span id="cb62-751"><a href="#cb62-751" aria-hidden="true" tabindex="-1"></a>&amp;= f(x^\top\beta)</span>
<span id="cb62-752"><a href="#cb62-752" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-753"><a href="#cb62-753" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-754"><a href="#cb62-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-755"><a href="#cb62-755" aria-hidden="true" tabindex="-1"></a>Typically, we use the $\expit$ inverse-link: </span>
<span id="cb62-756"><a href="#cb62-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-757"><a href="#cb62-757" aria-hidden="true" tabindex="-1"></a>$$\pi(\vec x) = \expit(\vx'\beta)$${#eq-logistic-link}</span>
<span id="cb62-758"><a href="#cb62-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-759"><a href="#cb62-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-760"><a href="#cb62-760" aria-hidden="true" tabindex="-1"></a><span class="fu">### Meet the beetles</span></span>
<span id="cb62-761"><a href="#cb62-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-762"><a href="#cb62-762" aria-hidden="true" tabindex="-1"></a>:::{#fig-beetles_1a}</span>
<span id="cb62-763"><a href="#cb62-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-766"><a href="#cb62-766" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-767"><a href="#cb62-767" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmx)</span>
<span id="cb62-768"><a href="#cb62-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-769"><a href="#cb62-769" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(BeetleMortality, <span class="at">package =</span> <span class="st">"glmx"</span>)</span>
<span id="cb62-770"><a href="#cb62-770" aria-hidden="true" tabindex="-1"></a>beetles <span class="ot">&lt;-</span> BeetleMortality <span class="sc">|&gt;</span></span>
<span id="cb62-771"><a href="#cb62-771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-772"><a href="#cb62-772" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct =</span> died <span class="sc">/</span> n,</span>
<span id="cb62-773"><a href="#cb62-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">survived =</span> n <span class="sc">-</span> died</span>
<span id="cb62-774"><a href="#cb62-774" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-775"><a href="#cb62-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-776"><a href="#cb62-776" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span></span>
<span id="cb62-777"><a href="#cb62-777" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span></span>
<span id="cb62-778"><a href="#cb62-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> pct)) <span class="sc">+</span></span>
<span id="cb62-779"><a href="#cb62-779" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n)) <span class="sc">+</span></span>
<span id="cb62-780"><a href="#cb62-780" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Dose (log mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb62-781"><a href="#cb62-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Mortality rate (%)"</span>) <span class="sc">+</span></span>
<span id="cb62-782"><a href="#cb62-782" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb62-783"><a href="#cb62-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb62-784"><a href="#cb62-784" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">18</span>)</span>
<span id="cb62-785"><a href="#cb62-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-786"><a href="#cb62-786" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plot1)</span>
<span id="cb62-787"><a href="#cb62-787" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-788"><a href="#cb62-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-789"><a href="#cb62-789" aria-hidden="true" tabindex="-1"></a>Mortality rates of adult flour beetles after five hours' exposure to gaseous carbon disulphide (Bliss 1935)</span>
<span id="cb62-790"><a href="#cb62-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-791"><a href="#cb62-791" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-792"><a href="#cb62-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-793"><a href="#cb62-793" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why don't we use linear regression?</span></span>
<span id="cb62-794"><a href="#cb62-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-795"><a href="#cb62-795" aria-hidden="true" tabindex="-1"></a>:::{#fig-beetles_2}</span>
<span id="cb62-796"><a href="#cb62-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-799"><a href="#cb62-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-800"><a href="#cb62-800" aria-hidden="true" tabindex="-1"></a>beetles_long <span class="ot">&lt;-</span> beetles <span class="sc">|&gt;</span></span>
<span id="cb62-801"><a href="#cb62-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb62-802"><a href="#cb62-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">everything</span>(),</span>
<span id="cb62-803"><a href="#cb62-803" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome =</span> <span class="fu">c</span>(</span>
<span id="cb62-804"><a href="#cb62-804" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">1</span>, <span class="at">times =</span> died),</span>
<span id="cb62-805"><a href="#cb62-805" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rep</span>(<span class="dv">0</span>, <span class="at">times =</span> survived)</span>
<span id="cb62-806"><a href="#cb62-806" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-807"><a href="#cb62-807" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-808"><a href="#cb62-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb62-809"><a href="#cb62-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-810"><a href="#cb62-810" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> beetles_long <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> dose)</span>
<span id="cb62-811"><a href="#cb62-811" aria-hidden="true" tabindex="-1"></a>f_linear <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm1, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb62-812"><a href="#cb62-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-813"><a href="#cb62-813" aria-hidden="true" tabindex="-1"></a>range1 <span class="ot">&lt;-</span> <span class="fu">range</span>(beetles<span class="sc">$</span>dose) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, .<span class="dv">2</span>)</span>
<span id="cb62-814"><a href="#cb62-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-815"><a href="#cb62-815" aria-hidden="true" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span></span>
<span id="cb62-816"><a href="#cb62-816" aria-hidden="true" tabindex="-1"></a>  plot1 <span class="sc">+</span></span>
<span id="cb62-817"><a href="#cb62-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-818"><a href="#cb62-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> f_linear,</span>
<span id="cb62-819"><a href="#cb62-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Straight line"</span>)</span>
<span id="cb62-820"><a href="#cb62-820" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-821"><a href="#cb62-821" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Model"</span>, <span class="at">size =</span> <span class="st">""</span>)</span>
<span id="cb62-822"><a href="#cb62-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-823"><a href="#cb62-823" aria-hidden="true" tabindex="-1"></a>plot2 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-824"><a href="#cb62-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-825"><a href="#cb62-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-826"><a href="#cb62-826" aria-hidden="true" tabindex="-1"></a>Mortality rates of adult flour beetles after five hours' exposure to gaseous carbon disulphide (Bliss 1935)</span>
<span id="cb62-827"><a href="#cb62-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-828"><a href="#cb62-828" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-829"><a href="#cb62-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-830"><a href="#cb62-830" aria-hidden="true" tabindex="-1"></a><span class="fu">### Zoom out</span></span>
<span id="cb62-831"><a href="#cb62-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-832"><a href="#cb62-832" aria-hidden="true" tabindex="-1"></a>:::{#fig-beetles_3}</span>
<span id="cb62-833"><a href="#cb62-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-836"><a href="#cb62-836" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-837"><a href="#cb62-837" aria-hidden="true" tabindex="-1"></a>(plot2 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-838"><a href="#cb62-838" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-839"><a href="#cb62-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-840"><a href="#cb62-840" aria-hidden="true" tabindex="-1"></a>Mortality rates of adult flour beetles after five hours' exposure to gaseous carbon disulphide (Bliss 1935)</span>
<span id="cb62-841"><a href="#cb62-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-842"><a href="#cb62-842" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-843"><a href="#cb62-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-844"><a href="#cb62-844" aria-hidden="true" tabindex="-1"></a><span class="fu">### log transformation of dose?</span></span>
<span id="cb62-845"><a href="#cb62-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-846"><a href="#cb62-846" aria-hidden="true" tabindex="-1"></a>:::{#fig-beetles_4}</span>
<span id="cb62-847"><a href="#cb62-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-850"><a href="#cb62-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-851"><a href="#cb62-851" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> beetles_long <span class="sc">|&gt;</span> <span class="fu">lm</span>(<span class="at">formula =</span> outcome <span class="sc">~</span> <span class="fu">log</span>(dose))</span>
<span id="cb62-852"><a href="#cb62-852" aria-hidden="true" tabindex="-1"></a>f_linearlog <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">predict</span>(lm2, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x))</span>
<span id="cb62-853"><a href="#cb62-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-854"><a href="#cb62-854" aria-hidden="true" tabindex="-1"></a>plot3 <span class="ot">&lt;-</span> plot2 <span class="sc">+</span></span>
<span id="cb62-855"><a href="#cb62-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb62-856"><a href="#cb62-856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun =</span> f_linearlog, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Log-transform dose"</span>))</span>
<span id="cb62-857"><a href="#cb62-857" aria-hidden="true" tabindex="-1"></a>(plot3 <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">1.6</span>, <span class="dv">2</span>))) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-858"><a href="#cb62-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-859"><a href="#cb62-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-860"><a href="#cb62-860" aria-hidden="true" tabindex="-1"></a>Mortality rates of adult flour beetles after five hours' exposure to gaseous carbon disulphide (Bliss 1935)</span>
<span id="cb62-861"><a href="#cb62-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-862"><a href="#cb62-862" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-863"><a href="#cb62-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-864"><a href="#cb62-864" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression</span></span>
<span id="cb62-865"><a href="#cb62-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-866"><a href="#cb62-866" aria-hidden="true" tabindex="-1"></a>:::{#fig-beetles_5}</span>
<span id="cb62-867"><a href="#cb62-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-870"><a href="#cb62-870" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-871"><a href="#cb62-871" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">&lt;-</span> beetles <span class="sc">|&gt;</span></span>
<span id="cb62-872"><a href="#cb62-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(<span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb62-873"><a href="#cb62-873" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb62-874"><a href="#cb62-874" aria-hidden="true" tabindex="-1"></a>  beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-875"><a href="#cb62-875" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(<span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> x), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb62-876"><a href="#cb62-876" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-877"><a href="#cb62-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-878"><a href="#cb62-878" aria-hidden="true" tabindex="-1"></a>plot4 <span class="ot">&lt;-</span> plot3 <span class="sc">+</span> <span class="fu">geom_function</span>(<span class="at">fun =</span> f, <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Logistic regression"</span>))</span>
<span id="cb62-879"><a href="#cb62-879" aria-hidden="true" tabindex="-1"></a>plot4 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-880"><a href="#cb62-880" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-881"><a href="#cb62-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-882"><a href="#cb62-882" aria-hidden="true" tabindex="-1"></a>Mortality rates of adult flour beetles after five hours' exposure to gaseous carbon disulphide (Bliss 1935)</span>
<span id="cb62-883"><a href="#cb62-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-884"><a href="#cb62-884" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-885"><a href="#cb62-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-886"><a href="#cb62-886" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-887"><a href="#cb62-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-888"><a href="#cb62-888" aria-hidden="true" tabindex="-1"></a><span class="fu">### Three parts to regression models</span></span>
<span id="cb62-889"><a href="#cb62-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-890"><a href="#cb62-890" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What distribution does the outcome have for a specific subpopulation</span>
<span id="cb62-891"><a href="#cb62-891" aria-hidden="true" tabindex="-1"></a>defined by covariates? (outcome model)</span>
<span id="cb62-892"><a href="#cb62-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-893"><a href="#cb62-893" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How does the combination of covariates relate to the mean? (link</span>
<span id="cb62-894"><a href="#cb62-894" aria-hidden="true" tabindex="-1"></a>function)</span>
<span id="cb62-895"><a href="#cb62-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-896"><a href="#cb62-896" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>How do the covariates combine? (linear predictor, interactions)</span>
<span id="cb62-897"><a href="#cb62-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-898"><a href="#cb62-898" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-899"><a href="#cb62-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-900"><a href="#cb62-900" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression in R</span></span>
<span id="cb62-901"><a href="#cb62-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-904"><a href="#cb62-904" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-905"><a href="#cb62-905" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="ot">&lt;-</span></span>
<span id="cb62-906"><a href="#cb62-906" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span></span>
<span id="cb62-907"><a href="#cb62-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb62-908"><a href="#cb62-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> <span class="fu">cbind</span>(died, survived) <span class="sc">~</span> dose,</span>
<span id="cb62-909"><a href="#cb62-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb62-910"><a href="#cb62-910" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-911"><a href="#cb62-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-912"><a href="#cb62-912" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parameters)</span>
<span id="cb62-913"><a href="#cb62-913" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-914"><a href="#cb62-914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-915"><a href="#cb62-915" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-916"><a href="#cb62-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-917"><a href="#cb62-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-918"><a href="#cb62-918" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-919"><a href="#cb62-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-920"><a href="#cb62-920" aria-hidden="true" tabindex="-1"></a>Fitted values:</span>
<span id="cb62-921"><a href="#cb62-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-924"><a href="#cb62-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-925"><a href="#cb62-925" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted.values</span>(beetles_glm_grouped)</span>
<span id="cb62-926"><a href="#cb62-926" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb62-927"><a href="#cb62-927" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(beetles_glm_grouped, <span class="at">type =</span> <span class="st">"link"</span>)</span>
<span id="cb62-928"><a href="#cb62-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-929"><a href="#cb62-929" aria-hidden="true" tabindex="-1"></a>fit_y <span class="ot">&lt;-</span> beetles<span class="sc">$</span>n <span class="sc">*</span> <span class="fu">fitted.values</span>(beetles_glm_grouped)</span>
<span id="cb62-930"><a href="#cb62-930" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-931"><a href="#cb62-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-932"><a href="#cb62-932" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-933"><a href="#cb62-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-934"><a href="#cb62-934" aria-hidden="true" tabindex="-1"></a><span class="fu">### Individual observations</span></span>
<span id="cb62-935"><a href="#cb62-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-938"><a href="#cb62-938" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-939"><a href="#cb62-939" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "`beetles` data in long format"</span></span>
<span id="cb62-940"><a href="#cb62-940" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-beetles-long</span></span>
<span id="cb62-941"><a href="#cb62-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-942"><a href="#cb62-942" aria-hidden="true" tabindex="-1"></a>beetles_long</span>
<span id="cb62-943"><a href="#cb62-943" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-944"><a href="#cb62-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-945"><a href="#cb62-945" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-946"><a href="#cb62-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-947"><a href="#cb62-947" aria-hidden="true" tabindex="-1"></a>:::{#tbl-beetles-model-ungrouped}</span>
<span id="cb62-948"><a href="#cb62-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-951"><a href="#cb62-951" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-952"><a href="#cb62-952" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="ot">&lt;-</span></span>
<span id="cb62-953"><a href="#cb62-953" aria-hidden="true" tabindex="-1"></a>  beetles_long <span class="sc">|&gt;</span></span>
<span id="cb62-954"><a href="#cb62-954" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb62-955"><a href="#cb62-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> outcome <span class="sc">~</span> dose,</span>
<span id="cb62-956"><a href="#cb62-956" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="st">"binomial"</span></span>
<span id="cb62-957"><a href="#cb62-957" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-958"><a href="#cb62-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-959"><a href="#cb62-959" aria-hidden="true" tabindex="-1"></a>beetles_glm_ungrouped <span class="sc">|&gt;</span></span>
<span id="cb62-960"><a href="#cb62-960" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-961"><a href="#cb62-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-962"><a href="#cb62-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-963"><a href="#cb62-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-964"><a href="#cb62-964" aria-hidden="true" tabindex="-1"></a>logistic regression model for beetles data with individual Bernoulli data</span>
<span id="cb62-965"><a href="#cb62-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-966"><a href="#cb62-966" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-967"><a href="#cb62-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-968"><a href="#cb62-968" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-969"><a href="#cb62-969" aria-hidden="true" tabindex="-1"></a>Here's the previous version again:</span>
<span id="cb62-970"><a href="#cb62-970" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-971"><a href="#cb62-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-972"><a href="#cb62-972" aria-hidden="true" tabindex="-1"></a>:::{#tbl-beetles-model-grouped}</span>
<span id="cb62-973"><a href="#cb62-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-976"><a href="#cb62-976" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-977"><a href="#cb62-977" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-978"><a href="#cb62-978" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-979"><a href="#cb62-979" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-980"><a href="#cb62-980" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-981"><a href="#cb62-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-982"><a href="#cb62-982" aria-hidden="true" tabindex="-1"></a>logistic regression model for beetles data with grouped (binomial) data</span>
<span id="cb62-983"><a href="#cb62-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-984"><a href="#cb62-984" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-985"><a href="#cb62-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-986"><a href="#cb62-986" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-987"><a href="#cb62-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-988"><a href="#cb62-988" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-989"><a href="#cb62-989" aria-hidden="true" tabindex="-1"></a>They seem the same! But not quite:</span>
<span id="cb62-990"><a href="#cb62-990" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-991"><a href="#cb62-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-994"><a href="#cb62-994" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-995"><a href="#cb62-995" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_grouped)</span>
<span id="cb62-996"><a href="#cb62-996" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(beetles_glm_ungrouped)</span>
<span id="cb62-997"><a href="#cb62-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-998"><a href="#cb62-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-999"><a href="#cb62-999" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1000"><a href="#cb62-1000" aria-hidden="true" tabindex="-1"></a>The difference is due to the binomial coefficient</span>
<span id="cb62-1001"><a href="#cb62-1001" aria-hidden="true" tabindex="-1"></a>$\left(n\atop x \right)$ which isn't included in the</span>
<span id="cb62-1002"><a href="#cb62-1002" aria-hidden="true" tabindex="-1"></a>individual-observations (Bernoulli) version of the model.</span>
<span id="cb62-1003"><a href="#cb62-1003" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1004"><a href="#cb62-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1005"><a href="#cb62-1005" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multiple logistic regression</span></span>
<span id="cb62-1006"><a href="#cb62-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1007"><a href="#cb62-1007" aria-hidden="true" tabindex="-1"></a><span class="fu">### Coronary heart disease (WCGS) study data</span></span>
<span id="cb62-1008"><a href="#cb62-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1009"><a href="#cb62-1009" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1010"><a href="#cb62-1010" aria-hidden="true" tabindex="-1"></a>Let's use the data from the Western Collaborative Group Study (WCGS) </span>
<span id="cb62-1011"><a href="#cb62-1011" aria-hidden="true" tabindex="-1"></a>(@rosenman1975coronary) to explore multiple logistic regression:</span>
<span id="cb62-1012"><a href="#cb62-1012" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1013"><a href="#cb62-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1014"><a href="#cb62-1014" aria-hidden="true" tabindex="-1"></a>*From @vittinghoff2e:*</span>
<span id="cb62-1015"><a href="#cb62-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1016"><a href="#cb62-1016" aria-hidden="true" tabindex="-1"></a>"The **Western Collaborative Group Study (WCGS)** was a large</span>
<span id="cb62-1017"><a href="#cb62-1017" aria-hidden="true" tabindex="-1"></a>epidemiological study designed to investigate the association between</span>
<span id="cb62-1018"><a href="#cb62-1018" aria-hidden="true" tabindex="-1"></a>the "type A" behavior pattern and coronary heart disease (CHD)".</span>
<span id="cb62-1019"><a href="#cb62-1019" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1020"><a href="#cb62-1020" aria-hidden="true" tabindex="-1"></a>*From Wikipedia, "Type A and Type B personality theory":*</span>
<span id="cb62-1021"><a href="#cb62-1021" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1022"><a href="#cb62-1022" aria-hidden="true" tabindex="-1"></a>"The hypothesis describes Type A individuals as outgoing, ambitious,</span>
<span id="cb62-1023"><a href="#cb62-1023" aria-hidden="true" tabindex="-1"></a>rigidly organized, highly status-conscious, impatient, anxious,</span>
<span id="cb62-1024"><a href="#cb62-1024" aria-hidden="true" tabindex="-1"></a>proactive, and concerned with time management....</span>
<span id="cb62-1025"><a href="#cb62-1025" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1026"><a href="#cb62-1026" aria-hidden="true" tabindex="-1"></a>The hypothesis describes Type B individuals as a contrast to those of</span>
<span id="cb62-1027"><a href="#cb62-1027" aria-hidden="true" tabindex="-1"></a>Type A. Type B personalities, by definition, are noted to live at lower</span>
<span id="cb62-1028"><a href="#cb62-1028" aria-hidden="true" tabindex="-1"></a>stress levels. They typically work steadily and may enjoy achievement,</span>
<span id="cb62-1029"><a href="#cb62-1029" aria-hidden="true" tabindex="-1"></a>although they have a greater tendency to disregard physical or mental</span>
<span id="cb62-1030"><a href="#cb62-1030" aria-hidden="true" tabindex="-1"></a>stress when they do not achieve."</span>
<span id="cb62-1031"><a href="#cb62-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1032"><a href="#cb62-1032" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1033"><a href="#cb62-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1034"><a href="#cb62-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Study design</span></span>
<span id="cb62-1035"><a href="#cb62-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1036"><a href="#cb62-1036" aria-hidden="true" tabindex="-1"></a>*from `?faraway::wcgs`:*</span>
<span id="cb62-1037"><a href="#cb62-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1038"><a href="#cb62-1038" aria-hidden="true" tabindex="-1"></a>3154 healthy young men aged 39-59 from the San Francisco area were</span>
<span id="cb62-1039"><a href="#cb62-1039" aria-hidden="true" tabindex="-1"></a>assessed for their personality type. All were free from coronary heart</span>
<span id="cb62-1040"><a href="#cb62-1040" aria-hidden="true" tabindex="-1"></a>disease at the start of the research. Eight and a half years later</span>
<span id="cb62-1041"><a href="#cb62-1041" aria-hidden="true" tabindex="-1"></a>change in CHD status was recorded.</span>
<span id="cb62-1042"><a href="#cb62-1042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1043"><a href="#cb62-1043" aria-hidden="true" tabindex="-1"></a>*Details (from `faraway::wcgs`)*</span>
<span id="cb62-1044"><a href="#cb62-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1045"><a href="#cb62-1045" aria-hidden="true" tabindex="-1"></a>The WCGS began in 1960 with 3,524 male volunteers who were employed by</span>
<span id="cb62-1046"><a href="#cb62-1046" aria-hidden="true" tabindex="-1"></a>11 California companies. Subjects were 39 to 59 years old and free of</span>
<span id="cb62-1047"><a href="#cb62-1047" aria-hidden="true" tabindex="-1"></a>heart disease as determined by electrocardiogram. After the initial</span>
<span id="cb62-1048"><a href="#cb62-1048" aria-hidden="true" tabindex="-1"></a>screening, the study population dropped to 3,154 and the number of</span>
<span id="cb62-1049"><a href="#cb62-1049" aria-hidden="true" tabindex="-1"></a>companies to 10 because of various exclusions. The cohort comprised both</span>
<span id="cb62-1050"><a href="#cb62-1050" aria-hidden="true" tabindex="-1"></a>blue- and white-collar employees.</span>
<span id="cb62-1051"><a href="#cb62-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1052"><a href="#cb62-1052" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1053"><a href="#cb62-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1054"><a href="#cb62-1054" aria-hidden="true" tabindex="-1"></a><span class="fu">### Baseline data collection</span></span>
<span id="cb62-1055"><a href="#cb62-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1056"><a href="#cb62-1056" aria-hidden="true" tabindex="-1"></a>socio-demographic characteristics:</span>
<span id="cb62-1057"><a href="#cb62-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1058"><a href="#cb62-1058" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>age</span>
<span id="cb62-1059"><a href="#cb62-1059" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>education</span>
<span id="cb62-1060"><a href="#cb62-1060" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>marital status</span>
<span id="cb62-1061"><a href="#cb62-1061" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>income</span>
<span id="cb62-1062"><a href="#cb62-1062" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>occupation</span>
<span id="cb62-1063"><a href="#cb62-1063" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>physical and physiological including:</span>
<span id="cb62-1064"><a href="#cb62-1064" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>height</span>
<span id="cb62-1065"><a href="#cb62-1065" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>weight</span>
<span id="cb62-1066"><a href="#cb62-1066" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>blood pressure</span>
<span id="cb62-1067"><a href="#cb62-1067" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>electrocardiogram</span>
<span id="cb62-1068"><a href="#cb62-1068" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>corneal arcus;</span>
<span id="cb62-1069"><a href="#cb62-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1070"><a href="#cb62-1070" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1071"><a href="#cb62-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1072"><a href="#cb62-1072" aria-hidden="true" tabindex="-1"></a>biochemical measurements:</span>
<span id="cb62-1073"><a href="#cb62-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1074"><a href="#cb62-1074" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>cholesterol and lipoprotein fractions;</span>
<span id="cb62-1075"><a href="#cb62-1075" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>medical and family history and use of medications;</span>
<span id="cb62-1076"><a href="#cb62-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1077"><a href="#cb62-1077" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1078"><a href="#cb62-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1079"><a href="#cb62-1079" aria-hidden="true" tabindex="-1"></a>behavioral data:</span>
<span id="cb62-1080"><a href="#cb62-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1081"><a href="#cb62-1081" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Type A interview,</span>
<span id="cb62-1082"><a href="#cb62-1082" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>smoking,</span>
<span id="cb62-1083"><a href="#cb62-1083" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>exercise</span>
<span id="cb62-1084"><a href="#cb62-1084" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>alcohol use.</span>
<span id="cb62-1085"><a href="#cb62-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1086"><a href="#cb62-1086" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1087"><a href="#cb62-1087" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1088"><a href="#cb62-1088" aria-hidden="true" tabindex="-1"></a>Later surveys added data on: </span>
<span id="cb62-1089"><a href="#cb62-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1090"><a href="#cb62-1090" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>anthropometry </span>
<span id="cb62-1091"><a href="#cb62-1091" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>triglycerides </span>
<span id="cb62-1092"><a href="#cb62-1092" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Jenkins Activity Survey </span>
<span id="cb62-1093"><a href="#cb62-1093" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>caffeine use</span>
<span id="cb62-1094"><a href="#cb62-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1095"><a href="#cb62-1095" aria-hidden="true" tabindex="-1"></a>Average follow-up continued for 8.5 years with repeat examinations.</span>
<span id="cb62-1096"><a href="#cb62-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1097"><a href="#cb62-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1098"><a href="#cb62-1098" aria-hidden="true" tabindex="-1"></a><span class="fu">### Load the data</span></span>
<span id="cb62-1099"><a href="#cb62-1099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1100"><a href="#cb62-1100" aria-hidden="true" tabindex="-1"></a>Here, I load the data:</span>
<span id="cb62-1101"><a href="#cb62-1101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1104"><a href="#cb62-1104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1105"><a href="#cb62-1105" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb62-1106"><a href="#cb62-1106" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb62-1107"><a href="#cb62-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1108"><a href="#cb62-1108" aria-hidden="true" tabindex="-1"></a><span class="do">### load the data directly from a UCSF website:</span></span>
<span id="cb62-1109"><a href="#cb62-1109" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb62-1110"><a href="#cb62-1110" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb62-1111"><a href="#cb62-1111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I'm breaking up the url into two chunks for readability</span></span>
<span id="cb62-1112"><a href="#cb62-1112" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://regression.ucsf.edu/sites/g/files/"</span>,</span>
<span id="cb62-1113"><a href="#cb62-1113" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tkssra6706/f/wysiwyg/home/data/wcgs.dta"</span></span>
<span id="cb62-1114"><a href="#cb62-1114" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1115"><a href="#cb62-1115" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(url)</span>
<span id="cb62-1116"><a href="#cb62-1116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1117"><a href="#cb62-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1120"><a href="#cb62-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1121"><a href="#cb62-1121" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb62-1122"><a href="#cb62-1122" aria-hidden="true" tabindex="-1"></a><span class="co"># I presaved the data in my project's `data` folder</span></span>
<span id="cb62-1123"><a href="#cb62-1123" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># provides the `here()` function</span></span>
<span id="cb62-1124"><a href="#cb62-1124" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs) <span class="co"># provides the `path()` function</span></span>
<span id="cb62-1125"><a href="#cb62-1125" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">here</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1126"><a href="#cb62-1126" aria-hidden="true" tabindex="-1"></a>  fs<span class="sc">::</span><span class="fu">path</span>(<span class="st">"Data/wcgs.rda"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-1127"><a href="#cb62-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>()</span>
<span id="cb62-1128"><a href="#cb62-1128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1129"><a href="#cb62-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1132"><a href="#cb62-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1133"><a href="#cb62-1133" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-wcgs</span></span>
<span id="cb62-1134"><a href="#cb62-1134" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "`wcgs` data"</span></span>
<span id="cb62-1135"><a href="#cb62-1135" aria-hidden="true" tabindex="-1"></a>wcgs <span class="sc">|&gt;</span> <span class="fu">head</span>()</span>
<span id="cb62-1136"><a href="#cb62-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1137"><a href="#cb62-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1138"><a href="#cb62-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1139"><a href="#cb62-1139" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data cleaning</span></span>
<span id="cb62-1140"><a href="#cb62-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1141"><a href="#cb62-1141" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1142"><a href="#cb62-1142" aria-hidden="true" tabindex="-1"></a>Now let's do some data cleaning</span>
<span id="cb62-1143"><a href="#cb62-1143" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1144"><a href="#cb62-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1147"><a href="#cb62-1147" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1148"><a href="#cb62-1148" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb62-1149"><a href="#cb62-1149" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arsenal) <span class="co"># provides `set_labels()`</span></span>
<span id="cb62-1150"><a href="#cb62-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats) <span class="co"># provides `as_factor()`</span></span>
<span id="cb62-1151"><a href="#cb62-1151" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb62-1152"><a href="#cb62-1152" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb62-1153"><a href="#cb62-1153" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span> wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1154"><a href="#cb62-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-1155"><a href="#cb62-1155" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> age <span class="sc">|&gt;</span></span>
<span id="cb62-1156"><a href="#cb62-1156" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Age (years)"</span>),</span>
<span id="cb62-1157"><a href="#cb62-1157" aria-hidden="true" tabindex="-1"></a>    <span class="at">arcus =</span> arcus <span class="sc">|&gt;</span></span>
<span id="cb62-1158"><a href="#cb62-1158" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.logical</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1159"><a href="#cb62-1159" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Arcus Senilis"</span>),</span>
<span id="cb62-1160"><a href="#cb62-1160" aria-hidden="true" tabindex="-1"></a>    <span class="at">time169 =</span> time169 <span class="sc">|&gt;</span></span>
<span id="cb62-1161"><a href="#cb62-1161" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.numeric</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1162"><a href="#cb62-1162" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Observation (follow up) time (days)"</span>),</span>
<span id="cb62-1163"><a href="#cb62-1163" aria-hidden="true" tabindex="-1"></a>    <span class="at">dibpat =</span> dibpat <span class="sc">|&gt;</span></span>
<span id="cb62-1164"><a href="#cb62-1164" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_factor</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1165"><a href="#cb62-1165" aria-hidden="true" tabindex="-1"></a>      <span class="fu">relevel</span>(<span class="at">ref =</span> <span class="st">"Type B"</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-1166"><a href="#cb62-1166" aria-hidden="true" tabindex="-1"></a>      arsenal<span class="sc">::</span><span class="fu">set_labels</span>(<span class="st">"Behavioral Pattern"</span>),</span>
<span id="cb62-1167"><a href="#cb62-1167" aria-hidden="true" tabindex="-1"></a>    <span class="at">typchd69 =</span> typchd69 <span class="sc">|&gt;</span></span>
<span id="cb62-1168"><a href="#cb62-1168" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(</span>
<span id="cb62-1169"><a href="#cb62-1169" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="st">"Type of CHD Event"</span>,</span>
<span id="cb62-1170"><a href="#cb62-1170" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span></span>
<span id="cb62-1171"><a href="#cb62-1171" aria-hidden="true" tabindex="-1"></a>          <span class="fu">c</span>(</span>
<span id="cb62-1172"><a href="#cb62-1172" aria-hidden="true" tabindex="-1"></a>            <span class="st">"None"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb62-1173"><a href="#cb62-1173" aria-hidden="true" tabindex="-1"></a>            <span class="st">"infdeath"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb62-1174"><a href="#cb62-1174" aria-hidden="true" tabindex="-1"></a>            <span class="st">"silent"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb62-1175"><a href="#cb62-1175" aria-hidden="true" tabindex="-1"></a>            <span class="st">"angina"</span> <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb62-1176"><a href="#cb62-1176" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb62-1177"><a href="#cb62-1177" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb62-1178"><a href="#cb62-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1179"><a href="#cb62-1179" aria-hidden="true" tabindex="-1"></a>    <span class="co"># turn stata-style labelled variables in to R-style factors:</span></span>
<span id="cb62-1180"><a href="#cb62-1180" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb62-1181"><a href="#cb62-1181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">where</span>(is.labelled),</span>
<span id="cb62-1182"><a href="#cb62-1182" aria-hidden="true" tabindex="-1"></a>      haven<span class="sc">::</span>as_factor</span>
<span id="cb62-1183"><a href="#cb62-1183" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-1184"><a href="#cb62-1184" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1185"><a href="#cb62-1185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1186"><a href="#cb62-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1187"><a href="#cb62-1187" aria-hidden="true" tabindex="-1"></a><span class="fu">### What's in the data {.smaller}</span></span>
<span id="cb62-1188"><a href="#cb62-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1189"><a href="#cb62-1189" aria-hidden="true" tabindex="-1"></a>Here's a table of the data:</span>
<span id="cb62-1190"><a href="#cb62-1190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1191"><a href="#cb62-1191" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results = "asis"}</span></span>
<span id="cb62-1192"><a href="#cb62-1192" aria-hidden="true" tabindex="-1"></a><span class="in">wcgs |&gt;</span></span>
<span id="cb62-1193"><a href="#cb62-1193" aria-hidden="true" tabindex="-1"></a><span class="in">  select(-c(id, uni, t1)) |&gt;</span></span>
<span id="cb62-1194"><a href="#cb62-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  tableby(chd69 ~ ., data = _) |&gt;</span></span>
<span id="cb62-1195"><a href="#cb62-1195" aria-hidden="true" tabindex="-1"></a><span class="in">  summary(</span></span>
<span id="cb62-1196"><a href="#cb62-1196" aria-hidden="true" tabindex="-1"></a><span class="in">    pfootnote = TRUE,</span></span>
<span id="cb62-1197"><a href="#cb62-1197" aria-hidden="true" tabindex="-1"></a><span class="in">    title =</span></span>
<span id="cb62-1198"><a href="#cb62-1198" aria-hidden="true" tabindex="-1"></a><span class="in">      "Baseline characteristics by CHD status at end of follow-up"</span></span>
<span id="cb62-1199"><a href="#cb62-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb62-1200"><a href="#cb62-1200" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1201"><a href="#cb62-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1202"><a href="#cb62-1202" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data by age and personality type</span></span>
<span id="cb62-1203"><a href="#cb62-1203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1204"><a href="#cb62-1204" aria-hidden="true" tabindex="-1"></a>For now, we will look at the interaction between age and personality</span>
<span id="cb62-1205"><a href="#cb62-1205" aria-hidden="true" tabindex="-1"></a>type (<span class="in">`dibpat`</span>). To make it easier to visualize the data, we summarize</span>
<span id="cb62-1206"><a href="#cb62-1206" aria-hidden="true" tabindex="-1"></a>the event rates for each combination of age:</span>
<span id="cb62-1207"><a href="#cb62-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1210"><a href="#cb62-1210" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1211"><a href="#cb62-1211" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: "event rates by age"</span></span>
<span id="cb62-1212"><a href="#cb62-1212" aria-hidden="true" tabindex="-1"></a>chd_grouped_data <span class="ot">&lt;-</span></span>
<span id="cb62-1213"><a href="#cb62-1213" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1214"><a href="#cb62-1214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-1215"><a href="#cb62-1215" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(age, dibpat),</span>
<span id="cb62-1216"><a href="#cb62-1216" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(chd69 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Yes"</span>, <span class="st">"No"</span>)),</span>
<span id="cb62-1217"><a href="#cb62-1217" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>)</span>
<span id="cb62-1218"><a href="#cb62-1218" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-1219"><a href="#cb62-1219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-1220"><a href="#cb62-1220" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">n - x</span><span class="st">`</span> <span class="ot">=</span> n <span class="sc">-</span> x,</span>
<span id="cb62-1221"><a href="#cb62-1221" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span> <span class="ot">=</span> (x <span class="sc">/</span> n) <span class="sc">|&gt;</span></span>
<span id="cb62-1222"><a href="#cb62-1222" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labelled</span>(<span class="at">label =</span> <span class="st">"CHD Event by 1969"</span>),</span>
<span id="cb62-1223"><a href="#cb62-1223" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>),</span>
<span id="cb62-1224"><a href="#cb62-1224" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">logit(chd)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log</span>(<span class="st">`</span><span class="at">odds(chd)</span><span class="st">`</span>)</span>
<span id="cb62-1225"><a href="#cb62-1225" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1226"><a href="#cb62-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1227"><a href="#cb62-1227" aria-hidden="true" tabindex="-1"></a>chd_grouped_data</span>
<span id="cb62-1228"><a href="#cb62-1228" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1229"><a href="#cb62-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1230"><a href="#cb62-1230" aria-hidden="true" tabindex="-1"></a><span class="fu">### Graphical exploration</span></span>
<span id="cb62-1231"><a href="#cb62-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1234"><a href="#cb62-1234" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1235"><a href="#cb62-1235" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd-graph-prob-scale</span></span>
<span id="cb62-1236"><a href="#cb62-1236" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD rates by age group, probability scale"</span></span>
<span id="cb62-1237"><a href="#cb62-1237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1238"><a href="#cb62-1238" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb62-1239"><a href="#cb62-1239" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeasy)</span>
<span id="cb62-1240"><a href="#cb62-1240" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb62-1241"><a href="#cb62-1241" aria-hidden="true" tabindex="-1"></a>chd_plot_probs <span class="ot">&lt;-</span></span>
<span id="cb62-1242"><a href="#cb62-1242" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span></span>
<span id="cb62-1243"><a href="#cb62-1243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb62-1244"><a href="#cb62-1244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb62-1245"><a href="#cb62-1245" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> age,</span>
<span id="cb62-1246"><a href="#cb62-1246" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">`</span><span class="at">p(chd)</span><span class="st">`</span>,</span>
<span id="cb62-1247"><a href="#cb62-1247" aria-hidden="true" tabindex="-1"></a>      <span class="at">col =</span> dibpat</span>
<span id="cb62-1248"><a href="#cb62-1248" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-1249"><a href="#cb62-1249" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1250"><a href="#cb62-1250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n), <span class="at">alpha =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb62-1251"><a href="#cb62-1251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb62-1252"><a href="#cb62-1252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb62-1253"><a href="#cb62-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb62-1254"><a href="#cb62-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"P(CHD Event by 1969)"</span>) <span class="sc">+</span></span>
<span id="cb62-1255"><a href="#cb62-1255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb62-1256"><a href="#cb62-1256" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(),</span>
<span id="cb62-1257"><a href="#cb62-1257" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb62-1258"><a href="#cb62-1258" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb62-1259"><a href="#cb62-1259" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span></span>
<span id="cb62-1260"><a href="#cb62-1260" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-1261"><a href="#cb62-1261" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1262"><a href="#cb62-1262" aria-hidden="true" tabindex="-1"></a>  ggeasy<span class="sc">::</span><span class="fu">easy_labs</span>() <span class="sc">+</span></span>
<span id="cb62-1263"><a href="#cb62-1263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb62-1264"><a href="#cb62-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1265"><a href="#cb62-1265" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_probs)</span>
<span id="cb62-1266"><a href="#cb62-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1267"><a href="#cb62-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1268"><a href="#cb62-1268" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1269"><a href="#cb62-1269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1270"><a href="#cb62-1270" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Odds scale</span></span>
<span id="cb62-1271"><a href="#cb62-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1274"><a href="#cb62-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1275"><a href="#cb62-1275" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd-odds-scale</span></span>
<span id="cb62-1276"><a href="#cb62-1276" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD rates by age group, odds spacing"</span></span>
<span id="cb62-1277"><a href="#cb62-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1278"><a href="#cb62-1278" aria-hidden="true" tabindex="-1"></a>trans_odds <span class="ot">&lt;-</span> <span class="fu">trans_new</span>(</span>
<span id="cb62-1279"><a href="#cb62-1279" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"odds"</span>,</span>
<span id="cb62-1280"><a href="#cb62-1280" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> odds,</span>
<span id="cb62-1281"><a href="#cb62-1281" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> odds_inv</span>
<span id="cb62-1282"><a href="#cb62-1282" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1283"><a href="#cb62-1283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1284"><a href="#cb62-1284" aria-hidden="true" tabindex="-1"></a>chd_plot_odds <span class="ot">&lt;-</span> chd_plot_probs <span class="sc">+</span></span>
<span id="cb62-1285"><a href="#cb62-1285" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb62-1286"><a href="#cb62-1286" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> trans_odds, <span class="co"># this line changes the vertical spacing</span></span>
<span id="cb62-1287"><a href="#cb62-1287" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> chd_plot_probs<span class="sc">$</span>labels<span class="sc">$</span>y,</span>
<span id="cb62-1288"><a href="#cb62-1288" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb62-1289"><a href="#cb62-1289" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">odds</span>(.),</span>
<span id="cb62-1290"><a href="#cb62-1290" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"odds(CHD Event by 1969)"</span></span>
<span id="cb62-1291"><a href="#cb62-1291" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-1292"><a href="#cb62-1292" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1293"><a href="#cb62-1293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1294"><a href="#cb62-1294" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_odds)</span>
<span id="cb62-1295"><a href="#cb62-1295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1296"><a href="#cb62-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1297"><a href="#cb62-1297" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1298"><a href="#cb62-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1299"><a href="#cb62-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Log-odds (logit) scale</span></span>
<span id="cb62-1300"><a href="#cb62-1300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1303"><a href="#cb62-1303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1304"><a href="#cb62-1304" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd_plot_logit</span></span>
<span id="cb62-1305"><a href="#cb62-1305" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "CHD data (logit-scale)"</span></span>
<span id="cb62-1306"><a href="#cb62-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1307"><a href="#cb62-1307" aria-hidden="true" tabindex="-1"></a>trans_logit <span class="ot">&lt;-</span> <span class="fu">trans_new</span>(</span>
<span id="cb62-1308"><a href="#cb62-1308" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"logit"</span>,</span>
<span id="cb62-1309"><a href="#cb62-1309" aria-hidden="true" tabindex="-1"></a>  <span class="at">transform =</span> logit,</span>
<span id="cb62-1310"><a href="#cb62-1310" aria-hidden="true" tabindex="-1"></a>  <span class="at">inverse =</span> expit</span>
<span id="cb62-1311"><a href="#cb62-1311" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1312"><a href="#cb62-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1313"><a href="#cb62-1313" aria-hidden="true" tabindex="-1"></a>chd_plot_logit <span class="ot">&lt;-</span></span>
<span id="cb62-1314"><a href="#cb62-1314" aria-hidden="true" tabindex="-1"></a>  chd_plot_probs <span class="sc">+</span></span>
<span id="cb62-1315"><a href="#cb62-1315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb62-1316"><a href="#cb62-1316" aria-hidden="true" tabindex="-1"></a>    <span class="at">trans =</span> trans_logit, <span class="co"># this line changes the vertical spacing</span></span>
<span id="cb62-1317"><a href="#cb62-1317" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> chd_plot_probs<span class="sc">$</span>labels<span class="sc">$</span>y,</span>
<span id="cb62-1318"><a href="#cb62-1318" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(.<span class="dv">01</span>, .<span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">01</span>), .<span class="dv">15</span>, .<span class="dv">2</span>),</span>
<span id="cb62-1319"><a href="#cb62-1319" aria-hidden="true" tabindex="-1"></a>    <span class="at">minor_breaks =</span> <span class="cn">NULL</span>,</span>
<span id="cb62-1320"><a href="#cb62-1320" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(</span>
<span id="cb62-1321"><a href="#cb62-1321" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">logit</span>(.),</span>
<span id="cb62-1322"><a href="#cb62-1322" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"log(odds(CHD Event by 1969))"</span></span>
<span id="cb62-1323"><a href="#cb62-1323" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-1324"><a href="#cb62-1324" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1325"><a href="#cb62-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1326"><a href="#cb62-1326" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit)</span>
<span id="cb62-1327"><a href="#cb62-1327" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1328"><a href="#cb62-1328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1329"><a href="#cb62-1329" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression models for CHD data {.smaller}</span></span>
<span id="cb62-1330"><a href="#cb62-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1331"><a href="#cb62-1331" aria-hidden="true" tabindex="-1"></a>Here, we fit stratified models for CHD by personality type.</span>
<span id="cb62-1332"><a href="#cb62-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1335"><a href="#cb62-1335" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1336"><a href="#cb62-1336" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "CHD model, stratified parametrization"</span></span>
<span id="cb62-1337"><a href="#cb62-1337" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-chd-strat</span></span>
<span id="cb62-1338"><a href="#cb62-1338" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb62-1339"><a href="#cb62-1339" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb62-1340"><a href="#cb62-1340" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs,</span>
<span id="cb62-1341"><a href="#cb62-1341" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb62-1342"><a href="#cb62-1342" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1343"><a href="#cb62-1343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1344"><a href="#cb62-1344" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span></span>
<span id="cb62-1345"><a href="#cb62-1345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1346"><a href="#cb62-1346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-1347"><a href="#cb62-1347" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1348"><a href="#cb62-1348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1349"><a href="#cb62-1349" aria-hidden="true" tabindex="-1"></a>We can get the corresponding odds ratios ($e^{\beta}$s) by passing</span>
<span id="cb62-1350"><a href="#cb62-1350" aria-hidden="true" tabindex="-1"></a><span class="in">`exponentiate = TRUE`</span> to <span class="in">`parameters()`</span>:</span>
<span id="cb62-1351"><a href="#cb62-1351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1354"><a href="#cb62-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1355"><a href="#cb62-1355" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Odds ratio estimates for CHD model"</span></span>
<span id="cb62-1356"><a href="#cb62-1356" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-chd-glm-strat-OR</span></span>
<span id="cb62-1357"><a href="#cb62-1357" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span></span>
<span id="cb62-1358"><a href="#cb62-1358" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-1359"><a href="#cb62-1359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-1360"><a href="#cb62-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1361"><a href="#cb62-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1362"><a href="#cb62-1362" aria-hidden="true" tabindex="-1"></a><span class="fu">### Models superimposed on data</span></span>
<span id="cb62-1363"><a href="#cb62-1363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1364"><a href="#cb62-1364" aria-hidden="true" tabindex="-1"></a>We can graph our fitted models on each scale (probability, odds,</span>
<span id="cb62-1365"><a href="#cb62-1365" aria-hidden="true" tabindex="-1"></a>log-odds).</span>
<span id="cb62-1366"><a href="#cb62-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1367"><a href="#cb62-1367" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1368"><a href="#cb62-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1369"><a href="#cb62-1369" aria-hidden="true" tabindex="-1"></a><span class="fu">#### probability scale</span></span>
<span id="cb62-1370"><a href="#cb62-1370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1373"><a href="#cb62-1373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1374"><a href="#cb62-1374" aria-hidden="true" tabindex="-1"></a>curve_type_A <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1375"><a href="#cb62-1375" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb62-1376"><a href="#cb62-1376" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb62-1377"><a href="#cb62-1377" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type A"</span>)</span>
<span id="cb62-1378"><a href="#cb62-1378" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1379"><a href="#cb62-1379" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-1380"><a href="#cb62-1380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1381"><a href="#cb62-1381" aria-hidden="true" tabindex="-1"></a>curve_type_B <span class="ot">&lt;-</span> <span class="cf">function</span>(x) { <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1382"><a href="#cb62-1382" aria-hidden="true" tabindex="-1"></a>  chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">predict</span>(</span>
<span id="cb62-1383"><a href="#cb62-1383" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"response"</span>,</span>
<span id="cb62-1384"><a href="#cb62-1384" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> <span class="fu">tibble</span>(<span class="at">age =</span> x, <span class="at">dibpat =</span> <span class="st">"Type B"</span>)</span>
<span id="cb62-1385"><a href="#cb62-1385" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1386"><a href="#cb62-1386" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-1387"><a href="#cb62-1387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1388"><a href="#cb62-1388" aria-hidden="true" tabindex="-1"></a>chd_plot_probs_2 <span class="ot">&lt;-</span></span>
<span id="cb62-1389"><a href="#cb62-1389" aria-hidden="true" tabindex="-1"></a>  chd_plot_probs <span class="sc">+</span></span>
<span id="cb62-1390"><a href="#cb62-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-1391"><a href="#cb62-1391" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb62-1392"><a href="#cb62-1392" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb62-1393"><a href="#cb62-1393" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1394"><a href="#cb62-1394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-1395"><a href="#cb62-1395" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb62-1396"><a href="#cb62-1396" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb62-1397"><a href="#cb62-1397" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1398"><a href="#cb62-1398" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_probs_2)</span>
<span id="cb62-1399"><a href="#cb62-1399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1400"><a href="#cb62-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1401"><a href="#cb62-1401" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1402"><a href="#cb62-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1403"><a href="#cb62-1403" aria-hidden="true" tabindex="-1"></a>:::{fig-fitted-odds-chd}</span>
<span id="cb62-1404"><a href="#cb62-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1407"><a href="#cb62-1407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1408"><a href="#cb62-1408" aria-hidden="true" tabindex="-1"></a>chd_plot_odds_2 <span class="ot">&lt;-</span></span>
<span id="cb62-1409"><a href="#cb62-1409" aria-hidden="true" tabindex="-1"></a>  chd_plot_odds <span class="sc">+</span></span>
<span id="cb62-1410"><a href="#cb62-1410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-1411"><a href="#cb62-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb62-1412"><a href="#cb62-1412" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb62-1413"><a href="#cb62-1413" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1414"><a href="#cb62-1414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-1415"><a href="#cb62-1415" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb62-1416"><a href="#cb62-1416" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb62-1417"><a href="#cb62-1417" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1418"><a href="#cb62-1418" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_odds_2)</span>
<span id="cb62-1419"><a href="#cb62-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1420"><a href="#cb62-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1421"><a href="#cb62-1421" aria-hidden="true" tabindex="-1"></a>odds scale</span>
<span id="cb62-1422"><a href="#cb62-1422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1423"><a href="#cb62-1423" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1424"><a href="#cb62-1424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1425"><a href="#cb62-1425" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1426"><a href="#cb62-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1427"><a href="#cb62-1427" aria-hidden="true" tabindex="-1"></a><span class="fu">#### log-odds (logit) scale</span></span>
<span id="cb62-1428"><a href="#cb62-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1431"><a href="#cb62-1431" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1432"><a href="#cb62-1432" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-fitted-log-odds</span></span>
<span id="cb62-1433"><a href="#cb62-1433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1434"><a href="#cb62-1434" aria-hidden="true" tabindex="-1"></a>chd_plot_logit_2 <span class="ot">&lt;-</span></span>
<span id="cb62-1435"><a href="#cb62-1435" aria-hidden="true" tabindex="-1"></a>  chd_plot_logit <span class="sc">+</span></span>
<span id="cb62-1436"><a href="#cb62-1436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-1437"><a href="#cb62-1437" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_A,</span>
<span id="cb62-1438"><a href="#cb62-1438" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type A"</span>)</span>
<span id="cb62-1439"><a href="#cb62-1439" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1440"><a href="#cb62-1440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_function</span>(</span>
<span id="cb62-1441"><a href="#cb62-1441" aria-hidden="true" tabindex="-1"></a>    <span class="at">fun =</span> curve_type_B,</span>
<span id="cb62-1442"><a href="#cb62-1442" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"Type B"</span>)</span>
<span id="cb62-1443"><a href="#cb62-1443" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1444"><a href="#cb62-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1445"><a href="#cb62-1445" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chd_plot_logit_2)</span>
<span id="cb62-1446"><a href="#cb62-1446" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1447"><a href="#cb62-1447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1448"><a href="#cb62-1448" aria-hidden="true" tabindex="-1"></a><span class="fu">### reference-group and contrast parametrization</span></span>
<span id="cb62-1449"><a href="#cb62-1449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1450"><a href="#cb62-1450" aria-hidden="true" tabindex="-1"></a>We can also use the corner-point parametrization (with reference groups</span>
<span id="cb62-1451"><a href="#cb62-1451" aria-hidden="true" tabindex="-1"></a>and contrasts):</span>
<span id="cb62-1452"><a href="#cb62-1452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1455"><a href="#cb62-1455" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1456"><a href="#cb62-1456" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-model-corner-point</span></span>
<span id="cb62-1457"><a href="#cb62-1457" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "CHD model (corner-point parametrization)"</span></span>
<span id="cb62-1458"><a href="#cb62-1458" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="ot">&lt;-</span></span>
<span id="cb62-1459"><a href="#cb62-1459" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1460"><a href="#cb62-1460" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb62-1461"><a href="#cb62-1461" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb62-1462"><a href="#cb62-1462" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">*</span> <span class="fu">I</span>(age <span class="sc">-</span> <span class="dv">50</span>),</span>
<span id="cb62-1463"><a href="#cb62-1463" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb62-1464"><a href="#cb62-1464" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1465"><a href="#cb62-1465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1466"><a href="#cb62-1466" aria-hidden="true" tabindex="-1"></a>chd_glm_contrasts <span class="sc">|&gt;</span></span>
<span id="cb62-1467"><a href="#cb62-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1468"><a href="#cb62-1468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-1469"><a href="#cb62-1469" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1470"><a href="#cb62-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1471"><a href="#cb62-1471" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1472"><a href="#cb62-1472" aria-hidden="true" tabindex="-1"></a>Compare with @tbl-chd-glm-strat-OR.</span>
<span id="cb62-1473"><a href="#cb62-1473" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1474"><a href="#cb62-1474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1475"><a href="#cb62-1475" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="revealjs"}</span>
<span id="cb62-1476"><a href="#cb62-1476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1479"><a href="#cb62-1479" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1480"><a href="#cb62-1480" aria-hidden="true" tabindex="-1"></a><span class="co">#| tbl-cap: "Odds ratio estimates for CHD model"</span></span>
<span id="cb62-1481"><a href="#cb62-1481" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: tbl-chd-glm-strat-OR-v2</span></span>
<span id="cb62-1482"><a href="#cb62-1482" aria-hidden="true" tabindex="-1"></a>chd_glm_strat <span class="sc">|&gt;</span></span>
<span id="cb62-1483"><a href="#cb62-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1484"><a href="#cb62-1484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-1485"><a href="#cb62-1485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1486"><a href="#cb62-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1487"><a href="#cb62-1487" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1488"><a href="#cb62-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1489"><a href="#cb62-1489" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1490"><a href="#cb62-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1491"><a href="#cb62-1491" aria-hidden="true" tabindex="-1"></a>:::{#exr-strat-to-contrast}</span>
<span id="cb62-1492"><a href="#cb62-1492" aria-hidden="true" tabindex="-1"></a>If I give you model 1, how would you get the coefficients of model 2?</span>
<span id="cb62-1493"><a href="#cb62-1493" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1494"><a href="#cb62-1494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1495"><a href="#cb62-1495" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1496"><a href="#cb62-1496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1497"><a href="#cb62-1497" aria-hidden="true" tabindex="-1"></a>:::{#thm-logistic-OR}</span>
<span id="cb62-1498"><a href="#cb62-1498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1499"><a href="#cb62-1499" aria-hidden="true" tabindex="-1"></a>For the logistic regression model:</span>
<span id="cb62-1500"><a href="#cb62-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1501"><a href="#cb62-1501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y_i|\vX_i \simind \Ber(\pi(\vX_i))$</span>
<span id="cb62-1502"><a href="#cb62-1502" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\pi(\vx) = \expitf{\vx'\vb}$</span>
<span id="cb62-1503"><a href="#cb62-1503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1504"><a href="#cb62-1504" aria-hidden="true" tabindex="-1"></a>Consider two covariate patterns, $\vx$ and $\vec{x^*}$.</span>
<span id="cb62-1505"><a href="#cb62-1505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1506"><a href="#cb62-1506" aria-hidden="true" tabindex="-1"></a>The odds ratio comparing these covariate patterns is:</span>
<span id="cb62-1507"><a href="#cb62-1507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1508"><a href="#cb62-1508" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1509"><a href="#cb62-1509" aria-hidden="true" tabindex="-1"></a>\omega(\vx,\vec{x^*}) = \exp{(\vx-\vec{x^*})\' \vb}</span>
<span id="cb62-1510"><a href="#cb62-1510" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1511"><a href="#cb62-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1512"><a href="#cb62-1512" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1513"><a href="#cb62-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1514"><a href="#cb62-1514" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1515"><a href="#cb62-1515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1516"><a href="#cb62-1516" aria-hidden="true" tabindex="-1"></a>::: proof</span>
<span id="cb62-1517"><a href="#cb62-1517" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1518"><a href="#cb62-1518" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1519"><a href="#cb62-1519" aria-hidden="true" tabindex="-1"></a>\omega(\vx,\vec{x^*}) </span>
<span id="cb62-1520"><a href="#cb62-1520" aria-hidden="true" tabindex="-1"></a>&amp;= \frac {\odds(Y=1 | \vX = \vx)} {\odds(Y=1 | \vX = \vec{x^*})}</span>
<span id="cb62-1521"><a href="#cb62-1521" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{\exp{\vx\'\vb}}{\exp{{\vec{x^*}}\' \vb}}</span>
<span id="cb62-1522"><a href="#cb62-1522" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \exp{\vx\'\vb - {\vec{x^*}}\' \vb}</span>
<span id="cb62-1523"><a href="#cb62-1523" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \exp{(\vx\' - {\vec{x^*}}\') \vb}</span>
<span id="cb62-1524"><a href="#cb62-1524" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \exp{{(\vx - \vec{x^*})}\' \vb}</span>
<span id="cb62-1525"><a href="#cb62-1525" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1526"><a href="#cb62-1526" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1527"><a href="#cb62-1527" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1528"><a href="#cb62-1528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1529"><a href="#cb62-1529" aria-hidden="true" tabindex="-1"></a><span class="fu">## Fitting logistic regression models</span></span>
<span id="cb62-1530"><a href="#cb62-1530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1531"><a href="#cb62-1531" aria-hidden="true" tabindex="-1"></a><span class="fu">### Maximum likelihood estimation for $\ciid$ data</span></span>
<span id="cb62-1532"><a href="#cb62-1532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1533"><a href="#cb62-1533" aria-hidden="true" tabindex="-1"></a>Assume:</span>
<span id="cb62-1534"><a href="#cb62-1534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1535"><a href="#cb62-1535" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y_i|\vX_i \simind \Ber(\pi(X_i))$</span>
<span id="cb62-1536"><a href="#cb62-1536" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\pi(\vx) = \expitf{\vx'\vb}$</span>
<span id="cb62-1537"><a href="#cb62-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1538"><a href="#cb62-1538" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1539"><a href="#cb62-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1540"><a href="#cb62-1540" aria-hidden="true" tabindex="-1"></a><span class="fu">#### log-likelihood function</span></span>
<span id="cb62-1541"><a href="#cb62-1541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1542"><a href="#cb62-1542" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1543"><a href="#cb62-1543" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1544"><a href="#cb62-1544" aria-hidden="true" tabindex="-1"></a>\ell(\vb, \vy) </span>
<span id="cb62-1545"><a href="#cb62-1545" aria-hidden="true" tabindex="-1"></a>   &amp;= \log{\Lik(\vb, \vec y) }</span>
<span id="cb62-1546"><a href="#cb62-1546" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \sumin \red{\ell_i}(\pi(\vx_i))</span>
<span id="cb62-1547"><a href="#cb62-1547" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1548"><a href="#cb62-1548" aria-hidden="true" tabindex="-1"></a>$$ {#eq-loglik-bernoulli-iid}</span>
<span id="cb62-1549"><a href="#cb62-1549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1550"><a href="#cb62-1550" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1551"><a href="#cb62-1551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1552"><a href="#cb62-1552" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1553"><a href="#cb62-1553" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1554"><a href="#cb62-1554" aria-hidden="true" tabindex="-1"></a>\red{\ell_i}(\pi)</span>
<span id="cb62-1555"><a href="#cb62-1555" aria-hidden="true" tabindex="-1"></a>   &amp;= y_i \log{\pi} + (1 - y_i) \log{1-\pi}</span>
<span id="cb62-1556"><a href="#cb62-1556" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i \log{\pi} + (1 \cd \log{1-\pi} - y_i \cd \log{1-\pi})</span>
<span id="cb62-1557"><a href="#cb62-1557" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i \log{\pi} + (\log{1-\pi} - y_i \log{1-\pi})</span>
<span id="cb62-1558"><a href="#cb62-1558" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i \log{\pi} + \log{1-\pi} - y_i \log{\blue{1-\pi}}</span>
<span id="cb62-1559"><a href="#cb62-1559" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i \log{\pi} - y_i \log{\blue{1-\pi}} + \log{1-\pi}</span>
<span id="cb62-1560"><a href="#cb62-1560" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= (y_i \log{\pi} - y_i \log{\blue{1-\pi}}) + \log{1-\pi}</span>
<span id="cb62-1561"><a href="#cb62-1561" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i (\log{\red{\pi}} - \log{\blue{1-\pi}}) + \log{1-\pi}</span>
<span id="cb62-1562"><a href="#cb62-1562" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i \paren{\log{\frac{\red{\pi}}{\blue{1-\pi}}}} + \log{1-\pi}</span>
<span id="cb62-1563"><a href="#cb62-1563" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= y_i (\logit(\pi)) + \log{1-\pi}</span>
<span id="cb62-1564"><a href="#cb62-1564" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1565"><a href="#cb62-1565" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1566"><a href="#cb62-1566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1567"><a href="#cb62-1567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1568"><a href="#cb62-1568" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1569"><a href="#cb62-1569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1570"><a href="#cb62-1570" aria-hidden="true" tabindex="-1"></a><span class="fu">#### score function</span></span>
<span id="cb62-1571"><a href="#cb62-1571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1572"><a href="#cb62-1572" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1573"><a href="#cb62-1573" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1574"><a href="#cb62-1574" aria-hidden="true" tabindex="-1"></a>\ell'(\vb) </span>
<span id="cb62-1575"><a href="#cb62-1575" aria-hidden="true" tabindex="-1"></a>   &amp;\eqdef \deriv{\vb} \ell(\vb)</span>
<span id="cb62-1576"><a href="#cb62-1576" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=      \deriv{\vb} \sumin \ell_i(\vb)</span>
<span id="cb62-1577"><a href="#cb62-1577" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=      \sumin \deriv{\vb} \ell_i(\vb)</span>
<span id="cb62-1578"><a href="#cb62-1578" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;=      \sumin \ell'_i(\vb)</span>
<span id="cb62-1579"><a href="#cb62-1579" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1580"><a href="#cb62-1580" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1581"><a href="#cb62-1581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1582"><a href="#cb62-1582" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1583"><a href="#cb62-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1584"><a href="#cb62-1584" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1585"><a href="#cb62-1585" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1586"><a href="#cb62-1586" aria-hidden="true" tabindex="-1"></a>\ell_i'(\vb) </span>
<span id="cb62-1587"><a href="#cb62-1587" aria-hidden="true" tabindex="-1"></a>   &amp;= \deriv{\vb} y_i \paren{\logitf{\pi_i}} + \log{1-\pi_i}</span>
<span id="cb62-1588"><a href="#cb62-1588" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \deriv{\vb}\cb{y_i \paren{\vx_i'\vb} + \log{1-\pi_i}}</span>
<span id="cb62-1589"><a href="#cb62-1589" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \cb{y_i \deriv{\vb}\paren{\vx_i'\vb} + \deriv{\vb}\log{1-\pi_i}}</span>
<span id="cb62-1590"><a href="#cb62-1590" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \cb{\vx_i y_i + \deriv{\vb}\log{1-\expit(\vx_i'\vb)}}</span>
<span id="cb62-1591"><a href="#cb62-1591" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \cb{\vx_i y_i + \deriv{\vb}\log{\inv{1+\exp{\vx_i'\vb}}}}</span>
<span id="cb62-1592"><a href="#cb62-1592" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \cb{\vx_i y_i - \deriv{\vb}\log{1+\exp{\vx_i'\vb}}}</span>
<span id="cb62-1593"><a href="#cb62-1593" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1594"><a href="#cb62-1594" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1595"><a href="#cb62-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1596"><a href="#cb62-1596" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1597"><a href="#cb62-1597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1598"><a href="#cb62-1598" aria-hidden="true" tabindex="-1"></a>Now we need to apply the <span class="co">[</span><span class="ot">chain rule</span><span class="co">](math-prereqs.qmd#thm-chain-rule)</span>:</span>
<span id="cb62-1599"><a href="#cb62-1599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1600"><a href="#cb62-1600" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1601"><a href="#cb62-1601" aria-hidden="true" tabindex="-1"></a>\deriv{\beta}\log{1+\exp{\vx_i'\beta}} = </span>
<span id="cb62-1602"><a href="#cb62-1602" aria-hidden="true" tabindex="-1"></a>\frac{1}{1+\exp{\vx_i'\beta}} \deriv{\beta}\cb{1+\exp{\vx_i'\beta}}</span>
<span id="cb62-1603"><a href="#cb62-1603" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1604"><a href="#cb62-1604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1605"><a href="#cb62-1605" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1606"><a href="#cb62-1606" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1607"><a href="#cb62-1607" aria-hidden="true" tabindex="-1"></a>\deriv{\beta}\cb{1+\exp{\vx_i'\beta}}</span>
<span id="cb62-1608"><a href="#cb62-1608" aria-hidden="true" tabindex="-1"></a>   &amp;= \exp{\vx_i'\beta} \deriv{\beta}\vx_i'\beta</span>
<span id="cb62-1609"><a href="#cb62-1609" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \vx_i \exp{\vx_i'\beta} </span>
<span id="cb62-1610"><a href="#cb62-1610" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1611"><a href="#cb62-1611" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1612"><a href="#cb62-1612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1613"><a href="#cb62-1613" aria-hidden="true" tabindex="-1"></a>So:</span>
<span id="cb62-1614"><a href="#cb62-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1615"><a href="#cb62-1615" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1616"><a href="#cb62-1616" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1617"><a href="#cb62-1617" aria-hidden="true" tabindex="-1"></a>\deriv{\beta}\log{1+\exp{\vx_i'\beta}} </span>
<span id="cb62-1618"><a href="#cb62-1618" aria-hidden="true" tabindex="-1"></a>   &amp;= \frac{1}{1+\exp{\vx_i'\beta}} \exp{\vx_i'\beta} \vx_i</span>
<span id="cb62-1619"><a href="#cb62-1619" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \frac{\exp{\vx_i'\beta}}{1+\exp{\vx_i'\beta}}  \vx_i</span>
<span id="cb62-1620"><a href="#cb62-1620" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \vx_i \expitf{\vx_i'\beta}</span>
<span id="cb62-1621"><a href="#cb62-1621" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1622"><a href="#cb62-1622" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1623"><a href="#cb62-1623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1624"><a href="#cb62-1624" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1625"><a href="#cb62-1625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1626"><a href="#cb62-1626" aria-hidden="true" tabindex="-1"></a>So:</span>
<span id="cb62-1627"><a href="#cb62-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1628"><a href="#cb62-1628" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1629"><a href="#cb62-1629" aria-hidden="true" tabindex="-1"></a>\ba</span>
<span id="cb62-1630"><a href="#cb62-1630" aria-hidden="true" tabindex="-1"></a>\llik_i'(\vb) </span>
<span id="cb62-1631"><a href="#cb62-1631" aria-hidden="true" tabindex="-1"></a>&amp;= \vx_i y_i - \vx_i \expitf{\vx_i'\beta} </span>
<span id="cb62-1632"><a href="#cb62-1632" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \vx_i (y_i - \expitf{\vx_i'\beta})</span>
<span id="cb62-1633"><a href="#cb62-1633" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \vx_i (y_i - \pi_i)</span>
<span id="cb62-1634"><a href="#cb62-1634" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \vx_i (y_i - \Expp<span class="co">[</span><span class="ot">Y_i|\vX_i=\vx_i</span><span class="co">]</span>)</span>
<span id="cb62-1635"><a href="#cb62-1635" aria-hidden="true" tabindex="-1"></a><span class="sc">\\</span> &amp;= \vx_i \ \err(y_i|\vX_i=\vx_i)</span>
<span id="cb62-1636"><a href="#cb62-1636" aria-hidden="true" tabindex="-1"></a>\ea</span>
<span id="cb62-1637"><a href="#cb62-1637" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1638"><a href="#cb62-1638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1639"><a href="#cb62-1639" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1640"><a href="#cb62-1640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1641"><a href="#cb62-1641" aria-hidden="true" tabindex="-1"></a>This last expression is essentially the same as we found in <span class="co">[</span><span class="ot">linear regression</span><span class="co">](Linear-models-overview.qmd#eq-scorefun-linreg)</span>.</span>
<span id="cb62-1642"><a href="#cb62-1642" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1643"><a href="#cb62-1643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1644"><a href="#cb62-1644" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1645"><a href="#cb62-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1646"><a href="#cb62-1646" aria-hidden="true" tabindex="-1"></a>Putting the pieces of $\llik'(\vb)$ back together, we have:</span>
<span id="cb62-1647"><a href="#cb62-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1648"><a href="#cb62-1648" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1649"><a href="#cb62-1649" aria-hidden="true" tabindex="-1"></a>\llik'(\vb) = \sumin \cb{\vx_i(y_i - \expitf{\vx_i'\beta}) }</span>
<span id="cb62-1650"><a href="#cb62-1650" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1651"><a href="#cb62-1651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1652"><a href="#cb62-1652" aria-hidden="true" tabindex="-1"></a>Setting $\ell'(\vb; \vy) = 0$ gives us:</span>
<span id="cb62-1653"><a href="#cb62-1653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1654"><a href="#cb62-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1655"><a href="#cb62-1655" aria-hidden="true" tabindex="-1"></a>$$\sumin \cb{\vx_i(y_i - \expitf{\vx_i'\beta}) } = 0$$ {#eq-score-logistic}</span>
<span id="cb62-1656"><a href="#cb62-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1657"><a href="#cb62-1657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1658"><a href="#cb62-1658" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-1659"><a href="#cb62-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1660"><a href="#cb62-1660" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1661"><a href="#cb62-1661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1662"><a href="#cb62-1662" aria-hidden="true" tabindex="-1"></a>In general, the estimating equation $\ell'(\vb; \vy) = 0$ cannot</span>
<span id="cb62-1663"><a href="#cb62-1663" aria-hidden="true" tabindex="-1"></a>be solved analytically.</span>
<span id="cb62-1664"><a href="#cb62-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1665"><a href="#cb62-1665" aria-hidden="true" tabindex="-1"></a>Instead, we can use the <span class="co">[</span><span class="ot">Newton-Raphson method</span><span class="co">](intro-MLEs.qmd#sec-newton-raphson)</span>:</span>
<span id="cb62-1666"><a href="#cb62-1666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1667"><a href="#cb62-1667" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1668"><a href="#cb62-1668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1669"><a href="#cb62-1669" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1670"><a href="#cb62-1670" aria-hidden="true" tabindex="-1"></a>\esttmp{\theta} </span>
<span id="cb62-1671"><a href="#cb62-1671" aria-hidden="true" tabindex="-1"></a>\leftarrow \esttmp{\theta} - \inv{\hessf{\vec y;\esttmp{\theta}}} </span>
<span id="cb62-1672"><a href="#cb62-1672" aria-hidden="true" tabindex="-1"></a>\scoref{\vec y;\esttmp{\theta}}</span>
<span id="cb62-1673"><a href="#cb62-1673" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-1674"><a href="#cb62-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1675"><a href="#cb62-1675" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1676"><a href="#cb62-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1677"><a href="#cb62-1677" aria-hidden="true" tabindex="-1"></a>We make an iterative series of</span>
<span id="cb62-1678"><a href="#cb62-1678" aria-hidden="true" tabindex="-1"></a>guesses, and each guess helps us make the next guess better (i.e., higher</span>
<span id="cb62-1679"><a href="#cb62-1679" aria-hidden="true" tabindex="-1"></a>log-likelihood). You can see some information about this process like so:</span>
<span id="cb62-1680"><a href="#cb62-1680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1681"><a href="#cb62-1681" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1682"><a href="#cb62-1682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1685"><a href="#cb62-1685" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1686"><a href="#cb62-1686" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: out-glm-fitting-process</span></span>
<span id="cb62-1687"><a href="#cb62-1687" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb62-1688"><a href="#cb62-1688" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">8</span>)</span>
<span id="cb62-1689"><a href="#cb62-1689" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span></span>
<span id="cb62-1690"><a href="#cb62-1690" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1691"><a href="#cb62-1691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb62-1692"><a href="#cb62-1692" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">glm.control</span>(<span class="at">trace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-1693"><a href="#cb62-1693" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> _,</span>
<span id="cb62-1694"><a href="#cb62-1694" aria-hidden="true" tabindex="-1"></a>    <span class="at">formula =</span> chd69 <span class="sc">==</span> <span class="st">"Yes"</span> <span class="sc">~</span> dibpat <span class="sc">*</span> age,</span>
<span id="cb62-1695"><a href="#cb62-1695" aria-hidden="true" tabindex="-1"></a>    <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb62-1696"><a href="#cb62-1696" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1697"><a href="#cb62-1697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1698"><a href="#cb62-1698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1699"><a href="#cb62-1699" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-1700"><a href="#cb62-1700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1701"><a href="#cb62-1701" aria-hidden="true" tabindex="-1"></a>After each iteration of the fitting procedure, the deviance</span>
<span id="cb62-1702"><a href="#cb62-1702" aria-hidden="true" tabindex="-1"></a>($2(\ell_{\text{full}} - \ell(\hat\beta))$ ) is printed. You can see</span>
<span id="cb62-1703"><a href="#cb62-1703" aria-hidden="true" tabindex="-1"></a>that the algorithm took six iterations to converge to a solution where</span>
<span id="cb62-1704"><a href="#cb62-1704" aria-hidden="true" tabindex="-1"></a>the likelihood wasn't changing much anymore.</span>
<span id="cb62-1705"><a href="#cb62-1705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1706"><a href="#cb62-1706" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1707"><a href="#cb62-1707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1708"><a href="#cb62-1708" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model comparisons for logistic models {#sec-gof}</span></span>
<span id="cb62-1709"><a href="#cb62-1709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1710"><a href="#cb62-1710" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deviance test</span></span>
<span id="cb62-1711"><a href="#cb62-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1712"><a href="#cb62-1712" aria-hidden="true" tabindex="-1"></a>We can compare the maximized log-likelihood of our model,</span>
<span id="cb62-1713"><a href="#cb62-1713" aria-hidden="true" tabindex="-1"></a>$\ell(\hat\beta; \mathbf x)$, versus the log-likelihood of the full</span>
<span id="cb62-1714"><a href="#cb62-1714" aria-hidden="true" tabindex="-1"></a>model (aka saturated model aka maximal model), $\ell_{\text{full}}$,</span>
<span id="cb62-1715"><a href="#cb62-1715" aria-hidden="true" tabindex="-1"></a>which has one parameter per covariate pattern. With enough data,</span>
<span id="cb62-1716"><a href="#cb62-1716" aria-hidden="true" tabindex="-1"></a>$2(\ell_{\text{full}} - \ell(\hat\beta; \mathbf x)) \dot \sim \chi^2(N - p)$,</span>
<span id="cb62-1717"><a href="#cb62-1717" aria-hidden="true" tabindex="-1"></a>where $N$ is the number of distinct covariate patterns and $p$ is the</span>
<span id="cb62-1718"><a href="#cb62-1718" aria-hidden="true" tabindex="-1"></a>number of $\beta$ parameters in our model. A significant p-value for</span>
<span id="cb62-1719"><a href="#cb62-1719" aria-hidden="true" tabindex="-1"></a>this **deviance** statistic indicates that there's some detectable</span>
<span id="cb62-1720"><a href="#cb62-1720" aria-hidden="true" tabindex="-1"></a>pattern in the data that our model isn't flexible enough to catch.</span>
<span id="cb62-1721"><a href="#cb62-1721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1722"><a href="#cb62-1722" aria-hidden="true" tabindex="-1"></a>::: callout-caution</span>
<span id="cb62-1723"><a href="#cb62-1723" aria-hidden="true" tabindex="-1"></a>The deviance statistic needs to have a large amount of data **for each</span>
<span id="cb62-1724"><a href="#cb62-1724" aria-hidden="true" tabindex="-1"></a>covariate pattern** for the $\chi^2$ approximation to hold. A guideline</span>
<span id="cb62-1725"><a href="#cb62-1725" aria-hidden="true" tabindex="-1"></a>from Dobson is that if there are $q$ distinct covariate patterns</span>
<span id="cb62-1726"><a href="#cb62-1726" aria-hidden="true" tabindex="-1"></a>$x_1...,x_q$, with $n_1,...,n_q$ observations per pattern, then the</span>
<span id="cb62-1727"><a href="#cb62-1727" aria-hidden="true" tabindex="-1"></a>expected frequencies $n_k \cdot \pi(x_k)$ should be at least 1 for every</span>
<span id="cb62-1728"><a href="#cb62-1728" aria-hidden="true" tabindex="-1"></a>pattern $k\in 1:q$.</span>
<span id="cb62-1729"><a href="#cb62-1729" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1730"><a href="#cb62-1730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1731"><a href="#cb62-1731" aria-hidden="true" tabindex="-1"></a>If you have covariates measured on a continuous scale, you may not be</span>
<span id="cb62-1732"><a href="#cb62-1732" aria-hidden="true" tabindex="-1"></a>able to use the deviance tests to assess goodness of fit.</span>
<span id="cb62-1733"><a href="#cb62-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1734"><a href="#cb62-1734" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hosmer-Lemeshow test</span></span>
<span id="cb62-1735"><a href="#cb62-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1736"><a href="#cb62-1736" aria-hidden="true" tabindex="-1"></a>If our covariate patterns produce groups that are too small, a</span>
<span id="cb62-1737"><a href="#cb62-1737" aria-hidden="true" tabindex="-1"></a>reasonable solution is to make bigger groups by merging some of the</span>
<span id="cb62-1738"><a href="#cb62-1738" aria-hidden="true" tabindex="-1"></a>covariate-pattern groups together.</span>
<span id="cb62-1739"><a href="#cb62-1739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1740"><a href="#cb62-1740" aria-hidden="true" tabindex="-1"></a>Hosmer and Lemeshow (1980) proposed that we group the patterns by their</span>
<span id="cb62-1741"><a href="#cb62-1741" aria-hidden="true" tabindex="-1"></a>predicted probabilities according to the model of interest. For example,</span>
<span id="cb62-1742"><a href="#cb62-1742" aria-hidden="true" tabindex="-1"></a>you could group all of the observations with predicted probabilities of</span>
<span id="cb62-1743"><a href="#cb62-1743" aria-hidden="true" tabindex="-1"></a>10% or less together, then group the observations with 11%-20%</span>
<span id="cb62-1744"><a href="#cb62-1744" aria-hidden="true" tabindex="-1"></a>probability together, and so on; $g=10$ categories in all.</span>
<span id="cb62-1745"><a href="#cb62-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1746"><a href="#cb62-1746" aria-hidden="true" tabindex="-1"></a>Then we can construct a statistic</span>
<span id="cb62-1747"><a href="#cb62-1747" aria-hidden="true" tabindex="-1"></a>$$X^2 = \sum_{c=1}^g \frac{(o_c - e_c)^2}{e_c}$$ where $o_c$ is the</span>
<span id="cb62-1748"><a href="#cb62-1748" aria-hidden="true" tabindex="-1"></a>number of events *observed* in group $c$, and $e_c$ is the number of</span>
<span id="cb62-1749"><a href="#cb62-1749" aria-hidden="true" tabindex="-1"></a>events expected in group $c$ (based on the sum of the fitted values</span>
<span id="cb62-1750"><a href="#cb62-1750" aria-hidden="true" tabindex="-1"></a>$\hat\pi_i$ for observations in group $c$).</span>
<span id="cb62-1751"><a href="#cb62-1751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1752"><a href="#cb62-1752" aria-hidden="true" tabindex="-1"></a>If each group has enough observations in it, you can compare $X^2$ to a</span>
<span id="cb62-1753"><a href="#cb62-1753" aria-hidden="true" tabindex="-1"></a>$\chi^2$ distribution; by simulation, the degrees of freedom has been</span>
<span id="cb62-1754"><a href="#cb62-1754" aria-hidden="true" tabindex="-1"></a>found to be approximately $g-2$.</span>
<span id="cb62-1755"><a href="#cb62-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1756"><a href="#cb62-1756" aria-hidden="true" tabindex="-1"></a>For our CHD model, this procedure would be:</span>
<span id="cb62-1757"><a href="#cb62-1757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1760"><a href="#cb62-1760" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1761"><a href="#cb62-1761" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span></span>
<span id="cb62-1762"><a href="#cb62-1762" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1763"><a href="#cb62-1763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-1764"><a href="#cb62-1764" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb62-1765"><a href="#cb62-1765" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> pred_probs_glm1 <span class="sc">|&gt;</span></span>
<span id="cb62-1766"><a href="#cb62-1766" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(</span>
<span id="cb62-1767"><a href="#cb62-1767" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>),</span>
<span id="cb62-1768"><a href="#cb62-1768" aria-hidden="true" tabindex="-1"></a>        <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb62-1769"><a href="#cb62-1769" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb62-1770"><a href="#cb62-1770" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1771"><a href="#cb62-1771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1772"><a href="#cb62-1772" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">&lt;-</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1773"><a href="#cb62-1773" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1774"><a href="#cb62-1774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-1775"><a href="#cb62-1775" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb62-1776"><a href="#cb62-1776" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb62-1777"><a href="#cb62-1777" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb62-1778"><a href="#cb62-1778" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb62-1779"><a href="#cb62-1779" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1780"><a href="#cb62-1780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1781"><a href="#cb62-1781" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb62-1782"><a href="#cb62-1782" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span>
<span id="cb62-1783"><a href="#cb62-1783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1784"><a href="#cb62-1784" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> HL_table <span class="sc">|&gt;</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1785"><a href="#cb62-1785" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-1786"><a href="#cb62-1786" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o <span class="sc">-</span> e)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> e)</span>
<span id="cb62-1787"><a href="#cb62-1787" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-1788"><a href="#cb62-1788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb62-1789"><a href="#cb62-1789" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb62-1790"><a href="#cb62-1790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1791"><a href="#cb62-1791" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb62-1792"><a href="#cb62-1792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1793"><a href="#cb62-1793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1794"><a href="#cb62-1794" aria-hidden="true" tabindex="-1"></a>Our statistic is $X^2 = <span class="in">`r X2`</span>$; $p(\chi^2(1) &gt; <span class="in">`r X2`</span>) = <span class="in">`r pval1`</span>$,</span>
<span id="cb62-1795"><a href="#cb62-1795" aria-hidden="true" tabindex="-1"></a>which is our p-value for detecting a lack of goodness of fit.</span>
<span id="cb62-1796"><a href="#cb62-1796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1797"><a href="#cb62-1797" aria-hidden="true" tabindex="-1"></a>Unfortunately that grouping plan left us with just three categories with</span>
<span id="cb62-1798"><a href="#cb62-1798" aria-hidden="true" tabindex="-1"></a>any observations, so instead of grouping by 10% increments of predicted</span>
<span id="cb62-1799"><a href="#cb62-1799" aria-hidden="true" tabindex="-1"></a>probability, typically analysts use deciles of the predicted</span>
<span id="cb62-1800"><a href="#cb62-1800" aria-hidden="true" tabindex="-1"></a>probabilities:</span>
<span id="cb62-1801"><a href="#cb62-1801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1804"><a href="#cb62-1804" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1805"><a href="#cb62-1805" aria-hidden="true" tabindex="-1"></a>wcgs <span class="ot">&lt;-</span></span>
<span id="cb62-1806"><a href="#cb62-1806" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1807"><a href="#cb62-1807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-1808"><a href="#cb62-1808" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_probs_glm1 =</span> chd_glm_strat <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb62-1809"><a href="#cb62-1809" aria-hidden="true" tabindex="-1"></a>    <span class="at">pred_prob_cats1 =</span> pred_probs_glm1 <span class="sc">|&gt;</span></span>
<span id="cb62-1810"><a href="#cb62-1810" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cut</span>(</span>
<span id="cb62-1811"><a href="#cb62-1811" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">quantile</span>(pred_probs_glm1, <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">1</span>)),</span>
<span id="cb62-1812"><a href="#cb62-1812" aria-hidden="true" tabindex="-1"></a>        <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb62-1813"><a href="#cb62-1813" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb62-1814"><a href="#cb62-1814" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1815"><a href="#cb62-1815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1816"><a href="#cb62-1816" aria-hidden="true" tabindex="-1"></a>HL_table <span class="ot">&lt;-</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1817"><a href="#cb62-1817" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1818"><a href="#cb62-1818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-1819"><a href="#cb62-1819" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> pred_prob_cats1,</span>
<span id="cb62-1820"><a href="#cb62-1820" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb62-1821"><a href="#cb62-1821" aria-hidden="true" tabindex="-1"></a>    <span class="at">o =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb62-1822"><a href="#cb62-1822" aria-hidden="true" tabindex="-1"></a>    <span class="at">e =</span> <span class="fu">sum</span>(pred_probs_glm1)</span>
<span id="cb62-1823"><a href="#cb62-1823" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1824"><a href="#cb62-1824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1825"><a href="#cb62-1825" aria-hidden="true" tabindex="-1"></a>HL_table <span class="sc">|&gt;</span> <span class="fu">pander</span>()</span>
<span id="cb62-1826"><a href="#cb62-1826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1827"><a href="#cb62-1827" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> HL_table <span class="sc">|&gt;</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1828"><a href="#cb62-1828" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-1829"><a href="#cb62-1829" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">X^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>((o <span class="sc">-</span> e)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> e)</span>
<span id="cb62-1830"><a href="#cb62-1830" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb62-1831"><a href="#cb62-1831" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(<span class="st">`</span><span class="at">X^2</span><span class="st">`</span>)</span>
<span id="cb62-1832"><a href="#cb62-1832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1833"><a href="#cb62-1833" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(X2)</span>
<span id="cb62-1834"><a href="#cb62-1834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1835"><a href="#cb62-1835" aria-hidden="true" tabindex="-1"></a>pval1 <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(X2, <span class="at">lower =</span> <span class="cn">FALSE</span>, <span class="at">df =</span> <span class="fu">nrow</span>(HL_table) <span class="sc">-</span> <span class="dv">2</span>)</span>
<span id="cb62-1836"><a href="#cb62-1836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1837"><a href="#cb62-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1838"><a href="#cb62-1838" aria-hidden="true" tabindex="-1"></a>Now we have more evenly split categories. The p-value is $<span class="in">`r pval1`</span>$,</span>
<span id="cb62-1839"><a href="#cb62-1839" aria-hidden="true" tabindex="-1"></a>still not significant.</span>
<span id="cb62-1840"><a href="#cb62-1840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1841"><a href="#cb62-1841" aria-hidden="true" tabindex="-1"></a>Graphically, we have compared:</span>
<span id="cb62-1842"><a href="#cb62-1842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1845"><a href="#cb62-1845" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1846"><a href="#cb62-1846" aria-hidden="true" tabindex="-1"></a>HL_plot <span class="ot">&lt;-</span> <span class="co"># nolint: object_name_linter</span></span>
<span id="cb62-1847"><a href="#cb62-1847" aria-hidden="true" tabindex="-1"></a>  HL_table <span class="sc">|&gt;</span></span>
<span id="cb62-1848"><a href="#cb62-1848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pred_prob_cats1)) <span class="sc">+</span></span>
<span id="cb62-1849"><a href="#cb62-1849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(</span>
<span id="cb62-1850"><a href="#cb62-1850" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">x =</span> pred_prob_cats1, <span class="at">group =</span> <span class="st">"Expected"</span>, <span class="at">col =</span> <span class="st">"Expected"</span>)</span>
<span id="cb62-1851"><a href="#cb62-1851" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1852"><a href="#cb62-1852" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> e, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Expected"</span>)) <span class="sc">+</span></span>
<span id="cb62-1853"><a href="#cb62-1853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">size =</span> n, <span class="at">col =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb62-1854"><a href="#cb62-1854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> o, <span class="at">col =</span> <span class="st">"Observed"</span>, <span class="at">group =</span> <span class="st">"Observed"</span>)) <span class="sc">+</span></span>
<span id="cb62-1855"><a href="#cb62-1855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb62-1856"><a href="#cb62-1856" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb62-1857"><a href="#cb62-1857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"number of CHD events"</span>) <span class="sc">+</span></span>
<span id="cb62-1858"><a href="#cb62-1858" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>))</span>
<span id="cb62-1859"><a href="#cb62-1859" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1860"><a href="#cb62-1860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1861"><a href="#cb62-1861" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb62-1864"><a href="#cb62-1864" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1865"><a href="#cb62-1865" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(HL_plot)</span>
<span id="cb62-1866"><a href="#cb62-1866" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1867"><a href="#cb62-1867" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1868"><a href="#cb62-1868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1869"><a href="#cb62-1869" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-1872"><a href="#cb62-1872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1873"><a href="#cb62-1873" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(HL_plot)</span>
<span id="cb62-1874"><a href="#cb62-1874" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1875"><a href="#cb62-1875" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1876"><a href="#cb62-1876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1877"><a href="#cb62-1877" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparing models</span></span>
<span id="cb62-1878"><a href="#cb62-1878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1879"><a href="#cb62-1879" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>AIC = $-2 * \ell(\hat\theta) + 2 * p$ <span class="sc">\[</span>lower is better<span class="sc">\]</span></span>
<span id="cb62-1880"><a href="#cb62-1880" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>BIC = $-2 * \ell(\hat\theta) + p * \text{log}(n)$ <span class="sc">\[</span>lower is</span>
<span id="cb62-1881"><a href="#cb62-1881" aria-hidden="true" tabindex="-1"></a>better<span class="sc">\]</span></span>
<span id="cb62-1882"><a href="#cb62-1882" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>likelihood ratio <span class="sc">\[</span>higher is better<span class="sc">\]</span></span>
<span id="cb62-1883"><a href="#cb62-1883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1884"><a href="#cb62-1884" aria-hidden="true" tabindex="-1"></a><span class="fu">## Residual-based diagnostics</span></span>
<span id="cb62-1885"><a href="#cb62-1885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1886"><a href="#cb62-1886" aria-hidden="true" tabindex="-1"></a><span class="fu">### Logistic regression residuals only work for grouped data</span></span>
<span id="cb62-1887"><a href="#cb62-1887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1888"><a href="#cb62-1888" aria-hidden="true" tabindex="-1"></a>Residuals only work if there is more than one observation for most</span>
<span id="cb62-1889"><a href="#cb62-1889" aria-hidden="true" tabindex="-1"></a>covariate patterns.</span>
<span id="cb62-1890"><a href="#cb62-1890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1891"><a href="#cb62-1891" aria-hidden="true" tabindex="-1"></a>Here we will create the grouped-data version of our CHD model from the</span>
<span id="cb62-1892"><a href="#cb62-1892" aria-hidden="true" tabindex="-1"></a>WCGS study:</span>
<span id="cb62-1893"><a href="#cb62-1893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1896"><a href="#cb62-1896" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1897"><a href="#cb62-1897" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">&lt;-</span></span>
<span id="cb62-1898"><a href="#cb62-1898" aria-hidden="true" tabindex="-1"></a>  wcgs <span class="sc">|&gt;</span></span>
<span id="cb62-1899"><a href="#cb62-1899" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb62-1900"><a href="#cb62-1900" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> <span class="fu">c</span>(dibpat, age),</span>
<span id="cb62-1901"><a href="#cb62-1901" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb62-1902"><a href="#cb62-1902" aria-hidden="true" tabindex="-1"></a>    <span class="at">chd =</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"Yes"</span>),</span>
<span id="cb62-1903"><a href="#cb62-1903" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">!chd</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(chd69 <span class="sc">==</span> <span class="st">"No"</span>)</span>
<span id="cb62-1904"><a href="#cb62-1904" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1905"><a href="#cb62-1905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1906"><a href="#cb62-1906" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb62-1907"><a href="#cb62-1907" aria-hidden="true" tabindex="-1"></a>  <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(chd, <span class="st">`</span><span class="at">!chd</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">+</span> dibpat<span class="sc">:</span>age <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb62-1908"><a href="#cb62-1908" aria-hidden="true" tabindex="-1"></a>  <span class="st">"data"</span> <span class="ot">=</span> wcgs_grouped,</span>
<span id="cb62-1909"><a href="#cb62-1909" aria-hidden="true" tabindex="-1"></a>  <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb62-1910"><a href="#cb62-1910" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1911"><a href="#cb62-1911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1912"><a href="#cb62-1912" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-1913"><a href="#cb62-1913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-1914"><a href="#cb62-1914" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-1915"><a href="#cb62-1915" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1916"><a href="#cb62-1916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1917"><a href="#cb62-1917" aria-hidden="true" tabindex="-1"></a><span class="fu">### (Response) residuals</span></span>
<span id="cb62-1918"><a href="#cb62-1918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1919"><a href="#cb62-1919" aria-hidden="true" tabindex="-1"></a>$$e_k \eqdef \bar y_k - \hat{\pi}(x_k)$$</span>
<span id="cb62-1920"><a href="#cb62-1920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1921"><a href="#cb62-1921" aria-hidden="true" tabindex="-1"></a>($k$ indexes the covariate patterns)</span>
<span id="cb62-1922"><a href="#cb62-1922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1923"><a href="#cb62-1923" aria-hidden="true" tabindex="-1"></a>We can graph these residuals $e_k$ against the fitted values</span>
<span id="cb62-1924"><a href="#cb62-1924" aria-hidden="true" tabindex="-1"></a>$\hat\pi(x_k)$:</span>
<span id="cb62-1925"><a href="#cb62-1925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1928"><a href="#cb62-1928" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1929"><a href="#cb62-1929" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: show</span></span>
<span id="cb62-1930"><a href="#cb62-1930" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">&lt;-</span></span>
<span id="cb62-1931"><a href="#cb62-1931" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-1932"><a href="#cb62-1932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-1933"><a href="#cb62-1933" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb62-1934"><a href="#cb62-1934" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="cb62-1935"><a href="#cb62-1935" aria-hidden="true" tabindex="-1"></a>    <span class="at">response_resids =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb62-1936"><a href="#cb62-1936" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1937"><a href="#cb62-1937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1938"><a href="#cb62-1938" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="ot">&lt;-</span></span>
<span id="cb62-1939"><a href="#cb62-1939" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-1940"><a href="#cb62-1940" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb62-1941"><a href="#cb62-1941" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb62-1942"><a href="#cb62-1942" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted,</span>
<span id="cb62-1943"><a href="#cb62-1943" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> response_resids</span>
<span id="cb62-1944"><a href="#cb62-1944" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-1945"><a href="#cb62-1945" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1946"><a href="#cb62-1946" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb62-1947"><a href="#cb62-1947" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="cb62-1948"><a href="#cb62-1948" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1949"><a href="#cb62-1949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb62-1950"><a href="#cb62-1950" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>( <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1951"><a href="#cb62-1951" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1952"><a href="#cb62-1952" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>( <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1953"><a href="#cb62-1953" aria-hidden="true" tabindex="-1"></a>      <span class="at">span =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1954"><a href="#cb62-1954" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="dv">1</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1955"><a href="#cb62-1955" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"symmetric"</span>, <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1956"><a href="#cb62-1956" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations =</span> <span class="dv">3</span></span>
<span id="cb62-1957"><a href="#cb62-1957" aria-hidden="true" tabindex="-1"></a>    ), <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1958"><a href="#cb62-1958" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> stats<span class="sc">::</span>loess</span>
<span id="cb62-1959"><a href="#cb62-1959" aria-hidden="true" tabindex="-1"></a>  ) <span class="co">#&lt;1&gt;</span></span>
<span id="cb62-1960"><a href="#cb62-1960" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1961"><a href="#cb62-1961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1962"><a href="#cb62-1962" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>Don't worry about these options for now; I chose them to match</span>
<span id="cb62-1963"><a href="#cb62-1963" aria-hidden="true" tabindex="-1"></a><span class="in">`autoplot()`</span> as closely as I can. <span class="in">`plot.glm`</span> and <span class="in">`autoplot`</span> use</span>
<span id="cb62-1964"><a href="#cb62-1964" aria-hidden="true" tabindex="-1"></a><span class="in">`stats::lowess`</span> instead of <span class="in">`stats::loess`</span>; <span class="in">`stats::lowess`</span> is older,</span>
<span id="cb62-1965"><a href="#cb62-1965" aria-hidden="true" tabindex="-1"></a>hard to use with <span class="in">`geom_smooth`</span>, and hard to match exactly with</span>
<span id="cb62-1966"><a href="#cb62-1966" aria-hidden="true" tabindex="-1"></a><span class="in">`stats::loess`</span>; see https://support.bioconductor.org/p/2323/.<span class="sc">\]</span></span>
<span id="cb62-1967"><a href="#cb62-1967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1968"><a href="#cb62-1968" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-1971"><a href="#cb62-1971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1972"><a href="#cb62-1972" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-1973"><a href="#cb62-1973" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-1974"><a href="#cb62-1974" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1975"><a href="#cb62-1975" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1976"><a href="#cb62-1976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1977"><a href="#cb62-1977" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb62-1980"><a href="#cb62-1980" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1981"><a href="#cb62-1981" aria-hidden="true" tabindex="-1"></a>wcgs_response_resid_plot <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span>
<span id="cb62-1982"><a href="#cb62-1982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1983"><a href="#cb62-1983" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-1984"><a href="#cb62-1984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1985"><a href="#cb62-1985" aria-hidden="true" tabindex="-1"></a>We can see a slight fan-shape here: observations on the right have</span>
<span id="cb62-1986"><a href="#cb62-1986" aria-hidden="true" tabindex="-1"></a>larger variance (as expected since $var(\bar y) = \pi(1-\pi)/n$ is</span>
<span id="cb62-1987"><a href="#cb62-1987" aria-hidden="true" tabindex="-1"></a>maximized when $\pi = 0.5$).</span>
<span id="cb62-1988"><a href="#cb62-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1989"><a href="#cb62-1989" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pearson residuals</span></span>
<span id="cb62-1990"><a href="#cb62-1990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1991"><a href="#cb62-1991" aria-hidden="true" tabindex="-1"></a>The fan-shape in the response residuals plot isn't necessarily a concern</span>
<span id="cb62-1992"><a href="#cb62-1992" aria-hidden="true" tabindex="-1"></a>here, since we haven't made an assumption of constant residual variance,</span>
<span id="cb62-1993"><a href="#cb62-1993" aria-hidden="true" tabindex="-1"></a>as we did for linear regression.</span>
<span id="cb62-1994"><a href="#cb62-1994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1995"><a href="#cb62-1995" aria-hidden="true" tabindex="-1"></a>However, we might want to divide by the standard error in order to make</span>
<span id="cb62-1996"><a href="#cb62-1996" aria-hidden="true" tabindex="-1"></a>the graph easier to interpret. Here's one way to do that:</span>
<span id="cb62-1997"><a href="#cb62-1997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1998"><a href="#cb62-1998" aria-hidden="true" tabindex="-1"></a>The Pearson (chi-squared) residual for covariate pattern $k$ is: $$</span>
<span id="cb62-1999"><a href="#cb62-1999" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-2000"><a href="#cb62-2000" aria-hidden="true" tabindex="-1"></a>X_k &amp;= \frac{\bar y_k - \hat\pi_k}{\sqrt{\hat \pi_k (1-\hat\pi_k)/n_k}}</span>
<span id="cb62-2001"><a href="#cb62-2001" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-2002"><a href="#cb62-2002" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-2003"><a href="#cb62-2003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2004"><a href="#cb62-2004" aria-hidden="true" tabindex="-1"></a>where $$</span>
<span id="cb62-2005"><a href="#cb62-2005" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb62-2006"><a href="#cb62-2006" aria-hidden="true" tabindex="-1"></a>\hat\pi_k </span>
<span id="cb62-2007"><a href="#cb62-2007" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \hat\pi(x_k)<span class="sc">\\</span></span>
<span id="cb62-2008"><a href="#cb62-2008" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \hat P(Y=1|X=x_k)<span class="sc">\\</span> </span>
<span id="cb62-2009"><a href="#cb62-2009" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \expit(x_i'\hat \beta)<span class="sc">\\</span></span>
<span id="cb62-2010"><a href="#cb62-2010" aria-hidden="true" tabindex="-1"></a>&amp;\eqdef \expit(\hat \beta_0 + \sum_{j=1}^p \hat \beta_j x_{ij})</span>
<span id="cb62-2011"><a href="#cb62-2011" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb62-2012"><a href="#cb62-2012" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb62-2013"><a href="#cb62-2013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2014"><a href="#cb62-2014" aria-hidden="true" tabindex="-1"></a>Let's take a look at the Pearson residuals for our CHD model from the</span>
<span id="cb62-2015"><a href="#cb62-2015" aria-hidden="true" tabindex="-1"></a>WCGS data (graphed against the fitted values on the logit scale):</span>
<span id="cb62-2016"><a href="#cb62-2016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2019"><a href="#cb62-2019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2020"><a href="#cb62-2020" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb62-2021"><a href="#cb62-2021" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2022"><a href="#cb62-2022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2023"><a href="#cb62-2023" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-2026"><a href="#cb62-2026" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2027"><a href="#cb62-2027" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-2028"><a href="#cb62-2028" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2029"><a href="#cb62-2029" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2030"><a href="#cb62-2030" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2031"><a href="#cb62-2031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2032"><a href="#cb62-2032" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb62-2035"><a href="#cb62-2035" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2036"><a href="#cb62-2036" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2037"><a href="#cb62-2037" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2038"><a href="#cb62-2038" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2039"><a href="#cb62-2039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2040"><a href="#cb62-2040" aria-hidden="true" tabindex="-1"></a>The fan-shape is gone, and these residuals don't show any obvious signs</span>
<span id="cb62-2041"><a href="#cb62-2041" aria-hidden="true" tabindex="-1"></a>of model fit issues.</span>
<span id="cb62-2042"><a href="#cb62-2042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2043"><a href="#cb62-2043" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pearson residuals plot for `beetles` data</span></span>
<span id="cb62-2044"><a href="#cb62-2044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2045"><a href="#cb62-2045" aria-hidden="true" tabindex="-1"></a>If we create the same plot for the <span class="in">`beetles`</span> model, we see some strong</span>
<span id="cb62-2046"><a href="#cb62-2046" aria-hidden="true" tabindex="-1"></a>evidence of a lack of fit:</span>
<span id="cb62-2047"><a href="#cb62-2047" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2048"><a href="#cb62-2048" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb62-2051"><a href="#cb62-2051" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2052"><a href="#cb62-2052" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(beetles_glm_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2053"><a href="#cb62-2053" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2054"><a href="#cb62-2054" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2055"><a href="#cb62-2055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2056"><a href="#cb62-2056" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-2059"><a href="#cb62-2059" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2060"><a href="#cb62-2060" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-2061"><a href="#cb62-2061" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(beetles_glm_grouped, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2062"><a href="#cb62-2062" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2063"><a href="#cb62-2063" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2064"><a href="#cb62-2064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2065"><a href="#cb62-2065" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Pearson residuals with individual (ungrouped) data</span></span>
<span id="cb62-2066"><a href="#cb62-2066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2067"><a href="#cb62-2067" aria-hidden="true" tabindex="-1"></a>What happens if we try to compute residuals without grouping the data by</span>
<span id="cb62-2068"><a href="#cb62-2068" aria-hidden="true" tabindex="-1"></a>covariate pattern?</span>
<span id="cb62-2069"><a href="#cb62-2069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2072"><a href="#cb62-2072" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2073"><a href="#cb62-2073" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb62-2074"><a href="#cb62-2074" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2075"><a href="#cb62-2075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2076"><a href="#cb62-2076" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb62-2079"><a href="#cb62-2079" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2080"><a href="#cb62-2080" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2081"><a href="#cb62-2081" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2082"><a href="#cb62-2082" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2083"><a href="#cb62-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2084"><a href="#cb62-2084" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-2087"><a href="#cb62-2087" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2088"><a href="#cb62-2088" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-2089"><a href="#cb62-2089" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(chd_glm_strat, <span class="at">which =</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2090"><a href="#cb62-2090" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2091"><a href="#cb62-2091" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2092"><a href="#cb62-2092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2093"><a href="#cb62-2093" aria-hidden="true" tabindex="-1"></a>Meaningless.</span>
<span id="cb62-2094"><a href="#cb62-2094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2095"><a href="#cb62-2095" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Residuals plot by hand (*optional section*)</span></span>
<span id="cb62-2096"><a href="#cb62-2096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2097"><a href="#cb62-2097" aria-hidden="true" tabindex="-1"></a>If you want to check your understanding of what these residual plots</span>
<span id="cb62-2098"><a href="#cb62-2098" aria-hidden="true" tabindex="-1"></a>are, try building them yourself:</span>
<span id="cb62-2099"><a href="#cb62-2099" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2102"><a href="#cb62-2102" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2103"><a href="#cb62-2103" aria-hidden="true" tabindex="-1"></a>wcgs_grouped <span class="ot">&lt;-</span></span>
<span id="cb62-2104"><a href="#cb62-2104" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-2105"><a href="#cb62-2105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-2106"><a href="#cb62-2106" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">fitted</span>(),</span>
<span id="cb62-2107"><a href="#cb62-2107" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted_logit =</span> fitted <span class="sc">|&gt;</span> <span class="fu">logit</span>(),</span>
<span id="cb62-2108"><a href="#cb62-2108" aria-hidden="true" tabindex="-1"></a>    <span class="at">resids =</span> chd_glm_strat_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb62-2109"><a href="#cb62-2109" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-2110"><a href="#cb62-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2111"><a href="#cb62-2111" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="ot">&lt;-</span></span>
<span id="cb62-2112"><a href="#cb62-2112" aria-hidden="true" tabindex="-1"></a>  wcgs_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-2113"><a href="#cb62-2113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb62-2114"><a href="#cb62-2114" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb62-2115"><a href="#cb62-2115" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> fitted_logit,</span>
<span id="cb62-2116"><a href="#cb62-2116" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> resids</span>
<span id="cb62-2117"><a href="#cb62-2117" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-2118"><a href="#cb62-2118" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-2119"><a href="#cb62-2119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb62-2120"><a href="#cb62-2120" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">col =</span> dibpat)</span>
<span id="cb62-2121"><a href="#cb62-2121" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-2122"><a href="#cb62-2122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb62-2123"><a href="#cb62-2123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(</span>
<span id="cb62-2124"><a href="#cb62-2124" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb62-2125"><a href="#cb62-2125" aria-hidden="true" tabindex="-1"></a>    <span class="at">method.args =</span> <span class="fu">list</span>(</span>
<span id="cb62-2126"><a href="#cb62-2126" aria-hidden="true" tabindex="-1"></a>      <span class="at">span =</span> <span class="dv">2</span> <span class="sc">/</span> <span class="dv">3</span>,</span>
<span id="cb62-2127"><a href="#cb62-2127" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="dv">1</span>,</span>
<span id="cb62-2128"><a href="#cb62-2128" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="st">"symmetric"</span>,</span>
<span id="cb62-2129"><a href="#cb62-2129" aria-hidden="true" tabindex="-1"></a>      <span class="at">iterations =</span> <span class="dv">3</span>,</span>
<span id="cb62-2130"><a href="#cb62-2130" aria-hidden="true" tabindex="-1"></a>      <span class="at">surface =</span> <span class="st">"direct"</span></span>
<span id="cb62-2131"><a href="#cb62-2131" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb62-2132"><a href="#cb62-2132" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> stats<span class="sc">::</span>loess</span>
<span id="cb62-2133"><a href="#cb62-2133" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-2134"><a href="#cb62-2134" aria-hidden="true" tabindex="-1"></a><span class="co"># plot.glm and autoplot use stats::lowess, which is hard to use with</span></span>
<span id="cb62-2135"><a href="#cb62-2135" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_smooth and hard to match exactly;</span></span>
<span id="cb62-2136"><a href="#cb62-2136" aria-hidden="true" tabindex="-1"></a><span class="co"># see https://support.bioconductor.org/p/2323/</span></span>
<span id="cb62-2137"><a href="#cb62-2137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2138"><a href="#cb62-2138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2139"><a href="#cb62-2139" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="pdf"}</span>
<span id="cb62-2142"><a href="#cb62-2142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2143"><a href="#cb62-2143" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-2144"><a href="#cb62-2144" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb62-2145"><a href="#cb62-2145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2146"><a href="#cb62-2146" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2147"><a href="#cb62-2147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2148"><a href="#cb62-2148" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb62-2151"><a href="#cb62-2151" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2152"><a href="#cb62-2152" aria-hidden="true" tabindex="-1"></a>wcgs_resid_plot1 <span class="sc">|&gt;</span> <span class="fu">ggplotly</span>()</span>
<span id="cb62-2153"><a href="#cb62-2153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2154"><a href="#cb62-2154" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2155"><a href="#cb62-2155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2156"><a href="#cb62-2156" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pearson chi-squared goodness of fit test</span></span>
<span id="cb62-2157"><a href="#cb62-2157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2158"><a href="#cb62-2158" aria-hidden="true" tabindex="-1"></a>The Pearson chi-squared goodness of fit statistic is: </span>
<span id="cb62-2159"><a href="#cb62-2159" aria-hidden="true" tabindex="-1"></a>$$X^2 = \sum_{k=1}^m X_k^2$$ </span>
<span id="cb62-2160"><a href="#cb62-2160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2161"><a href="#cb62-2161" aria-hidden="true" tabindex="-1"></a>Under the null hypothesis that the model in question is correct</span>
<span id="cb62-2162"><a href="#cb62-2162" aria-hidden="true" tabindex="-1"></a>(i.e., sufficiently complex), $X^2\ \dot \sim\ \chi^2(N-p)$.</span>
<span id="cb62-2163"><a href="#cb62-2163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2166"><a href="#cb62-2166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2167"><a href="#cb62-2167" aria-hidden="true" tabindex="-1"></a>x_pearson <span class="ot">&lt;-</span> chd_glm_strat_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-2168"><a href="#cb62-2168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"pearson"</span>)</span>
<span id="cb62-2169"><a href="#cb62-2169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2170"><a href="#cb62-2170" aria-hidden="true" tabindex="-1"></a>chisq_stat <span class="ot">&lt;-</span> <span class="fu">sum</span>(x_pearson<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb62-2171"><a href="#cb62-2171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2172"><a href="#cb62-2172" aria-hidden="true" tabindex="-1"></a>pval <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(</span>
<span id="cb62-2173"><a href="#cb62-2173" aria-hidden="true" tabindex="-1"></a>  chisq_stat,</span>
<span id="cb62-2174"><a href="#cb62-2174" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="cn">FALSE</span>,</span>
<span id="cb62-2175"><a href="#cb62-2175" aria-hidden="true" tabindex="-1"></a>  <span class="at">df =</span> <span class="fu">length</span>(x_pearson) <span class="sc">-</span> <span class="fu">length</span>(<span class="fu">coef</span>(chd_glm_strat_grouped))</span>
<span id="cb62-2176"><a href="#cb62-2176" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-2177"><a href="#cb62-2177" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2178"><a href="#cb62-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2179"><a href="#cb62-2179" aria-hidden="true" tabindex="-1"></a>For our CHD model, the p-value for this test is <span class="in">`r pval`</span>; no significant</span>
<span id="cb62-2180"><a href="#cb62-2180" aria-hidden="true" tabindex="-1"></a>evidence of a lack of fit at the 0.05 level.</span>
<span id="cb62-2181"><a href="#cb62-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2182"><a href="#cb62-2182" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized Pearson residuals</span></span>
<span id="cb62-2183"><a href="#cb62-2183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2184"><a href="#cb62-2184" aria-hidden="true" tabindex="-1"></a>Especially for small data sets, we might want to adjust our residuals</span>
<span id="cb62-2185"><a href="#cb62-2185" aria-hidden="true" tabindex="-1"></a>for leverage (since outliers in $X$ add extra variance to the</span>
<span id="cb62-2186"><a href="#cb62-2186" aria-hidden="true" tabindex="-1"></a>residuals):</span>
<span id="cb62-2187"><a href="#cb62-2187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2188"><a href="#cb62-2188" aria-hidden="true" tabindex="-1"></a>$$r_{P_k} = \frac{X_k}{\sqrt{1-h_k}}$$</span>
<span id="cb62-2189"><a href="#cb62-2189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2190"><a href="#cb62-2190" aria-hidden="true" tabindex="-1"></a>where $h_k$ is the leverage of $X_k$. The functions <span class="in">`autoplot()`</span> and</span>
<span id="cb62-2191"><a href="#cb62-2191" aria-hidden="true" tabindex="-1"></a><span class="in">`plot.lm()`</span> use these for some of their graphs.</span>
<span id="cb62-2192"><a href="#cb62-2192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2193"><a href="#cb62-2193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Deviance residuals</span></span>
<span id="cb62-2194"><a href="#cb62-2194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2195"><a href="#cb62-2195" aria-hidden="true" tabindex="-1"></a>For large sample sizes, the Pearson and deviance residuals will be</span>
<span id="cb62-2196"><a href="#cb62-2196" aria-hidden="true" tabindex="-1"></a>approximately the same. For small sample sizes, the deviance residuals</span>
<span id="cb62-2197"><a href="#cb62-2197" aria-hidden="true" tabindex="-1"></a>from covariate patterns with small sample sizes can be unreliable (high</span>
<span id="cb62-2198"><a href="#cb62-2198" aria-hidden="true" tabindex="-1"></a>variance).</span>
<span id="cb62-2199"><a href="#cb62-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2200"><a href="#cb62-2200" aria-hidden="true" tabindex="-1"></a>$$d_k = \text{sign}(y_k - n_k \hat \pi_k)\left<span class="sc">\{</span>\sqrt{2<span class="co">[</span><span class="ot">\ell_{\text{full}}(x_k) - \ell(\hat\beta; x_k)</span><span class="co">]</span>}\right<span class="sc">\}</span>$$</span>
<span id="cb62-2201"><a href="#cb62-2201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2202"><a href="#cb62-2202" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Standardized deviance residuals</span></span>
<span id="cb62-2203"><a href="#cb62-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2204"><a href="#cb62-2204" aria-hidden="true" tabindex="-1"></a>$$r_{D_k} = \frac{d_k}{\sqrt{1-h_k}}$$</span>
<span id="cb62-2205"><a href="#cb62-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2206"><a href="#cb62-2206" aria-hidden="true" tabindex="-1"></a><span class="fu">### Diagnostic plots</span></span>
<span id="cb62-2207"><a href="#cb62-2207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2208"><a href="#cb62-2208" aria-hidden="true" tabindex="-1"></a>Let's take a look at the full set of <span class="in">`autoplot()`</span> diagnostics now for</span>
<span id="cb62-2209"><a href="#cb62-2209" aria-hidden="true" tabindex="-1"></a>our <span class="in">`CHD`</span> model:</span>
<span id="cb62-2210"><a href="#cb62-2210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2213"><a href="#cb62-2213" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2214"><a href="#cb62-2214" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-2215"><a href="#cb62-2215" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Diagnostics for CHD model"</span></span>
<span id="cb62-2216"><a href="#cb62-2216" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-chd-model-diagnostics</span></span>
<span id="cb62-2217"><a href="#cb62-2217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2218"><a href="#cb62-2218" aria-hidden="true" tabindex="-1"></a>chd_glm_strat_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-2219"><a href="#cb62-2219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-2220"><a href="#cb62-2220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb62-2221"><a href="#cb62-2221" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2222"><a href="#cb62-2222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2223"><a href="#cb62-2223" aria-hidden="true" tabindex="-1"></a>::: notes</span>
<span id="cb62-2224"><a href="#cb62-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2225"><a href="#cb62-2225" aria-hidden="true" tabindex="-1"></a>Things look pretty good here. The QQ plot is still usable; with large</span>
<span id="cb62-2226"><a href="#cb62-2226" aria-hidden="true" tabindex="-1"></a>samples; the residuals should be approximately Gaussian.</span>
<span id="cb62-2227"><a href="#cb62-2227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2228"><a href="#cb62-2228" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb62-2229"><a href="#cb62-2229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2230"><a href="#cb62-2230" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Beetles</span></span>
<span id="cb62-2231"><a href="#cb62-2231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2232"><a href="#cb62-2232" aria-hidden="true" tabindex="-1"></a>Let's look at the beetles model diagnostic plots for comparison:</span>
<span id="cb62-2233"><a href="#cb62-2233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2236"><a href="#cb62-2236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2237"><a href="#cb62-2237" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-2238"><a href="#cb62-2238" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-beetles-glm-diag</span></span>
<span id="cb62-2239"><a href="#cb62-2239" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Diagnostics for logistic model of `BeetleMortality` data"</span></span>
<span id="cb62-2240"><a href="#cb62-2240" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span></span>
<span id="cb62-2241"><a href="#cb62-2241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-2242"><a href="#cb62-2242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb62-2243"><a href="#cb62-2243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2244"><a href="#cb62-2244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2245"><a href="#cb62-2245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2246"><a href="#cb62-2246" aria-hidden="true" tabindex="-1"></a>Hard to tell much from so little data, but there might be some issues</span>
<span id="cb62-2247"><a href="#cb62-2247" aria-hidden="true" tabindex="-1"></a>here.</span>
<span id="cb62-2248"><a href="#cb62-2248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2249"><a href="#cb62-2249" aria-hidden="true" tabindex="-1"></a><span class="fu">## Objections to reporting odds ratios</span></span>
<span id="cb62-2250"><a href="#cb62-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2251"><a href="#cb62-2251" aria-hidden="true" tabindex="-1"></a>{{&lt; include _sec_OR_objections.qmd &gt;}}</span>
<span id="cb62-2252"><a href="#cb62-2252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2253"><a href="#cb62-2253" aria-hidden="true" tabindex="-1"></a><span class="fu">## Other link functions for Bernoulli outcomes</span></span>
<span id="cb62-2254"><a href="#cb62-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2255"><a href="#cb62-2255" aria-hidden="true" tabindex="-1"></a>If you want risk ratios, you can sometimes get them by changing the link</span>
<span id="cb62-2256"><a href="#cb62-2256" aria-hidden="true" tabindex="-1"></a>function:</span>
<span id="cb62-2257"><a href="#cb62-2257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2260"><a href="#cb62-2260" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2261"><a href="#cb62-2261" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(anthers, <span class="at">package =</span> <span class="st">"dobson"</span>)</span>
<span id="cb62-2262"><a href="#cb62-2262" aria-hidden="true" tabindex="-1"></a>anthers_sum <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb62-2263"><a href="#cb62-2263" aria-hidden="true" tabindex="-1"></a>  anthers[<span class="fu">c</span>(<span class="st">"n"</span>, <span class="st">"y"</span>)],</span>
<span id="cb62-2264"><a href="#cb62-2264" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> anthers[<span class="fu">c</span>(<span class="st">"storage"</span>)], <span class="at">FUN =</span> sum</span>
<span id="cb62-2265"><a href="#cb62-2265" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-2266"><a href="#cb62-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2267"><a href="#cb62-2267" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb62-2268"><a href="#cb62-2268" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y, n <span class="sc">-</span> y) <span class="sc">~</span> storage,</span>
<span id="cb62-2269"><a href="#cb62-2269" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> anthers_sum,</span>
<span id="cb62-2270"><a href="#cb62-2270" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"log"</span>)</span>
<span id="cb62-2271"><a href="#cb62-2271" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-2272"><a href="#cb62-2272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2273"><a href="#cb62-2273" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span></span>
<span id="cb62-2274"><a href="#cb62-2274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-2275"><a href="#cb62-2275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-2276"><a href="#cb62-2276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2277"><a href="#cb62-2277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2278"><a href="#cb62-2278" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-2279"><a href="#cb62-2279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2280"><a href="#cb62-2280" aria-hidden="true" tabindex="-1"></a>Now $\exp{\beta}$ gives us risk ratios instead of odds ratios:</span>
<span id="cb62-2281"><a href="#cb62-2281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2284"><a href="#cb62-2284" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2285"><a href="#cb62-2285" aria-hidden="true" tabindex="-1"></a>anthers_glm_log <span class="sc">|&gt;</span></span>
<span id="cb62-2286"><a href="#cb62-2286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-2287"><a href="#cb62-2287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-2288"><a href="#cb62-2288" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2289"><a href="#cb62-2289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2290"><a href="#cb62-2290" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-2291"><a href="#cb62-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2292"><a href="#cb62-2292" aria-hidden="true" tabindex="-1"></a>Let's compare this model with a logistic model:</span>
<span id="cb62-2293"><a href="#cb62-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2296"><a href="#cb62-2296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2297"><a href="#cb62-2297" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb62-2298"><a href="#cb62-2298" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> <span class="fu">cbind</span>(y, n <span class="sc">-</span> y) <span class="sc">~</span> storage,</span>
<span id="cb62-2299"><a href="#cb62-2299" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> anthers_sum,</span>
<span id="cb62-2300"><a href="#cb62-2300" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb62-2301"><a href="#cb62-2301" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-2302"><a href="#cb62-2302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2303"><a href="#cb62-2303" aria-hidden="true" tabindex="-1"></a>anthers_glm_logit <span class="sc">|&gt;</span></span>
<span id="cb62-2304"><a href="#cb62-2304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parameters</span>(<span class="at">exponentiate =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb62-2305"><a href="#cb62-2305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print_md</span>()</span>
<span id="cb62-2306"><a href="#cb62-2306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2307"><a href="#cb62-2307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2308"><a href="#cb62-2308" aria-hidden="true" tabindex="-1"></a><span class="sc">\[</span>to add: fitted plots on each outcome scale<span class="sc">\]</span></span>
<span id="cb62-2309"><a href="#cb62-2309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2310"><a href="#cb62-2310" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb62-2311"><a href="#cb62-2311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2312"><a href="#cb62-2312" aria-hidden="true" tabindex="-1"></a>When I try to use <span class="in">`link ="log"`</span> in practice, I often get errors about</span>
<span id="cb62-2313"><a href="#cb62-2313" aria-hidden="true" tabindex="-1"></a>not finding good starting values for the estimation procedure. </span>
<span id="cb62-2314"><a href="#cb62-2314" aria-hidden="true" tabindex="-1"></a>This is likely because the model is producing fitted probabilities greater than</span>
<span id="cb62-2315"><a href="#cb62-2315" aria-hidden="true" tabindex="-1"></a>1.</span>
<span id="cb62-2316"><a href="#cb62-2316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2317"><a href="#cb62-2317" aria-hidden="true" tabindex="-1"></a>When this happens, you can try to fit Poisson regression models instead</span>
<span id="cb62-2318"><a href="#cb62-2318" aria-hidden="true" tabindex="-1"></a>(we will see those soon!). </span>
<span id="cb62-2319"><a href="#cb62-2319" aria-hidden="true" tabindex="-1"></a>But then the outcome distribution isn't quite</span>
<span id="cb62-2320"><a href="#cb62-2320" aria-hidden="true" tabindex="-1"></a>right, and you won't get warnings about fitted probabilities greater</span>
<span id="cb62-2321"><a href="#cb62-2321" aria-hidden="true" tabindex="-1"></a>than 1. </span>
<span id="cb62-2322"><a href="#cb62-2322" aria-hidden="true" tabindex="-1"></a>In my opinion, the Poisson model for binary outcomes is</span>
<span id="cb62-2323"><a href="#cb62-2323" aria-hidden="true" tabindex="-1"></a>confusing and not very appealing.</span>
<span id="cb62-2324"><a href="#cb62-2324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2325"><a href="#cb62-2325" aria-hidden="true" tabindex="-1"></a><span class="fu">### WCGS: link functions</span></span>
<span id="cb62-2326"><a href="#cb62-2326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2329"><a href="#cb62-2329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2330"><a href="#cb62-2330" aria-hidden="true" tabindex="-1"></a>wcgs_glm_logit_link <span class="ot">&lt;-</span> chd_grouped_data <span class="sc">|&gt;</span></span>
<span id="cb62-2331"><a href="#cb62-2331" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">relevel</span>(dibpat, <span class="at">ref =</span> <span class="st">"Type B"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-2332"><a href="#cb62-2332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb62-2333"><a href="#cb62-2333" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(x, <span class="st">`</span><span class="at">n - x</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">*</span> age,</span>
<span id="cb62-2334"><a href="#cb62-2334" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb62-2335"><a href="#cb62-2335" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>)</span>
<span id="cb62-2336"><a href="#cb62-2336" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-2337"><a href="#cb62-2337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2338"><a href="#cb62-2338" aria-hidden="true" tabindex="-1"></a>wcgs_glm_identity_link <span class="ot">&lt;-</span></span>
<span id="cb62-2339"><a href="#cb62-2339" aria-hidden="true" tabindex="-1"></a>  chd_grouped_data <span class="sc">|&gt;</span></span>
<span id="cb62-2340"><a href="#cb62-2340" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">relevel</span>(dibpat, <span class="at">ref =</span> <span class="st">"Type B"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-2341"><a href="#cb62-2341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glm</span>(</span>
<span id="cb62-2342"><a href="#cb62-2342" aria-hidden="true" tabindex="-1"></a>    <span class="st">"formula"</span> <span class="ot">=</span> <span class="fu">cbind</span>(x, <span class="st">`</span><span class="at">n - x</span><span class="st">`</span>) <span class="sc">~</span> dibpat <span class="sc">*</span> age,</span>
<span id="cb62-2343"><a href="#cb62-2343" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data"</span> <span class="ot">=</span> _,</span>
<span id="cb62-2344"><a href="#cb62-2344" aria-hidden="true" tabindex="-1"></a>    <span class="st">"family"</span> <span class="ot">=</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"identity"</span>)</span>
<span id="cb62-2345"><a href="#cb62-2345" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-2346"><a href="#cb62-2346" aria-hidden="true" tabindex="-1"></a>wcgs_glm_identity_link <span class="sc">|&gt;</span></span>
<span id="cb62-2347"><a href="#cb62-2347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-2348"><a href="#cb62-2348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pander</span>()</span>
<span id="cb62-2349"><a href="#cb62-2349" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2350"><a href="#cb62-2350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2353"><a href="#cb62-2353" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2354"><a href="#cb62-2354" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diagnostics-glm1</span></span>
<span id="cb62-2355"><a href="#cb62-2355" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Residuals vs Fitted plot for `wcgs` models"</span></span>
<span id="cb62-2356"><a href="#cb62-2356" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb62-2357"><a href="#cb62-2357" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb62-2358"><a href="#cb62-2358" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "Logistic link"</span></span>
<span id="cb62-2359"><a href="#cb62-2359" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "Identity link"</span></span>
<span id="cb62-2360"><a href="#cb62-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2361"><a href="#cb62-2361" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)</span>
<span id="cb62-2362"><a href="#cb62-2362" aria-hidden="true" tabindex="-1"></a>wcgs_glm_logit_link <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>dibpat)</span>
<span id="cb62-2363"><a href="#cb62-2363" aria-hidden="true" tabindex="-1"></a>wcgs_glm_identity_link <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>dibpat)</span>
<span id="cb62-2364"><a href="#cb62-2364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2365"><a href="#cb62-2365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2368"><a href="#cb62-2368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-2369"><a href="#cb62-2369" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-diagnostics-beetles</span></span>
<span id="cb62-2370"><a href="#cb62-2370" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Residuals vs Fitted plot for `BeetleMortality` models"</span></span>
<span id="cb62-2371"><a href="#cb62-2371" aria-hidden="true" tabindex="-1"></a><span class="co">#| layout-ncol: 2</span></span>
<span id="cb62-2372"><a href="#cb62-2372" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-subcap:</span></span>
<span id="cb62-2373"><a href="#cb62-2373" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "Logistic link"</span></span>
<span id="cb62-2374"><a href="#cb62-2374" aria-hidden="true" tabindex="-1"></a><span class="co">#| - "Identity link"</span></span>
<span id="cb62-2375"><a href="#cb62-2375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2376"><a href="#cb62-2376" aria-hidden="true" tabindex="-1"></a>beetles_lm <span class="ot">&lt;-</span></span>
<span id="cb62-2377"><a href="#cb62-2377" aria-hidden="true" tabindex="-1"></a>  beetles_long <span class="sc">|&gt;</span></span>
<span id="cb62-2378"><a href="#cb62-2378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(<span class="at">formula =</span> died <span class="sc">~</span> dose)</span>
<span id="cb62-2379"><a href="#cb62-2379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2380"><a href="#cb62-2380" aria-hidden="true" tabindex="-1"></a>beetles <span class="ot">&lt;-</span></span>
<span id="cb62-2381"><a href="#cb62-2381" aria-hidden="true" tabindex="-1"></a>  beetles <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb62-2382"><a href="#cb62-2382" aria-hidden="true" tabindex="-1"></a>    <span class="at">resid_logit =</span> beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">resid</span>(<span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb62-2383"><a href="#cb62-2383" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-2384"><a href="#cb62-2384" aria-hidden="true" tabindex="-1"></a>beetles_glm_grouped <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb62-2385"><a href="#cb62-2385" aria-hidden="true" tabindex="-1"></a>beetles_lm <span class="sc">|&gt;</span> <span class="fu">autoplot</span>(<span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb62-2386"><a href="#cb62-2386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-2387"><a href="#cb62-2387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2388"><a href="#cb62-2388" aria-hidden="true" tabindex="-1"></a><span class="fu">## Quasibinomial</span></span>
<span id="cb62-2389"><a href="#cb62-2389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2390"><a href="#cb62-2390" aria-hidden="true" tabindex="-1"></a>See <span class="co">[</span><span class="ot">Hua Zhou</span><span class="co">](https://hua-zhou.github.io/)</span>'s <span class="co">[</span><span class="ot">lecture notes</span><span class="co">](https://ucla-biostat-200c-2020spring.github.io/slides/04-binomial/binomial.html#:~:text=0.05%20%27.%27%200.1%20%27%20%27%201-,Quasi%2Dbinomial,-Another%20way%20to)</span></span>
<span id="cb62-2391"><a href="#cb62-2391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2392"><a href="#cb62-2392" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further reading</span></span>
<span id="cb62-2393"><a href="#cb62-2393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-2394"><a href="#cb62-2394" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>@hosmer2013applied is a classic textbook on logistic regression</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 Copyright 2024, Douglas Ezra Morrison
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/d-morrison/rme/edit/main/logistic-regression.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/d-morrison/rme/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>
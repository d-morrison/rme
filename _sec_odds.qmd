{{< include macros.qmd >}}

::: notes
In logistic regression, we will make use of a mathematically-convenient transformation of probability, called *odds*.
:::

---

:::{#def-odds}
#### Odds
The **odds** of an outcome $A$, 
which we will represent using $\odds$ ("omega"), 
is the probability that the outcome occurs, 
divided by the probability that it doesn't occur:

$$\odds \eqdef \frac{\Pr(A)}{\Pr(\neg A)}$${#eq-def-odds}

:::

---


:::{#thm-prob-to-odds}
If $\prob$ is the probability of an outcome $A$
and $\odds$ is the corresponding odds of $A$, 
then:

$$\odds = \frac{\prob}{1-\prob}$${#eq-odds-prob}

:::

---

:::{.proof}

Using @def-odds and @cor-p-neg:

$$
\ba
\odds(A) &\eqdef \frac{\Pr(A)}{\Pr(\neg A)}
\\ &= \frac{\pi}{1-\pi}
\ea
$$

:::

---

:::{#def-odds-fn}
#### Odds function

The **odds function** is defined as:
$$\oddsf{\pi} \eqdef \frac{\pi}{1-\pi}$$ {#eq-def-odds-fn}

:::

---

:::{#cor-oddsf-to-odds}
If $\prob$ is the probability of an outcome $A$
and $\odds$ is the corresponding odds of $A$,
then:

$$\odds = \oddsf{\prob}$$

:::

---

::: proof

By @thm-prob-to-odds and @def-odds-fn.

:::

---

::: notes
Thus, the odds function transforms probabilities into odds. 
@fig-odds-probs graphs the shape of this function.
:::

```{r}
#| code-fold: true
#| label: fig-odds-probs
#| fig-cap: "Odds versus probability"

odds <- function(pi) pi / (1 - pi)
library(ggplot2)
ggplot() +
  geom_function(
    fun = odds,
    arrow = arrow(ends = "last"),
    mapping = aes(col = "odds function")
  ) +
  xlim(0, .99) +
  xlab("Probability") +
  ylab("Odds") +
  geom_abline(aes(
    intercept = 0,
    slope = 1,
    col = "y=x"
  )) +
  theme_bw() +
  labs(colour = "") +
  theme(legend.position = "bottom")
```

---

:::{#exm-odds}

#### Computing odds from probabilities

In @exr-probs, we estimated that the probability of MI, given OC use, is $\pi(OC) \eqdef \Pr(MI|OC) = `r 13/5000`$. If this estimate is correct, then the odds of MI, given OC use, is:

```{r}
#| include: false
pi_OC <- 13 / 5000 # nolint: object_name_linter
odds_OC <- odds(pi_OC) # nolint: object_name_linter
```


$$
\begin{aligned}
\odds(OC)
&\eqdef \frac{\Pr(MI|OC)}{\Pr(\neg MI|OC)}\\
&=\frac{\Pr(MI|OC)}{1-\Pr(MI|OC)}\\
&=\frac{\pi(OC)}{1-\pi(OC)}\\
&=\frac{`r 13/5000`}{1-`r 13/5000`}\\
&\approx `r odds_OC |> round(digits = 6) |> as.character()`
\end{aligned}
$$

:::

---

:::{#exr-odds}

#### Computing odds from probabilities

Estimate the odds of MI, for non-OC users.

::::{.solution}
```{r, include = FALSE}
pi_nOC <- 7 / 10000 # nolint: object_name_linter
odds_nOC <- pi_nOC / (1 - pi_nOC) # nolint: object_name_linter
```

$$
\odds(\neg OC) = `r odds_nOC`
$$

::::

:::

---

:::{#thm-est-odds}
#### One-sample MLE for odds

Let $X_1,...X_n$ be a set of $n$ $\iid$ Bernoulli trials, and let $X = \sumin X_i$ be their sum.

Then the maximum likelihood estimate of the odds of $X=1$, $\odds$, is:

$$
\hat{\odds}= \frac{x}{n-x}
$$

:::

---

::: proof

$$
\begin{aligned}
1-\hat\pi
&= 1-\frac{x}{n}\\
&= \frac{n}{n} - \frac{x}{n}\\
&= \frac{n - x}{n}
\end{aligned}
$$

Thus, the estimated odds is:

$$
\begin{aligned}
\frac{\hat\pi}{1-\hat\pi}
&= \frac{\left(\frac{x}{n}\right)}{\left(\frac{n-x}{n}\right)}\\
&= \frac{x}{n-x}
\end{aligned}
$$

:::: notes
That is, odds can be calculated directly as "# events" divided by "# nonevents" (without needing to calculate $\hat\pi$ and $1-\hat\pi$ first).
::::

:::

---

::::{#exm-odds-shortcut}

#### Calculating odds using the shortcut
In @exm-odds, we calculated
$$
\begin{aligned}
\odds(OC)
&=`r (13/5000)/(1- (13/5000))`
\end{aligned}
$$

Let's recalculate this result using our shortcut.

::::

---

::::{#sol-odds-shortcut}
$$
\begin{aligned}
\odds(OC)
&=\frac{13}{5000-13}\\
&=`r (13)/(5000- 13)`
\end{aligned}
$$

Same answer as in @exm-odds!

::::

---

:::{#thm-odds-simplified}

#### Simplified expressions for odds function

::: notes
Two equivalent expressions for the odds function are:
:::

$$
\ba
\oddsf{\pi} &= \frac{1}{\pi^{-1}-1}
\\ &= \invf{\pi^{-1}-1}
\ea
$$ {#eq-odds-reduced}

:::

---

:::{#exr-odds2}
Prove @thm-odds-simplified.
:::

---

:::{#sol-odds2}
Starting from @def-odds-fn:

$$
\ba
\oddsf{\pi} &= \frac{\pi}{1-\pi}
\\
&= \frac{\pi}{1-\pi}\frac{\pi^{-1}}{\pi^{-1}}
\\
&= \frac{\pi\pi^{-1}}{(1-\pi)\pi^{-1}}
\\
&= \frac{1}{(\pi^{-1}-\pi\pi^{-1})}
\\
&= \frac{1}{(\pi^{-1}-1)}
\\
&= \invf{\pi^{-1}-1}
\ea
$$

:::

---

:::{#thm-deriv-odds}
#### Derivative of odds function

$$\doddsf{\pi} = \frac{1}{\sqf{1-\pi}}$$
:::

---

::: proof
$$
\ba
\doddsf{\pi}
   &= \deriv{\pi}\paren{\frac{\pi}{1-\pi}}
\\ &=  \frac {\deriv{\pi}\pi} {1-\pi} -
       \paren{\frac{\pi}{\sqf{1-\pi}} \cd \deriv{\pi}\paren{1-\pi}}
\\ &=  \frac{1}{1-\pi} - \frac{\pi}{\sqf{1-\pi}} \cd (-1)
\\ &=  \frac{1}{1-\pi} + \frac{\pi}{\sqf{1-\pi}}
\\ &=  \frac{1-\pi}{\sqf{1-\pi}} + \frac{\pi}{\sqf{1-\pi}}
\\ &=  \frac{1-\pi + \pi}{\sqf{1-\pi}}
\\ &=  \frac{1}{\sqf{1-\pi}}
\ea
$$

:::

---

:::{#cor-d_odds-d_prob}
$$\derivf{\odds}{\prob} = \frac{1}{\sqf{1-\prob}}$$
:::

---

#### Odds of rare events

For rare events (small $\pi$), odds and probabilities are nearly equal, because $1-\pi \approx 1$ (see @fig-odds-probs).

For example, in @exm-odds, the probability and odds differ by $`r abs(pi_OC - odds_OC)`$.

---

:::{#exr-odds-probs}

What odds value corresponds to the probability $\pi = 0.2$, and what is the numerical difference between these two values?

:::

---

::::{.solution}
$$
\odds = \frac{\pi}{1-\pi}
=\frac{.2}{.8}
= .25
$$
::::

---

:::{#thm-odds-minus-probs}

Let $\odds = \frac{\pi}{1-\pi}$. Then:

$$\odds - \pi =  \odds \cd \pi$$

:::

---

:::{#exr-odds-minus-probs}

Prove @thm-odds-minus-probs.

:::

---

::: solution

$$
\ba
\odds - \pi
&= \frac{\pi}{1-\pi} - \pi
\\ &= \frac{\pi}{1-\pi} - \frac{\pi(1-\pi)}{1-\pi}
\\ &= \frac{\pi}{1-\pi} - \frac{\pi - \pi^2}{1-\pi}
\\ &= \frac{\pi - (\pi - \pi^2)}{1-\pi}
\\ &= \frac{\pi - \pi + \pi^2}{1-\pi}
\\ &= \frac{\pi^2}{1-\pi}
\\ &= \frac{\pi}{1-\pi} \pi
\\ &= \odds \pi
\ea
$$

:::

---

:::{#lem-odds-neg}
#### Odds of a non-event

If $\pi$ is the odds of event $A$
and $\odds$ is the corresponding odds of $A$,
then the odds of $\neg A$ are:

$$
\ba
\odds(\neg A) &= \frac{1-\pi}{\pi}
\\&= \pi^{-1}-1
\ea
$$

:::

::: proof
Left to the reader.
:::

---


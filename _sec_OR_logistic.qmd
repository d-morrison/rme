{{< include macros.qmd >}}

:::{#exr-logistic-OR-general}


For the logistic regression model:

- $Y_i|\vX_i \simind \Ber(\pi(\vX_i))$
- $\pi(\vx) = \expitf{\vx'\vb}$

Consider two covariate patterns, $\vx$ and $\vxs$,
representing 
two individuals 
or two subpopulations.

Find a concise expression for the odds ratio comparing covariate patterns $\vx$ and $\vxs$:

$$\or(\vx,\vxs) \eqdef \frac{\odds(\vx)}{\odds(\vxs)}$$

:::

---

:::{#sol-logistic-OR}

$$
\ba
\or(\vx,\vxs) 
&\eqdef \frac{\odds(\vx)}{\odds(\vxs)}
\\ 
&= \frac{\expf{\logodds(\vx)}}{\expf{\logodds(\vxs)}}
\\
&= \expf{\red{\logodds(\vx) - \logodds(\vxs)}}
\ea
$$

Now, let:

$$
\ba
\red{\difflogodds} 
&\eqdef \red{\logodds(\vx) - \logodds(\vxs)}
\\
\blue{\diffvx} &\eqdef \blue{\vx - \vxs}
\ea
$$

Then:

:::{#lem-diff-logodds}

$$
\ba
\red{\difflogodds}
&\eqdef \red{\logodds(\vx) - \logodds(\vxs)}
\\
&= (\vx\cd\vb) - (\vxs\cd\vb)
\\
&= (\vx\'\vb) - (\vxs\'\vb)
\\
&= (\vx\' - \vxs\')\vb
\\
&= (\vx - \vxs)\'\vb
\\
&= (\blue{\vx - \vxs})\cdot\vb
\\
&= (\blue{\diffvx}) \cdot \vb
\ea
$$

:::

So:

:::{#thm-logistic-OR}

The odds ratio comparing covariate patterns $\vx$ and $\vxs$ is:

{{< include _eq_OR_delta.qmd >}}

:::

:::

---

:::{#cor-log-or}

$$\logf {\or(\vx,\vxs)} = \difflogodds$$

:::

---

:::{#exr-ci-OR}
Given 
a maximum likelihood estimate $\hb$ 
and 
a corresponding estimated covariance matrix $\hS \eqdef \hat{\Covt}(\hb)$, calculate a 95% confidence interval for the odds ratio comparing covariate patterns $\vx$ and $\vxs$, $\or(\vx,\vxs)$.
:::

---

:::{#sol-ci-OR}
By the invariance property of MLEs, 
we can first calculate a 95% confidence interval for the log of the odds ratio, 
$\logf{\or(\vx,\vxs)} = \difflogodds$,
and then exponentiate the endpoints of that log-odds-scale confidence interval.
:::

---

:::{#exr-or-diff-logodds}

Find a 95% confidence interval for the log of the odds ratio, 
$\logf{\or(\vx,\vxs)} = \difflogodds$

:::

---

:::{#sol-or-diff-logodds}

By @thm-dist-mle,
a 95% confidence interval for the log of the odds ratio, 
$\logf{\or(\vx,\vxs)} = \difflogodds$, 
can be constructed as:

$$\widehat{\difflogodds} \pm 1.96 * \hse{\widehat{\difflogodds}}$$

:::

---

:::{#exr-se-diff-logodds}

::: notes
Find an expression for the standard error of 
$\Delta{\hat\logodds} \eqdef \hat{\logodds}(\vx) - \hat{\logodds}(\vxs)$
in terms of $\hb$ and $\Sigma \eqdef \Covt(\hb)$ (the variance-covariance matrix of $\hb$) .
:::

$$\hse{\difflogodds} = ?$$

:::

---

:::{#sol-se-diff-logodds}

$$\SE{\Delta \hat \logodds} = \sqrt{\Var{\Delta \hat \logodds}}$$

By @lem-diff-logodds and @thm-var-lincom:

$$
\ba
\Var{\Delta \hat \logodds}
&= 
\Var{(\diffvx) \cdot \hb}
\\
&= \Var{(\diffvx) \cdot \hb}
\\
&= \tp{\diffvx}\Var{\hb}(\diffvx)
\\
&= \tp{\diffvx}\Sigma(\diffvx)
\\
&= \sumip\sumjp (\diffvx)_i \Sigma_{ij} (\diffvx)_j
\\
&= \sumip\sumjp (\Delta x_i) \Sigma_{ij} (\Delta x_j)
\\
&= \sumip\sumjp (x_i - x^*_i) \Covt(\hb_i,\hb_j) (x_j - x^*_j)
\ea
$$

:::

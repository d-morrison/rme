:::{#tbl-beetles-model-grouped}

```{r}
#| label: beetles-model-grouped-tbl

library(glmx)
library(dplyr)
data(BeetleMortality)
beetles <- BeetleMortality |>
  mutate(
    pct = died / n,
    survived = n - died
  )

beetles_glm_grouped <-
  beetles |>
  glm(
    formula = cbind(died, survived) ~ dose,
    family = "binomial"
  )

library(parameters)
beetles_glm_grouped |>
  parameters() |>
  print_md()
```

logistic regression model for beetles data with grouped (binomial) data

:::

---

#### Fitted values

Fitted values are provided on the probability scale (@tbl-beetles-model-fitted-values)

```{r}
#| label: tbl-beetles-model-fitted-values
#| code-fold: show

fitted(beetles_glm_grouped)
predict(beetles_glm_grouped, type = "response")
```

---

#### Count scale

For grouped data, 
we can convert to the count scale by multiplying by the group size:

```{r}
beetles$n * fitted(beetles_glm_grouped)
```

---


#### Logit scale

```{r}
predict(beetles_glm_grouped, type = "link")

```

---

Converting between logit and probability scales works as expected:

```{R}
predict(beetles_glm_grouped, type = "link") |> arm::invlogit()
predict(beetles_glm_grouped, type = "response")

predict(beetles_glm_grouped, type = "response") |> arm::logit()
predict(beetles_glm_grouped, type = "link")
```

---

`type = "terms"` is confusing, because the variables get centered:

```{r}
predict(beetles_glm_grouped, type = "terms")
coef(beetles_glm_grouped)["dose"] * beetles$dose
```

---

We can construct the link-scale predictions from the terms:

```{r}
terms_pred <- predict(beetles_glm_grouped, type = "terms")
terms_pred + attr(terms_pred, "constant")
predict(beetles_glm_grouped, type = "link")
```

---

#### Individual observations

```{r}
#| tbl-cap: "`beetles` data in long format"
#| label: tbl-beetles-long

beetles_long
```

---

:::{#tbl-beetles-model-ungrouped}

```{r}
#| label: beetles-ungrouped-param-ests
beetles_glm_ungrouped <-
  beetles_long |>
  glm(
    formula = outcome ~ dose,
    family = "binomial"
  )

beetles_glm_ungrouped |>
  parameters() |>
  print_md()
```

logistic regression model for beetles data with individual Bernoulli data

:::

:::{#exr-compare-grouped-ungrouped}
Compare this model with the grouped-observations model (@tbl-beetles-model-grouped).
:::

---

:::{#sol-compare-grouped-ungrouped}

::: notes
They seem the same! But not quite:
:::

```{r}
#| code-fold: show
logLik(beetles_glm_grouped)
logLik(beetles_glm_ungrouped)
```

::: notes
The difference is due to the binomial coefficient
$\left(n\atop x \right)$ which isn't included in the
individual-observations (Bernoulli) version of the model.
:::

:::

{
  "hash": "3e84345539d7bf1f6f5a7f8b69ec42fa",
  "result": {
    "engine": "knitr",
    "markdown": "# Parametric survival models\n\n---\n\n\n<!-- ::: {.content-hidden when-format=\"revealjs\"} -->\n\n---\n\n### Configuring R {.unnumbered}\n\nFunctions from these packages will be used throughout this document:\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(conflicted) # check for conflicting function definitions\n# library(printr) # inserts help-file output into markdown output\nlibrary(rmarkdown) # Convert R Markdown documents into a variety of formats.\nlibrary(pander) # format tables for markdown\nlibrary(ggplot2) # graphics\nlibrary(ggeasy) # help with graphics\nlibrary(ggfortify) # help with graphics\nlibrary(dplyr) # manipulate data\nlibrary(tibble) # `tibble`s extend `data.frame`s\nlibrary(magrittr) # `%>%` and other additional piping tools\nlibrary(haven) # import Stata files\nlibrary(knitr) # format R output for markdown\nlibrary(tidyr) # Tools to help to create tidy data\nlibrary(plotly) # interactive graphics\nlibrary(dobson) # datasets from Dobson and Barnett 2018\nlibrary(parameters) # format model output tables for markdown\nlibrary(haven) # import Stata files\nlibrary(latex2exp) # use LaTeX in R code (for figures and tables)\nlibrary(fs) # filesystem path manipulations\nlibrary(survival) # survival analysis\nlibrary(survminer) # survival analysis graphics\nlibrary(KMsurv) # datasets from Klein and Moeschberger\nlibrary(parameters) # format model output tables for\nlibrary(webshot2) # convert interactive content to static for pdf\nlibrary(forcats) # functions for categorical variables (\"factors\")\nlibrary(stringr) # functions for dealing with strings\nlibrary(lubridate) # functions for dealing with dates and times\n```\n:::\n\n\n\n\n\n\n\nHere are some R settings I use in this document:\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(list = ls()) # delete any data that's already loaded into R\n\nconflicts_prefer(dplyr::filter)\nggplot2::theme_set(\n  ggplot2::theme_bw() + \n        # ggplot2::labs(col = \"\") +\n    ggplot2::theme(\n      legend.position = \"bottom\",\n      text = ggplot2::element_text(size = 12, family = \"serif\")))\n\nknitr::opts_chunk$set(message = FALSE)\noptions('digits' = 4)\n\npanderOptions(\"big.mark\", \",\")\npander::panderOptions(\"table.emphasize.rownames\", FALSE)\npander::panderOptions(\"table.split.table\", Inf)\nconflicts_prefer(dplyr::filter) # use the `filter()` function from dplyr() by default\nlegend_text_size = 9\n```\n:::\n\n\n\n\n\n\n\n<!-- ::: -->\n\n\n\n\\providecommand{\\cbl}[1]{\\left\\{#1\\right.}\n\\providecommand{\\cb}[1]{\\left\\{#1\\right\\}}\n\\providecommand{\\paren}[1]{\\left(#1\\right)}\n\\providecommand{\\sb}[1]{\\left[#1\\right]}\n\\def\\pr{\\text{p}}\n\\def\\am{\\arg \\max}\n\\def\\argmax{\\arg \\max}\n\\def\\p{\\text{p}}\n\\def\\P{\\text{P}}\n\\def\\ph{\\hat{\\text{p}}}\n\\def\\hp{\\hat{\\text{p}}}\n\\def\\ga{\\alpha}\n\\def\\b{\\beta}\n\\providecommand{\\floor}[1]{\\left \\lfloor{#1}\\right \\rfloor}\n\\providecommand{\\ceiling}[1]{\\left \\lceil{#1}\\right \\rceil}\n\\providecommand{\\ceil}[1]{\\left \\lceil{#1}\\right \\rceil}\n\\def\\Ber{\\text{Ber}}\n\\def\\Bernoulli{\\text{Bernoulli}}\n\\def\\Pois{\\text{Pois}}\n\\def\\Poisson{\\text{Poisson}}\n\\def\\Gaus{\\text{Gaussian}}\n\\def\\Normal{\\text{N}}\n\\def\\NB{\\text{NegBin}}\n\\def\\NegBin{\\text{NegBin}}\n\\def\\vbeta{\\vec \\beta}\n\\def\\vb{\\vec \\b}\n\\def\\v0{\\vec{0}}\n\\def\\gb{\\beta}\n\\def\\gg{\\gamma}\n\\def\\gd{\\delta}\n\\def\\eps{\\varepsilon}\n\\def\\om{\\omega}\n\\def\\m{\\mu}\n\\def\\s{\\sigma}\n\\def\\l{\\lambda}\n\\def\\gs{\\sigma}\n\\def\\gm{\\mu}\n\\def\\M{\\text{M}}\n\\def\\gM{\\text{M}}\n\\def\\Mu{\\text{M}}\n\\def\\cd{\\cdot}\n\\def\\cds{\\cdots}\n\\def\\lds{\\ldots}\n\\def\\eqdef{\\stackrel{\\text{def}}{=}}\n\\def\\defeq{\\stackrel{\\text{def}}{=}}\n\\def\\hb{\\hat \\beta}\n\\def\\hl{\\hat \\lambda}\n\\def\\hy{\\hat y}\n\\def\\yh{\\hat y}\n\\def\\V{{\\text{Var}}}\n\\def\\hs{\\hat \\sigma}\n\\def\\hsig{\\hat \\sigma}\n\\def\\hS{\\hat \\Sigma}\n\\def\\hSig{\\hat \\Sigma}\n\\def\\hSigma{\\hat \\Sigma}\n\\def\\hSurv{\\hat{S}}\n\\providecommand{\\hSurvf}[1]{\\hat{S}\\paren{#1}}\n\\def\\dist{\\ \\sim \\ }\n\\def\\ddist{\\ \\dot{\\sim} \\ }\n\\def\\dsim{\\ \\dot{\\sim} \\ }\n\\def\\za{z_{1 - \\frac{\\alpha}{2}}}\n\\def\\cirad{\\za \\cdot \\hse{\\hb}}\n\\def\\ci{\\hb {\\color{red}\\pm} \\cirad}\n\\def\\th{\\theta}\n\\def\\Th{\\Theta}\n\\def\\xbar{\\bar{x}}\n\\def\\hth{\\hat\\theta}\n\\def\\hthml{\\hth_{\\text{ML}}}\n\\def\\ba{\\begin{aligned}}\n\\def\\ea{\\end{aligned}}\n\\def\\ind{тлл}\n\\def\\indpt{тлл}\n\\def\\all{\\forall}\n\\def\\iid{\\text{iid}}\n\\def\\ciid{\\text{ciid}}\n\\def\\simind{\\ \\sim_{\\ind}\\ }\n\\def\\siid{\\ \\sim_{\\iid}\\ }\n\\def\\simiid{\\siid}\n\\def\\distiid{\\siid}\n\\def\\tf{\\therefore}\n\\def\\Lik{\\mathcal{L}}\n\\def\\llik{\\ell}\n\\providecommand{\\llikf}[1]{\\llik \\paren{#1}}\n\\def\\score{\\ell'}\n\\providecommand{\\scoref}[1]{\\score \\paren{#1}}\n\\def\\hess{\\ell''}\n\\def\\hessian{\\ell''}\n\\providecommand{\\hessf}[1]{\\hess \\paren{#1}}\n\\providecommand{\\hessianf}[1]{\\hess \\paren{#1}}\n\\providecommand{\\starf}[1]{#1^*}\n\\def\\lik{\\ell}\n\\providecommand{\\est}[1]{\\widehat{#1}}\n\\providecommand{\\esttmp}[1]{{\\widehat{#1}}^*}\n\\def\\esttmpl{\\esttmp{\\lambda}}\n\\def\\cR{\\mathcal{R}}\n\\def\\range{\\mathcal{R}}\n\\def\\Range{\\mathcal{R}}\n\\providecommand{\\rangef}[1]{\\cR(#1)}\n\\def\\~{\\approx}\n\\def\\dapp{\\dot\\approx}\n\\providecommand{\\red}[1]{{\\color{red}#1}}\n\\providecommand{\\deriv}[1]{\\frac{\\partial}{\\partial #1}}\n\\providecommand{\\derivf}[2]{\\frac{\\partial #1}{\\partial #2}}\n\\providecommand{\\blue}[1]{{\\color{blue}#1}}\n\\providecommand{\\green}[1]{{\\color{green}#1}}\n\\providecommand{\\hE}[1]{\\hat{\\text{E}}\\sb{#1}}\n\\providecommand{\\hExp}[1]{\\hat{\\text{E}}\\sb{#1}}\n\\providecommand{\\hmu}[1]{\\hat{\\mu}\\sb{#1}}\n\\def\\Expp{\\mathbb{E}}\n\\def\\Ep{\\mathbb{E}}\n\\def\\expit{\\text{expit}}\n\\providecommand{\\expitf}[1]{\\expit\\cb{#1}}\n\\providecommand{\\dexpitf}[1]{\\expit'\\cb{#1}}\n\\def\\logit{\\text{logit}}\n\\providecommand{\\logitf}[1]{\\logit\\cb{#1}}\n\\providecommand{\\E}[1]{\\mathbb{E}\\sb{#1}}\n\\providecommand{\\Ef}[1]{\\mathbb{E}\\sb{#1}}\n\\providecommand{\\Exp}[1]{\\mathbb{E}\\sb{#1}}\n\\providecommand{\\Expf}[1]{\\mathbb{E}\\sb{#1}}\n\\def\\Varr{\\text{Var}}\n\\providecommand{\\var}[1]{\\text{Var}\\paren{#1}}\n\\providecommand{\\varf}[1]{\\text{Var}\\paren{#1}}\n\\providecommand{\\Var}[1]{\\text{Var}\\paren{#1}}\n\\providecommand{\\Varf}[1]{\\text{Var}\\paren{#1}}\n\\def\\Covt{\\text{Cov}}\n\\providecommand{\\covh}[1]{\\widehat{\\text{Cov}}\\paren{#1}}\n\\providecommand{\\Cov}[1]{\\Covt \\paren{#1}}\n\\providecommand{\\Covf}[1]{\\Covt \\paren{#1}}\n\\def\\varht{\\widehat{\\text{Var}}}\n\\providecommand{\\varh}[1]{\\varht\\paren{#1}}\n\\providecommand{\\varhf}[1]{\\varht\\paren{#1}}\n\\providecommand{\\vc}[1]{\\boldsymbol{#1}}\n\\providecommand{\\sd}[1]{\\text{sd}\\paren{#1}}\n\\providecommand{\\SD}[1]{\\text{SD}\\paren{#1}}\n\\providecommand{\\hSD}[1]{\\widehat{\\text{SD}}\\paren{#1}}\n\\providecommand{\\se}[1]{\\text{se}\\paren{#1}}\n\\providecommand{\\hse}[1]{\\hat{\\text{se}}\\paren{#1}}\n\\providecommand{\\SE}[1]{\\text{SE}\\paren{#1}}\n\\providecommand{\\HSE}[1]{\\widehat{\\text{SE}}\\paren{#1}}\n\\renewcommand{\\log}[1]{\\text{log}\\cb{#1}}\n\\providecommand{\\logf}[1]{\\text{log}\\cb{#1}}\n\\def\\dlog{\\text{log}'}\n\\providecommand{\\dlogf}[1]{\\dlog \\cb{#1}}\n\\renewcommand{\\exp}[1]{\\text{exp}\\cb{#1}}\n\\providecommand{\\expf}[1]{\\exp{#1}}\n\\def\\dexp{\\text{exp}'}\n\\providecommand{\\dexpf}[1]{\\dexp \\cb{#1}}\n\\providecommand{\\e}[1]{\\text{e}^{#1}}\n\\providecommand{\\ef}[1]{\\text{e}^{#1}}\n\\providecommand{\\inv}[1]{\\paren{#1}^{-1}}\n\\providecommand{\\invf}[1]{\\paren{#1}^{-1}}\n\\def\\oinf{I}\n\\def\\Nat{\\mathbb{N}}\n\\providecommand{\\oinff}[1]{\\oinf\\paren{#1}}\n\\def\\einf{\\mathcal{I}}\n\\providecommand{\\einff}[1]{\\einf\\paren{#1}}\n\\def\\heinf{\\hat{\\einf}}\n\\providecommand{\\heinff}[1]{\\heinf \\paren{#1}}\n\\providecommand{\\1}[1]{\\mathbb{1}_{#1}}\n\\providecommand{\\set}[1]{\\cb{#1}}\n\\providecommand{\\pf}[1]{\\p \\paren{#1}}\n\\providecommand{\\Bias}[1]{\\text{Bias}\\paren{#1}}\n\\providecommand{\\bias}[1]{\\text{Bias}\\paren{#1}}\n\\def\\ss{\\sigma^2}\n\\providecommand{\\ssqf}[1]{\\sigma^2\\paren{#1}}\n\\providecommand{\\mselr}[1]{\\text{MSE}\\paren{#1}}\n\\providecommand{\\maelr}[1]{\\text{MAE}\\paren{#1}}\n\\providecommand{\\abs}[1]{\\left|#1\\right|}\n\\providecommand{\\sqf}[1]{\\paren{#1}^2}\n\\providecommand{\\sq}{^2}\n\\def\\err{\\eps}\n\\providecommand{\\erf}[1]{\\err\\paren{#1}}\n\\renewcommand{\\vec}[1]{\\tilde{#1}}\n\\providecommand{\\v}[1]{\\vec{#1}}\n\\providecommand{\\matr}[1]{\\mathbf{#1}}\n\\def\\mX{\\matr{X}}\n\\def\\mx{\\matr{x}}\n\\def\\vx{\\vec{x}}\n\\def\\vX{\\vec{X}}\n\\def\\vy{\\vec{y}}\n\\def\\vY{\\vec{Y}}\n\\def\\vpi{\\vec{\\pi}}\n\\providecommand{\\mat}[1]{\\mathbf{#1}}\n\\providecommand{\\dsn}[1]{#1_1, \\ldots, #1_n}\n\\def\\X1n{\\dsn{X}}\n\\def\\Xin{\\dsn{X}}\n\\def\\x1n{\\dsn{x}}\n\\def\\'{^{\\top}}\n\\def\\dpr{\\cdot}\n\\def\\Xx1n{X_1=x_1, \\ldots, X_n = x_n}\n\\providecommand{\\dsvn}[2]{#1_1=#2_1, \\ldots, #1_n = #2_n}\n\\providecommand{\\sumn}[1]{\\sum_{#1=1}^n}\n\\def\\sumin{\\sum_{i=1}^n}\n\\def\\sumi1n{\\sum_{i=1}^n}\n\\def\\prodin{\\prod_{i=1}^n}\n\\def\\prodi1n{\\prod_{i=1}^n}\n\\providecommand{\\lp}[2]{#1 \\' \\beta}\n\\def\\odds{\\omega}\n\\def\\OR{\\text{OR}}\n\\def\\logodds{\\eta}\n\\def\\oddst{\\text{odds}}\n\\def\\probst{\\text{probs}}\n\\def\\probt{\\text{probt}}\n\\def\\probit{\\text{probit}}\n\\providecommand{\\oddsf}[1]{\\oddst\\cb{#1}}\n\\providecommand{\\doddsf}[1]{{\\oddst}'\\cb{#1}}\n\\def\\oddsinv{\\text{invodds}}\n\\providecommand{\\oddsinvf}[1]{\\oddsinv\\cb{#1}}\n\\def\\invoddsf{\\oddsinvf}\n\\providecommand{\\doddsinvf}[1]{{\\oddsinv}'\\cb{#1}}\n\\def\\dinvoddsf{\\doddsinvf}\n\\def\\haz{h}\n\\def\\cuhaz{H}\n\\def\\incidence{\\bar{\\haz}}\n\\def\\phaz{\\Expf{\\haz}}\n\n\n\n\n\n\n\n\n\n```{=html}\n<style>\n.quarto-figure-center > figure {\ntext-align: center;\n}\n</style>\n```\n\n\n\n\n\n\n\n\n\n## Parametric Survival Models\n\n### Exponential Distribution\n\n-   The exponential distribution is the basic distribution for survival\n    analysis.\n\n$$\n\\begin{aligned} \nf(t) &= \\lambda e^{-\\lambda t}\\\\\n\\log{f(t)} &= \\log{\\lambda}-\\lambda t\\\\\nF(t) &= 1-e^{-\\lambda t}\\\\\nS(t)&= e^{-\\lambda t}\\\\\nH(t) &= \\log{S(t)}\n\\\\   &= -\\lambda t\\\\\nh(t) &= \\lambda\\\\\n\\text{E}(T) &= \\lambda^{-1}\n\\end{aligned}\n$$\n\n### Weibull Distribution\n\nUsing the Kalbfleisch and Prentice (2002) notation:\n\n$$\n\\begin{aligned}\nf(t)&= \\lambda p (\\lambda t)^{p-1}e^{-(\\lambda t)^p}\\\\\nF(t)&=1 - e^{-(\\lambda t)^p}\\\\\nS(t)&=e^{-(\\lambda t)^p}\\\\\nh(t)&=\\lambda p (\\lambda t)^{p-1}\\\\\nH(t)&=(\\lambda t)^p\\\\\n\\log{H(t)} &= p \\log{\\lambda t} \n\\\\ &= p \\log{\\lambda} + p \\log{t}\n\\\\ \\text{E}(T) &= \\lambda^{-1} \\cdot \\Gamma\\left(1 + \\frac{1}{p}\\right)\n\\end{aligned}\n$$\n\n::: callout-note\nRecall from calculus:\n\n-   $\\Gamma(t) \\stackrel{\\text{def}}{=}\\int_{u=0}^{\\infty}u^{t-1}e^{-u}du$\n\n-   $\\Gamma(t) = (t-1)!$ for integers $t \\in \\mathbb Z$\n\n-   It is implemented by the `gamma()` function in R.\n\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](parametric-survival-models_files/figure-pdf/unnamed-chunk-3-1.pdf)\n:::\n:::\n\n\n\n\n\n\n\n:::\n\nHere are some Weibull density functions, with $\\lambda = 1$ and $p$\nvarying:\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlambda = 1\nggplot() +\n  geom_function(\n    aes(col = \"0.25\"),\n    fun = \\(x) dweibull(x, shape = 0.25, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"0.5\"),\n    fun = \\(x) dweibull(x, shape = 0.5, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"1\"),\n    fun = \\(x) dweibull(x, shape = 1, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"1.5\"),\n    fun = \\(x) dweibull(x, shape = 1.5, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"2\"),\n    fun = \\(x) dweibull(x, shape = 2, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"5\"),\n    fun = \\(x) dweibull(x, shape = 5, scale = 1/lambda)) +\n  theme_bw() + \n  xlim(0, 2.5) +\n  ylab(\"f(t)\") +\n  theme(axis.title.y = element_text(angle=0)) +\n  theme(legend.position=\"bottom\") +\n  guides(\n    col = \n      guide_legend(\n        title = \"p\",\n        label.theme = \n          element_text(\n            size = 12)))\n```\n\n::: {.cell-output-display}\n![Density functions for Weibull distribution](parametric-survival-models_files/figure-pdf/unnamed-chunk-4-1.pdf)\n:::\n:::\n\n\n\n\n\n\n\n\n#### Properties of Weibull hazard functions\n\n:::{#thm-weibull-props}\n\nIf $T$ has a Weibull distribution, then:\n\n-   When $p=1$, the Weibull distribution simplifies to the exponential\n    distribution\n-   When $p > 1$, the hazard is increasing: $h'(t) > 0$\n-   When $p < 1$, the hazard is decreasing: $h'(t) < 0$\n-   $\\log{H(t)}$ is a straight line relative to $\\log{t}$: \n$\\log{H(t)} = p \\log{\\lambda} + p \\log{t}$\n\n:::\n\n---\n\n:::{#exr-weibull}\n\nProve @thm-weibull-props.\n \n:::\n\n---\n\n::: notes\nThe Weibull distribution provides more flexibility than the exponential.\n@fig-exm-weibull-hazards shows some Weibull hazard functions, \nwith $\\lambda = 1$ and $p$ varying:\n:::\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(eha)\nlambda = 1\n\nggplot() +\n  geom_function(\n    aes(col = \"0.25\"),\n    fun = \\(x) hweibull(x, shape = 0.25, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"0.5\"),\n    fun = \\(x) hweibull(x, shape = 0.5, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"1\"),\n    fun = \\(x) hweibull(x, shape = 1, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"1.5\"),\n    fun = \\(x) hweibull(x, shape = 1.5, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"2\"),\n    fun = \\(x) hweibull(x, shape = 2, scale = 1/lambda)) +\n  theme_bw() + \n  xlim(0, 2.5) + \n  ylab(\"h(t)\") +\n  theme(axis.title.y = element_text(angle=0)) +\n  theme(legend.position=\"bottom\") +\n  guides(\n    col = \n      guide_legend(\n        title = \"p\",\n        label.theme = \n          element_text(\n            size = 12)))\n```\n\n::: {.cell-output-display}\n![Hazard functions for Weibull distribution](parametric-survival-models_files/figure-pdf/fig-exm-weibull-hazards-1.pdf){#fig-exm-weibull-hazards}\n:::\n:::\n\n\n\n\n\n\n\n\n---\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlambda = 1\n\nggplot() +\n  geom_function(\n    aes(col = \"0.25\"),\n    fun = \\(x) pweibull(lower = FALSE, x, shape = 0.25, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"0.5\"),\n    fun = \\(x) pweibull(lower = FALSE, x, shape = 0.5, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"1\"),\n    fun = \\(x) pweibull(lower = FALSE, x, shape = 1, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"1.5\"),\n    fun = \\(x) pweibull(lower = FALSE, x, shape = 1.5, scale = 1/lambda)) +\n  geom_function(\n    aes(col = \"2\"),\n    fun = \\(x) pweibull(lower = FALSE, x, shape = 2, scale = 1/lambda)) +\n  theme_bw() + \n  xlim(0, 2.5) + \n  ylab(\"S(t)\") +\n  theme(axis.title.y = element_text(angle=0)) +\n  theme(legend.position=\"bottom\") +\n  guides(\n    col = \n      guide_legend(\n        title = \"p\",\n        label.theme = \n          element_text(\n            size = 12)))\n```\n\n::: {.cell-output-display}\n![Survival functions for Weibull distribution](parametric-survival-models_files/figure-pdf/fig-surv-weibull-1.pdf){#fig-surv-weibull}\n:::\n:::\n\n\n\n\n\n\n\n\n### Exponential Regression\n\nFor each subject $i$, define a linear predictor:\n\n$$\n\\begin{aligned}\n\\eta(\\boldsymbol x) &= \\beta_0 + (\\beta_1x_1 + \\dots + \\beta_p x_p)\\\\\nh(t|\\boldsymbol x) &= \\exp{\\eta(\\boldsymbol x)}\\\\\nh_0 &\\stackrel{\\text{def}}{=} h(t|\\boldsymbol 0)\\\\\n&= \\exp{\\eta(\\boldsymbol 0)}\\\\\n&= \\exp{\\beta_0 + (\\beta_1 \\cdot 0 + \\dots + \\beta_p \\cdot 0)}\\\\\n&= \\exp{\\beta_0 + 0}\\\\\n&= \\exp{\\beta_0}\\\\\n\\end{aligned}\n$$\n\nWe let the linear predictor have a constant term, and when there are no\nadditional predictors the hazard is $\\lambda = \\exp{\\beta_0}$. This has\na log link as in a generalized linear model. Since the hazard does not\ndepend on $t$, the hazards are (trivially) proportional.\n\n### Accelerated Failure Time\n\nPreviously, we assumed the hazards were proportional; that is, the\ncovariates multiplied the baseline hazard function:\n\n$$\n\\begin{aligned}\nh(T=t|X=x) \n&\\stackrel{\\text{def}}{=} p(T=t|X=x,T \\ge t)\\\\\n&= h(t|X=0)\\cdot \\exp{\\eta(x)}\\\\\n&= h(t|X=0)\\cdot \\theta(x)\\\\\n&= h_0(t)\\cdot \\theta(x)\n\\end{aligned}\n$$\n\nand correspondingly,\n\n$$\n\\begin{aligned}\nH(t|x)\n&= \\theta(x)H_0(t)\\\\\nS(t|x)\n&= \\exp{-H(t|x)}\\\\\n&= \\exp{-\\theta(x)\\cdot H_0(t)}\\\\\n&= \\left(\\exp{- H_0(t)}\\right)^{\\theta(x)}\\\\\n&= \\left(S_0(t)\\right)^{\\theta(x)}\\\\\n\\end{aligned}\n$$\n\nAn alternative modeling assumption would be\n$$S(t|X=x)=S_0(t\\cdot \\theta(x))$$ where $\\theta(x)=\\exp{\\eta(x)}$,\n$\\eta(x) =\\beta_1x_1+\\cdots+\\beta_px_p$, and $S_0(t)=P(T\\ge t|X=0)$ is\nthe base survival function.\n\nThen\n\n$$\n\\begin{aligned}\nE(T|X=x)\n&= \\int_{t=0}^{\\infty} S(t|x)dt\\\\\n&= \\int_{t=0}^{\\infty} S_0(t\\cdot \\theta(x))dt\\\\\n&= \\int_{u=0}^{\\infty} S_0(u)du \\cdot \\theta(x)^{-1}\\\\\n&= \\theta(x)^{-1} \\cdot \\int_{u=0}^{\\infty} S_0(u)du\\\\\n&= \\theta(x)^{-1} \\cdot \\text{E}(T|X=0)\\\\\n\\end{aligned}\n$$ So the mean of $T$ given $X=x$ is the baseline mean divided by\n$\\theta(x) = \\exp{\\eta(x)}$.\n\nThis modeling strategy is called an accelerated failure time model,\nbecause covariates cause uniform acceleration (or slowing) of failure\ntimes.\n\nAdditionally:\n\n$$\n\\begin{aligned}\nH(t|x) &= H_0(\\theta(x)\\cdot t)\\\\\nh(t|x) &= \\theta(x) \\cdot h_0(\\theta(x)\\cdot t)\n\\end{aligned}\n$$\n\nIf the base distribution is exponential with parameter $\\lambda$ then\n\n$$\n\\begin{aligned}\nS(t|x)\n&= \\exp{-\\lambda \\cdot t \\theta(x)}\\\\\n&= [\\exp{-\\lambda t}]^{\\theta(x)}\\\\\n\\end{aligned}\n$$\n\nwhich is an exponential model with base hazard multiplied by\n$\\theta(x)$, which is also the proportional hazards model.\n\n::: hidden\nIn terms of the log survival time $Y=\\log{T}$ the model can be written\nas\n\n$$\n\\begin{aligned}\nY&=\\alpha-\\eta+W\\\\\n\\alpha&= -\\log{\\lambda}\n\\end{aligned}\n$$\n\nwhere $W$ has the extreme value distribution. The estimated parameter\n$\\lambda$ is the intercept and the other coefficients are those of\n$\\eta$, which will be the opposite sign of those for coxph.\n:::\n\nFor a Weibull distribution, the hazard function and the survival\nfunction are\n\n$$\n\\begin{aligned}\nh(t)&=\\lambda p (\\lambda t)^{p-1}\\\\\nS(t)&=e^{-(\\lambda t)^p}\n\\end{aligned}\n$$\n\nWe can construct a proportional hazards model by using a linear\npredictor $\\eta_i$ without constant term and letting\n$\\theta_i=e^{\\eta_i}$ we have\n\n$$\n\\begin{aligned}\nh(t)&=\\lambda p (\\lambda t)^{p-1}\\theta_i\n\\end{aligned}\n$$\n\nA distribution with $h(t)=\\lambda p (\\lambda t)^{p-1}\\theta_i$ is a\nWeibull distribution with parameters $\\lambda^*=\\lambda \\theta_i^{1/p}$\nand $p$ so the survival function is\n\n$$\n\\begin{aligned}\nS^*(t)&=e^{-(\\lambda^* t)^p}\\\\\n&=e^{-(\\lambda \\theta^{1/p} t)^p}\\\\\n&= S(t\\theta^{1/p})\n\\end{aligned}\n$$\n\nso this is also an accelerated failure time model.\n\n::: hidden\nIn terms of the log survival time $Y=\\log{T}$ the model can be written\nas\n\n$$\n\\begin{aligned}\nY&=\\alpha-\\sigma\\eta+\\sigma W\\\\\n\\alpha&= -\\log{\\lambda}\\\\\n\\sigma &= 1/p\n\\end{aligned}\n$$\n\nwhere $W$ has the extreme value distribution. The estimated parameter\n$\\lambda$ is the intercept and the other coefficients are those of\n$\\eta$, which will be the opposite sign of those for `coxph`.\n:::\n\nThese AFT models are log-linear, meaning that the linear predictor has a\nlog link. The exponential and the Weibull are the only log-linear models\nthat are simultaneously proportional hazards models. Other parametric\ndistributions can be used for survival regression either as a\nproportional hazards model or as an accelerated failure time model.\n\n### Dataset: Leukemia treatments\n\nRemission survival times on 42 leukemia patients, half on new treatment,\nhalf on standard treatment.\n\nThis is the same data as the `drug6mp` data from KMsurv, but with two\nother variables and without the pairing.\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(haven)\nlibrary(survival)\nanderson = \n  paste0(\n    \"http://web1.sph.emory.edu/dkleinb/allDatasets\",\n    \"/surv2datasets/anderson.dta\") |> \n  read_dta() |> \n  mutate(\n    status = status |> \n      case_match(\n        1 ~ \"relapse\",\n        0 ~ \"censored\"\n      ),\n    sex = sex |> \n      case_match(\n        0 ~ \"female\",\n        1 ~ \"male\"\n      ),\n    \n    rx = rx |> \n      case_match(\n        0 ~ \"new\",\n        1 ~ \"standard\"\n      ),\n    \n    surv = Surv(time = survt,event = (status == \"relapse\"))\n  ) \n\nprint(anderson)\n```\n:::\n\n\n\n\n\n\n\n\n\n\n#### Cox semi-parametric model\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nanderson.cox0 = coxph(\n  formula = surv ~ rx,\n  data = anderson)\nsummary(anderson.cox0)\n#> Call:\n#> coxph(formula = surv ~ rx, data = anderson)\n#> \n#>   n= 42, number of events= 30 \n#> \n#>             coef exp(coef) se(coef)    z Pr(>|z|)    \n#> rxstandard 1.572     4.817    0.412 3.81  0.00014 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#>            exp(coef) exp(-coef) lower .95 upper .95\n#> rxstandard      4.82      0.208      2.15      10.8\n#> \n#> Concordance= 0.69  (se = 0.041 )\n#> Likelihood ratio test= 16.4  on 1 df,   p=5e-05\n#> Wald test            = 14.5  on 1 df,   p=1e-04\n#> Score (logrank) test = 17.2  on 1 df,   p=3e-05\n```\n:::\n\n\n\n\n\n\n\n\n#### Weibull parametric model\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanderson.weib <- survreg(\n  formula = surv ~ rx,\n  data = anderson,\n  dist = \"weibull\")\nsummary(anderson.weib)\n#> \n#> Call:\n#> survreg(formula = surv ~ rx, data = anderson, dist = \"weibull\")\n#>              Value Std. Error     z       p\n#> (Intercept)  3.516      0.252 13.96 < 2e-16\n#> rxstandard  -1.267      0.311 -4.08 4.5e-05\n#> Log(scale)  -0.312      0.147 -2.12   0.034\n#> \n#> Scale= 0.732 \n#> \n#> Weibull distribution\n#> Loglik(model)= -106.6   Loglik(intercept only)= -116.4\n#> \tChisq= 19.65 on 1 degrees of freedom, p= 9.3e-06 \n#> Number of Newton-Raphson Iterations: 5 \n#> n= 42\n```\n:::\n\n\n\n\n\n\n\n\n#### Exponential parametric model\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanderson.exp <- survreg(\n  formula = surv ~ rx,\n  data = anderson,\n  dist = \"exp\")\nsummary(anderson.exp)\n#> \n#> Call:\n#> survreg(formula = surv ~ rx, data = anderson, dist = \"exp\")\n#>              Value Std. Error     z       p\n#> (Intercept)  3.686      0.333 11.06 < 2e-16\n#> rxstandard  -1.527      0.398 -3.83 0.00013\n#> \n#> Scale fixed at 1 \n#> \n#> Exponential distribution\n#> Loglik(model)= -108.5   Loglik(intercept only)= -116.8\n#> \tChisq= 16.49 on 1 degrees of freedom, p= 4.9e-05 \n#> Number of Newton-Raphson Iterations: 4 \n#> n= 42\n```\n:::\n\n\n\n\n\n\n\n\n#### Diagnostic - complementary log-log survival plot\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(survminer)\nsurvfit(\n  formula = surv ~ rx,\n  data = anderson) |> \n  ggsurvplot(fun = \"cloglog\")\n```\n\n::: {.cell-output-display}\n![](parametric-survival-models_files/figure-pdf/unnamed-chunk-12-1.pdf)\n:::\n:::\n\n\n\n\n\n\n\n\nIf the cloglog plot is linear, then a Weibull model may be ok.\n\n## Combining left-truncation and interval-censoring\n\nFrom [https://stat.ethz.ch/pipermail/r-help/2015-August/431733.html]:\n\n> coxph does left truncation but not left (or interval) censoring\n> survreg does interval censoring but not left truncation (or time dependent covariates).\n\n - Terry Therneau, August 31, 2015\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}
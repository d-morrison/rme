::: notes
@fig-rd-rr-or compares risk differences, risk ratios, and odds ratios
as functions of the underlying probabilities being compared.
:::

:::{#fig-rd-rr-or}

```{R}

if (run_graph) {
  
  RD <- function(p1, p2) p1 - p2
  RR <- function(p1, p2) p1/p2
  odds <- function(p) p/(1-p)
  OR <- function(p1, p2) odds(p1) / odds(p2)
  OR_minus_RR <- function(p1, p2) OR(p1, p2) - RR(p1, p2)
  
  n_ticks <- 201
  # probs <- c(10^-(3:1), seq(.02, .25, by = .02))
  # probs <- 10^seq(-4, log10(.99), length.out = n_ticks)
  probs <- seq(.001, .99, length.out = n_ticks)
  RD_mat <- outer(probs, probs, RD)
  RR_mat <- outer(probs, probs, RR)
  OR_mat <- outer(probs, probs, OR)
  OR_minus_RR_mat <- outer(probs, probs, OR_minus_RR)
  to_erase1 <- outer(probs, probs, `<`)
  to_erase3 <- abs(OR_mat) > Inf
  to_erase4 <- abs(RR_mat) > Inf
  to_erase <-
    to_erase1 |
    to_erase3 | 
    to_erase4
  RD_mat[to_erase1] = NA
  RR_mat[to_erase1 | to_erase4] = NA
  OR_mat[to_erase1 | to_erase3] = NA
  OR_minus_RR_mat[to_erase] = NA
  
  opacity = .9
  
  plotly::plot_ly(
    x = ~probs,
    y = ~probs
  ) |>
    plotly::add_surface(
      z = ~ t(RD_mat),
      name = "RD",
      showscale = FALSE,
      opacity = .5,
      colorscale = list(c(0, 1), c("green", "green"))
    ) |>
    plotly::add_surface(
      opacity = .5,
      colorscale = list(c(0, 1), c("red", "red")),
      z = ~ t(RR_mat),
      showscale = FALSE,
      name = "RR"
    ) |>
    plotly::add_surface(
      opacity = .5,
      colorscale = list(c(0, 1), c("blue", "blue")),
      z = ~ t(OR_mat),
      showscale = FALSE,
      name = "OR"
    ) |>
    plotly::layout(
      scene = list(
        xaxis = list(
          # type = "log",
          title = "pi_1"
        ),
        yaxis = list(
          # type = "log",
          title = "pi_2"
        ),
        zaxis = list(
          # type = "log",
          range = c(0, 5),
          title = "comparison metric"
        ),
        # camera = list(eye = list(x = -1.25, y = -1.25)),
        aspectratio = list(x = .9, y = .8, z = 0.7)

      )
    )
  
}
```

Graph of risk difference, risk ratio, and odds ratio

:::
